<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MongoDB | 小朱杂记</title>
    <meta name="description" content="My Document">
    <link rel="preload stylesheet" href="/charles-blog/assets/style.ae2285a1.css" as="style">
    <script type="module" src="/charles-blog/assets/app.7c064305.js"></script>
    <link rel="preload" href="/charles-blog/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
  <link rel="modulepreload" href="/charles-blog/assets/chunks/framework.981adca9.js">
  <link rel="modulepreload" href="/charles-blog/assets/chunks/theme.9dbacb91.js">
  <link rel="modulepreload" href="/charles-blog/assets/chunks/ArticleMetadata.8b6b367a.js">
  <link rel="modulepreload" href="/charles-blog/assets/md_database_MongoDB.md.ed78548e.lean.js">
  <link rel="icon" href="/charles-blog/favicon.ico">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-fc105c82><!--[--><!--]--><!--[--><span tabindex="-1" data-v-827f7975></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-827f7975> Skip to content </a><!--]--><!----><header class="VPNav" data-v-fc105c82 data-v-4765fb17><div class="VPNavBar has-sidebar" data-v-4765fb17 data-v-c560f0cd><div class="container" data-v-c560f0cd><div class="title" data-v-c560f0cd><div class="VPNavBarTitle has-sidebar" data-v-c560f0cd data-v-ebec4beb><a class="title" href="/charles-blog/" data-v-ebec4beb><!--[--><!--]--><!----><!--[-->小朱杂记<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-c560f0cd><div class="curtain" data-v-c560f0cd></div><div class="content-body" data-v-c560f0cd><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-c560f0cd><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-c560f0cd data-v-8a05be25><span id="main-nav-aria-label" class="visually-hidden" data-v-8a05be25>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/java/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->Java<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/charles-blog/md/database/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->数据库<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/middleware/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->中间件<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/network/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->网络<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/environment/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->环境<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/distributed/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->分布式<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/about/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->关于我<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-c560f0cd data-v-7489216d><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-7489216d data-v-c852f474 data-v-43044c5b><span class="check" data-v-43044c5b><span class="icon" data-v-43044c5b><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-c852f474><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-c852f474><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-c560f0cd data-v-46915da0 data-v-5e7b6306><!--[--><a class="VPSocialLink" href="https://github.com/CharleZhuJJ/charles-blog" aria-label="github" target="_blank" rel="noopener" data-v-5e7b6306 data-v-5124df20><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-c560f0cd data-v-0f46c100 data-v-fa61944e><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-fa61944e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-fa61944e><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-fa61944e><div class="VPMenu" data-v-fa61944e data-v-4eba600d><!----><!--[--><!--[--><!----><div class="group" data-v-0f46c100><div class="item appearance" data-v-0f46c100><p class="label" data-v-0f46c100>切换日光/暗黑模式</p><div class="appearance-action" data-v-0f46c100><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-0f46c100 data-v-c852f474 data-v-43044c5b><span class="check" data-v-43044c5b><span class="icon" data-v-43044c5b><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-c852f474><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-c852f474><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-0f46c100><div class="item social-links" data-v-0f46c100><div class="VPSocialLinks social-links-list" data-v-0f46c100 data-v-5e7b6306><!--[--><a class="VPSocialLink" href="https://github.com/CharleZhuJJ/charles-blog" aria-label="github" target="_blank" rel="noopener" data-v-5e7b6306 data-v-5124df20><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-c560f0cd data-v-05cc2436><span class="container" data-v-05cc2436><span class="top" data-v-05cc2436></span><span class="middle" data-v-05cc2436></span><span class="bottom" data-v-05cc2436></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-fc105c82 data-v-c9d1ee7c><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-c9d1ee7c><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-c9d1ee7c><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-c9d1ee7c>文章</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-c9d1ee7c data-v-43a3820c><button data-v-43a3820c>返回顶部</button><!----></div></div><aside class="VPSidebar" data-v-fc105c82 data-v-def99251><div class="curtain" data-v-def99251></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-def99251><span class="visually-hidden" id="sidebar-aria-label" data-v-def99251> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-def99251><section class="VPSidebarItem level-0 is-link has-active" data-v-def99251 data-v-94aa024f><div class="item" tabindex="0" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/database/" data-v-94aa024f data-v-a8e5736d><!--[--><h2 class="text" data-v-94aa024f>数据库</h2><!--]--><!----></a><!----></div><div class="items" data-v-94aa024f><!--[--><div class="VPSidebarItem level-1 is-link" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/database/Mysql.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>MySQL</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/database/Oracle.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>Oracle</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/database/Redis.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>Redis</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/database/ElkStack.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>ELK Stack</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link is-active has-active" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/database/MongoDB.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>MongoDB</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/database/Cache.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>缓存</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-fc105c82 data-v-6c89610d><div class="VPDoc has-sidebar has-aside" data-v-6c89610d data-v-462c643b><!--[--><!--]--><div class="container" data-v-462c643b><div class="aside" data-v-462c643b><div class="aside-curtain" data-v-462c643b></div><div class="aside-container" data-v-462c643b><div class="aside-content" data-v-462c643b><div class="VPDocAside" data-v-462c643b data-v-eda16060><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-eda16060 data-v-5a905545><div class="content" data-v-5a905545><div class="outline-marker" data-v-5a905545></div><div class="outline-title" data-v-5a905545>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-5a905545><span class="visually-hidden" id="doc-outline-aria-label" data-v-5a905545> Table of Contents for current page </span><ul class="root" data-v-5a905545 data-v-ce114d19><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-eda16060></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-462c643b><div class="content-container" data-v-462c643b><!--[--><!--]--><!----><main class="main" data-v-462c643b><div style="position:relative;" class="vp-doc _charles-blog_md_database_MongoDB" data-v-462c643b><div><h1 id="mongodb" tabindex="-1">MongoDB <a class="header-anchor" href="#mongodb" aria-label="Permalink to &quot;MongoDB&quot;">​</a></h1><!----><p>  MongoDB中的记录是一个文档，它是一个由字段和值对（field:value）组成的数据结构。</p><p>  MongoDB文档类似于JSON对象，即一个文档认为就是一个对象。字段的数据类型是字符型，它的值除了使用基本的一些类型外，还可以包括其他文档、普通数组和文档数组。</p><p>  对于这样的数据，我们更适合使用MongoDB来实现数据的存储：</p><ol><li>数据量大；</li><li>写入操作频繁（读写都很频繁）；</li><li>价值较低的数据，对事务性要求不高。 <img src="/charles-blog/assets/Mongo_mysql.e1c608c9.png" alt="Mongo&amp;mysql"></li></ol><p>  MongoDB的最小存储单位就是文档(document)对象。文档对象对应于关系型数据库的行。数据在MongoDB中以BSON（Binary-JSON）的格式存储在磁盘。</p><h2 id="登陆mongo客户端" tabindex="-1">登陆mongo客户端 <a class="header-anchor" href="#登陆mongo客户端" aria-label="Permalink to &quot;登陆mongo客户端&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 进入mongo安装目录，进入bin目录</span></span>
<span class="line"><span style="color:#F69D50;">./mongo</span></span>
<span class="line"><span style="color:#768390;"># 或者</span></span>
<span class="line"><span style="color:#F69D50;">./mongo</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">-u</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">root</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">-p</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">root</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 或者登陆后，在admin数据库下进行超级用户的登录验证 </span></span>
<span class="line"><span style="color:#F69D50;">db.auth(“root”,”root″</span><span style="color:#ADBAC7;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 进入mongo安装目录，进入bin目录</span></span>
<span class="line"><span style="color:#6F42C1;">./mongo</span></span>
<span class="line"><span style="color:#6A737D;"># 或者</span></span>
<span class="line"><span style="color:#6F42C1;">./mongo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-u</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 或者登陆后，在admin数据库下进行超级用户的登录验证 </span></span>
<span class="line"><span style="color:#6F42C1;">db.auth(“root”,”root″</span><span style="color:#24292E;">)</span></span></code></pre></div><h2 id="数据库的操作" tabindex="-1">数据库的操作 <a class="header-anchor" href="#数据库的操作" aria-label="Permalink to &quot;数据库的操作&quot;">​</a></h2><h3 id="_1、选择和创建数据库" tabindex="-1">1、选择和创建数据库 <a class="header-anchor" href="#_1、选择和创建数据库" aria-label="Permalink to &quot;1、选择和创建数据库&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 选择和创建数据库的语法格式，如果数据库不存在则自动创建</span></span>
<span class="line"><span style="color:#F69D50;">use</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">`</span><span style="color:#F69D50;">数据库名称</span><span style="color:#96D0FF;">`</span></span>
<span class="line"><span style="color:#768390;"># 例如，以下语句创建 articledb 数据库：</span></span>
<span class="line"><span style="color:#F69D50;">use</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">articledb</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 注意: 在MongoDB中，集合只有在内容插入后才会创建! </span></span>
<span class="line"><span style="color:#768390;"># 就是说，创建集合(数据表)后要再插入一个文档(记录)，集合才会真正创建。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 数据库名可以是满足以下条件的任意UTF-8字符串。</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;"># 不能是空字符串（ &quot;&quot;)。</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;"># 不得含有 &#39; &#39;（空格)、.、$、/、\和\0 (空字符)。</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;"># 应全部小写。</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;"># 最多64字节。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 有一些数据库名是保留的，可以直接访问这些有特殊作用的数据库。</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;"># admin ： 从权限的角度来看，这是&quot;root&quot;数据库。要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限。一些特定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器。</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;"># local: 这个数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合。</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;"># config : 当Mongo用于分片设置时，config数据库在内部使用，用于保存分片的相关信息。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 选择和创建数据库的语法格式，如果数据库不存在则自动创建</span></span>
<span class="line"><span style="color:#6F42C1;">use</span><span style="color:#24292E;"> </span><span style="color:#032F62;">`</span><span style="color:#6F42C1;">数据库名称</span><span style="color:#032F62;">`</span></span>
<span class="line"><span style="color:#6A737D;"># 例如，以下语句创建 articledb 数据库：</span></span>
<span class="line"><span style="color:#6F42C1;">use</span><span style="color:#24292E;"> </span><span style="color:#032F62;">articledb</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 注意: 在MongoDB中，集合只有在内容插入后才会创建! </span></span>
<span class="line"><span style="color:#6A737D;"># 就是说，创建集合(数据表)后要再插入一个文档(记录)，集合才会真正创建。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 数据库名可以是满足以下条件的任意UTF-8字符串。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 不能是空字符串（ &quot;&quot;)。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 不得含有 &#39; &#39;（空格)、.、$、/、\和\0 (空字符)。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 应全部小写。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 最多64字节。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 有一些数据库名是保留的，可以直接访问这些有特殊作用的数据库。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># admin ： 从权限的角度来看，这是&quot;root&quot;数据库。要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限。一些特定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># local: 这个数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># config : 当Mongo用于分片设置时，config数据库在内部使用，用于保存分片的相关信息。</span></span></code></pre></div><h3 id="_2、查看有权限查看的所有的数据库命令" tabindex="-1">2、查看有权限查看的所有的数据库命令 <a class="header-anchor" href="#_2、查看有权限查看的所有的数据库命令" aria-label="Permalink to &quot;2、查看有权限查看的所有的数据库命令&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">show</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">dbs</span></span>
<span class="line"><span style="color:#F69D50;">或</span></span>
<span class="line"><span style="color:#F69D50;">show</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">databases</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dbs</span></span>
<span class="line"><span style="color:#6F42C1;">或</span></span>
<span class="line"><span style="color:#6F42C1;">show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">databases</span></span></code></pre></div><h3 id="_3、查看当前正在使用的数据库命令" tabindex="-1">3、查看当前正在使用的数据库命令 <a class="header-anchor" href="#_3、查看当前正在使用的数据库命令" aria-label="Permalink to &quot;3、查看当前正在使用的数据库命令&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">db</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">db</span></span></code></pre></div><h3 id="_4、删除数据库" tabindex="-1">4、删除数据库 <a class="header-anchor" href="#_4、删除数据库" aria-label="Permalink to &quot;4、删除数据库&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 语法格式如下，主要用来删除已经持久化的数据库</span></span>
<span class="line"><span style="color:#DCBDFB;">db.dropDatabase</span><span style="color:#ADBAC7;">()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 语法格式如下，主要用来删除已经持久化的数据库</span></span>
<span class="line"><span style="color:#6F42C1;">db.dropDatabase</span><span style="color:#24292E;">()</span></span></code></pre></div><h2 id="集合的操作" tabindex="-1">集合的操作 <a class="header-anchor" href="#集合的操作" aria-label="Permalink to &quot;集合的操作&quot;">​</a></h2><h3 id="_1、创建集合" tabindex="-1">1、创建集合 <a class="header-anchor" href="#_1、创建集合" aria-label="Permalink to &quot;1、创建集合&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 集合，类似关系型数据库中的表；可以显示的创建，也可以隐式的创建。</span></span>
<span class="line"><span style="color:#768390;"># 集合的显式创建：（name: 要创建的集合名称）</span></span>
<span class="line"><span style="color:#F69D50;">db.createCollection(name</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#768390;"># 例如：创建一个名为 mycollection 的普通集合。</span></span>
<span class="line"><span style="color:#F69D50;">db.createCollection(</span><span style="color:#F69D50;">&quot;mycollection&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 集合的隐式创建:</span></span>
<span class="line"><span style="color:#768390;"># 当向一个集合中插入一个文档的时候，如果集合不存在，则会自动创建集合。</span></span>
<span class="line"><span style="color:#768390;"># 通常我们使用隐式创建文档即可</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 集合的命名规范：</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;"># 集合名不能是空字符串 &quot;&quot;。</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;"># 集合名不能含有 \0字符（空字符)，这个字符表示集合名的结尾。</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;"># 集合名不能以 &quot;system.&quot;开头，这是为系统集合保留的前缀。</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;"># 用户创建的集合名字不能含有保留字符。有些驱动程序的确支持在集合名里面包含，这是因为某些系统生成的集合中包含该字符。除非你要访问这种系统创建的集合，否则千万不要在名字里出现$。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 集合，类似关系型数据库中的表；可以显示的创建，也可以隐式的创建。</span></span>
<span class="line"><span style="color:#6A737D;"># 集合的显式创建：（name: 要创建的集合名称）</span></span>
<span class="line"><span style="color:#6F42C1;">db.createCollection(name</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;"># 例如：创建一个名为 mycollection 的普通集合。</span></span>
<span class="line"><span style="color:#6F42C1;">db.createCollection(</span><span style="color:#6F42C1;">&quot;mycollection&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 集合的隐式创建:</span></span>
<span class="line"><span style="color:#6A737D;"># 当向一个集合中插入一个文档的时候，如果集合不存在，则会自动创建集合。</span></span>
<span class="line"><span style="color:#6A737D;"># 通常我们使用隐式创建文档即可</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 集合的命名规范：</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 集合名不能是空字符串 &quot;&quot;。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 集合名不能含有 \0字符（空字符)，这个字符表示集合名的结尾。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 集合名不能以 &quot;system.&quot;开头，这是为系统集合保留的前缀。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 用户创建的集合名字不能含有保留字符。有些驱动程序的确支持在集合名里面包含，这是因为某些系统生成的集合中包含该字符。除非你要访问这种系统创建的集合，否则千万不要在名字里出现$。</span></span></code></pre></div><h3 id="_2、查看当前库中的集合" tabindex="-1">2、查看当前库中的集合 <a class="header-anchor" href="#_2、查看当前库中的集合" aria-label="Permalink to &quot;2、查看当前库中的集合&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">show</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">collections</span></span>
<span class="line"><span style="color:#F69D50;">或</span></span>
<span class="line"><span style="color:#F69D50;">show</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">tables</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">collections</span></span>
<span class="line"><span style="color:#6F42C1;">或</span></span>
<span class="line"><span style="color:#6F42C1;">show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tables</span></span></code></pre></div><h3 id="_3、删除集合" tabindex="-1">3、删除集合 <a class="header-anchor" href="#_3、删除集合" aria-label="Permalink to &quot;3、删除集合&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 集合的删除，如果成功删除选定集合，则 drop() 方法返回 true，否则返回 false。</span></span>
<span class="line"><span style="color:#DCBDFB;">db.collection.drop</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"><span style="color:#ADBAC7;">或</span></span>
<span class="line"><span style="color:#ADBAC7;">db.集合.drop() </span></span>
<span class="line"><span style="color:#768390;"># 例如：要删除mycollection集合</span></span>
<span class="line"><span style="color:#DCBDFB;">db.mycollection.drop</span><span style="color:#ADBAC7;">()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 集合的删除，如果成功删除选定集合，则 drop() 方法返回 true，否则返回 false。</span></span>
<span class="line"><span style="color:#6F42C1;">db.collection.drop</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">或</span></span>
<span class="line"><span style="color:#24292E;">db.集合.drop() </span></span>
<span class="line"><span style="color:#6A737D;"># 例如：要删除mycollection集合</span></span>
<span class="line"><span style="color:#6F42C1;">db.mycollection.drop</span><span style="color:#24292E;">()</span></span></code></pre></div><h2 id="文档的操作" tabindex="-1">文档的操作 <a class="header-anchor" href="#文档的操作" aria-label="Permalink to &quot;文档的操作&quot;">​</a></h2><h3 id="_1、单个文档插入" tabindex="-1">1、单个文档插入 <a class="header-anchor" href="#_1、单个文档插入" aria-label="Permalink to &quot;1、单个文档插入&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 使用insert() 或 save() 方法向集合中插入文档，语法如下</span></span>
<span class="line"><span style="color:#F69D50;">db.collection.insert(</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&lt;</span><span style="color:#F69D50;">document</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">or</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">array</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">of</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">document</span><span style="color:#ADBAC7;">s</span><span style="color:#F47067;">&gt;</span><span style="color:#96D0FF;">,</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 要插入到集合中的文档或文档数组。（(json格式）</span></span>
<span class="line"><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F69D50;">writeConcern:</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&lt;</span><span style="color:#96D0FF;">documen</span><span style="color:#ADBAC7;">t</span><span style="color:#F47067;">&gt;</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F69D50;">ordered:</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&lt;</span><span style="color:#96D0FF;">boolea</span><span style="color:#ADBAC7;">n</span><span style="color:#F47067;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;"> }</span></span>
<span class="line"><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 要向comment的集合(表)中插入一条测试数据</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.insert(</span><span style="color:#ADBAC7;">{&quot;</span><span style="color:#F69D50;">articleid</span><span style="color:#F69D50;">&quot;:&quot;</span><span style="color:#F69D50;">100000</span><span style="color:#F69D50;">&quot;,&quot;</span><span style="color:#F69D50;">content</span><span style="color:#F69D50;">&quot;:&quot;</span><span style="color:#F69D50;">今天天气真好，阳光明媚</span><span style="color:#F69D50;">&quot;,&quot;</span><span style="color:#F69D50;">userid</span><span style="color:#F69D50;">&quot;:&quot;</span><span style="color:#F69D50;">1001</span><span style="color:#F69D50;">&quot;,&quot;</span><span style="color:#F69D50;">nickname</span><span style="color:#F69D50;">&quot;:&quot;</span><span style="color:#F69D50;">Rose</span><span style="color:#F69D50;">&quot;,</span></span>
<span class="line"><span style="color:#F69D50;">&quot;</span><span style="color:#F69D50;">createdatetime</span><span style="color:#F69D50;">&quot;:new Date(),&quot;</span><span style="color:#F69D50;">likenum</span><span style="color:#F69D50;">&quot;:NumberInt(10),&quot;</span><span style="color:#F69D50;">state</span><span style="color:#F69D50;">&quot;:null})   </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F69D50;"># 执行后，如下，说明插入一个数据成功了。</span></span>
<span class="line"><span style="color:#F69D50;">WriteResult({ &quot;</span><span style="color:#F69D50;">nInserted</span><span style="color:#F69D50;">&quot; : 1 })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F69D50;"># 文档键命名规范：</span></span>
<span class="line"><span style="color:#F69D50;">    # 键不能含有 \0 (空字符)。这个字符用来表示键的结尾。</span></span>
<span class="line"><span style="color:#F69D50;">    # .和</span><span style="color:#ADBAC7;">$有特别的意义</span><span style="color:#F69D50;">，只有在特定环境下才能使用。</span></span>
<span class="line"><span style="color:#F69D50;">    # 以下划线 &quot;</span><span style="color:#F69D50;">_</span><span style="color:#F69D50;">&quot;开头的键是保留的(不是严格要求的)。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F69D50;"># 提示</span></span>
<span class="line"><span style="color:#F69D50;">    # comment集合如果不存在，则会隐式创建</span></span>
<span class="line"><span style="color:#F69D50;">    # mongo中的数字，默认情况下是double类型，如果要存整型，必须使用函数NumberInt(整型数字)，否则取出来就有问题了。</span></span>
<span class="line"><span style="color:#F69D50;">    # 插入当前日期使用 new Date()</span></span>
<span class="line"><span style="color:#F69D50;">    # 插入的数据没有指定 _id ，会自动生成主键值</span></span>
<span class="line"><span style="color:#F69D50;">    # 如果某字段没值，可以赋值为null，或不写该字段。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 使用insert() 或 save() 方法向集合中插入文档，语法如下</span></span>
<span class="line"><span style="color:#6F42C1;">db.collection.insert(</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#6F42C1;">document</span><span style="color:#24292E;"> </span><span style="color:#032F62;">or</span><span style="color:#24292E;"> </span><span style="color:#032F62;">array</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">document</span><span style="color:#24292E;">s</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 要插入到集合中的文档或文档数组。（(json格式）</span></span>
<span class="line"><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">writeConcern:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">documen</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">ordered:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">boolea</span><span style="color:#24292E;">n</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;"> }</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 要向comment的集合(表)中插入一条测试数据</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.insert(</span><span style="color:#24292E;">{&quot;</span><span style="color:#6F42C1;">articleid</span><span style="color:#6F42C1;">&quot;:&quot;</span><span style="color:#6F42C1;">100000</span><span style="color:#6F42C1;">&quot;,&quot;</span><span style="color:#6F42C1;">content</span><span style="color:#6F42C1;">&quot;:&quot;</span><span style="color:#6F42C1;">今天天气真好，阳光明媚</span><span style="color:#6F42C1;">&quot;,&quot;</span><span style="color:#6F42C1;">userid</span><span style="color:#6F42C1;">&quot;:&quot;</span><span style="color:#6F42C1;">1001</span><span style="color:#6F42C1;">&quot;,&quot;</span><span style="color:#6F42C1;">nickname</span><span style="color:#6F42C1;">&quot;:&quot;</span><span style="color:#6F42C1;">Rose</span><span style="color:#6F42C1;">&quot;,</span></span>
<span class="line"><span style="color:#6F42C1;">&quot;</span><span style="color:#6F42C1;">createdatetime</span><span style="color:#6F42C1;">&quot;:new Date(),&quot;</span><span style="color:#6F42C1;">likenum</span><span style="color:#6F42C1;">&quot;:NumberInt(10),&quot;</span><span style="color:#6F42C1;">state</span><span style="color:#6F42C1;">&quot;:null})   </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;"># 执行后，如下，说明插入一个数据成功了。</span></span>
<span class="line"><span style="color:#6F42C1;">WriteResult({ &quot;</span><span style="color:#6F42C1;">nInserted</span><span style="color:#6F42C1;">&quot; : 1 })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;"># 文档键命名规范：</span></span>
<span class="line"><span style="color:#6F42C1;">    # 键不能含有 \0 (空字符)。这个字符用来表示键的结尾。</span></span>
<span class="line"><span style="color:#6F42C1;">    # .和</span><span style="color:#24292E;">$有特别的意义</span><span style="color:#6F42C1;">，只有在特定环境下才能使用。</span></span>
<span class="line"><span style="color:#6F42C1;">    # 以下划线 &quot;</span><span style="color:#6F42C1;">_</span><span style="color:#6F42C1;">&quot;开头的键是保留的(不是严格要求的)。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;"># 提示</span></span>
<span class="line"><span style="color:#6F42C1;">    # comment集合如果不存在，则会隐式创建</span></span>
<span class="line"><span style="color:#6F42C1;">    # mongo中的数字，默认情况下是double类型，如果要存整型，必须使用函数NumberInt(整型数字)，否则取出来就有问题了。</span></span>
<span class="line"><span style="color:#6F42C1;">    # 插入当前日期使用 new Date()</span></span>
<span class="line"><span style="color:#6F42C1;">    # 插入的数据没有指定 _id ，会自动生成主键值</span></span>
<span class="line"><span style="color:#6F42C1;">    # 如果某字段没值，可以赋值为null，或不写该字段。</span></span></code></pre></div><h4 id="参数" tabindex="-1">参数 <a class="header-anchor" href="#参数" aria-label="Permalink to &quot;参数&quot;">​</a></h4><p><img src="/charles-blog/assets/DocumentParameter.058be931.png" alt="DocumentParameter"></p><h4 id="注意" tabindex="-1">注意 <a class="header-anchor" href="#注意" aria-label="Permalink to &quot;注意&quot;">​</a></h4><ul><li>文档中的键/值对是有序的。</li><li>文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档)。</li><li>MongoDB区分类型和大小写。</li><li>MongoDB的文档不能有重复的键。</li><li>文档的键是字符串。除了少数例外情况，键可以使用任意UTF-8字符。</li></ul><h3 id="_2、批量插入文档" tabindex="-1">2、批量插入文档 <a class="header-anchor" href="#_2、批量插入文档" aria-label="Permalink to &quot;2、批量插入文档&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">db.collection.insertMany(</span></span>
<span class="line"><span style="color:#ADBAC7;"> [ </span><span style="color:#F47067;">&lt;</span><span style="color:#ADBAC7;">document </span><span style="color:#F47067;">1&gt;</span><span style="color:#ADBAC7;"> , </span><span style="color:#F47067;">&lt;</span><span style="color:#ADBAC7;">document </span><span style="color:#F47067;">2&gt;</span><span style="color:#ADBAC7;">, ... ]</span><span style="color:#F69D50;">,</span></span>
<span class="line"><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">   </span><span style="color:#F69D50;">writeConcern:</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&lt;</span><span style="color:#96D0FF;">documen</span><span style="color:#ADBAC7;">t</span><span style="color:#F47067;">&gt;</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">   </span><span style="color:#F69D50;">ordered:</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&lt;</span><span style="color:#96D0FF;">boolea</span><span style="color:#ADBAC7;">n</span><span style="color:#F47067;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;"> }</span></span>
<span class="line"><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 示例：</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.insertMany([</span></span>
<span class="line"><span style="color:#ADBAC7;"> {</span><span style="color:#F69D50;">&quot;_id&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;1&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;articleid&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;100001&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;content&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我</span></span>
<span class="line"><span style="color:#F69D50;">他。&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;userid&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;1002&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;nickname&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;相忘于江湖&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;createdatetime&quot;</span><span style="color:#F69D50;">:new</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">Date</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">&quot;2019-08-</span></span>
<span class="line"><span style="color:#F69D50;">05T22:08:15.522Z&quot;</span><span style="color:#ADBAC7;">)</span><span style="color:#96D0FF;">,&quot;likenum&quot;:NumberInt</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">1000</span><span style="color:#ADBAC7;">)</span><span style="color:#96D0FF;">,&quot;state&quot;:&quot;1&quot;},</span></span>
<span class="line"><span style="color:#ADBAC7;"> {</span><span style="color:#F69D50;">&quot;_id&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;2&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;articleid&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;100001&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;content&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;我夏天空腹喝凉开水，冬天喝温开水&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;userid&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;1005&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;nickname&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;伊人憔</span></span>
<span class="line"><span style="color:#F69D50;">悴&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;createdatetime&quot;</span><span style="color:#F69D50;">:new</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">Date</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">&quot;2019-08-05T23:58:51.485Z&quot;</span><span style="color:#ADBAC7;">)</span><span style="color:#96D0FF;">,&quot;likenum&quot;:NumberInt</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">888</span><span style="color:#ADBAC7;">)</span><span style="color:#96D0FF;">,&quot;state&quot;:&quot;1&quot;},</span></span>
<span class="line"><span style="color:#ADBAC7;"> {</span><span style="color:#F69D50;">&quot;_id&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;3&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;articleid&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;100001&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;content&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;我一直喝凉开水，冬天夏天都喝。&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;userid&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;1004&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;nickname&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;杰克船</span></span>
<span class="line"><span style="color:#F69D50;">长&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;createdatetime&quot;</span><span style="color:#F69D50;">:new</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">Date</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">&quot;2019-08-06T01:05:06.321Z&quot;</span><span style="color:#ADBAC7;">)</span><span style="color:#96D0FF;">,&quot;likenum&quot;:NumberInt</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">666</span><span style="color:#ADBAC7;">)</span><span style="color:#96D0FF;">,&quot;state&quot;:&quot;1&quot;},</span></span>
<span class="line"><span style="color:#ADBAC7;"> {</span><span style="color:#F69D50;">&quot;_id&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;4&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;articleid&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;100001&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;content&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;专家说不能空腹吃饭，影响健康。&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;userid&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;1003&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;nickname&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;凯</span></span>
<span class="line"><span style="color:#F69D50;">撒&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;createdatetime&quot;</span><span style="color:#F69D50;">:new</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">Date</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">&quot;2019-08-06T08:18:35.288Z&quot;</span><span style="color:#ADBAC7;">)</span><span style="color:#96D0FF;">,&quot;likenum&quot;:NumberInt</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">2000</span><span style="color:#ADBAC7;">)</span><span style="color:#96D0FF;">,&quot;state&quot;:&quot;1&quot;},</span></span>
<span class="line"><span style="color:#ADBAC7;"> {</span><span style="color:#F69D50;">&quot;_id&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;5&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;articleid&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;100001&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;content&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;研究表明，刚烧开的水千万不能喝，因为烫</span></span>
<span class="line"><span style="color:#F69D50;">嘴。&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;userid&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;1003&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;nickname&quot;</span><span style="color:#6CB6FF;">:</span><span style="color:#F69D50;">&quot;凯撒&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;createdatetime&quot;</span><span style="color:#F69D50;">:new</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">Date</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">&quot;2019-08-</span></span>
<span class="line"><span style="color:#F69D50;">06T11:01:02.521Z&quot;</span><span style="color:#ADBAC7;">)</span><span style="color:#96D0FF;">,&quot;likenum&quot;:NumberInt</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">3000</span><span style="color:#ADBAC7;">)</span><span style="color:#96D0FF;">,&quot;state&quot;:&quot;1&quot;}</span><span style="color:#ADBAC7;"> </span></span>
<span class="line"><span style="color:#ADBAC7;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 提示：</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;"># 插入时指定了 _id ，则主键就是该值。</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;"># 如果某条数据插入失败，将会终止插入，但已经插入成功的数据不会回滚掉。</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;"># 因为批量插入由于数据较多容易出现失败，因此，可以使用try catch进行异常捕捉处理，测试的时候可以不处理。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">db.collection.insertMany(</span></span>
<span class="line"><span style="color:#24292E;"> [ </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">document </span><span style="color:#D73A49;">1&gt;</span><span style="color:#24292E;"> , </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">document </span><span style="color:#D73A49;">2&gt;</span><span style="color:#24292E;">, ... ]</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">writeConcern:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">documen</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">ordered:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">boolea</span><span style="color:#24292E;">n</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;"> }</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 示例：</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.insertMany([</span></span>
<span class="line"><span style="color:#24292E;"> {</span><span style="color:#6F42C1;">&quot;_id&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;1&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;articleid&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;100001&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;content&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我</span></span>
<span class="line"><span style="color:#6F42C1;">他。&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;userid&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;1002&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;nickname&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;相忘于江湖&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;createdatetime&quot;</span><span style="color:#6F42C1;">:new</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Date</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&quot;2019-08-</span></span>
<span class="line"><span style="color:#6F42C1;">05T22:08:15.522Z&quot;</span><span style="color:#24292E;">)</span><span style="color:#032F62;">,&quot;likenum&quot;:NumberInt</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">1000</span><span style="color:#24292E;">)</span><span style="color:#032F62;">,&quot;state&quot;:&quot;1&quot;},</span></span>
<span class="line"><span style="color:#24292E;"> {</span><span style="color:#6F42C1;">&quot;_id&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;2&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;articleid&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;100001&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;content&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;我夏天空腹喝凉开水，冬天喝温开水&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;userid&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;1005&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;nickname&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;伊人憔</span></span>
<span class="line"><span style="color:#6F42C1;">悴&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;createdatetime&quot;</span><span style="color:#6F42C1;">:new</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Date</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&quot;2019-08-05T23:58:51.485Z&quot;</span><span style="color:#24292E;">)</span><span style="color:#032F62;">,&quot;likenum&quot;:NumberInt</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">888</span><span style="color:#24292E;">)</span><span style="color:#032F62;">,&quot;state&quot;:&quot;1&quot;},</span></span>
<span class="line"><span style="color:#24292E;"> {</span><span style="color:#6F42C1;">&quot;_id&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;3&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;articleid&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;100001&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;content&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;我一直喝凉开水，冬天夏天都喝。&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;userid&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;1004&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;nickname&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;杰克船</span></span>
<span class="line"><span style="color:#6F42C1;">长&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;createdatetime&quot;</span><span style="color:#6F42C1;">:new</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Date</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&quot;2019-08-06T01:05:06.321Z&quot;</span><span style="color:#24292E;">)</span><span style="color:#032F62;">,&quot;likenum&quot;:NumberInt</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">666</span><span style="color:#24292E;">)</span><span style="color:#032F62;">,&quot;state&quot;:&quot;1&quot;},</span></span>
<span class="line"><span style="color:#24292E;"> {</span><span style="color:#6F42C1;">&quot;_id&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;4&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;articleid&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;100001&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;content&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;专家说不能空腹吃饭，影响健康。&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;userid&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;1003&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;nickname&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;凯</span></span>
<span class="line"><span style="color:#6F42C1;">撒&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;createdatetime&quot;</span><span style="color:#6F42C1;">:new</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Date</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&quot;2019-08-06T08:18:35.288Z&quot;</span><span style="color:#24292E;">)</span><span style="color:#032F62;">,&quot;likenum&quot;:NumberInt</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">2000</span><span style="color:#24292E;">)</span><span style="color:#032F62;">,&quot;state&quot;:&quot;1&quot;},</span></span>
<span class="line"><span style="color:#24292E;"> {</span><span style="color:#6F42C1;">&quot;_id&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;5&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;articleid&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;100001&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;content&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;研究表明，刚烧开的水千万不能喝，因为烫</span></span>
<span class="line"><span style="color:#6F42C1;">嘴。&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;userid&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;1003&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;nickname&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;凯撒&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;createdatetime&quot;</span><span style="color:#6F42C1;">:new</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Date</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&quot;2019-08-</span></span>
<span class="line"><span style="color:#6F42C1;">06T11:01:02.521Z&quot;</span><span style="color:#24292E;">)</span><span style="color:#032F62;">,&quot;likenum&quot;:NumberInt</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">3000</span><span style="color:#24292E;">)</span><span style="color:#032F62;">,&quot;state&quot;:&quot;1&quot;}</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 提示：</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 插入时指定了 _id ，则主键就是该值。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 如果某条数据插入失败，将会终止插入，但已经插入成功的数据不会回滚掉。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 因为批量插入由于数据较多容易出现失败，因此，可以使用try catch进行异常捕捉处理，测试的时候可以不处理。</span></span></code></pre></div><h3 id="_3、文档的查询" tabindex="-1">3、文档的查询 <a class="header-anchor" href="#_3、文档的查询" aria-label="Permalink to &quot;3、文档的查询&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 查询数据的语法格式如下:</span></span>
<span class="line"><span style="color:#F69D50;">db.collection.find(&lt;query&gt;,</span><span style="color:#ADBAC7;"> [projection])</span></span>
<span class="line"><span style="color:#768390;"># &lt;query&gt;:可选。使用查询运算符指定选择筛选器。若要返回集合中的所有文档，请省略此参数或传递空文档( {} )。</span></span>
<span class="line"><span style="color:#768390;"># [projection]:可选。指定要在与查询筛选器匹配的文档中返回的字段（投影）。若要返回匹配文档中的所有字段，请省略此参数。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 查询数据的语法格式如下:</span></span>
<span class="line"><span style="color:#6F42C1;">db.collection.find(&lt;query&gt;,</span><span style="color:#24292E;"> [projection])</span></span>
<span class="line"><span style="color:#6A737D;"># &lt;query&gt;:可选。使用查询运算符指定选择筛选器。若要返回集合中的所有文档，请省略此参数或传递空文档( {} )。</span></span>
<span class="line"><span style="color:#6A737D;"># [projection]:可选。指定要在与查询筛选器匹配的文档中返回的字段（投影）。若要返回匹配文档中的所有字段，请省略此参数。</span></span></code></pre></div><h4 id="_3-1、查询所有" tabindex="-1">3.1、查询所有 <a class="header-anchor" href="#_3-1、查询所有" aria-label="Permalink to &quot;3.1、查询所有&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 查询comment集合的所有文档</span></span>
<span class="line"><span style="color:#DCBDFB;">db.comment.find</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"><span style="color:#ADBAC7;">或</span></span>
<span class="line"><span style="color:#ADBAC7;">db.comment.find({})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 查询comment集合的所有文档</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.find</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">或</span></span>
<span class="line"><span style="color:#24292E;">db.comment.find({})</span></span></code></pre></div><h4 id="_3-2、条件查询" tabindex="-1">3.2、条件查询 <a class="header-anchor" href="#_3-2、条件查询" aria-label="Permalink to &quot;3.2、条件查询&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 按一定条件来查询：查询userid为1003的记录</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.find(</span><span style="color:#ADBAC7;">{userid:</span><span style="color:#F69D50;">&#39;1003&#39;</span><span style="color:#F69D50;">}</span><span style="color:#ADBAC7;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 按一定条件来查询：查询userid为1003的记录</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.find(</span><span style="color:#24292E;">{userid:</span><span style="color:#6F42C1;">&#39;1003&#39;</span><span style="color:#6F42C1;">}</span><span style="color:#24292E;">)</span></span></code></pre></div><h4 id="_3-3、查询只返回一条" tabindex="-1">3.3、查询只返回一条 <a class="header-anchor" href="#_3-3、查询只返回一条" aria-label="Permalink to &quot;3.3、查询只返回一条&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 如果只需要返回符合条件的第一条数据：</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.findOne(</span><span style="color:#ADBAC7;">{userid:</span><span style="color:#F69D50;">&#39;1003&#39;</span><span style="color:#F69D50;">}</span><span style="color:#ADBAC7;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 如果只需要返回符合条件的第一条数据：</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.findOne(</span><span style="color:#24292E;">{userid:</span><span style="color:#6F42C1;">&#39;1003&#39;</span><span style="color:#6F42C1;">}</span><span style="color:#24292E;">)</span></span></code></pre></div><h4 id="_3-4、投影查询-projection-query" tabindex="-1">3.4、投影查询（Projection Query） <a class="header-anchor" href="#_3-4、投影查询-projection-query" aria-label="Permalink to &quot;3.4、投影查询（Projection Query）&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 投影查询：不显示所有字段，只显示指定的字段</span></span>
<span class="line"><span style="color:#768390;"># 示例：查询userid为1003的记录，只显示 _id 、userid、nickname:</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.find(</span><span style="color:#ADBAC7;">{userid:</span><span style="color:#F69D50;">&quot;1003&quot;</span><span style="color:#F69D50;">},</span><span style="color:#ADBAC7;">{userid:1,nickname:1})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 投影查询默认 _id 会显示。若不显示 _id ：</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.find(</span><span style="color:#ADBAC7;">{userid:</span><span style="color:#F69D50;">&quot;1003&quot;</span><span style="color:#F69D50;">},</span><span style="color:#ADBAC7;">{userid:1,nickname:1,_id:0})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 投影查询：不显示所有字段，只显示指定的字段</span></span>
<span class="line"><span style="color:#6A737D;"># 示例：查询userid为1003的记录，只显示 _id 、userid、nickname:</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.find(</span><span style="color:#24292E;">{userid:</span><span style="color:#6F42C1;">&quot;1003&quot;</span><span style="color:#6F42C1;">},</span><span style="color:#24292E;">{userid:1,nickname:1})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 投影查询默认 _id 会显示。若不显示 _id ：</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.find(</span><span style="color:#24292E;">{userid:</span><span style="color:#6F42C1;">&quot;1003&quot;</span><span style="color:#6F42C1;">},</span><span style="color:#24292E;">{userid:1,nickname:1,_id:0})</span></span></code></pre></div><h4 id="_3-5、统计查询" tabindex="-1">3.5、统计查询 <a class="header-anchor" href="#_3-5、统计查询" aria-label="Permalink to &quot;3.5、统计查询&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 统计查询使用count()方法，语法:</span></span>
<span class="line"><span style="color:#F69D50;">db.collection.count(query,</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">options</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#768390;"># query:查询选择条件</span></span>
<span class="line"><span style="color:#768390;"># options:可选。用于修改计数的额外选项。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 统计所有记录数，统计comment集合的所有的记录数：</span></span>
<span class="line"><span style="color:#DCBDFB;">db.comment.count</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;"># 按条件统计记录数，统计userid为1003的记录条数：</span></span>
<span class="line"><span style="color:#ADBAC7;">db.comment.count({userid:&quot;1003&quot;})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 统计查询使用count()方法，语法:</span></span>
<span class="line"><span style="color:#6F42C1;">db.collection.count(query,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">options</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;"># query:查询选择条件</span></span>
<span class="line"><span style="color:#6A737D;"># options:可选。用于修改计数的额外选项。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 统计所有记录数，统计comment集合的所有的记录数：</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.count</span><span style="color:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;"># 按条件统计记录数，统计userid为1003的记录条数：</span></span>
<span class="line"><span style="color:#24292E;">db.comment.count({userid:&quot;1003&quot;})</span></span></code></pre></div><h4 id="_3-6、分页列表查询" tabindex="-1">3.6、分页列表查询 <a class="header-anchor" href="#_3-6、分页列表查询" aria-label="Permalink to &quot;3.6、分页列表查询&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 可以使用limit()方法来读取指定数量的数据，使用skip()方法来跳过指定数量的数据</span></span>
<span class="line"><span style="color:#768390;"># 基本语法如下：</span></span>
<span class="line"><span style="color:#DCBDFB;">db.COLLECTION_NAME.find</span><span style="color:#ADBAC7;">().limit(</span><span style="color:#F69D50;">NUMBER</span><span style="color:#ADBAC7;">).skip(</span><span style="color:#F69D50;">NUMBER</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 如果想返回指定条数的记录，可以在find方法后调用limit来返回结果(TopN)，默认值20：</span></span>
<span class="line"><span style="color:#DCBDFB;">db.comment.find</span><span style="color:#ADBAC7;">().limit(</span><span style="color:#F69D50;">3</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># skip 方法同样接受一个数字参数作为跳过的记录条数。（前N个不要）,默认值是0</span></span>
<span class="line"><span style="color:#DCBDFB;">db.comment.find</span><span style="color:#ADBAC7;">().skip(</span><span style="color:#F69D50;">3</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 分页查询：需求：每页2个，第二页开始：跳过前两条数据，接着值显示3和4条数据:</span></span>
<span class="line"><span style="color:#DCBDFB;">db.comment.find</span><span style="color:#ADBAC7;">().skip(</span><span style="color:#F69D50;">0</span><span style="color:#ADBAC7;">).limit(</span><span style="color:#F69D50;">2</span><span style="color:#ADBAC7;">) </span><span style="color:#768390;"># 第一页</span></span>
<span class="line"><span style="color:#DCBDFB;">db.comment.find</span><span style="color:#ADBAC7;">().skip(</span><span style="color:#F69D50;">2</span><span style="color:#ADBAC7;">).limit(</span><span style="color:#F69D50;">2</span><span style="color:#ADBAC7;">) </span><span style="color:#768390;"># 第二页</span></span>
<span class="line"><span style="color:#DCBDFB;">db.comment.find</span><span style="color:#ADBAC7;">().skip(</span><span style="color:#F69D50;">4</span><span style="color:#ADBAC7;">).limit(</span><span style="color:#F69D50;">2</span><span style="color:#ADBAC7;">) </span><span style="color:#768390;"># 第三页</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 可以使用limit()方法来读取指定数量的数据，使用skip()方法来跳过指定数量的数据</span></span>
<span class="line"><span style="color:#6A737D;"># 基本语法如下：</span></span>
<span class="line"><span style="color:#6F42C1;">db.COLLECTION_NAME.find</span><span style="color:#24292E;">().limit(</span><span style="color:#6F42C1;">NUMBER</span><span style="color:#24292E;">).skip(</span><span style="color:#6F42C1;">NUMBER</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 如果想返回指定条数的记录，可以在find方法后调用limit来返回结果(TopN)，默认值20：</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.find</span><span style="color:#24292E;">().limit(</span><span style="color:#6F42C1;">3</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># skip 方法同样接受一个数字参数作为跳过的记录条数。（前N个不要）,默认值是0</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.find</span><span style="color:#24292E;">().skip(</span><span style="color:#6F42C1;">3</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 分页查询：需求：每页2个，第二页开始：跳过前两条数据，接着值显示3和4条数据:</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.find</span><span style="color:#24292E;">().skip(</span><span style="color:#6F42C1;">0</span><span style="color:#24292E;">).limit(</span><span style="color:#6F42C1;">2</span><span style="color:#24292E;">) </span><span style="color:#6A737D;"># 第一页</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.find</span><span style="color:#24292E;">().skip(</span><span style="color:#6F42C1;">2</span><span style="color:#24292E;">).limit(</span><span style="color:#6F42C1;">2</span><span style="color:#24292E;">) </span><span style="color:#6A737D;"># 第二页</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.find</span><span style="color:#24292E;">().skip(</span><span style="color:#6F42C1;">4</span><span style="color:#24292E;">).limit(</span><span style="color:#6F42C1;">2</span><span style="color:#24292E;">) </span><span style="color:#6A737D;"># 第三页</span></span></code></pre></div><h4 id="_3-7、-排序查询" tabindex="-1">3.7、 排序查询 <a class="header-anchor" href="#_3-7、-排序查询" aria-label="Permalink to &quot;3.7、 排序查询&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># sort()方法可以通过参数指定排序的字段，并使用1和-1来指定排序的方式（其中1为升序排列，而-1是用于降序排列。)</span></span>
<span class="line"><span style="color:#768390;"># 语法如下所示：</span></span>
<span class="line"><span style="color:#DCBDFB;">db.COLLECTION_NAME.find</span><span style="color:#ADBAC7;">().sort({KEY:1})</span></span>
<span class="line"><span style="color:#F69D50;">或</span></span>
<span class="line"><span style="color:#DCBDFB;">db.集合名称.find</span><span style="color:#ADBAC7;">().sort(</span><span style="color:#F69D50;">排序方式</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 示例：对userid降序排列，并对访问量进行升序排列</span></span>
<span class="line"><span style="color:#DCBDFB;">db.comment.find</span><span style="color:#ADBAC7;">().sort({userid:-1,likenum:1})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 提示</span></span>
<span class="line"><span style="color:#DCBDFB;">skip</span><span style="color:#ADBAC7;">()</span><span style="color:#DCBDFB;">,limilt</span><span style="color:#ADBAC7;">()</span><span style="color:#DCBDFB;">,sort</span><span style="color:#ADBAC7;">()</span><span style="color:#DCBDFB;">三个放在一起执行的时候，执行的顺序是先sort</span><span style="color:#ADBAC7;">()</span><span style="color:#DCBDFB;">,然后是skip</span><span style="color:#ADBAC7;">()</span><span style="color:#DCBDFB;">，最后是显示的limit</span><span style="color:#ADBAC7;">()，和命令编写顺序无关。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># sort()方法可以通过参数指定排序的字段，并使用1和-1来指定排序的方式（其中1为升序排列，而-1是用于降序排列。)</span></span>
<span class="line"><span style="color:#6A737D;"># 语法如下所示：</span></span>
<span class="line"><span style="color:#6F42C1;">db.COLLECTION_NAME.find</span><span style="color:#24292E;">().sort({KEY:1})</span></span>
<span class="line"><span style="color:#6F42C1;">或</span></span>
<span class="line"><span style="color:#6F42C1;">db.集合名称.find</span><span style="color:#24292E;">().sort(</span><span style="color:#6F42C1;">排序方式</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 示例：对userid降序排列，并对访问量进行升序排列</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.find</span><span style="color:#24292E;">().sort({userid:-1,likenum:1})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 提示</span></span>
<span class="line"><span style="color:#6F42C1;">skip</span><span style="color:#24292E;">()</span><span style="color:#6F42C1;">,limilt</span><span style="color:#24292E;">()</span><span style="color:#6F42C1;">,sort</span><span style="color:#24292E;">()</span><span style="color:#6F42C1;">三个放在一起执行的时候，执行的顺序是先sort</span><span style="color:#24292E;">()</span><span style="color:#6F42C1;">,然后是skip</span><span style="color:#24292E;">()</span><span style="color:#6F42C1;">，最后是显示的limit</span><span style="color:#24292E;">()，和命令编写顺序无关。</span></span></code></pre></div><h4 id="_3-8、正则的复杂条件查询" tabindex="-1">3.8、正则的复杂条件查询 <a class="header-anchor" href="#_3-8、正则的复杂条件查询" aria-label="Permalink to &quot;3.8、正则的复杂条件查询&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># MongoDB的模糊查询是通过正则表达式的方式实现的</span></span>
<span class="line"><span style="color:#F69D50;">db.collection.find(</span><span style="color:#ADBAC7;">{field:/正则表达式/})</span></span>
<span class="line"><span style="color:#F69D50;">或</span></span>
<span class="line"><span style="color:#F69D50;">db.集合.find(</span><span style="color:#ADBAC7;">{字段:/正则表达式/})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 示例，我要查询评论内容包含“开水”的所有文档</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.find(</span><span style="color:#ADBAC7;">{content:/开水/})</span></span>
<span class="line"><span style="color:#768390;"># 要查询评论的内容中以 “专家”开头的</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.find(</span><span style="color:#ADBAC7;">{content:/^专家/})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># MongoDB的模糊查询是通过正则表达式的方式实现的</span></span>
<span class="line"><span style="color:#6F42C1;">db.collection.find(</span><span style="color:#24292E;">{field:/正则表达式/})</span></span>
<span class="line"><span style="color:#6F42C1;">或</span></span>
<span class="line"><span style="color:#6F42C1;">db.集合.find(</span><span style="color:#24292E;">{字段:/正则表达式/})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 示例，我要查询评论内容包含“开水”的所有文档</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.find(</span><span style="color:#24292E;">{content:/开水/})</span></span>
<span class="line"><span style="color:#6A737D;"># 要查询评论的内容中以 “专家”开头的</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.find(</span><span style="color:#24292E;">{content:/^专家/})</span></span></code></pre></div><h4 id="_3-9、比较查询" tabindex="-1">3.9、比较查询 <a class="header-anchor" href="#_3-9、比较查询" aria-label="Permalink to &quot;3.9、比较查询&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">db.集合名称.find(</span><span style="color:#ADBAC7;">{ </span><span style="color:#96D0FF;">&quot;field&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span><span style="color:#ADBAC7;"> $gt</span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">value</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">}}</span><span style="color:#ADBAC7;">) // 大于: field </span><span style="color:#F47067;">&gt;</span><span style="color:#ADBAC7;"> value</span></span>
<span class="line"><span style="color:#F69D50;">db.集合名称.find(</span><span style="color:#ADBAC7;">{ </span><span style="color:#96D0FF;">&quot;field&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span><span style="color:#ADBAC7;"> $lt</span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">value</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">}}</span><span style="color:#ADBAC7;">) // 小于: field </span><span style="color:#F47067;">&lt;</span><span style="color:#ADBAC7;"> value</span></span>
<span class="line"><span style="color:#F69D50;">db.集合名称.find(</span><span style="color:#ADBAC7;">{ </span><span style="color:#96D0FF;">&quot;field&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span><span style="color:#ADBAC7;"> $gte</span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">value</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">}}</span><span style="color:#ADBAC7;">) // 大于等于: field </span><span style="color:#F47067;">&gt;</span><span style="color:#ADBAC7;">= value</span></span>
<span class="line"><span style="color:#F69D50;">db.集合名称.find(</span><span style="color:#ADBAC7;">{ </span><span style="color:#96D0FF;">&quot;field&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span><span style="color:#ADBAC7;"> $lte</span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">value</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">}}</span><span style="color:#ADBAC7;">) // 小于等于: field </span><span style="color:#F47067;">&lt;</span><span style="color:#ADBAC7;">= value</span></span>
<span class="line"><span style="color:#F69D50;">db.集合名称.find(</span><span style="color:#ADBAC7;">{ </span><span style="color:#96D0FF;">&quot;field&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span><span style="color:#ADBAC7;"> $ne</span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">value</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">}}</span><span style="color:#ADBAC7;">) // 不等于: field </span><span style="color:#F47067;">!</span><span style="color:#ADBAC7;">= </span><span style="color:#96D0FF;">value</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">db.集合名称.find(</span><span style="color:#24292E;">{ </span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> $gt</span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">value</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}}</span><span style="color:#24292E;">) // 大于: field </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> value</span></span>
<span class="line"><span style="color:#6F42C1;">db.集合名称.find(</span><span style="color:#24292E;">{ </span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> $lt</span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">value</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}}</span><span style="color:#24292E;">) // 小于: field </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> value</span></span>
<span class="line"><span style="color:#6F42C1;">db.集合名称.find(</span><span style="color:#24292E;">{ </span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> $gte</span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">value</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}}</span><span style="color:#24292E;">) // 大于等于: field </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">= value</span></span>
<span class="line"><span style="color:#6F42C1;">db.集合名称.find(</span><span style="color:#24292E;">{ </span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> $lte</span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">value</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}}</span><span style="color:#24292E;">) // 小于等于: field </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">= value</span></span>
<span class="line"><span style="color:#6F42C1;">db.集合名称.find(</span><span style="color:#24292E;">{ </span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> $ne</span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">value</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}}</span><span style="color:#24292E;">) // 不等于: field </span><span style="color:#D73A49;">!</span><span style="color:#24292E;">= </span><span style="color:#032F62;">value</span></span></code></pre></div><h4 id="_3-10、包含查询" tabindex="-1">3.10、包含查询 <a class="header-anchor" href="#_3-10、包含查询" aria-label="Permalink to &quot;3.10、包含查询&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 包含使用$in操作符。示例：查询评论的集合中userid字段包含1003或1004的文档</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.find(</span><span style="color:#ADBAC7;">{userid:{$in:[</span><span style="color:#F69D50;">&quot;1003&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;1004&quot;</span><span style="color:#F69D50;">]}}</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 不包含使用 $nin操作符。示例：查询评论集合中userid字段不包含1003和1004的文档</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.find(</span><span style="color:#ADBAC7;">{userid:{$nin:[</span><span style="color:#F69D50;">&quot;1003&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;1004&quot;</span><span style="color:#F69D50;">]}}</span><span style="color:#ADBAC7;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 包含使用$in操作符。示例：查询评论的集合中userid字段包含1003或1004的文档</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.find(</span><span style="color:#24292E;">{userid:{$in:[</span><span style="color:#6F42C1;">&quot;1003&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;1004&quot;</span><span style="color:#6F42C1;">]}}</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 不包含使用 $nin操作符。示例：查询评论集合中userid字段不包含1003和1004的文档</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.find(</span><span style="color:#24292E;">{userid:{$nin:[</span><span style="color:#6F42C1;">&quot;1003&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;1004&quot;</span><span style="color:#6F42C1;">]}}</span><span style="color:#24292E;">)</span></span></code></pre></div><h4 id="_3-11、条件连接查询" tabindex="-1">3.11、条件连接查询 <a class="header-anchor" href="#_3-11、条件连接查询" aria-label="Permalink to &quot;3.11、条件连接查询&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 需要查询同时满足两个以上条件，需要使用$and操作符将条件进行关联。（相当于SQL的and） 格式为</span></span>
<span class="line"><span style="color:#ADBAC7;">$and:[ {  },{  },{ } ]</span></span>
<span class="line"><span style="color:#768390;"># 示例：查询评论集合中 likenum大于等于700 并且小于2000的文档：</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.find(</span><span style="color:#ADBAC7;">{$and:[{likenum:{$gte:NumberInt(700)}},{</span><span style="color:#F69D50;">likenum:</span><span style="color:#ADBAC7;">{$lt:NumberInt(2000)}}]})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 如果两个以上条件之间是或者的关系，我们使用 操作符进行关联，与前面 and的使用方式相同 格式为:</span></span>
<span class="line"><span style="color:#ADBAC7;">$or:[ {  },{  },{   } ]</span></span>
<span class="line"><span style="color:#768390;"># 示例：查询评论集合中 userid为1003，或者点赞数小于1000的文档记录</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.find(</span><span style="color:#ADBAC7;">{$or:[ </span><span style="color:#96D0FF;">{userid:&quot;1003&quot;}</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">,{likenum:{</span><span style="color:#ADBAC7;">$lt</span><span style="color:#96D0FF;">:1000}</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">}]}</span><span style="color:#ADBAC7;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 需要查询同时满足两个以上条件，需要使用$and操作符将条件进行关联。（相当于SQL的and） 格式为</span></span>
<span class="line"><span style="color:#24292E;">$and:[ {  },{  },{ } ]</span></span>
<span class="line"><span style="color:#6A737D;"># 示例：查询评论集合中 likenum大于等于700 并且小于2000的文档：</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.find(</span><span style="color:#24292E;">{$and:[{likenum:{$gte:NumberInt(700)}},{</span><span style="color:#6F42C1;">likenum:</span><span style="color:#24292E;">{$lt:NumberInt(2000)}}]})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 如果两个以上条件之间是或者的关系，我们使用 操作符进行关联，与前面 and的使用方式相同 格式为:</span></span>
<span class="line"><span style="color:#24292E;">$or:[ {  },{  },{   } ]</span></span>
<span class="line"><span style="color:#6A737D;"># 示例：查询评论集合中 userid为1003，或者点赞数小于1000的文档记录</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.find(</span><span style="color:#24292E;">{$or:[ </span><span style="color:#032F62;">{userid:&quot;1003&quot;}</span><span style="color:#24292E;"> </span><span style="color:#032F62;">,{likenum:{</span><span style="color:#24292E;">$lt</span><span style="color:#032F62;">:1000}</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}]}</span><span style="color:#24292E;">)</span></span></code></pre></div><h3 id="_4、文档的更新" tabindex="-1">4、文档的更新 <a class="header-anchor" href="#_4、文档的更新" aria-label="Permalink to &quot;4、文档的更新&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 语法：</span></span>
<span class="line"><span style="color:#F69D50;">db.collection.update(query,</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">update,</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">options</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F69D50;">//或</span></span>
<span class="line"><span style="color:#F69D50;">db.collection.update(</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&lt;</span><span style="color:#F69D50;">query&gt;,</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 更新的选择条件。可以使用与find（）方法中相同的查询选择器，类似sql update查询内where后面的。</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&lt;</span><span style="color:#F69D50;">update&gt;,</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 要应用的修改</span></span>
<span class="line"><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F69D50;">upsert:</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&lt;</span><span style="color:#96D0FF;">boolea</span><span style="color:#ADBAC7;">n</span><span style="color:#F47067;">&gt;</span><span style="color:#96D0FF;">,</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 可选。如果设置为true，则在没有与查询条件匹配的文档时创建新文档。</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F69D50;">multi:</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&lt;</span><span style="color:#96D0FF;">boolea</span><span style="color:#ADBAC7;">n</span><span style="color:#F47067;">&gt;</span><span style="color:#96D0FF;">,</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 如果设置为true，则更新符合查询条件的多个文档。</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F69D50;">writeConcern:</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&lt;</span><span style="color:#96D0FF;">documen</span><span style="color:#ADBAC7;">t</span><span style="color:#F47067;">&gt;</span><span style="color:#96D0FF;">,</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 可选。表示写问题的文档。抛出异常的级别。</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F69D50;">collation:</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&lt;</span><span style="color:#96D0FF;">documen</span><span style="color:#ADBAC7;">t</span><span style="color:#F47067;">&gt;</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F69D50;">arrayFilters:</span><span style="color:#ADBAC7;"> [ </span><span style="color:#F47067;">&lt;</span><span style="color:#96D0FF;">filterdocument</span><span style="color:#F47067;">1&gt;</span><span style="color:#96D0FF;">,</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">...</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">],</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 可选。一个筛选文档数组，用于确定要为数组字段上的更新操作修改哪些数组元素。</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F69D50;">hint:</span><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">&lt;</span><span style="color:#96D0FF;">document</span><span style="color:#F47067;">|</span><span style="color:#F69D50;">string&gt;</span><span style="color:#ADBAC7;">     </span><span style="color:#96D0FF;">//</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">Available</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">starting</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">in</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">MongoDB</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">4.2</span></span>
<span class="line"><span style="color:#ADBAC7;"> }</span></span>
<span class="line"><span style="color:#ADBAC7;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 语法：</span></span>
<span class="line"><span style="color:#6F42C1;">db.collection.update(query,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">update,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">options</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">//或</span></span>
<span class="line"><span style="color:#6F42C1;">db.collection.update(</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#6F42C1;">query&gt;,</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 更新的选择条件。可以使用与find（）方法中相同的查询选择器，类似sql update查询内where后面的。</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#6F42C1;">update&gt;,</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 要应用的修改</span></span>
<span class="line"><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">upsert:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">boolea</span><span style="color:#24292E;">n</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 可选。如果设置为true，则在没有与查询条件匹配的文档时创建新文档。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">multi:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">boolea</span><span style="color:#24292E;">n</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 如果设置为true，则更新符合查询条件的多个文档。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">writeConcern:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">documen</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 可选。表示写问题的文档。抛出异常的级别。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">collation:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">documen</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">arrayFilters:</span><span style="color:#24292E;"> [ </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">filterdocument</span><span style="color:#D73A49;">1&gt;</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">...</span><span style="color:#24292E;"> </span><span style="color:#032F62;">],</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 可选。一个筛选文档数组，用于确定要为数组字段上的更新操作修改哪些数组元素。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">hint:</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">document</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">string&gt;</span><span style="color:#24292E;">     </span><span style="color:#032F62;">//</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Available</span><span style="color:#24292E;"> </span><span style="color:#032F62;">starting</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MongoDB</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4.2</span></span>
<span class="line"><span style="color:#24292E;"> }</span></span>
<span class="line"><span style="color:#24292E;">)</span></span></code></pre></div><h4 id="_4-1、覆盖的修改" tabindex="-1">4.1、覆盖的修改 <a class="header-anchor" href="#_4-1、覆盖的修改" aria-label="Permalink to &quot;4.1、覆盖的修改&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 如我们想修改_id为1的记录，点赞量为1001：</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.update(</span><span style="color:#ADBAC7;">{_id:</span><span style="color:#F69D50;">&quot;1&quot;</span><span style="color:#F69D50;">},</span><span style="color:#ADBAC7;">{likenum:NumberInt(1001)})</span></span>
<span class="line"><span style="color:#768390;"># 执行后，我们会发现，这条文档除了likenum字段其它字段都不见了</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 如我们想修改_id为1的记录，点赞量为1001：</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.update(</span><span style="color:#24292E;">{_id:</span><span style="color:#6F42C1;">&quot;1&quot;</span><span style="color:#6F42C1;">},</span><span style="color:#24292E;">{likenum:NumberInt(1001)})</span></span>
<span class="line"><span style="color:#6A737D;"># 执行后，我们会发现，这条文档除了likenum字段其它字段都不见了</span></span></code></pre></div><h4 id="_4-2、局部修改" tabindex="-1">4.2、局部修改 <a class="header-anchor" href="#_4-2、局部修改" aria-label="Permalink to &quot;4.2、局部修改&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 局部修改：$set</span></span>
<span class="line"><span style="color:#768390;"># 我们想修改_id为2的记录，浏览量为889</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.update(</span><span style="color:#ADBAC7;">{_id:</span><span style="color:#F69D50;">&quot;2&quot;</span><span style="color:#F69D50;">},</span><span style="color:#ADBAC7;">{$set:{likenum:NumberInt(889)}})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 局部修改：$set</span></span>
<span class="line"><span style="color:#6A737D;"># 我们想修改_id为2的记录，浏览量为889</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.update(</span><span style="color:#24292E;">{_id:</span><span style="color:#6F42C1;">&quot;2&quot;</span><span style="color:#6F42C1;">},</span><span style="color:#24292E;">{$set:{likenum:NumberInt(889)}})</span></span></code></pre></div><h4 id="_4-3、批量的修改" tabindex="-1">4.3、批量的修改 <a class="header-anchor" href="#_4-3、批量的修改" aria-label="Permalink to &quot;4.3、批量的修改&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 更新所有用户为 1003 的用户的昵称为“凯撒大帝”</span></span>
<span class="line"><span style="color:#768390;"># 默认只修改第一条数据</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.update(</span><span style="color:#ADBAC7;">{userid:</span><span style="color:#F69D50;">&quot;1003&quot;</span><span style="color:#F69D50;">},</span><span style="color:#ADBAC7;">{$set:{nickname:</span><span style="color:#F69D50;">&quot;凯撒2&quot;</span><span style="color:#F69D50;">}}</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#768390;"># 修改所有符合条件的数据</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.update(</span><span style="color:#ADBAC7;">{userid:</span><span style="color:#F69D50;">&quot;1003&quot;</span><span style="color:#F69D50;">},</span><span style="color:#ADBAC7;">{$set:{nickname:</span><span style="color:#F69D50;">&quot;凯撒大帝&quot;</span><span style="color:#F69D50;">}},</span><span style="color:#ADBAC7;">{multi:</span><span style="color:#6CB6FF;">true</span><span style="color:#ADBAC7;">})</span></span>
<span class="line"><span style="color:#768390;"># 如果不加后面的参数multi，则只更新符合条件的第一条记录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 列值增长的修改，如果我们想实现对某列值在原有值的基础上进行增加或减少，可以使用 $inc 运算符来实现。</span></span>
<span class="line"><span style="color:#768390;"># 对3号数据的点赞数，每次递增1：</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.update(</span><span style="color:#ADBAC7;">{_id:</span><span style="color:#F69D50;">&quot;3&quot;</span><span style="color:#F69D50;">},</span><span style="color:#ADBAC7;">{$inc:{likenum:NumberInt(1)}})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 更新所有用户为 1003 的用户的昵称为“凯撒大帝”</span></span>
<span class="line"><span style="color:#6A737D;"># 默认只修改第一条数据</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.update(</span><span style="color:#24292E;">{userid:</span><span style="color:#6F42C1;">&quot;1003&quot;</span><span style="color:#6F42C1;">},</span><span style="color:#24292E;">{$set:{nickname:</span><span style="color:#6F42C1;">&quot;凯撒2&quot;</span><span style="color:#6F42C1;">}}</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;"># 修改所有符合条件的数据</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.update(</span><span style="color:#24292E;">{userid:</span><span style="color:#6F42C1;">&quot;1003&quot;</span><span style="color:#6F42C1;">},</span><span style="color:#24292E;">{$set:{nickname:</span><span style="color:#6F42C1;">&quot;凯撒大帝&quot;</span><span style="color:#6F42C1;">}},</span><span style="color:#24292E;">{multi:</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">})</span></span>
<span class="line"><span style="color:#6A737D;"># 如果不加后面的参数multi，则只更新符合条件的第一条记录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 列值增长的修改，如果我们想实现对某列值在原有值的基础上进行增加或减少，可以使用 $inc 运算符来实现。</span></span>
<span class="line"><span style="color:#6A737D;"># 对3号数据的点赞数，每次递增1：</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.update(</span><span style="color:#24292E;">{_id:</span><span style="color:#6F42C1;">&quot;3&quot;</span><span style="color:#6F42C1;">},</span><span style="color:#24292E;">{$inc:{likenum:NumberInt(1)}})</span></span></code></pre></div><h3 id="_5、文档的删除" tabindex="-1">5、文档的删除 <a class="header-anchor" href="#_5、文档的删除" aria-label="Permalink to &quot;5、文档的删除&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 删除文档的语法结构：</span></span>
<span class="line"><span style="color:#F69D50;">db.集合名称.remove(条件</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#768390;"># 将数据全部删除</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.remove(</span><span style="color:#ADBAC7;">{})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 示例：删除 _id=1的记录:</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.remove(</span><span style="color:#ADBAC7;">{_id:</span><span style="color:#F69D50;">&quot;1&quot;</span><span style="color:#F69D50;">}</span><span style="color:#ADBAC7;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 删除文档的语法结构：</span></span>
<span class="line"><span style="color:#6F42C1;">db.集合名称.remove(条件</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;"># 将数据全部删除</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.remove(</span><span style="color:#24292E;">{})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 示例：删除 _id=1的记录:</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.remove(</span><span style="color:#24292E;">{_id:</span><span style="color:#6F42C1;">&quot;1&quot;</span><span style="color:#6F42C1;">}</span><span style="color:#24292E;">)</span></span></code></pre></div><h2 id="索引" tabindex="-1">索引 <a class="header-anchor" href="#索引" aria-label="Permalink to &quot;索引&quot;">​</a></h2><p>  索引支持在MongoDB中高效地执行查询。如果没有索引，MongoDB必须执行全集合扫描，即扫描集合中的每个文档，以选择与查询语句匹配的文档。如果查询存在适当的索引，MongoDB可以使用该索引限制必须检查的文档数。</p><p>  索引是特殊的数据结构，它以易于遍历的形式存储集合数据集的一小部分。索引存储特定字段或一组字段的值，按字段值排序。索引项的排序支持有效的相等匹配和基于范围的查询操作。此外，MongoDB还可以使用索引中的排序返回排序结果。</p><p>  MongoDB索引使用B树数据结构（确切的说是B-Tree，MySQL是B+Tree）</p><h3 id="索引类型" tabindex="-1">索引类型 <a class="header-anchor" href="#索引类型" aria-label="Permalink to &quot;索引类型&quot;">​</a></h3><h4 id="_1、单字段索引" tabindex="-1">1、单字段索引 <a class="header-anchor" href="#_1、单字段索引" aria-label="Permalink to &quot;1、单字段索引&quot;">​</a></h4><ul><li>MongoDB支持在文档的单个字段上创建用户定义的升序/降序索引，称为单字段索引（Single Field Index）。</li><li>对于单个字段索引和排序操作，索引键的排序顺序（即升序或降序）并不重要，因为MongoDB可以在任何方向上遍历索引。 <img src="/charles-blog/assets/SingleFieldIndex.b7311d99.png" alt="SingleFieldIndex"></li></ul><h4 id="_2、复合索引" tabindex="-1">2、复合索引 <a class="header-anchor" href="#_2、复合索引" aria-label="Permalink to &quot;2、复合索引&quot;">​</a></h4><ul><li>MongoDB还支持多个字段的用户定义索引，即复合索引（Compound Index）。</li><li>复合索引中列出的字段顺序具有重要意义。例如，如果复合索引由 { userid: 1, score: -1 } 组成，则索引首先按userid正序排序，然后在每个userid的值内，再在按score倒序排序。 <img src="/charles-blog/assets/CompoundIndex.d5e5d9a4.png" alt="CompoundIndex"></li></ul><h3 id="索引操作" tabindex="-1">索引操作 <a class="header-anchor" href="#索引操作" aria-label="Permalink to &quot;索引操作&quot;">​</a></h3><h4 id="_1、索引的查看" tabindex="-1">1、索引的查看 <a class="header-anchor" href="#_1、索引的查看" aria-label="Permalink to &quot;1、索引的查看&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 返回一个集合中的所有索引的数组，该语法命令运行要求是 MongoDB 3.0+</span></span>
<span class="line"><span style="color:#DCBDFB;">db.collection.getIndexes</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"><span style="color:#ADBAC7;"># 示例:</span></span>
<span class="line"><span style="color:#ADBAC7;">db.comment.getIndexes()</span></span>
<span class="line"><span style="color:#ADBAC7;">[</span></span>
<span class="line"><span style="color:#ADBAC7;">   {</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#96D0FF;">&quot;v&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">2</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#96D0FF;">&quot;key&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">:</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#96D0FF;">&quot;_id&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span></span>
<span class="line"><span style="color:#ADBAC7;">       },</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#96D0FF;">&quot;name&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;_id_&quot;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#96D0FF;">&quot;ns&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;articledb.comment&quot;</span></span>
<span class="line"><span style="color:#ADBAC7;">   }</span></span>
<span class="line"><span style="color:#ADBAC7;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 结果中显示的是默认 _id 索引。</span></span>
<span class="line"><span style="color:#768390;"># 默认_id索引：MongoDB在创建集合的过程中，在 _id 字段上创建一个唯一的索引，默认名字为 _id_ ，该索引可防止客户端插入两个具有相同值的文档，您不能在_id字段上删除此索引。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 返回一个集合中的所有索引的数组，该语法命令运行要求是 MongoDB 3.0+</span></span>
<span class="line"><span style="color:#6F42C1;">db.collection.getIndexes</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;"># 示例:</span></span>
<span class="line"><span style="color:#24292E;">db.comment.getIndexes()</span></span>
<span class="line"><span style="color:#24292E;">[</span></span>
<span class="line"><span style="color:#24292E;">   {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;v&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;key&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&quot;_id&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">       },</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;name&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;_id_&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;ns&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;articledb.comment&quot;</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"><span style="color:#24292E;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 结果中显示的是默认 _id 索引。</span></span>
<span class="line"><span style="color:#6A737D;"># 默认_id索引：MongoDB在创建集合的过程中，在 _id 字段上创建一个唯一的索引，默认名字为 _id_ ，该索引可防止客户端插入两个具有相同值的文档，您不能在_id字段上删除此索引。</span></span></code></pre></div><h4 id="_2、索引的创建" tabindex="-1">2、索引的创建 <a class="header-anchor" href="#_2、索引的创建" aria-label="Permalink to &quot;2、索引的创建&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 在集合上创建索引</span></span>
<span class="line"><span style="color:#F69D50;">db.collection.createIndex(keys,</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">options</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#768390;"># keys：包含字段和值对的文档，其中字段是索引键，值描述该字段的索引类型。</span></span>
<span class="line"><span style="color:#768390;">#       对于字段上的升序索引，指定值1；对于降序索引，请指定值-1。比如： { 字段:1或-1} </span></span>
<span class="line"><span style="color:#768390;"># options：可选。包含一组控制索引创建的选项的文档。</span></span>
<span class="line"><span style="color:#768390;">#         name：索引的名称。</span></span>
<span class="line"><span style="color:#768390;">#         unique：建立的索引是否唯一。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 示例</span></span>
<span class="line"><span style="color:#768390;"># 单字段索引，对 userid 字段建立索引：</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">db.comment.createIndex(</span><span style="color:#ADBAC7;">{userid:1})</span></span>
<span class="line"><span style="color:#ADBAC7;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">   </span><span style="color:#F69D50;">&quot;createdCollectionAutomatically&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">false</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">   </span><span style="color:#F69D50;">&quot;numIndexesBefore&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">   </span><span style="color:#F69D50;">&quot;numIndexesAfter&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">2</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">   </span><span style="color:#F69D50;">&quot;ok&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 复合索引：对 userid 和 nickname 同时建立复合（Compound）索引：</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.createIndex(</span><span style="color:#ADBAC7;">{userid:1,nickname:-1})</span></span>
<span class="line"><span style="color:#ADBAC7;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">   </span><span style="color:#F69D50;">&quot;createdCollectionAutomatically&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">false</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">   </span><span style="color:#F69D50;">&quot;numIndexesBefore&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">2</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">   </span><span style="color:#F69D50;">&quot;numIndexesAfter&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">3</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">   </span><span style="color:#F69D50;">&quot;ok&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 在集合上创建索引</span></span>
<span class="line"><span style="color:#6F42C1;">db.collection.createIndex(keys,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">options</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;"># keys：包含字段和值对的文档，其中字段是索引键，值描述该字段的索引类型。</span></span>
<span class="line"><span style="color:#6A737D;">#       对于字段上的升序索引，指定值1；对于降序索引，请指定值-1。比如： { 字段:1或-1} </span></span>
<span class="line"><span style="color:#6A737D;"># options：可选。包含一组控制索引创建的选项的文档。</span></span>
<span class="line"><span style="color:#6A737D;">#         name：索引的名称。</span></span>
<span class="line"><span style="color:#6A737D;">#         unique：建立的索引是否唯一。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 示例</span></span>
<span class="line"><span style="color:#6A737D;"># 单字段索引，对 userid 字段建立索引：</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">db.comment.createIndex(</span><span style="color:#24292E;">{userid:1})</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">&quot;createdCollectionAutomatically&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">&quot;numIndexesBefore&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">&quot;numIndexesAfter&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">&quot;ok&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 复合索引：对 userid 和 nickname 同时建立复合（Compound）索引：</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.createIndex(</span><span style="color:#24292E;">{userid:1,nickname:-1})</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">&quot;createdCollectionAutomatically&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">&quot;numIndexesBefore&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">&quot;numIndexesAfter&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">&quot;ok&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h4 id="_3、索引的移除" tabindex="-1">3、索引的移除 <a class="header-anchor" href="#_3、索引的移除" aria-label="Permalink to &quot;3、索引的移除&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 指定索引的移除</span></span>
<span class="line"><span style="color:#F69D50;">db.collection.dropIndex(index</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#768390;"># index：指定要删除的索引</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 示例：删除 comment 集合中 userid 字段上的升序索引</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.dropIndex(</span><span style="color:#ADBAC7;">{userid:1})</span></span>
<span class="line"><span style="color:#ADBAC7;">{ </span><span style="color:#F69D50;">&quot;nIndexesWas&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">3</span><span style="color:#96D0FF;">,</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;ok&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 所有索引的移除</span></span>
<span class="line"><span style="color:#DCBDFB;">db.collection.dropIndexes</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"><span style="color:#ADBAC7;"># 示例：删除 spit 集合中所有索引</span></span>
<span class="line"><span style="color:#ADBAC7;">db.comment.dropIndexes()</span></span>
<span class="line"><span style="color:#ADBAC7;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">   </span><span style="color:#F69D50;">&quot;nIndexesWas&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">2</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">   </span><span style="color:#F69D50;">&quot;msg&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;non-_id indexes dropped for collection&quot;,</span></span>
<span class="line"><span style="color:#ADBAC7;">   </span><span style="color:#F69D50;">&quot;ok&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 提示： _id 的字段的索引是无法删除的，只能删除非 _id 字段的索引。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 指定索引的移除</span></span>
<span class="line"><span style="color:#6F42C1;">db.collection.dropIndex(index</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;"># index：指定要删除的索引</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 示例：删除 comment 集合中 userid 字段上的升序索引</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.dropIndex(</span><span style="color:#24292E;">{userid:1})</span></span>
<span class="line"><span style="color:#24292E;">{ </span><span style="color:#6F42C1;">&quot;nIndexesWas&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;ok&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 所有索引的移除</span></span>
<span class="line"><span style="color:#6F42C1;">db.collection.dropIndexes</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;"># 示例：删除 spit 集合中所有索引</span></span>
<span class="line"><span style="color:#24292E;">db.comment.dropIndexes()</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">&quot;nIndexesWas&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">&quot;msg&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;non-_id indexes dropped for collection&quot;,</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">&quot;ok&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 提示： _id 的字段的索引是无法删除的，只能删除非 _id 字段的索引。</span></span></code></pre></div><h4 id="_4、索引的使用" tabindex="-1">4、索引的使用 <a class="header-anchor" href="#_4、索引的使用" aria-label="Permalink to &quot;4、索引的使用&quot;">​</a></h4><p>  分析查询性能（Analyze Query Performance）通常使用执行计划（Explain Plan）来查看查询的情况，如查询耗费的时间、是否基于索引查询等。</p><p>  关键点：</p><ul><li>&quot;stage&quot; : &quot;COLLSCAN&quot;, 表示全集合扫描</li><li>&quot;stage&quot; : &quot;IXSCAN&quot; ,基于索引的扫描</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">db.collection.find(query,options</span><span style="color:#ADBAC7;">).explain(</span><span style="color:#F69D50;">options</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 示例，查看根据userid查询数据的情况：</span></span>
<span class="line"><span style="color:#F69D50;">db.comment.find(</span><span style="color:#ADBAC7;">{userid:</span><span style="color:#F69D50;">&quot;1003&quot;</span><span style="color:#F69D50;">}</span><span style="color:#ADBAC7;">)</span><span style="color:#DCBDFB;">.explain</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"><span style="color:#ADBAC7;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">&quot;queryPlanner&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;plannerVersion&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;namespace&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;articledb.comment&quot;,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;indexFilterSet&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">false</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;parsedQuery&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#F69D50;">&quot;userid&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">                </span><span style="color:#F69D50;">&quot;</span><span style="color:#ADBAC7;">$eq</span><span style="color:#F69D50;">&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;1003&quot;</span></span>
<span class="line"><span style="color:#ADBAC7;">           }</span></span>
<span class="line"><span style="color:#ADBAC7;">       },</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;winningPlan&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#F69D50;">&quot;stage&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;COLLSCAN&quot;,</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 表示全集合扫描</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#F69D50;">&quot;filter&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">                </span><span style="color:#F69D50;">&quot;userid&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">                    </span><span style="color:#F69D50;">&quot;</span><span style="color:#ADBAC7;">$eq</span><span style="color:#F69D50;">&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;1003&quot;</span></span>
<span class="line"><span style="color:#ADBAC7;">               }</span></span>
<span class="line"><span style="color:#ADBAC7;">           },</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#F69D50;">&quot;direction&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;forward&quot;</span></span>
<span class="line"><span style="color:#ADBAC7;">       },</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;rejectedPlans&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> [ </span><span style="color:#96D0FF;">]</span></span>
<span class="line"><span style="color:#ADBAC7;">   },</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">&quot;serverInfo&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;host&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;9ef3740277ad&quot;,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;port&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">27017</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;version&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;4.0.10&quot;,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;gitVersion&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;c389e7f69f637f7a1ac3cc9fae843b635f20b766&quot;</span></span>
<span class="line"><span style="color:#ADBAC7;">   },</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">&quot;ok&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">db.collection.find(query,options</span><span style="color:#24292E;">).explain(</span><span style="color:#6F42C1;">options</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 示例，查看根据userid查询数据的情况：</span></span>
<span class="line"><span style="color:#6F42C1;">db.comment.find(</span><span style="color:#24292E;">{userid:</span><span style="color:#6F42C1;">&quot;1003&quot;</span><span style="color:#6F42C1;">}</span><span style="color:#24292E;">)</span><span style="color:#6F42C1;">.explain</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">&quot;queryPlanner&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;plannerVersion&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;namespace&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;articledb.comment&quot;,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;indexFilterSet&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;parsedQuery&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;userid&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">&quot;</span><span style="color:#24292E;">$eq</span><span style="color:#6F42C1;">&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;1003&quot;</span></span>
<span class="line"><span style="color:#24292E;">           }</span></span>
<span class="line"><span style="color:#24292E;">       },</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;winningPlan&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;stage&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;COLLSCAN&quot;,</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 表示全集合扫描</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;filter&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">&quot;userid&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6F42C1;">&quot;</span><span style="color:#24292E;">$eq</span><span style="color:#6F42C1;">&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;1003&quot;</span></span>
<span class="line"><span style="color:#24292E;">               }</span></span>
<span class="line"><span style="color:#24292E;">           },</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;direction&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;forward&quot;</span></span>
<span class="line"><span style="color:#24292E;">       },</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;rejectedPlans&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> [ </span><span style="color:#032F62;">]</span></span>
<span class="line"><span style="color:#24292E;">   },</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">&quot;serverInfo&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;host&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;9ef3740277ad&quot;,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;port&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">27017</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;version&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;4.0.10&quot;,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;gitVersion&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;c389e7f69f637f7a1ac3cc9fae843b635f20b766&quot;</span></span>
<span class="line"><span style="color:#24292E;">   },</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">&quot;ok&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h4 id="_5、涵盖的查询" tabindex="-1">5、涵盖的查询 <a class="header-anchor" href="#_5、涵盖的查询" aria-label="Permalink to &quot;5、涵盖的查询&quot;">​</a></h4><p>  当查询条件和查询的投影仅包含索引字段时，MongoDB直接从索引返回结果，而不扫描任何文档或将文档带入内存。 这些覆盖的查询可以非常有效。 <img src="/charles-blog/assets/CoveringQueries.52a5bc7f.png" alt="CoveringQueries"></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">db.comment.find(</span><span style="color:#ADBAC7;">{userid:</span><span style="color:#F69D50;">&quot;1003&quot;</span><span style="color:#F69D50;">},</span><span style="color:#ADBAC7;">{userid:1,_id:0})</span></span>
<span class="line"><span style="color:#ADBAC7;">{ </span><span style="color:#F69D50;">&quot;userid&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;1003&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">}</span></span>
<span class="line"><span style="color:#ADBAC7;">{ </span><span style="color:#F69D50;">&quot;userid&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;1003&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">db.comment.find(</span><span style="color:#24292E;">{userid:</span><span style="color:#6F42C1;">&quot;1003&quot;</span><span style="color:#6F42C1;">},</span><span style="color:#24292E;">{userid:1,_id:0})</span></span>
<span class="line"><span style="color:#24292E;">{ </span><span style="color:#6F42C1;">&quot;userid&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;1003&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#24292E;">{ </span><span style="color:#6F42C1;">&quot;userid&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;1003&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}</span></span></code></pre></div><h2 id="副本集" tabindex="-1">副本集 <a class="header-anchor" href="#副本集" aria-label="Permalink to &quot;副本集&quot;">​</a></h2><p>  MongoDB中的副本集（Replica Set）是一组维护相同数据集的mongod服务。 副本集可提供冗余和高可用性，是所有生产部署的基础。</p><p>  也可以说，副本集类似于有自动故障恢复功能的主从集群。通俗的讲就是用多台机器进行同一数据的异步同步，从而使多台机器拥有同一数据的多个副本，并且当主库当掉时在不需要用户干预的情况下自动切换其他备份服务器做主库。而且还可以利用副本服务器做只读服务器，实现读写分离，提高负载。</p><h3 id="主从复制和副本集区别" tabindex="-1">主从复制和副本集区别 <a class="header-anchor" href="#主从复制和副本集区别" aria-label="Permalink to &quot;主从复制和副本集区别&quot;">​</a></h3><p>  主从集群和副本集最大的区别就是副本集没有固定的“主节点”；整个集群会选出一个“主节点”，当其挂掉后，又在剩下的从节点中选中其他节点为“主节点”，副本集总有一个活跃点(主、primary)和一个或多个备份节点(从、secondary)。</p><h3 id="副本集有两种类型三种角色" tabindex="-1">副本集有两种类型三种角色 <a class="header-anchor" href="#副本集有两种类型三种角色" aria-label="Permalink to &quot;副本集有两种类型三种角色&quot;">​</a></h3><h4 id="两种类型" tabindex="-1">两种类型 <a class="header-anchor" href="#两种类型" aria-label="Permalink to &quot;两种类型&quot;">​</a></h4><ul><li>主节点（ Primary）类型：数据操作的主要连接点，可读写。</li><li>次要（辅助、从）节点（ Secondaries）类型：数据冗余备份节点，可以读或选举。</li></ul><h4 id="三种角色" tabindex="-1">三种角色 <a class="header-anchor" href="#三种角色" aria-label="Permalink to &quot;三种角色&quot;">​</a></h4><ul><li>主要成员（Primary）：主要接收所有写操作。就是主节点。</li><li>副本成员（Replicate）：从主节点通过复制操作以维护相同的数据集，即备份数据，不可写操作，但可以读操作（但需要配置）。是默认的一种从节点类型</li><li>仲裁者（ Arbiter）：不保留任何数据的副本，只具有投票选举作用。当然也可以将仲裁服务器维护为副本集的一部分，即副本成员同时也可以是仲裁者。也是一种从节点类型 <img src="/charles-blog/assets/ReplicaSet.3a4a6b0b.png" alt="ReplicaSet"></li></ul><p>  如果你的副本+主节点的个数是偶数，建议加一个仲裁者，形成奇数，容易满足大多数的投票。</p><p>  如果你的副本+主节点的个数是奇数，可以不加仲裁者。</p><h3 id="副本集的创建" tabindex="-1">副本集的创建 <a class="header-anchor" href="#副本集的创建" aria-label="Permalink to &quot;副本集的创建&quot;">​</a></h3><h4 id="_1、所有节点的配置文件上定义副本集名称" tabindex="-1">1、所有节点的配置文件上定义副本集名称 <a class="header-anchor" href="#_1、所有节点的配置文件上定义副本集名称" aria-label="Permalink to &quot;1、所有节点的配置文件上定义副本集名称&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">replication:</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#副本集的名称</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">replSetName:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">myrs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">replication:</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">#副本集的名称</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">replSetName:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">myrs</span></span></code></pre></div><h4 id="_2、初始化配置副本集" tabindex="-1">2、初始化配置副本集 <a class="header-anchor" href="#_2、初始化配置副本集" aria-label="Permalink to &quot;2、初始化配置副本集&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 语法：</span></span>
<span class="line"><span style="color:#F69D50;">rs.initiate(configuration</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 使用默认的配置来初始化副本集，尽量在主节点操作</span></span>
<span class="line"><span style="color:#DCBDFB;">rs.initiate</span><span style="color:#ADBAC7;">()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 语法：</span></span>
<span class="line"><span style="color:#6F42C1;">rs.initiate(configuration</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 使用默认的配置来初始化副本集，尽量在主节点操作</span></span>
<span class="line"><span style="color:#6F42C1;">rs.initiate</span><span style="color:#24292E;">()</span></span></code></pre></div><h4 id="_3、查看副本集的配置内容" tabindex="-1">3、查看副本集的配置内容 <a class="header-anchor" href="#_3、查看副本集的配置内容" aria-label="Permalink to &quot;3、查看副本集的配置内容&quot;">​</a></h4><p>本质是查询的是system.replset的表中的数据</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 返回包含当前副本集配置的文档</span></span>
<span class="line"><span style="color:#F69D50;">rs.conf(configuration</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#768390;"># rs.config() 是该方法的别名。</span></span>
<span class="line"><span style="color:#768390;"># configuration：可选，如果没有配置，则使用默认主节点配置</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 示例</span></span>
<span class="line"><span style="color:#DCBDFB;">rs.conf</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"><span style="color:#ADBAC7;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">&quot;_id&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;myrs&quot;,</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 副本集的配置数据存储的主键值，默认就是副本集的名字</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">&quot;version&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">&quot;protocolVersion&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">NumberLong</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">1</span><span style="color:#ADBAC7;">)</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">&quot;writeConcernMajorityJournalDefault&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">true</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">&quot;members&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> [ </span><span style="color:#768390;"># 副本集成员数组</span></span>
<span class="line"><span style="color:#ADBAC7;">       {</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#F69D50;">&quot;_id&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#F69D50;">&quot;host&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;180.76.159.126:27017&quot;,</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#F69D50;">&quot;arbiterOnly&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">false</span><span style="color:#96D0FF;">,</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 该成员不是仲裁节点</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#F69D50;">&quot;buildIndexes&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">true</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#F69D50;">&quot;hidden&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">false</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#F69D50;">&quot;priority&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#F69D50;">&quot;tags&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">           },</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#F69D50;">&quot;slaveDelay&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">NumberLong</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">0</span><span style="color:#ADBAC7;">)</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#F69D50;">&quot;votes&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span></span>
<span class="line"><span style="color:#ADBAC7;">       }</span></span>
<span class="line"><span style="color:#ADBAC7;">   ],</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">&quot;settings&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 副本集的参数配置</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;chainingAllowed&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">true</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;heartbeatIntervalMillis&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">2000</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;heartbeatTimeoutSecs&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">10</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;electionTimeoutMillis&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">10000</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;catchUpTimeoutMillis&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">-1,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;catchUpTakeoverDelayMillis&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">30000</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;getLastErrorModes&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">       },</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;getLastErrorDefaults&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#F69D50;">&quot;w&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#96D0FF;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#F69D50;">&quot;wtimeout&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span></span>
<span class="line"><span style="color:#ADBAC7;">       },</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F69D50;">&quot;replicaSetId&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">ObjectId</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">&quot;5d539bdcd6a308e600d126bb&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">   }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 返回包含当前副本集配置的文档</span></span>
<span class="line"><span style="color:#6F42C1;">rs.conf(configuration</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;"># rs.config() 是该方法的别名。</span></span>
<span class="line"><span style="color:#6A737D;"># configuration：可选，如果没有配置，则使用默认主节点配置</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 示例</span></span>
<span class="line"><span style="color:#6F42C1;">rs.conf</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">&quot;_id&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;myrs&quot;,</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 副本集的配置数据存储的主键值，默认就是副本集的名字</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">&quot;version&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">&quot;protocolVersion&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NumberLong</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">1</span><span style="color:#24292E;">)</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">&quot;writeConcernMajorityJournalDefault&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">&quot;members&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> [ </span><span style="color:#6A737D;"># 副本集成员数组</span></span>
<span class="line"><span style="color:#24292E;">       {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;_id&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;host&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;180.76.159.126:27017&quot;,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;arbiterOnly&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 该成员不是仲裁节点</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;buildIndexes&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;hidden&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;priority&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;tags&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">           },</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;slaveDelay&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NumberLong</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">0</span><span style="color:#24292E;">)</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;votes&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">       }</span></span>
<span class="line"><span style="color:#24292E;">   ],</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">&quot;settings&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 副本集的参数配置</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;chainingAllowed&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;heartbeatIntervalMillis&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2000</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;heartbeatTimeoutSecs&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;electionTimeoutMillis&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10000</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;catchUpTimeoutMillis&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-1,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;catchUpTakeoverDelayMillis&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">30000</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;getLastErrorModes&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">       },</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;getLastErrorDefaults&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;w&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;wtimeout&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">       },</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">&quot;replicaSetId&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ObjectId</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&quot;5d539bdcd6a308e600d126bb&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h4 id="_4、查看副本集状态" tabindex="-1">4、查看副本集状态 <a class="header-anchor" href="#_4、查看副本集状态" aria-label="Permalink to &quot;4、查看副本集状态&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 语法</span></span>
<span class="line"><span style="color:#DCBDFB;">rs.status</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"><span style="color:#ADBAC7;"># 返回包含状态信息的文档</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 语法</span></span>
<span class="line"><span style="color:#6F42C1;">rs.status</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;"># 返回包含状态信息的文档</span></span></code></pre></div><h4 id="_5、添加副本从节点" tabindex="-1">5、添加副本从节点 <a class="header-anchor" href="#_5、添加副本从节点" aria-label="Permalink to &quot;5、添加副本从节点&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 在主节点添加从节点，将其他成员加入到副本集。语法：</span></span>
<span class="line"><span style="color:#F69D50;">rs.add(host,</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">arbiterOnly</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#768390;"># host：要添加到副本集的新成员</span></span>
<span class="line"><span style="color:#768390;"># arbiterOnly：如果为true，要添加到副本集的新成员</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 示例，将27018的副本节点添加到副本集中：</span></span>
<span class="line"><span style="color:#F69D50;">rs.add(</span><span style="color:#F69D50;">&quot;180.76.159.126:27018&quot;</span><span style="color:#ADBAC7;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 在主节点添加从节点，将其他成员加入到副本集。语法：</span></span>
<span class="line"><span style="color:#6F42C1;">rs.add(host,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">arbiterOnly</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;"># host：要添加到副本集的新成员</span></span>
<span class="line"><span style="color:#6A737D;"># arbiterOnly：如果为true，要添加到副本集的新成员</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 示例，将27018的副本节点添加到副本集中：</span></span>
<span class="line"><span style="color:#6F42C1;">rs.add(</span><span style="color:#6F42C1;">&quot;180.76.159.126:27018&quot;</span><span style="color:#24292E;">)</span></span></code></pre></div><h4 id="_6、添加仲裁从节点" tabindex="-1">6、添加仲裁从节点 <a class="header-anchor" href="#_6、添加仲裁从节点" aria-label="Permalink to &quot;6、添加仲裁从节点&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 添加一个仲裁节点到副本集。语法:</span></span>
<span class="line"><span style="color:#F69D50;">rs.addArb(host</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 示例，将27019的仲裁节点添加到副本集中：</span></span>
<span class="line"><span style="color:#F69D50;">rs.addArb(</span><span style="color:#F69D50;">&quot;180.76.159.126:27019&quot;</span><span style="color:#ADBAC7;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 添加一个仲裁节点到副本集。语法:</span></span>
<span class="line"><span style="color:#6F42C1;">rs.addArb(host</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 示例，将27019的仲裁节点添加到副本集中：</span></span>
<span class="line"><span style="color:#6F42C1;">rs.addArb(</span><span style="color:#6F42C1;">&quot;180.76.159.126:27019&quot;</span><span style="color:#24292E;">)</span></span></code></pre></div><h4 id="_7、副本集的数据读写操作" tabindex="-1">7、副本集的数据读写操作 <a class="header-anchor" href="#_7、副本集的数据读写操作" aria-label="Permalink to &quot;7、副本集的数据读写操作&quot;">​</a></h4><p>  因为默认情况下，从节点是没有读写权限的，可以增加读的权限；设置为奴隶节点，允许在从成员上运行读的操作</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 语法：</span></span>
<span class="line"><span style="color:#DCBDFB;">rs.slaveOk</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"><span style="color:#ADBAC7;">或</span></span>
<span class="line"><span style="color:#ADBAC7;">rs.slaveOk(</span><span style="color:#6CB6FF;">true</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#768390;"># 该命令是 db.getMongo().setSlaveOk() 的简化命令</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 取消读操作权限</span></span>
<span class="line"><span style="color:#F69D50;">rs.slaveOk(false</span><span style="color:#ADBAC7;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 语法：</span></span>
<span class="line"><span style="color:#6F42C1;">rs.slaveOk</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">或</span></span>
<span class="line"><span style="color:#24292E;">rs.slaveOk(</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;"># 该命令是 db.getMongo().setSlaveOk() 的简化命令</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 取消读操作权限</span></span>
<span class="line"><span style="color:#6F42C1;">rs.slaveOk(false</span><span style="color:#24292E;">)</span></span></code></pre></div><h3 id="主节点的选举原则" tabindex="-1">主节点的选举原则 <a class="header-anchor" href="#主节点的选举原则" aria-label="Permalink to &quot;主节点的选举原则&quot;">​</a></h3><p>  MongoDB在副本集中，会自动进行主节点的选举，主节点选举的触发条件：</p><ul><li>主节点故障</li><li>主节点网络不可达（默认心跳信息为10秒）</li><li>人工干预（rs.stepDown(600)）</li></ul><p>  一旦触发选举，就要根据一定规则来选主节点。</p><p>  选举规则是根据票数来决定谁获胜：</p><ul><li>票数最高，且获得了 “大多数”成员的投票支持的节点获胜。“大多数”的定义为：假设复制集内投票成员数量为N，则大多数为 N/2 + 1。例如：3个投票成员，则大多数的值是2。当复制集内存活成员数量不足大多数时，整个复制集将无法选举出Primary，复制集将无法提供写服务，处于只读状态。</li><li>若票数相同，且都获得了 “大多数”成员的投票支持的，数据新的节点获胜。数据的新旧是通过操作日志oplog来对比的。</li></ul><p>  可以通过设置优先级（priority）来设置额外票数。优先级即权重，取值为0-1000，相当于可额外增加0-1000的票数，优先级的值越大，就越可能获得多数成员的投票（votes）数。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 修改优先级</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 先将配置导入cfg变量</span></span>
<span class="line"><span style="color:#ADBAC7;">cfg</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">rs.conf</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 然后修改值（ID号默认从0开始）</span></span>
<span class="line"><span style="color:#F69D50;">cfg.members[1].priority</span><span style="color:#ADBAC7;">=2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 重新加载配置</span></span>
<span class="line"><span style="color:#F69D50;">rs.reconfig(cfg</span><span style="color:#ADBAC7;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 修改优先级</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 先将配置导入cfg变量</span></span>
<span class="line"><span style="color:#24292E;">cfg</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">rs.conf</span><span style="color:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 然后修改值（ID号默认从0开始）</span></span>
<span class="line"><span style="color:#6F42C1;">cfg.members[1].priority</span><span style="color:#24292E;">=2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 重新加载配置</span></span>
<span class="line"><span style="color:#6F42C1;">rs.reconfig(cfg</span><span style="color:#24292E;">)</span></span></code></pre></div><h3 id="springdatamongodb-连接副本集" tabindex="-1">SpringDataMongoDB 连接副本集 <a class="header-anchor" href="#springdatamongodb-连接副本集" aria-label="Permalink to &quot;SpringDataMongoDB 连接副本集&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#96D0FF;">mongodb://host1,host2,host3/dbName?connect=replicaSet&amp;slaveOk=true&amp;replicaSet=副本集名字</span></span>
<span class="line"><span style="color:#768390;"># slaveOk=true ：开启副本节点读的功能，可实现读写分离。</span></span>
<span class="line"><span style="color:#768390;"># connect=replicaSet ：自动到副本集中选择读写的主机。如果slaveOK是打开的，则实现了读写分离</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">mongodb://host1,host2,host3/dbName?connect=replicaSet&amp;slaveOk=true&amp;replicaSet=副本集名字</span></span>
<span class="line"><span style="color:#6A737D;"># slaveOk=true ：开启副本节点读的功能，可实现读写分离。</span></span>
<span class="line"><span style="color:#6A737D;"># connect=replicaSet ：自动到副本集中选择读写的主机。如果slaveOK是打开的，则实现了读写分离</span></span></code></pre></div><h2 id="分片集群" tabindex="-1">分片集群 <a class="header-anchor" href="#分片集群" aria-label="Permalink to &quot;分片集群&quot;">​</a></h2><p>  分片(sharding)是指将数据拆分，将其分散存在不同的机器上的过程。有时也用分区(partitioning)来表示这个概念。将数据分散到不同的机器上，不需要功能强大的大型计算机就可以储存更多的数据，处理更多的负载。</p><p>  MongoDB分片群集包含以下组件：</p><ul><li>分片（存储）：每个分片包含分片数据的子集。 每个分片都可以部署为副本集。</li><li>mongos （路由）：mongos充当查询路由器，在客户端应用程序和分片集群之间提供接口。</li><li>config servers （“调度”的配置）：配置服务器存储群集的元数据和配置设置。 从MongoDB 3.4开始，必须将配置服务器部署为副本集（CSRS） <img src="/charles-blog/assets/ShardedCluster.9400ad32.png" alt="ShardedCluster"></li></ul><h3 id="分片集群搭建" tabindex="-1">分片集群搭建 <a class="header-anchor" href="#分片集群搭建" aria-label="Permalink to &quot;分片集群搭建&quot;">​</a></h3><h4 id="_1、第一-二套副本集的创建" tabindex="-1">1、第一，二套副本集的创建 <a class="header-anchor" href="#_1、第一-二套副本集的创建" aria-label="Permalink to &quot;1、第一，二套副本集的创建&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">replication:</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#副本集的名称</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">replSetName:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">myshardrs01</span></span>
<span class="line"><span style="color:#F69D50;">sharding:</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#分片角色</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">clusterRole:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">shardsvr</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">replication:</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">#副本集的名称</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">replSetName:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">myshardrs01</span></span>
<span class="line"><span style="color:#6F42C1;">sharding:</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">#分片角色</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">clusterRole:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">shardsvr</span></span></code></pre></div><h4 id="_2、初始化该副本集和创建主节点-添加从节点" tabindex="-1">2、初始化该副本集和创建主节点，添加从节点 <a class="header-anchor" href="#_2、初始化该副本集和创建主节点-添加从节点" aria-label="Permalink to &quot;2、初始化该副本集和创建主节点，添加从节点&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#DCBDFB;">rs.initiate</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"><span style="color:#ADBAC7;">rs.add(</span><span style="color:#F69D50;">&quot;180.76.159.126:27118&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F69D50;">rs.addArb(</span><span style="color:#F69D50;">&quot;180.76.159.126:27218&quot;</span><span style="color:#ADBAC7;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">rs.initiate</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">rs.add(</span><span style="color:#6F42C1;">&quot;180.76.159.126:27118&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">rs.addArb(</span><span style="color:#6F42C1;">&quot;180.76.159.126:27218&quot;</span><span style="color:#24292E;">)</span></span></code></pre></div><h4 id="_3、配置节点-config-server-副本集的搭建" tabindex="-1">3、配置节点（config server）副本集的搭建 <a class="header-anchor" href="#_3、配置节点-config-server-副本集的搭建" aria-label="Permalink to &quot;3、配置节点（config server）副本集的搭建&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">replication:</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">replSetName:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">myconfigrs</span></span>
<span class="line"><span style="color:#F69D50;">sharding:</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 分片角色   </span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">clusterRole:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">configsvr</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">replication:</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">replSetName:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">myconfigrs</span></span>
<span class="line"><span style="color:#6F42C1;">sharding:</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 分片角色   </span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">clusterRole:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configsvr</span></span></code></pre></div><h4 id="_4、初始化该副本集和创建主节点-添加从节点" tabindex="-1">4、初始化该副本集和创建主节点，添加从节点 <a class="header-anchor" href="#_4、初始化该副本集和创建主节点-添加从节点" aria-label="Permalink to &quot;4、初始化该副本集和创建主节点，添加从节点&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#DCBDFB;">rs.initiate</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"><span style="color:#ADBAC7;">rs.add(</span><span style="color:#F69D50;">&quot;180.76.159.126:27119&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F69D50;">rs.add(</span><span style="color:#F69D50;">&quot;180.76.159.126:27219&quot;</span><span style="color:#ADBAC7;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">rs.initiate</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">rs.add(</span><span style="color:#6F42C1;">&quot;180.76.159.126:27119&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">rs.add(</span><span style="color:#6F42C1;">&quot;180.76.159.126:27219&quot;</span><span style="color:#24292E;">)</span></span></code></pre></div><h4 id="_5、路由节点的创建" tabindex="-1">5、路由节点的创建 <a class="header-anchor" href="#_5、路由节点的创建" aria-label="Permalink to &quot;5、路由节点的创建&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">sharding:</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#指定配置节点的副本集</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">configDB:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">myconfigrs/180.76.159.126:27019,180.76.159.126:27119,180.76.159.126:27219</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sharding:</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">#指定配置节点的副本集</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">configDB:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">myconfigrs/180.76.159.126:27019,180.76.159.126:27119,180.76.159.126:27219</span></span></code></pre></div><h4 id="_6、启动mongos" tabindex="-1">6、启动mongos <a class="header-anchor" href="#_6、启动mongos" aria-label="Permalink to &quot;6、启动mongos&quot;">​</a></h4><h4 id="_7、在路由节点上进行分片配置操作" tabindex="-1">7、在路由节点上进行分片配置操作 <a class="header-anchor" href="#_7、在路由节点上进行分片配置操作" aria-label="Permalink to &quot;7、在路由节点上进行分片配置操作&quot;">​</a></h4><h5 id="_7-1、添加分片" tabindex="-1">7.1、添加分片 <a class="header-anchor" href="#_7-1、添加分片" aria-label="Permalink to &quot;7.1、添加分片&quot;">​</a></h5><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 语法：</span></span>
<span class="line"><span style="color:#F69D50;">sh.addShard(</span><span style="color:#F69D50;">&quot;IP:Port&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#768390;"># 示例，将第一套分片副本集添加进来</span></span>
<span class="line"><span style="color:#F69D50;">sh.addShard(</span><span style="color:#F69D50;">&quot;myshardrs01/192.168.0.2:27018,180.76.159.126:27118,180.76.159.126:27218&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#768390;"># 查看分片状态情况</span></span>
<span class="line"><span style="color:#DCBDFB;">sh.status</span><span style="color:#ADBAC7;">()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 语法：</span></span>
<span class="line"><span style="color:#6F42C1;">sh.addShard(</span><span style="color:#6F42C1;">&quot;IP:Port&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;"># 示例，将第一套分片副本集添加进来</span></span>
<span class="line"><span style="color:#6F42C1;">sh.addShard(</span><span style="color:#6F42C1;">&quot;myshardrs01/192.168.0.2:27018,180.76.159.126:27118,180.76.159.126:27218&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;"># 查看分片状态情况</span></span>
<span class="line"><span style="color:#6F42C1;">sh.status</span><span style="color:#24292E;">()</span></span></code></pre></div><h5 id="_7-2、开启分片功能" tabindex="-1">7.2、开启分片功能 <a class="header-anchor" href="#_7-2、开启分片功能" aria-label="Permalink to &quot;7.2、开启分片功能&quot;">​</a></h5><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 语法:</span></span>
<span class="line"><span style="color:#F69D50;">sh.enableSharding(</span><span style="color:#F69D50;">&quot;库名&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#768390;"># 示例，在mongos上的articledb数据库配置sharding:</span></span>
<span class="line"><span style="color:#F69D50;">sh.enableSharding(</span><span style="color:#F69D50;">&quot;articledb&quot;</span><span style="color:#ADBAC7;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 语法:</span></span>
<span class="line"><span style="color:#6F42C1;">sh.enableSharding(</span><span style="color:#6F42C1;">&quot;库名&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;"># 示例，在mongos上的articledb数据库配置sharding:</span></span>
<span class="line"><span style="color:#6F42C1;">sh.enableSharding(</span><span style="color:#6F42C1;">&quot;articledb&quot;</span><span style="color:#24292E;">)</span></span></code></pre></div><h5 id="_7-3、集合分片" tabindex="-1">7.3、集合分片 <a class="header-anchor" href="#_7-3、集合分片" aria-label="Permalink to &quot;7.3、集合分片&quot;">​</a></h5><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 对集合分片，必须使用 sh.shardCollection() 方法指定集合和分片键</span></span>
<span class="line"><span style="color:#F69D50;">sh.shardCollection(</span><span style="color:#F69D50;">&quot;库名.集合名&quot;</span><span style="color:#F69D50;">,</span><span style="color:#ADBAC7;">{&quot;</span><span style="color:#F69D50;">key</span><span style="color:#F69D50;">&quot;:1})</span></span>
<span class="line"><span style="color:#F69D50;"># 对集合进行分片时,你需要选择一个 片键（Shard Key） , shard key 是每条记录都必须包含的,且建立了索引的单个字段或复合字段,</span></span>
<span class="line"><span style="color:#F69D50;"># MongoDB按照片键将数据划分到不同的 数据块 中,并将 数据块 均衡地分布到所有分片中.</span></span>
<span class="line"><span style="color:#F69D50;"># 为了按照片键划分数据块,MongoDB使用 基于哈希的分片方式（随机平均分配）或者基于范围的分片方式（数值大小分配）。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F69D50;"># 分片规则一：哈希策略</span></span>
<span class="line"><span style="color:#F69D50;">sh.shardCollection(&quot;</span><span style="color:#F69D50;">articledb.comment</span><span style="color:#F69D50;">&quot;,{&quot;</span><span style="color:#F69D50;">nickname</span><span style="color:#F69D50;">&quot;:&quot;</span><span style="color:#F69D50;">hashed</span><span style="color:#F69D50;">&quot;})</span></span>
<span class="line"><span style="color:#F69D50;"># 分片规则二：范围策略</span></span>
<span class="line"><span style="color:#F69D50;">sh.shardCollection(&quot;</span><span style="color:#F69D50;">articledb.author</span><span style="color:#F69D50;">&quot;,{&quot;</span><span style="color:#F69D50;">age</span><span style="color:#F69D50;">&quot;:1})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 对集合分片，必须使用 sh.shardCollection() 方法指定集合和分片键</span></span>
<span class="line"><span style="color:#6F42C1;">sh.shardCollection(</span><span style="color:#6F42C1;">&quot;库名.集合名&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#24292E;">{&quot;</span><span style="color:#6F42C1;">key</span><span style="color:#6F42C1;">&quot;:1})</span></span>
<span class="line"><span style="color:#6F42C1;"># 对集合进行分片时,你需要选择一个 片键（Shard Key） , shard key 是每条记录都必须包含的,且建立了索引的单个字段或复合字段,</span></span>
<span class="line"><span style="color:#6F42C1;"># MongoDB按照片键将数据划分到不同的 数据块 中,并将 数据块 均衡地分布到所有分片中.</span></span>
<span class="line"><span style="color:#6F42C1;"># 为了按照片键划分数据块,MongoDB使用 基于哈希的分片方式（随机平均分配）或者基于范围的分片方式（数值大小分配）。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;"># 分片规则一：哈希策略</span></span>
<span class="line"><span style="color:#6F42C1;">sh.shardCollection(&quot;</span><span style="color:#6F42C1;">articledb.comment</span><span style="color:#6F42C1;">&quot;,{&quot;</span><span style="color:#6F42C1;">nickname</span><span style="color:#6F42C1;">&quot;:&quot;</span><span style="color:#6F42C1;">hashed</span><span style="color:#6F42C1;">&quot;})</span></span>
<span class="line"><span style="color:#6F42C1;"># 分片规则二：范围策略</span></span>
<span class="line"><span style="color:#6F42C1;">sh.shardCollection(&quot;</span><span style="color:#6F42C1;">articledb.author</span><span style="color:#6F42C1;">&quot;,{&quot;</span><span style="color:#6F42C1;">age</span><span style="color:#6F42C1;">&quot;:1})</span></span></code></pre></div><h3 id="删除分片" tabindex="-1">删除分片 <a class="header-anchor" href="#删除分片" aria-label="Permalink to &quot;删除分片&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 提示：如果添加分片失败，需要先手动移除分片，检查添加分片的信息的正确性后，再次添加分片。</span></span>
<span class="line"><span style="color:#768390;"># 移除分片</span></span>
<span class="line"><span style="color:#F69D50;">use</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">admin</span></span>
<span class="line"><span style="color:#F69D50;">db.runCommand(</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">removeShard:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;myshardrs02&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">}</span><span style="color:#ADBAC7;"> )</span></span>
<span class="line"><span style="color:#768390;"># 注意：如果只剩下最后一个 shard，是无法删除的</span></span>
<span class="line"><span style="color:#768390;"># 移除时会自动转移分片数据，需要一个时间过程。</span></span>
<span class="line"><span style="color:#768390;"># 完成后，再次执行删除分片命令才能真正删除。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 提示：如果添加分片失败，需要先手动移除分片，检查添加分片的信息的正确性后，再次添加分片。</span></span>
<span class="line"><span style="color:#6A737D;"># 移除分片</span></span>
<span class="line"><span style="color:#6F42C1;">use</span><span style="color:#24292E;"> </span><span style="color:#032F62;">admin</span></span>
<span class="line"><span style="color:#6F42C1;">db.runCommand(</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> </span><span style="color:#032F62;">removeShard:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;myshardrs02&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}</span><span style="color:#24292E;"> )</span></span>
<span class="line"><span style="color:#6A737D;"># 注意：如果只剩下最后一个 shard，是无法删除的</span></span>
<span class="line"><span style="color:#6A737D;"># 移除时会自动转移分片数据，需要一个时间过程。</span></span>
<span class="line"><span style="color:#6A737D;"># 完成后，再次执行删除分片命令才能真正删除。</span></span></code></pre></div><h3 id="springdatamongdb-连接分片集群" tabindex="-1">SpringDataMongDB 连接分片集群 <a class="header-anchor" href="#springdatamongdb-连接分片集群" aria-label="Permalink to &quot;SpringDataMongDB 连接分片集群&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#8DDB8C;">uri</span><span style="color:#ADBAC7;">: </span><span style="color:#96D0FF;">mongodb://180.76.159.126:27017,180.76.159.126:27117/articledb</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">uri</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mongodb://180.76.159.126:27017,180.76.159.126:27117/articledb</span></span></code></pre></div><h2 id="安全认证" tabindex="-1">安全认证 <a class="header-anchor" href="#安全认证" aria-label="Permalink to &quot;安全认证&quot;">​</a></h2><p>  MongoDB使用的是基于角色的访问控制(Role-Based Access Control,RBAC)来管理用户对实例的访问。通过对用户授予一个或多个角色来控制用户访问数据库资源的权限和数据库操作的权限，在对用户分配角色之前，用户无法访问实例。</p><h3 id="角色权限的查看" tabindex="-1">角色权限的查看 <a class="header-anchor" href="#角色权限的查看" aria-label="Permalink to &quot;角色权限的查看&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 查询所有角色权限(仅用户自定义角色)</span></span>
<span class="line"><span style="color:#F69D50;">db.runCommand(</span><span style="color:#ADBAC7;">{ </span><span style="color:#96D0FF;">rolesInfo:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">}</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 查询所有角色权限(包含内置角色)</span></span>
<span class="line"><span style="color:#F69D50;">db.runCommand(</span><span style="color:#ADBAC7;">{ </span><span style="color:#96D0FF;">rolesInfo:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#96D0FF;">,</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">showBuiltinRoles:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">true</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">}</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 查询当前数据库中的某角色的权限</span></span>
<span class="line"><span style="color:#F69D50;">db.runCommand(</span><span style="color:#ADBAC7;">{ </span><span style="color:#96D0FF;">rolesInfo:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;&lt;rolename&gt;&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">}</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 查询其它数据库中指定的角色权限</span></span>
<span class="line"><span style="color:#F69D50;">db.runCommand(</span><span style="color:#ADBAC7;">{ </span><span style="color:#96D0FF;">rolesInfo:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">role:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;&lt;rolename&gt;&quot;,</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">db:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;&lt;database&gt;&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">}</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 查询多个角色权限</span></span>
<span class="line"><span style="color:#F69D50;">db.runCommand(</span></span>
<span class="line"><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">rolesInfo:</span><span style="color:#ADBAC7;"> [</span></span>
<span class="line"><span style="color:#ADBAC7;">      </span><span style="color:#F69D50;">&quot;&lt;rolename&gt;&quot;</span><span style="color:#F69D50;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">     { </span><span style="color:#F69D50;">role:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;&lt;rolename&gt;&quot;,</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">db:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;&lt;database&gt;&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">},</span></span>
<span class="line"><span style="color:#ADBAC7;">      </span><span style="color:#6CB6FF;">...</span></span>
<span class="line"><span style="color:#ADBAC7;">   ]  </span></span>
<span class="line"><span style="color:#ADBAC7;"> }</span></span>
<span class="line"><span style="color:#ADBAC7;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 查询所有角色权限(仅用户自定义角色)</span></span>
<span class="line"><span style="color:#6F42C1;">db.runCommand(</span><span style="color:#24292E;">{ </span><span style="color:#032F62;">rolesInfo:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查询所有角色权限(包含内置角色)</span></span>
<span class="line"><span style="color:#6F42C1;">db.runCommand(</span><span style="color:#24292E;">{ </span><span style="color:#032F62;">rolesInfo:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">showBuiltinRoles:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查询当前数据库中的某角色的权限</span></span>
<span class="line"><span style="color:#6F42C1;">db.runCommand(</span><span style="color:#24292E;">{ </span><span style="color:#032F62;">rolesInfo:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&lt;rolename&gt;&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查询其它数据库中指定的角色权限</span></span>
<span class="line"><span style="color:#6F42C1;">db.runCommand(</span><span style="color:#24292E;">{ </span><span style="color:#032F62;">rolesInfo:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> </span><span style="color:#032F62;">role:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&lt;rolename&gt;&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">db:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&lt;database&gt;&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查询多个角色权限</span></span>
<span class="line"><span style="color:#6F42C1;">db.runCommand(</span></span>
<span class="line"><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">rolesInfo:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">&quot;&lt;rolename&gt;&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">     { </span><span style="color:#6F42C1;">role:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&lt;rolename&gt;&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">db:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&lt;database&gt;&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">},</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;">   ]  </span></span>
<span class="line"><span style="color:#24292E;"> }</span></span>
<span class="line"><span style="color:#24292E;">)</span></span></code></pre></div><h3 id="常用的内置角色" tabindex="-1">常用的内置角色 <a class="header-anchor" href="#常用的内置角色" aria-label="Permalink to &quot;常用的内置角色&quot;">​</a></h3><ul><li>数据库用户角色： read、readWrite;</li><li>所有数据库用户角色： readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase</li><li>数据库管理角色： dbAdmin、dbOwner、userAdmin；</li><li>集群管理角色： clusterAdmin、clusterManager、clusterMonitor、hostManager；</li><li>备份恢复角色： backup、restore；</li><li>超级用户角色： root</li><li>内部角色： system <img src="/charles-blog/assets/Roles.5535eac1.png" alt="Roles"></li></ul><h3 id="单实例环境的安全认证" tabindex="-1">单实例环境的安全认证 <a class="header-anchor" href="#单实例环境的安全认证" aria-label="Permalink to &quot;单实例环境的安全认证&quot;">​</a></h3><h4 id="_1、创建管理员用户" tabindex="-1">1、创建管理员用户 <a class="header-anchor" href="#_1、创建管理员用户" aria-label="Permalink to &quot;1、创建管理员用户&quot;">​</a></h4><p>  创建两个管理员用户，一个是系统的超级管理员 myroot ，一个是admin库的管理用户myadmin</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 切换到admin库</span></span>
<span class="line"><span style="color:#F69D50;">use</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">admin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 创建系统超级用户 myroot,设置密码123456，设置角色root</span></span>
<span class="line"><span style="color:#F69D50;">db.createUser(</span><span style="color:#ADBAC7;">{user:</span><span style="color:#F69D50;">&quot;myroot&quot;</span><span style="color:#F69D50;">,pwd:</span><span style="color:#F69D50;">&quot;123456&quot;</span><span style="color:#F69D50;">,roles:[</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">{</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;role&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;root&quot;,</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;db&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:&quot;admin&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">}</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">]}</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#768390;"># 或</span></span>
<span class="line"><span style="color:#F69D50;">db.createUser(</span><span style="color:#ADBAC7;">{user:</span><span style="color:#F69D50;">&quot;myroot&quot;</span><span style="color:#F69D50;">,pwd:</span><span style="color:#F69D50;">&quot;123456&quot;</span><span style="color:#F69D50;">,roles:[</span><span style="color:#F69D50;">&quot;root&quot;</span><span style="color:#F69D50;">]}</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#768390;"># 如果不指定数据库，则创建的指定的权限的用户在所有的数据库上有效，如 {role:&quot;userAdminAnyDatabase&quot;, db:&quot;&quot;}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 创建专门用来管理admin库的账号myadmin，只用来作为用户权限的管理</span></span>
<span class="line"><span style="color:#F69D50;">db.createUser(</span><span style="color:#ADBAC7;">{user:</span><span style="color:#F69D50;">&quot;myadmin&quot;</span><span style="color:#F69D50;">,pwd:</span><span style="color:#F69D50;">&quot;123456&quot;</span><span style="color:#F69D50;">,roles:[</span><span style="color:#ADBAC7;">{role:</span><span style="color:#F69D50;">&quot;userAdminAnyDatabase&quot;</span><span style="color:#F69D50;">,db:</span><span style="color:#F69D50;">&quot;admin&quot;</span><span style="color:#F69D50;">}]}</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 查看已经创建了的用户的情况：</span></span>
<span class="line"><span style="color:#DCBDFB;">db.system.users.find</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;"># 删除用户</span></span>
<span class="line"><span style="color:#ADBAC7;">db.dropUser(</span><span style="color:#F69D50;">&quot;myadmin&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 认证测试：</span></span>
<span class="line"><span style="color:#768390;"># 切换到admin：</span></span>
<span class="line"><span style="color:#F69D50;">use</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">admin</span></span>
<span class="line"><span style="color:#768390;"># 密码输错：</span></span>
<span class="line"><span style="color:#F69D50;">db.auth(</span><span style="color:#F69D50;">&quot;myroot&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;12345&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F69D50;">Error:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">Authentication</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">failed.</span></span>
<span class="line"><span style="color:#F69D50;">0</span></span>
<span class="line"><span style="color:#768390;"># 密码正确：</span></span>
<span class="line"><span style="color:#F69D50;">db.auth(</span><span style="color:#F69D50;">&quot;myroot&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;123456&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F69D50;">1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 切换到admin库</span></span>
<span class="line"><span style="color:#6F42C1;">use</span><span style="color:#24292E;"> </span><span style="color:#032F62;">admin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 创建系统超级用户 myroot,设置密码123456，设置角色root</span></span>
<span class="line"><span style="color:#6F42C1;">db.createUser(</span><span style="color:#24292E;">{user:</span><span style="color:#6F42C1;">&quot;myroot&quot;</span><span style="color:#6F42C1;">,pwd:</span><span style="color:#6F42C1;">&quot;123456&quot;</span><span style="color:#6F42C1;">,roles:[</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;role&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;root&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;db&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:&quot;admin&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}</span><span style="color:#24292E;"> </span><span style="color:#032F62;">]}</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;"># 或</span></span>
<span class="line"><span style="color:#6F42C1;">db.createUser(</span><span style="color:#24292E;">{user:</span><span style="color:#6F42C1;">&quot;myroot&quot;</span><span style="color:#6F42C1;">,pwd:</span><span style="color:#6F42C1;">&quot;123456&quot;</span><span style="color:#6F42C1;">,roles:[</span><span style="color:#6F42C1;">&quot;root&quot;</span><span style="color:#6F42C1;">]}</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;"># 如果不指定数据库，则创建的指定的权限的用户在所有的数据库上有效，如 {role:&quot;userAdminAnyDatabase&quot;, db:&quot;&quot;}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 创建专门用来管理admin库的账号myadmin，只用来作为用户权限的管理</span></span>
<span class="line"><span style="color:#6F42C1;">db.createUser(</span><span style="color:#24292E;">{user:</span><span style="color:#6F42C1;">&quot;myadmin&quot;</span><span style="color:#6F42C1;">,pwd:</span><span style="color:#6F42C1;">&quot;123456&quot;</span><span style="color:#6F42C1;">,roles:[</span><span style="color:#24292E;">{role:</span><span style="color:#6F42C1;">&quot;userAdminAnyDatabase&quot;</span><span style="color:#6F42C1;">,db:</span><span style="color:#6F42C1;">&quot;admin&quot;</span><span style="color:#6F42C1;">}]}</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看已经创建了的用户的情况：</span></span>
<span class="line"><span style="color:#6F42C1;">db.system.users.find</span><span style="color:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;"># 删除用户</span></span>
<span class="line"><span style="color:#24292E;">db.dropUser(</span><span style="color:#6F42C1;">&quot;myadmin&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 认证测试：</span></span>
<span class="line"><span style="color:#6A737D;"># 切换到admin：</span></span>
<span class="line"><span style="color:#6F42C1;">use</span><span style="color:#24292E;"> </span><span style="color:#032F62;">admin</span></span>
<span class="line"><span style="color:#6A737D;"># 密码输错：</span></span>
<span class="line"><span style="color:#6F42C1;">db.auth(</span><span style="color:#6F42C1;">&quot;myroot&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;12345&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">Error:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Authentication</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failed.</span></span>
<span class="line"><span style="color:#6F42C1;">0</span></span>
<span class="line"><span style="color:#6A737D;"># 密码正确：</span></span>
<span class="line"><span style="color:#6F42C1;">db.auth(</span><span style="color:#6F42C1;">&quot;myroot&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;123456&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">1</span></span></code></pre></div><h4 id="_2、创建普通用户" tabindex="-1">2、创建普通用户 <a class="header-anchor" href="#_2、创建普通用户" aria-label="Permalink to &quot;2、创建普通用户&quot;">​</a></h4><p>  创建普通用户可以在没有开启认证的时候添加，也可以在开启认证之后添加，但开启认证之后，必须使用有操作admin库的用户登录认证后才能操作。底层都是将用户信息保存在了admin数据库的集合system.users中。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 创建(切换)将来要操作的数据库articledb,</span></span>
<span class="line"><span style="color:#F69D50;">use</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">articledb</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 创建用户，拥有articledb数据库的读写权限readWrite，密码是123456</span></span>
<span class="line"><span style="color:#F69D50;">db.createUser(</span><span style="color:#ADBAC7;">{user: </span><span style="color:#96D0FF;">&quot;bobo&quot;,</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">pwd:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;123456&quot;,</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">roles:</span><span style="color:#ADBAC7;"> [{ </span><span style="color:#F69D50;">role:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;readWrite&quot;,</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">db:&quot;articledb&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">}]}</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 测试是否可用</span></span>
<span class="line"><span style="color:#F69D50;">db.auth(</span><span style="color:#F69D50;">&quot;bobo&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;123456&quot;</span><span style="color:#ADBAC7;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 创建(切换)将来要操作的数据库articledb,</span></span>
<span class="line"><span style="color:#6F42C1;">use</span><span style="color:#24292E;"> </span><span style="color:#032F62;">articledb</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 创建用户，拥有articledb数据库的读写权限readWrite，密码是123456</span></span>
<span class="line"><span style="color:#6F42C1;">db.createUser(</span><span style="color:#24292E;">{user: </span><span style="color:#032F62;">&quot;bobo&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pwd:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;123456&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">roles:</span><span style="color:#24292E;"> [{ </span><span style="color:#6F42C1;">role:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;readWrite&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">db:&quot;articledb&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}]}</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 测试是否可用</span></span>
<span class="line"><span style="color:#6F42C1;">db.auth(</span><span style="color:#6F42C1;">&quot;bobo&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;123456&quot;</span><span style="color:#24292E;">)</span></span></code></pre></div><h4 id="_3、以开启认证的方式启动服务" tabindex="-1">3、以开启认证的方式启动服务 <a class="header-anchor" href="#_3、以开启认证的方式启动服务" aria-label="Permalink to &quot;3、以开启认证的方式启动服务&quot;">​</a></h4><p>  有两种方式开启权限认证启动服务：一种是参数方式，一种是配置文件方式。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 参数方式，在启动时指定参数 -- auth：</span></span>
<span class="line"><span style="color:#F69D50;">/usr/local/mongodb/bin/mongod</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">-f</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/mongodb/single/mongod.conf</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--auth</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 配置文件方式，在mongod.conf配置文件中加入，启动时不用加 --auth参数</span></span>
<span class="line"><span style="color:#F69D50;">security:</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#开启授权认证</span></span>
<span class="line"><span style="color:#F69D50;">authorization:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">enabled</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 参数方式，在启动时指定参数 -- auth：</span></span>
<span class="line"><span style="color:#6F42C1;">/usr/local/mongodb/bin/mongod</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/mongodb/single/mongod.conf</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--auth</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 配置文件方式，在mongod.conf配置文件中加入，启动时不用加 --auth参数</span></span>
<span class="line"><span style="color:#6F42C1;">security:</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">#开启授权认证</span></span>
<span class="line"><span style="color:#6F42C1;">authorization:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enabled</span></span></code></pre></div><h4 id="_4、开启了认证的情况下的客户端登录" tabindex="-1">4、开启了认证的情况下的客户端登录 <a class="header-anchor" href="#_4、开启了认证的情况下的客户端登录" aria-label="Permalink to &quot;4、开启了认证的情况下的客户端登录&quot;">​</a></h4><p>  有两种认证方式，一种是先登录，在mongo shell中认证；一种是登录时直接认证。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 先连接再认证</span></span>
<span class="line"><span style="color:#F69D50;">/usr/local/mongodb/bin/mongo</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--host</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">180.76</span><span style="color:#96D0FF;">.159.126</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--port27017</span></span>
<span class="line"><span style="color:#F69D50;">use</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">admin</span></span>
<span class="line"><span style="color:#F69D50;">db.auth(</span><span style="color:#F69D50;">&quot;myroot&quot;</span><span style="color:#F69D50;">,</span><span style="color:#F69D50;">&quot;123456&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 连接时直接认证</span></span>
<span class="line"><span style="color:#768390;"># 对admin数据库进行登录认证和相关操作：</span></span>
<span class="line"><span style="color:#F69D50;">/usr/local/mongodb/bin/mongo</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--host</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">180.76</span><span style="color:#96D0FF;">.159.126</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--port</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">27017</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--authenticationDatabase</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">admin</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">-u</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">myroot</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">-p</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">123456</span></span>
<span class="line"><span style="color:#768390;"># 对articledb数据库进行登录认证和相关操作</span></span>
<span class="line"><span style="color:#F69D50;">/usr/local/mongodb/bin/mongo</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--host</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">180.76</span><span style="color:#96D0FF;">.159.126</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--port</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">27017</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--authenticationDatabase</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">articledb</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">-u</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">bobo</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">-p</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">123456</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 先连接再认证</span></span>
<span class="line"><span style="color:#6F42C1;">/usr/local/mongodb/bin/mongo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--host</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">180.76</span><span style="color:#032F62;">.159.126</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port27017</span></span>
<span class="line"><span style="color:#6F42C1;">use</span><span style="color:#24292E;"> </span><span style="color:#032F62;">admin</span></span>
<span class="line"><span style="color:#6F42C1;">db.auth(</span><span style="color:#6F42C1;">&quot;myroot&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;123456&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 连接时直接认证</span></span>
<span class="line"><span style="color:#6A737D;"># 对admin数据库进行登录认证和相关操作：</span></span>
<span class="line"><span style="color:#6F42C1;">/usr/local/mongodb/bin/mongo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--host</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">180.76</span><span style="color:#032F62;">.159.126</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">27017</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--authenticationDatabase</span><span style="color:#24292E;"> </span><span style="color:#032F62;">admin</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-u</span><span style="color:#24292E;"> </span><span style="color:#032F62;">myroot</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">123456</span></span>
<span class="line"><span style="color:#6A737D;"># 对articledb数据库进行登录认证和相关操作</span></span>
<span class="line"><span style="color:#6F42C1;">/usr/local/mongodb/bin/mongo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--host</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">180.76</span><span style="color:#032F62;">.159.126</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">27017</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--authenticationDatabase</span><span style="color:#24292E;"> </span><span style="color:#032F62;">articledb</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-u</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bobo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">123456</span></span></code></pre></div><h4 id="_5、springdatamongodb连接认证" tabindex="-1">5、SpringDataMongoDB连接认证 <a class="header-anchor" href="#_5、springdatamongodb连接认证" aria-label="Permalink to &quot;5、SpringDataMongoDB连接认证&quot;">​</a></h4><p>  使用用户名和密码连接到 MongoDB 服务器，必须使用&#39;username:password@hostname/dbname&#39; 格式</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">uri:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">mongodb://bobo:123456@180.76.159.126:27017/articledb</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">uri:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mongodb://bobo:123456@180.76.159.126:27017/articledb</span></span></code></pre></div><h3 id="副本集环境的安全认证" tabindex="-1">副本集环境的安全认证 <a class="header-anchor" href="#副本集环境的安全认证" aria-label="Permalink to &quot;副本集环境的安全认证&quot;">​</a></h3><p>  副本集和共享集群的各个节点成员之间使用内部身份验证，可以使用密钥文件或x.509证书。</p><p>  密钥文件比较简单，密钥文件的内容必须在6到1024个字符之间，并且在unix/linux系统中文件所有者必须有对文件至少有读的权限。官方推荐如果是测试环境可以使用密钥文件，但是正式环境，官方推荐x.509证书。原理就是，集群中每一个实例彼此连接的时候都检验彼此使用的证书的内容是否相同。只有证书相同的实例彼此才可以访问。</p><h4 id="_1、通过主节点添加一个管理员帐号" tabindex="-1">1、通过主节点添加一个管理员帐号 <a class="header-anchor" href="#_1、通过主节点添加一个管理员帐号" aria-label="Permalink to &quot;1、通过主节点添加一个管理员帐号&quot;">​</a></h4><p>  只需要在主节点上添加用户，副本集会自动同步</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 创建超管用户：myroot，密码：123456</span></span>
<span class="line"><span style="color:#F69D50;">use</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">admin</span></span>
<span class="line"><span style="color:#F69D50;">db.createUser(</span><span style="color:#ADBAC7;">{user:</span><span style="color:#F69D50;">&quot;myroot&quot;</span><span style="color:#F69D50;">,pwd:</span><span style="color:#F69D50;">&quot;123456&quot;</span><span style="color:#F69D50;">,roles:[</span><span style="color:#F69D50;">&quot;root&quot;</span><span style="color:#F69D50;">]}</span><span style="color:#ADBAC7;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 创建超管用户：myroot，密码：123456</span></span>
<span class="line"><span style="color:#6F42C1;">use</span><span style="color:#24292E;"> </span><span style="color:#032F62;">admin</span></span>
<span class="line"><span style="color:#6F42C1;">db.createUser(</span><span style="color:#24292E;">{user:</span><span style="color:#6F42C1;">&quot;myroot&quot;</span><span style="color:#6F42C1;">,pwd:</span><span style="color:#6F42C1;">&quot;123456&quot;</span><span style="color:#6F42C1;">,roles:[</span><span style="color:#6F42C1;">&quot;root&quot;</span><span style="color:#6F42C1;">]}</span><span style="color:#24292E;">)</span></span></code></pre></div><h4 id="_2、创建副本集认证的key文件" tabindex="-1">2、创建副本集认证的key文件 <a class="header-anchor" href="#_2、创建副本集认证的key文件" aria-label="Permalink to &quot;2、创建副本集认证的key文件&quot;">​</a></h4><p>  所有副本集节点都必须要用同一份keyfile，一般是在一台机器上生成，然后拷贝到其他机器上，且必须有读的权限</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 1、生成一个key文件到当前文件夹中。可以使用任何方法生成密钥文件。</span></span>
<span class="line"><span style="color:#F69D50;">openssl</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">rand</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">-base64</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">90</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">-out</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">./mongo.keyfile</span></span>
<span class="line"><span style="color:#768390;"># 2、使用chmod来更改文件权限，仅为文件所有者提供读取权限</span></span>
<span class="line"><span style="color:#F69D50;">chmod</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">400</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">./mongo.keyfile</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 1、生成一个key文件到当前文件夹中。可以使用任何方法生成密钥文件。</span></span>
<span class="line"><span style="color:#6F42C1;">openssl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rand</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-base64</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">90</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-out</span><span style="color:#24292E;"> </span><span style="color:#032F62;">./mongo.keyfile</span></span>
<span class="line"><span style="color:#6A737D;"># 2、使用chmod来更改文件权限，仅为文件所有者提供读取权限</span></span>
<span class="line"><span style="color:#6F42C1;">chmod</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">400</span><span style="color:#24292E;"> </span><span style="color:#032F62;">./mongo.keyfile</span></span></code></pre></div><h4 id="_3、修改配置文件指定keyfile" tabindex="-1">3、修改配置文件指定keyfile <a class="header-anchor" href="#_3、修改配置文件指定keyfile" aria-label="Permalink to &quot;3、修改配置文件指定keyfile&quot;">​</a></h4><p>  分别编辑几个服务的mongod.conf文件，添加相关内容</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">security:</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#KeyFile鉴权文件</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">keyFile:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/mongodb/replica_sets/myrs_27017/mongo.keyfile</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#开启认证方式运行</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">authorization:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">enabled</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">security:</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">#KeyFile鉴权文件</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">keyFile:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/mongodb/replica_sets/myrs_27017/mongo.keyfile</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">#开启认证方式运行</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">authorization:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enabled</span></span></code></pre></div><h4 id="_4、springdatamongodb连接副本集的认证" tabindex="-1">4、SpringDataMongoDB连接副本集的认证 <a class="header-anchor" href="#_4、springdatamongodb连接副本集的认证" aria-label="Permalink to &quot;4、SpringDataMongoDB连接副本集的认证&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">uri:</span></span>
<span class="line"><span style="color:#F69D50;">mongodb://bobo:123456@180.76.159.126:27017,180.76.159.126:27018,180.76.159.126:27019/articledb?</span></span>
<span class="line"><span style="color:#ADBAC7;">        connect</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">replicaSet</span><span style="color:#ADBAC7;">&amp;slaveOk</span><span style="color:#F47067;">=</span><span style="color:#6CB6FF;">true</span><span style="color:#ADBAC7;">&amp;replicaSet</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">myrs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">uri:</span></span>
<span class="line"><span style="color:#6F42C1;">mongodb://bobo:123456@180.76.159.126:27017,180.76.159.126:27018,180.76.159.126:27019/articledb?</span></span>
<span class="line"><span style="color:#24292E;">        connect</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">replicaSet</span><span style="color:#24292E;">&amp;slaveOk</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">&amp;replicaSet</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">myrs</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-462c643b data-v-f6bde3e6><!--[--><!--]--><div class="edit-info" data-v-f6bde3e6><!----><div class="last-updated" data-v-f6bde3e6><p class="VPLastUpdated" data-v-f6bde3e6 data-v-cfcf869c>最后更新: <time datetime="2023-08-12T07:30:38.000Z" data-v-cfcf869c></time></p></div></div><div class="prev-next" data-v-f6bde3e6><div class="pager" data-v-f6bde3e6><a class="pager-link prev" href="/charles-blog/md/database/ElkStack.html" data-v-f6bde3e6><span class="desc" data-v-f6bde3e6>上一篇</span><span class="title" data-v-f6bde3e6>ELK Stack</span></a></div><div class="has-prev pager" data-v-f6bde3e6><a class="pager-link next" href="/charles-blog/md/database/Cache.html" data-v-f6bde3e6><span class="desc" data-v-f6bde3e6>下一篇</span><span class="title" data-v-f6bde3e6>缓存</span></a></div></div></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"md_test_child1.md\":\"6f9aed24\",\"md_test_lin_index.md\":\"706ea71f\",\"md_test_index.md\":\"a179ba4f\",\"md_test_zhu_index.md\":\"2c99a562\",\"md_about_index.md\":\"4984c4d8\",\"md_database_cache.md\":\"ee1e9375\",\"index.md\":\"4503a516\",\"md_environment_index.md\":\"4e1f2168\",\"md_distributed_index.md\":\"85eafa6b\",\"md_environment_docker.md\":\"6d9d0c36\",\"md_database_oracle.md\":\"7147de3e\",\"md_environment_shell.md\":\"779c4602\",\"md_database_mongodb.md\":\"ed78548e\",\"md_environment_linux.md\":\"9e61f6d8\",\"md_database_elkstack.md\":\"ca5582c6\",\"md_database_redis.md\":\"2eb607ad\",\"md_java_index.md\":\"8e3f7d5f\",\"md_distributed_singlesignon.md\":\"e9469380\",\"md_database_index.md\":\"8ef353e5\",\"md_database_mysql.md\":\"c1f317d9\",\"md_java_javaother_java8.md\":\"98624343\",\"md_java_javaother_designpatterns.md\":\"0858d58e\",\"md_java_javaother_javainterviewquestions.md\":\"b05c4f2a\",\"md_java_javaother_lock.md\":\"1b11e871\",\"md_java_javaunderlayer_classloader.md\":\"a28e97d8\",\"md_java_javaunderlayer_gc.md\":\"8b102f85\",\"md_java_javaother_regularexpression.md\":\"dbb63f3f\",\"md_java_javaunderlayer_memoryleak.md\":\"0d57ac68\",\"md_java_spring_springannotations.md\":\"89640029\",\"md_java_mybatis_mybatis.md\":\"d9803a83\",\"md_java_javaweb_javaweb.md\":\"cc6cf75c\",\"md_java_javaother_synchronized.md\":\"ee25ab08\",\"md_java_javaunderlayer_hash.md\":\"e1bfbdd6\",\"md_java_javaother_thread.md\":\"2ad6e1e2\",\"md_java_spring_springmvc.md\":\"d3ce0b21\",\"md_java_spring_springtransaction.md\":\"ef9c6d8a\",\"md_java_mybatis_mybatisplus.md\":\"a46e638f\",\"md_middleware_jms.md\":\"ac6f5658\",\"md_middleware_nginx.md\":\"2bf5bd09\",\"md_middleware_arthas.md\":\"ed6d7630\",\"md_java_javaunderlayer_jvm.md\":\"4a6ccd9b\",\"md_middleware_activemq.md\":\"45ec1a9b\",\"md_network_ip.md\":\"b8f18932\",\"md_network_dns.md\":\"7a6bd009\",\"md_middleware_zookeeper.md\":\"7a7e70a5\",\"md_network_conversationtechnolog.md\":\"f21c82a7\",\"md_network_loadbalance.md\":\"1714c06e\",\"md_network_mac.md\":\"992dbcbd\",\"md_network_tcp.md\":\"fcf7ac1f\",\"md_network_index.md\":\"09603bc1\",\"md_java_spring_spring.md\":\"a80a4f49\",\"md_java_spring_springboot.md\":\"5bba519d\",\"md_middleware_kafka.md\":\"3238de67\",\"md_network_model.md\":\"7a0f94c4\",\"md_network_https.md\":\"1fbe42dd\",\"md_middleware_index.md\":\"1c4b5f2c\",\"md_network_http.md\":\"fa7644b0\",\"md_network_networkdevices.md\":\"7a850f72\",\"md_middleware_rabbitmq.md\":\"17ee6046\"}")
__VP_SITE_DATA__ = JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"小朱杂记\",\"description\":\"My Document\",\"base\":\"/charles-blog/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Java\",\"link\":\"/md/java/\",\"activeMatch\":\"/md/java/\"},{\"text\":\"数据库\",\"link\":\"/md/database/\",\"activeMatch\":\"/md/database/\"},{\"text\":\"中间件\",\"link\":\"/md/middleware/\",\"activeMatch\":\"/md/middleware/\"},{\"text\":\"网络\",\"link\":\"/md/network/\",\"activeMatch\":\"/md/network/\"},{\"text\":\"环境\",\"link\":\"/md/environment/\",\"activeMatch\":\"/md/environment/\"},{\"text\":\"分布式\",\"link\":\"/md/distributed/\",\"activeMatch\":\"/md/distributed/\"},{\"text\":\"关于我\",\"link\":\"/md/about/\"}],\"sidebar\":{\"/md/java/\":[{\"text\":\"Java\",\"link\":\"/md/java/\",\"items\":[{\"text\":\"Spring \",\"collapsed\":true,\"items\":[{\"text\":\"Spring杂叙\",\"link\":\"/md/java/spring/Spring\"},{\"text\":\"SpringMvc\",\"link\":\"/md/java/spring/SpringMVC\"},{\"text\":\"SpringBoot\",\"link\":\"/md/java/spring/SpringBoot\"},{\"text\":\"Spring事务\",\"link\":\"/md/java/spring/SpringTransaction\"},{\"text\":\"Spring注解\",\"link\":\"/md/java/spring/SpringAnnotations\"}]},{\"text\":\"Java底层\",\"collapsed\":true,\"items\":[{\"text\":\"JVM\",\"link\":\"/md/java/javaUnderlayer/JVM\"},{\"text\":\"GC\",\"link\":\"/md/java/javaUnderlayer/GC\"},{\"text\":\"内存泄漏\",\"link\":\"/md/java/javaUnderlayer/MemoryLeak\"},{\"text\":\"哈希(Hash)\",\"link\":\"/md/java/javaUnderlayer/Hash\"},{\"text\":\"类加载器\",\"link\":\"/md/java/javaUnderlayer/ClassLoader\"}]},{\"text\":\"JavaWeb\",\"collapsed\":true,\"items\":[{\"text\":\"JavaWeb杂叙\",\"link\":\"/md/java/javaWeb/JavaWeb\"}]},{\"text\":\"Java其他\",\"collapsed\":true,\"items\":[{\"text\":\"Java8\",\"link\":\"/md/java/javaOther/Java8\"},{\"text\":\"锁\",\"link\":\"/md/java/javaOther/Lock\"},{\"text\":\"Synchronized\",\"link\":\"/md/java/javaOther/Synchronized\"},{\"text\":\"浅谈设计模式\",\"link\":\"/md/java/javaOther/DesignPatterns\"},{\"text\":\"进程，线程，线程池，调度\",\"link\":\"/md/java/javaOther/Thread\"},{\"text\":\"正则表达式\",\"link\":\"/md/java/javaOther/RegularExpression\"},{\"text\":\"Java面试题\",\"link\":\"/md/java/javaOther/JavaInterviewQuestions\"}]},{\"text\":\"Mybatis\",\"collapsed\":true,\"items\":[{\"text\":\"Mybatis杂叙\",\"link\":\"/md/java/mybatis/Mybatis\"},{\"text\":\"Mybatis-Plus\",\"link\":\"/md/java/mybatis/MybatisPlus\"}]}]}],\"/md/database/\":[{\"text\":\"数据库\",\"link\":\"/md/database/\",\"items\":[{\"text\":\"MySQL\",\"link\":\"/md/database/Mysql\"},{\"text\":\"Oracle\",\"link\":\"/md/database/Oracle\"},{\"text\":\"Redis\",\"link\":\"/md/database/Redis\"},{\"text\":\"ELK Stack\",\"link\":\"/md/database/ElkStack\"},{\"text\":\"MongoDB\",\"link\":\"/md/database/MongoDB\"},{\"text\":\"缓存\",\"link\":\"/md/database/Cache\"}]}],\"/md/network/\":[{\"text\":\"网络\",\"link\":\"/md/network/\",\"items\":[{\"text\":\"网络模型\",\"link\":\"/md/network/Model\"},{\"text\":\"HTTP\",\"link\":\"/md/network/Http\"},{\"text\":\"HTTPS\",\"link\":\"/md/network/Https\"},{\"text\":\"TCP\",\"link\":\"/md/network/Tcp\"},{\"text\":\"IP\",\"link\":\"/md/network/Ip\"},{\"text\":\"MAC\",\"link\":\"/md/network/Mac\"},{\"text\":\"DNS\",\"link\":\"/md/network/Dns\"},{\"text\":\"会话技术\",\"link\":\"/md/network/ConversationTechnolog\"},{\"text\":\"常见的网络设备\",\"link\":\"/md/network/NetworkDevices\"},{\"text\":\"负载均衡\",\"link\":\"/md/network/LoadBalance\"}]}],\"/md/environment/\":[{\"text\":\"环境\",\"link\":\"/md/environment/\",\"items\":[{\"text\":\"Linux\",\"link\":\"/md/environment/Linux\"},{\"text\":\"Shell\",\"link\":\"/md/environment/Shell\"},{\"text\":\"Docker\",\"link\":\"/md/environment/Docker\"}]}],\"/md/distributed/\":[{\"text\":\"分布式\",\"items\":[{\"text\":\"单点登陆\",\"link\":\"/md/distributed/SingleSignOn\"},{\"text\":\"分布式系统\",\"link\":\"/md/distributed/\"}]}],\"/md/middleware/\":[{\"text\":\"中间件\",\"link\":\"/md/middleware/\",\"items\":[{\"text\":\"Nginx\",\"link\":\"/md/middleware/Nginx\"},{\"text\":\"RabbitMQ\",\"link\":\"/md/middleware/Rabbitmq\"},{\"text\":\"Zookeeper\",\"link\":\"/md/middleware/Zookeeper\"},{\"text\":\"Arthas\",\"link\":\"/md/middleware/Arthas\"},{\"text\":\"JMS\",\"link\":\"/md/middleware/Jms\"},{\"text\":\"ActiveMQ\",\"link\":\"/md/middleware/ActiveMq\"},{\"text\":\"Kafka\",\"link\":\"/md/middleware/Kafka\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/CharleZhuJJ/charles-blog\"}],\"outline\":{\"level\":\"deep\",\"label\":\"目录\"},\"darkModeSwitchLabel\":\"切换日光/暗黑模式\",\"sidebarMenuLabel\":\"文章\",\"returnToTopLabel\":\"返回顶部\",\"lastUpdatedText\":\"最后更新\",\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"},\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}")</script>
    
  </body>
</html>