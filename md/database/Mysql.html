<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL | 小朱杂记</title>
    <meta name="description" content="My Document">
    <link rel="preload stylesheet" href="/charles-blog/assets/style.59210d54.css" as="style">
    <script type="module" src="/charles-blog/assets/app.67cc4fde.js"></script>
    <link rel="preload" href="/charles-blog/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
  <link rel="modulepreload" href="/charles-blog/assets/chunks/framework.981adca9.js">
  <link rel="modulepreload" href="/charles-blog/assets/chunks/theme.9dbacb91.js">
  <link rel="modulepreload" href="/charles-blog/assets/chunks/ArticleMetadata.8b6b367a.js">
  <link rel="modulepreload" href="/charles-blog/assets/md_database_Mysql.md.c1f317d9.lean.js">
  <link rel="icon" href="/charles-blog/favicon.ico">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-fc105c82><!--[--><!--]--><!--[--><span tabindex="-1" data-v-827f7975></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-827f7975> Skip to content </a><!--]--><!----><header class="VPNav" data-v-fc105c82 data-v-4765fb17><div class="VPNavBar has-sidebar" data-v-4765fb17 data-v-c560f0cd><div class="container" data-v-c560f0cd><div class="title" data-v-c560f0cd><div class="VPNavBarTitle has-sidebar" data-v-c560f0cd data-v-ebec4beb><a class="title" href="/charles-blog/" data-v-ebec4beb><!--[--><!--]--><!----><!--[-->小朱杂记<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-c560f0cd><div class="curtain" data-v-c560f0cd></div><div class="content-body" data-v-c560f0cd><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-c560f0cd><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-c560f0cd data-v-8a05be25><span id="main-nav-aria-label" class="visually-hidden" data-v-8a05be25>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/java/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->Java<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/charles-blog/md/database/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->数据库<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/middleware/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->中间件<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/network/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->网络<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/environment/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->环境<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/distributed/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->分布式<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/about/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->关于我<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-c560f0cd data-v-7489216d><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-7489216d data-v-c852f474 data-v-43044c5b><span class="check" data-v-43044c5b><span class="icon" data-v-43044c5b><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-c852f474><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-c852f474><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-c560f0cd data-v-46915da0 data-v-5e7b6306><!--[--><a class="VPSocialLink" href="https://github.com/CharleZhuJJ/charles-blog" aria-label="github" target="_blank" rel="noopener" data-v-5e7b6306 data-v-5124df20><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-c560f0cd data-v-0f46c100 data-v-fa61944e><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-fa61944e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-fa61944e><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-fa61944e><div class="VPMenu" data-v-fa61944e data-v-4eba600d><!----><!--[--><!--[--><!----><div class="group" data-v-0f46c100><div class="item appearance" data-v-0f46c100><p class="label" data-v-0f46c100>切换日光/暗黑模式</p><div class="appearance-action" data-v-0f46c100><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-0f46c100 data-v-c852f474 data-v-43044c5b><span class="check" data-v-43044c5b><span class="icon" data-v-43044c5b><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-c852f474><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-c852f474><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-0f46c100><div class="item social-links" data-v-0f46c100><div class="VPSocialLinks social-links-list" data-v-0f46c100 data-v-5e7b6306><!--[--><a class="VPSocialLink" href="https://github.com/CharleZhuJJ/charles-blog" aria-label="github" target="_blank" rel="noopener" data-v-5e7b6306 data-v-5124df20><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-c560f0cd data-v-05cc2436><span class="container" data-v-05cc2436><span class="top" data-v-05cc2436></span><span class="middle" data-v-05cc2436></span><span class="bottom" data-v-05cc2436></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-fc105c82 data-v-c9d1ee7c><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-c9d1ee7c><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-c9d1ee7c><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-c9d1ee7c>文章</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-c9d1ee7c data-v-43a3820c><button data-v-43a3820c>返回顶部</button><!----></div></div><aside class="VPSidebar" data-v-fc105c82 data-v-def99251><div class="curtain" data-v-def99251></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-def99251><span class="visually-hidden" id="sidebar-aria-label" data-v-def99251> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-def99251><section class="VPSidebarItem level-0 is-link has-active" data-v-def99251 data-v-94aa024f><div class="item" tabindex="0" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/database/" data-v-94aa024f data-v-a8e5736d><!--[--><h2 class="text" data-v-94aa024f>数据库</h2><!--]--><!----></a><!----></div><div class="items" data-v-94aa024f><!--[--><div class="VPSidebarItem level-1 is-link is-active has-active" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/database/Mysql.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>MySQL</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/database/Oracle.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>Oracle</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/database/Redis.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>Redis</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/database/ElkStack.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>ELK Stack</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/database/MongoDB.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>MongoDB</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/database/Cache.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>缓存</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-fc105c82 data-v-6c89610d><div class="VPDoc has-sidebar has-aside" data-v-6c89610d data-v-462c643b><!--[--><!--]--><div class="container" data-v-462c643b><div class="aside" data-v-462c643b><div class="aside-curtain" data-v-462c643b></div><div class="aside-container" data-v-462c643b><div class="aside-content" data-v-462c643b><div class="VPDocAside" data-v-462c643b data-v-eda16060><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-eda16060 data-v-5a905545><div class="content" data-v-5a905545><div class="outline-marker" data-v-5a905545></div><div class="outline-title" data-v-5a905545>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-5a905545><span class="visually-hidden" id="doc-outline-aria-label" data-v-5a905545> Table of Contents for current page </span><ul class="root" data-v-5a905545 data-v-ce114d19><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-eda16060></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-462c643b><div class="content-container" data-v-462c643b><!--[--><!--]--><!----><main class="main" data-v-462c643b><div style="position:relative;" class="vp-doc _charles-blog_md_database_Mysql" data-v-462c643b><div><h1 id="mysql" tabindex="-1">MySQL <a class="header-anchor" href="#mysql" aria-label="Permalink to &quot;MySQL&quot;">​</a></h1><!----><h2 id="mysql体系结构" tabindex="-1">MySQL体系结构 <a class="header-anchor" href="#mysql体系结构" aria-label="Permalink to &quot;MySQL体系结构&quot;">​</a></h2><p><img src="/charles-blog/assets/MysqlInstruction.30b39db8.png" alt="MysqlInstruction"></p><ul><li>Connectors：指不同语言与SQL的交互</li><li>Management Services &amp; Utilities：系统管理和控制工具，例如备份恢复、Mysql复制、集群等</li><li>Connection Pool：连接池，管理缓冲用户连接</li><li>SQL Interface：SQL接口，接受用户的SQL命令，并且返回用户需要查询的结果。比如select from就是调用SQL Interface</li><li>Parser：解析器，SQL命令传递到解析器的时候会被解析器验证和解析。 <ul><li>a. 将SQL语句分解成数据结构，并将这个结构传递到后续步骤，以后SQL语句的传递和处理就是基于这个结构的</li><li>b. 如果在分解构成中遇到错误，那么就说明这个sql语句是不合理的</li></ul></li><li>Optimizer：查询优化器，SQL语句在查询之前会使用查询优化器对查询进行优化。</li><li>Caches &amp; Buffers：查询缓存，如果查询缓存有命中的查询结果，查询语句就可以直接去查询缓存中取数据。</li><li>Engines：存储引擎，Mysql的存储引擎是插件式的。</li></ul><h3 id="_1、连接层" tabindex="-1">1、连接层 <a class="header-anchor" href="#_1、连接层" aria-label="Permalink to &quot;1、连接层&quot;">​</a></h3><p>  最上层是一些客户端和链接服务，包含本地sock通信和大多数基于客户端/服务端工具实现的类似于TCP/IP的通信。 主要完成一些类似于连接处理、授权认证、及相关的安全方案。在该层上引入了线程池的概念，为通过认证安全接入的客户端提供线程。同样在该层上可以实现基于SSL的安全链接 。服务器也会为安全接入的每个客户端验证它所具有的操作权限。</p><h3 id="_2、服务层" tabindex="-1">2、服务层 <a class="header-anchor" href="#_2、服务层" aria-label="Permalink to &quot;2、服务层&quot;">​</a></h3><p>  第二层架构主要完成大多数的核心服务功能，如 SQL接口，并完成缓存的查询，SQL的分析和优化，部分内置函数的执行 。所有跨存储引擎的功能也在这一层实现，如过程、函数等。在该层，服务器会解析查询并创建相应的内部解析树，并对其完成相应的优化如确定表的查询的顺序，是否利用索引等， 最后生成相应的执行操作。 如果是select语句，服务器还会查询内部的缓存，如果缓存空间足够大，这样在解决大量读操作的环境中能够很好的提升系统的性能。</p><h3 id="_3、引擎层" tabindex="-1">3、引擎层 <a class="header-anchor" href="#_3、引擎层" aria-label="Permalink to &quot;3、引擎层&quot;">​</a></h3><p>  存储引擎层， 存储引擎真正的负责了MySQL中数据的存储和提取，服务器通过API和存储引擎进行通信 。不同的存储引擎具有不同的功能，这样我们可以根据自己的需要，来选取合适的存储引擎。</p><h3 id="_4、存储层" tabindex="-1">4、存储层 <a class="header-anchor" href="#_4、存储层" aria-label="Permalink to &quot;4、存储层&quot;">​</a></h3><p>  数据存储层， 主要是将数据存储在文件系统之上，并完成与存储引擎的交互。</p><h3 id="特点" tabindex="-1">特点 <a class="header-anchor" href="#特点" aria-label="Permalink to &quot;特点&quot;">​</a></h3><p>  和其他数据库相比，MySQL有点与众不同，它的架构可以在多种不同场景中应用并发挥良好作用。主要体现在存储引擎上，插件式的存储引擎架构，将查询处理和其他的系统任务以及数据的存储提取分离。这种架构可以根据业务的需求和实际需要选择合适的存储引擎。</p><h2 id="mysql存储引擎" tabindex="-1">MySQL存储引擎 <a class="header-anchor" href="#mysql存储引擎" aria-label="Permalink to &quot;MySQL存储引擎&quot;">​</a></h2><p>  Mysql中的数据用各种不同的技术存储在文件（或内存）中。这些技术中的每一种技术都使用不同的存储机制、索引技巧、锁定水平并且最终提供广泛的不同的功能和能力。这些不同的技术以及配套的相关功能在MySQL中被称为存储引擎（也称作表类型）。</p><p>  可以通过指定 show engines ，来查询当前数据库支持的存储引擎</p><h3 id="inndb" tabindex="-1">InnDB <a class="header-anchor" href="#inndb" aria-label="Permalink to &quot;InnDB&quot;">​</a></h3><p>  InnDB是5.5版本后MySQL的默认存储引擎，事务性数据库的首选，支持ACID事务，支持行级锁定；适合处理多重并发的更新请求；事务；自动灾难恢复；支持外键；支持自动增加列AUTO_INCREMENT属性</p><p>  但是对比MyISAM的存储引擎，InnoDB写的处理效率差一些，并且占用更多的磁盘空间以保留数据和索引。</p><h4 id="存储方式" tabindex="-1">存储方式 <a class="header-anchor" href="#存储方式" aria-label="Permalink to &quot;存储方式&quot;">​</a></h4><ol><li>使用共享表空间存储， 这种方式创建的表的表结构保存在.frm文件中， 数据和索引保存在innodb_data_home_dir 和 innodb_data_file_path定义的表空间中，可以是多个文件。</li><li>使用多表空间存储，这种方式创建表的结构仍然存在.frm文件中，但是每个表的数据和索引单独保存在.ibd中。</li></ol><h3 id="myisam" tabindex="-1">MyISAM <a class="header-anchor" href="#myisam" aria-label="Permalink to &quot;MyISAM&quot;">​</a></h3><p>  拥有较高的插入，查询速度，但不支持事务；强调的是性能。二进制数据文件可以在不同操作数据系统中迁移。</p><p>  适合管理邮件或Web服务器日志数据</p><h3 id="bdb" tabindex="-1">BDB <a class="header-anchor" href="#bdb" aria-label="Permalink to &quot;BDB&quot;">​</a></h3><p>  源自Berkeley DB，事务性数据库的另一种选择，支持COMMIT和ROLLBACK等其他事务特性；</p><h3 id="memory" tabindex="-1">Memory <a class="header-anchor" href="#memory" aria-label="Permalink to &quot;Memory&quot;">​</a></h3><p>  所有数据置于内存的存储引擎，拥有极高的插入，更新和查询效率。但会占用和数据量成正比的内存空间。并且内容在Mysql重新启动时丢失；</p><ol><li>目标数据较小，而且被非常频繁地访问；</li><li>数据是临时的，而且要求必须立即可用；</li><li>数据丢失不会对应用服务器产生实质的负面影响</li></ol><h3 id="merge" tabindex="-1">Merge <a class="header-anchor" href="#merge" aria-label="Permalink to &quot;Merge&quot;">​</a></h3><p>  将一定数量的MyISAM表联合而成一个整体，在超大规模数据存储时很有用；</p><p>  几个相同的MyISAM表的聚合；merge表中没有数据，对Mergr类型的表可以进行查询、更新、删除操作，实际上是对内部的MyISAM表操作；</p><h3 id="archive" tabindex="-1">Archive <a class="header-anchor" href="#archive" aria-label="Permalink to &quot;Archive&quot;">​</a></h3><p>  非常适合存储大量的独立的，作为历史记录的数据。因为它们不经常被读取。Archive拥有高效的插入速度，但其对查询的支持相对较差；</p><p>  Archive是归纳；使用zlib压缩库，在记录被请求时实时压缩，经常被用来当作仓库使用。</p><h3 id="federated" tabindex="-1">Federated <a class="header-anchor" href="#federated" aria-label="Permalink to &quot;Federated&quot;">​</a></h3><p>  将不同的Mysql服务器联合起来，逻辑上组成一个完整的数据库。非常适合分布式应用；</p><h3 id="cluster-ndb" tabindex="-1">Cluster/NDB <a class="header-anchor" href="#cluster-ndb" aria-label="Permalink to &quot;Cluster/NDB&quot;">​</a></h3><p>  高冗余的存储引擎，用多台数据机器联合提供服务以提高整体性能和安全性。适合数据量大，安全和性能要求高的应用；</p><h3 id="csv" tabindex="-1">CSV <a class="header-anchor" href="#csv" aria-label="Permalink to &quot;CSV&quot;">​</a></h3><p>  逻辑上由逗号分割数据的存储引擎。它会在数据库子目录里为每个数据表创建一个.CSV文件。这是一种普通文本文件，每个数据行占用一个文本行。CSV存储引擎不支持索引。</p><h3 id="blackhole" tabindex="-1">BlackHole <a class="header-anchor" href="#blackhole" aria-label="Permalink to &quot;BlackHole&quot;">​</a></h3><p>  黑洞引擎，写入的任何数据都会消失，一般用于记录binlog做复制的中继</p><h2 id="mysql文件类型" tabindex="-1">MySQL文件类型 <a class="header-anchor" href="#mysql文件类型" aria-label="Permalink to &quot;MySQL文件类型&quot;">​</a></h2><h3 id="_1、参数文件-my-cnf" tabindex="-1">1、参数文件(my.cnf) <a class="header-anchor" href="#_1、参数文件-my-cnf" aria-label="Permalink to &quot;1、参数文件(my.cnf)&quot;">​</a></h3><p>  mysql实例启动时，会先读取配置参数文件my.cnf，用于寻找数据库的各种文件所在的位置以及制定某些初始化参数</p><p>  参数文件中的类型可以分两种类型，动态参数（dynamic）和静态参数（static）</p><ul><li>动态参数：可以在mysql实例运行的时候进行修改，修改后别的connection重新进行连接就可以生效。如：set global sort_buffer_size = 329999；</li><li>静态参数：在整个mysql实例运行期间不得进行修改。</li></ul><h3 id="_2、日志文件" tabindex="-1">2、日志文件 <a class="header-anchor" href="#_2、日志文件" aria-label="Permalink to &quot;2、日志文件&quot;">​</a></h3><p>  记录了Mysql对数据的操作，Mysql运行的情况等等。Mysql也需要日志文件来保证事务的正常运行。</p><p>  Mysql主要包括以下几种日志：错误日志、查询日志、慢查询日志、事务日志、二进制日志；</p><h4 id="_2-1、错误日志" tabindex="-1">2.1、错误日志 <a class="header-anchor" href="#_2-1、错误日志" aria-label="Permalink to &quot;2.1、错误日志&quot;">​</a></h4><p>  错误日志对mysql的启动，运行，关闭过程进行了记录。该文件不但记录了出错信息，还记录一些警告信息以及正确的信息</p><h4 id="_2-2、慢查询日志-slow-log" tabindex="-1">2.2、慢查询日志（slow log） <a class="header-anchor" href="#_2-2、慢查询日志-slow-log" aria-label="Permalink to &quot;2.2、慢查询日志（slow log）&quot;">​</a></h4><p>  慢查询日志就是记录运行较慢的sql语句信息。可以设置一个阈值，将运行时间超过该阈值的sql语句的运行信息记录到slow log日志里，运行时间等于阈值，不会记录到slow log。</p><p>  阈值可以通过long_query_time来设置。show variables like &#39;long_query_time&#39;查询阈值。log_queries_not_using_indexes，如果sql没有使用索引也会记录</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 该参数用来控制慢查询日志是否开启，可取值：1 和 0 ，1代表开启，0代表关闭</span></span>
<span class="line"><span style="color:#ADBAC7;">slow_query_log</span><span style="color:#F47067;">=</span><span style="color:#6CB6FF;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 该参数用来指定慢查询日志的文件名</span></span>
<span class="line"><span style="color:#ADBAC7;">slow_query_log_file</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">slow_query.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 该选项用来配置查询的时间限制， 超过这个时间将认为值慢查询， 将需要进行日志记录， 默认10s</span></span>
<span class="line"><span style="color:#ADBAC7;">long_query_time</span><span style="color:#F47067;">=</span><span style="color:#6CB6FF;">10</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 该参数用来控制慢查询日志是否开启，可取值：1 和 0 ，1代表开启，0代表关闭</span></span>
<span class="line"><span style="color:#24292E;">slow_query_log</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 该参数用来指定慢查询日志的文件名</span></span>
<span class="line"><span style="color:#24292E;">slow_query_log_file</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">slow_query.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 该选项用来配置查询的时间限制， 超过这个时间将认为值慢查询， 将需要进行日志记录， 默认10s</span></span>
<span class="line"><span style="color:#24292E;">long_query_time</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">10</span></span></code></pre></div><h4 id="_2-3、全查询日志-general-log" tabindex="-1">2.3、全查询日志（general log） <a class="header-anchor" href="#_2-3、全查询日志-general-log" aria-label="Permalink to &quot;2.3、全查询日志（general log）&quot;">​</a></h4><p>  记录了对mysql数据库所有的信息请求，不论这些请求信息是否得到了正确的执行。</p><p>  默认情况下MySQL查询日志是关闭的。生产环境，如果开启MySQL查询日志，对性能还是有蛮大的影响。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">#该选项用来开启查询日志 ， 可选值 ：0或者1； 0代表关闭，1代表开启</span></span>
<span class="line"><span style="color:#ADBAC7;">general_log</span><span style="color:#F47067;">=</span><span style="color:#6CB6FF;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">#设置日志的文件名 ， 如果没有指定， 默认的文件名为 host_name.log</span></span>
<span class="line"><span style="color:#ADBAC7;">general_log_file</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">file_name</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#该选项用来开启查询日志 ， 可选值 ：0或者1； 0代表关闭，1代表开启</span></span>
<span class="line"><span style="color:#24292E;">general_log</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#设置日志的文件名 ， 如果没有指定， 默认的文件名为 host_name.log</span></span>
<span class="line"><span style="color:#24292E;">general_log_file</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">file_name</span></span></code></pre></div><h4 id="_2-4、二进制日志-binlog" tabindex="-1">2.4、二进制日志(binlog) <a class="header-anchor" href="#_2-4、二进制日志-binlog" aria-label="Permalink to &quot;2.4、二进制日志(binlog)&quot;">​</a></h4><p>  记录对数据库进行变更的操作(不包含select，show这类操作)，还记录了执行数据库更改的操作时间和执行时间等信息，以二进制的形式保存在磁盘；binlog是通过追加的方式进行写入的。</p><h5 id="作用" tabindex="-1">作用 <a class="header-anchor" href="#作用" aria-label="Permalink to &quot;作用&quot;">​</a></h5><ol><li>数据恢复recovery，通过使用mysqlbinlog工具来恢复数据；</li><li>主从复制(replication)，slave和master进行实时同步。</li></ol><h5 id="binlog日志参数" tabindex="-1">binlog日志参数 <a class="header-anchor" href="#binlog日志参数" aria-label="Permalink to &quot;binlog日志参数&quot;">​</a></h5><ol><li>max_binglong_size：指定了单个二进制文件的最大值，如果超过了会产生新的日志文件，后缀名+1，并且记录到.index文件中；</li><li>binlog_chache_size：使用innodb存储引擎时，所有未提交uncommitted的二进制日志会被记录到一个缓存中，等该事务提交时committed直接将缓存中的二进制日志写入到二进制日志文件中，而该缓存的大小由此参数决定。</li><li>sync_binlog：对于InnoDB存储引擎而言，只有在事务提交时才会记录biglog，此时记录还在内存中，mysql通过sync_binlog参数控制biglog的刷盘时机，取值范围是0-N； <ul><li>0：不去强制要求，由系统自行判断何时写入磁盘；</li><li>1：每次commit的时候都要将binlog写入磁盘；</li><li>N：每N个事务，才会将binlog写入磁盘。</li></ul></li><li>binlog-do-db、binlog-ingore-db：需要写入或忽略写入哪些库的日志。默认为空，表示将所有库的日志写入到二进制文件中。</li><li>binlog-format：日志格式，statement、row、mixed <ul><li>statement：每一条会修改数据的sql都会记录在binlog中。日志文件小，节约IO，提高性能；但准确性差，某些情况导致主从数据不一致；</li><li>row：不记录sql语句上下文相关信息，仅保存哪条记录被修改。准确性强；但日志文件较大，较大的网络IO和磁盘IO；</li><li>mixed：以上两种的混合，在statement和row之间选择一种；一般的复制使用STATEMENT模式保存binlog，对于STATEMENT模式无法复制的操作使用ROW模式保存binlog。准确性强，文件大小适中；但可能主从不一致。</li></ul></li></ol><h5 id="日志读取" tabindex="-1">日志读取 <a class="header-anchor" href="#日志读取" aria-label="Permalink to &quot;日志读取&quot;">​</a></h5><p>  由于日志以二进制方式存储，不能直接读取，需要用mysqlbinlog工具来查看</p><p>  语法：mysqlbinlog log-file；</p><h5 id="日志删除" tabindex="-1">日志删除 <a class="header-anchor" href="#日志删除" aria-label="Permalink to &quot;日志删除&quot;">​</a></h5><p>  对于比较繁忙的系统，由于每天生成日志量大 ，这些日志如果长时间不清楚，将会占用大量的磁盘空间。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">#1、通过 Reset Master 指令删除全部 binlog 日志，删除之后，日志编号，将从 xxxx.000001重新开始 。</span></span>
<span class="line"><span style="color:#F69D50;">Reset</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">Master</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#768390;"># 2、删除指定编号之前的所有数据：</span></span>
<span class="line"><span style="color:#F69D50;">purge</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">master</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">logs</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">to</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;mysqlbin.******&#39;</span><span style="color:#ADBAC7;">  </span><span style="color:#768390;"># 该命令将删除 ****** 编号之前的所有日志。</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span></span>
<span class="line"><span style="color:#768390;"># 3、删除指定日期之前的所有数据：</span></span>
<span class="line"><span style="color:#F69D50;">purge</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">master</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">logs</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">before</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;yyyy-mm-dd hh24:mi:ss&#39;</span><span style="color:#ADBAC7;">  </span><span style="color:#768390;"># 该命令将删除日志为 &quot;yyyy-mm-dd hh24:mi:ss&quot; 之前产生的所有日志 。</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#768390;"># 4、设置日志的过期天数，过了指定的天数后日志将会被自动删除，这样将有利于减少DBA管理日志的工作量。</span></span>
<span class="line"><span style="color:#ADBAC7;">--expire_logs_days</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">days</span><span style="color:#ADBAC7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#1、通过 Reset Master 指令删除全部 binlog 日志，删除之后，日志编号，将从 xxxx.000001重新开始 。</span></span>
<span class="line"><span style="color:#6F42C1;">Reset</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Master</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#6A737D;"># 2、删除指定编号之前的所有数据：</span></span>
<span class="line"><span style="color:#6F42C1;">purge</span><span style="color:#24292E;"> </span><span style="color:#032F62;">master</span><span style="color:#24292E;"> </span><span style="color:#032F62;">logs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;mysqlbin.******&#39;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 该命令将删除 ****** 编号之前的所有日志。</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#6A737D;"># 3、删除指定日期之前的所有数据：</span></span>
<span class="line"><span style="color:#6F42C1;">purge</span><span style="color:#24292E;"> </span><span style="color:#032F62;">master</span><span style="color:#24292E;"> </span><span style="color:#032F62;">logs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">before</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;yyyy-mm-dd hh24:mi:ss&#39;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 该命令将删除日志为 &quot;yyyy-mm-dd hh24:mi:ss&quot; 之前产生的所有日志 。</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#6A737D;"># 4、设置日志的过期天数，过了指定的天数后日志将会被自动删除，这样将有利于减少DBA管理日志的工作量。</span></span>
<span class="line"><span style="color:#24292E;">--expire_logs_days</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">days</span><span style="color:#24292E;">;</span></span></code></pre></div><h3 id="_3、套接字文件-socket" tabindex="-1">3、套接字文件（socket） <a class="header-anchor" href="#_3、套接字文件-socket" aria-label="Permalink to &quot;3、套接字文件（socket）&quot;">​</a></h3><p>  Linux系统下本地连接mysql可以采用linux域套接字socket方式，需要一个套接字socket发文件</p><h3 id="_4、pid文件" tabindex="-1">4、pid文件 <a class="header-anchor" href="#_4、pid文件" aria-label="Permalink to &quot;4、pid文件&quot;">​</a></h3><p>  当mysql实例启动的时候，会将自己的进程id写入pid文件。</p><h3 id="_5、innodb存储文件" tabindex="-1">5、innodb存储文件 <a class="header-anchor" href="#_5、innodb存储文件" aria-label="Permalink to &quot;5、innodb存储文件&quot;">​</a></h3><p>  InnoDB将存储的数据库放在表空间文件中</p><h3 id="_6、redo文件" tabindex="-1">6、redo文件 <a class="header-anchor" href="#_6、redo文件" aria-label="Permalink to &quot;6、redo文件&quot;">​</a></h3><p>  redo log是用来恢复数据的，用于保障已提交事务的持久化特性。</p><p>  所有的数据库都是日志先行，先写日志，再写数据文件，所以才会有redo log。</p><p>  默认情况有2个文件分别为ib_logfile0 和 ib_logfile1；它们记录了innodb存储引擎的事务日志。如果数据库由于所有主机掉电导致实例失败，innodb存储引擎会使用redo log恢复到掉电前的时刻，以此来保证数据的完整性。</p><p>  redo log包括两部分：</p><ul><li>内存中的日志缓冲(redo log buffer)</li><li>磁盘上的日志文件(redo log file)</li></ul><p>  mysql每执行一条DML语句，先将记录写入redo log buffer，后续某个时间点再一次性将多个操作记录写到redo log file。这种先写日志，再写磁盘的技术就是MySQL里经常说到的WAL(Write-Ahead Logging) 技术。</p><p>  在计算机操作系统中，用户空间(user space)下的缓冲区数据一般情况下是无法直接写入磁盘的，中间必须经过操作系统内核空间(kernel space)缓冲区(OS Buffer)。因此，redo log buffer写入redo log file实际上是先写入OS Buffer，然后再通过系统调用fsync()将其刷到redo log file中，过程如下： <img src="/charles-blog/assets/RedoLog.523fb6f9.png" alt="RedoLog"></p><p>  mysql支持三种将redo log buffer写入redo log file的时机，可以通过innodb_flush_log_at_trx_commit参数配置，各参数值含义如下：</p><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>0（延迟写）</td><td>事务提交时不会将redo log buffer中日志写入os buffer，而是每秒写入os buffer并调用fsync() 写入到redo log file中。也就是说设置为0是约每秒刷新写入到磁盘中的，当系统崩溃，会丢失1秒钟的数据。</td></tr><tr><td>1（实时写，实时刷）</td><td>事务每次提交都会将redo log buffer中的日志写入os buffer并调用fsync()刷到redo log file中。这种方式即使系统崩溃也不会丢失任何数据，但是每次提交都写入磁盘，IO的性能较差。</td></tr><tr><td>2（实时写，延迟刷）</td><td>每次提交都仅写入到os buffer，然后是每秒调用fsync() 将os buffer中的日志写到redo log file。</td></tr></tbody></table><p>  MySQL的表数据是存放在磁盘上的，因此想要存取的时候都要经历磁盘IO,然而即使是使用SSD磁盘IO也是非常消耗性能的。为了提升性能InnoDB提供了缓冲池(Buffer Pool)，Buffer Pool中包含了磁盘数据页的映射，可以当做缓存来使用：</p><ul><li>读数据：会首先从缓冲池中读取，如果缓冲池中没有，则从磁盘读取在放入缓冲池；</li><li>写数据：会首先写入缓冲池，缓冲池中的数据会定期同步到磁盘中。</li></ul><p>  当MySQL系统宕机，断电的时候可能会丢数据！因为我们的数据已经提交了，但此时是在缓冲池里头，还没来得及在磁盘持久化，所以我们急需一种机制需要存一下已提交事务的数据，为恢复数据使用。于是redo log就派上用场了。</p><h3 id="_7、undo文件" tabindex="-1">7、undo文件 <a class="header-anchor" href="#_7、undo文件" aria-label="Permalink to &quot;7、undo文件&quot;">​</a></h3><p>  undo log是用来回滚数据的，用于保障未提交事务的原子性。</p><p>  存储了与redo文件相反的数据更新操作，如果rollback的话，就把undod段里面数据回写到数据文件里面。</p><p>  redo和undo之间是有关联的，交替合作保证数据的一致性和安全性。 <img src="/charles-blog/assets/UndoLog.c4bb58a6.png" alt="UndoLog"></p><ol><li>每条数据变更(insert/update/delete)操作都伴随一条undo log的生成,并且回滚日志必须先于数据持久化到磁盘上；</li><li>所谓的回滚就是根据回滚日志做逆向操作，比如delete的逆向操作为insert，insert的逆向操作为delete，update的逆向为update等。</li></ol><h3 id="redo-log-和-undo-log" tabindex="-1">redo log 和 undo log <a class="header-anchor" href="#redo-log-和-undo-log" aria-label="Permalink to &quot;redo log  和 undo log&quot;">​</a></h3><ul><li><p>redo log是用来恢复数据的，用于保障已提交事务的持久化特性.</p><ul><li>redo log叫做重做日志，是用来实现事务的持久性。该日志文件由两部分组成：重做日志缓冲（redo log buffer）以及重做日志文件（redo log）,前者是在内存中，后者在磁盘中。当事务提交之后会把所有修改信息都会存到该日志中。</li></ul></li><li><p>undo log是用来回滚数据的，用于保障未提交事务的原子性</p><ul><li>undo log 叫做回滚日志，用于记录数据被修改前的信息。他正好跟重做日志所记录的相反，重做日志记录数据被修改后的信息。undo log主要记录的是数据的逻辑变化，为了在发生错误时回滚之前的操作，需要将之前的操作都记录下来，然后在发生错误时才可以回滚。</li><li>每条数据变更(insert/update/delete)操作都伴随一条undo log的生成,并且回滚日志必须先于数据持久化到磁盘上。</li></ul></li><li><p>事务的持久性性是通过 redo log 来实现的</p></li><li><p>事务的原子性是通过 undo log 来实现的</p></li></ul><h2 id="mvcc" tabindex="-1">MVCC <a class="header-anchor" href="#mvcc" aria-label="Permalink to &quot;MVCC&quot;">​</a></h2><p>  MVCC (MultiVersion Concurrency Control) 叫做多版本并发控制。</p><p>  InnoDB的MVCC，是通过在每行记录的后面保存两个隐藏的列来实现的。这两个列，一个保存了行的创建时间，一个保存了行的过期时间，当然存储的并不是实际的时间值，而是系统版本号。他的主要实现思想是通过数据多版本来做到读写分离。从而实现不加锁读进而做到读写并行。</p><h2 id="mysql数据类型" tabindex="-1">MySQL数据类型 <a class="header-anchor" href="#mysql数据类型" aria-label="Permalink to &quot;MySQL数据类型&quot;">​</a></h2><h3 id="char和varchar" tabindex="-1">char和varchar <a class="header-anchor" href="#char和varchar" aria-label="Permalink to &quot;char和varchar&quot;">​</a></h3><ul><li>char(n) 若存入字符数小于n，则以空格补于其后，查询的时候再将空格去掉。所以char类型存储的字符串末尾不能有空格；</li><li>char(n) 固定长度，char(4)不管是存入几个字符，都将占用4个字符；varchar是存入的实际字符数+1个字节；</li><li>char类型的字符串检索速度要比varchar类型的快；</li></ul><h3 id="varchar和text" tabindex="-1">varchar和text <a class="header-anchor" href="#varchar和text" aria-label="Permalink to &quot;varchar和text&quot;">​</a></h3><ul><li>varchar可以指定n，text不能指定；</li><li>varchar是存入的实际字符数+1个字节；text是实际字符数+2个字节；</li><li>text类型不能有默认值；</li><li>varchar可以直接创建索引；text创建索引要指定前多少个字符；varchar查询速度快于text</li></ul><h3 id="blob和text" tabindex="-1">blob和text <a class="header-anchor" href="#blob和text" aria-label="Permalink to &quot;blob和text&quot;">​</a></h3><ul><li>text以文本方式存储，英文存储区分大小写，而blob是以二进制方式存储，不分大小写。</li><li>blob存储的数据只能整体读出。</li><li>text可以指定字符集，blob不用指定字符集。</li></ul><h3 id="timestamp" tabindex="-1">timestamp <a class="header-anchor" href="#timestamp" aria-label="Permalink to &quot;timestamp&quot;">​</a></h3><p>这个字段里的时间数据会随其他字段修改的时候自动刷新，所以这个数据类型的字段可以存放这条记录最后被修改的时间。</p><h2 id="mysql初始数据库" tabindex="-1">MySQL初始数据库 <a class="header-anchor" href="#mysql初始数据库" aria-label="Permalink to &quot;MySQL初始数据库&quot;">​</a></h2><ol><li>INFORMATION_SCHEMA：提供了访问数据库元数据的方式； <ul><li>元数据是关于数据的数据，如数据库名或表名，列的数据类型，或访问权限等。</li><li>INFORMATION_SCHEM是信息数据库，有数个只读表，实际上是视图</li></ul></li><li>mysql：mysql的核心数据库 <ul><li>主要负责存储数据库的用户、权限设置、关键字等mysql自己需要使用的控制和管理信息。</li></ul></li><li>test：测试数据库</li></ol><h2 id="索引-index" tabindex="-1">索引（index） <a class="header-anchor" href="#索引-index" aria-label="Permalink to &quot;索引（index）&quot;">​</a></h2><p>  一种的特殊的文件，包含着对数据表里所有的记录的引用指针。</p><p>  索引是帮助MySQL高效获取数据的数据结构（有序）。</p><p>  索引可以加快数据检索的操作，但会使数据修改操作变慢。每修改数据记录，索引就必须刷新一次；为了弥补这个缺陷，有一个DELAY_KEY_WRITE项，可以暂时制止每次修改都立即刷新，等全部记录修改完成后再进行刷新。</p><h3 id="索引的优势和劣势" tabindex="-1">索引的优势和劣势 <a class="header-anchor" href="#索引的优势和劣势" aria-label="Permalink to &quot;索引的优势和劣势&quot;">​</a></h3><h4 id="优势" tabindex="-1">优势 <a class="header-anchor" href="#优势" aria-label="Permalink to &quot;优势&quot;">​</a></h4><ol><li>类似于书籍的目录索引，提高数据检索的效率，降低数据库的IO成本。</li><li>通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗。</li></ol><h4 id="劣势" tabindex="-1">劣势 <a class="header-anchor" href="#劣势" aria-label="Permalink to &quot;劣势&quot;">​</a></h4><ol><li>实际上索引也是一张表，该表中保存了主键与索引字段，并指向实体类的记录，所以索引列也是要占用空间的。</li><li>虽然索引大大提高了查询效率，同时却也降低更新表的速度，如对表进行INSERT、UPDATE、DELETE。因为更新表时，MySQL 不仅要保存数据，还要保存一下索引文件。每次更新添加了索引列的字段，都会调整因为更新所带来的键值变化后的索引信息。</li></ol><h3 id="索引结构" tabindex="-1">索引结构 <a class="header-anchor" href="#索引结构" aria-label="Permalink to &quot;索引结构&quot;">​</a></h3><p>  索引是在MySQL的存储引擎层中实现的，而不是在服务器层实现的 。所以每种存储引擎的索引都不一定完全相同，也不是所有的存储引擎都支持所有的索引类型的。MySQL目前提供了以下4种索引：</p><ul><li>BTREE 索引 ： 最常见的索引类型，大部分索引都支持 B 树索引。</li><li>HASH 索引：只有Memory引擎支持 ， 使用场景简单 。</li><li>R-tree 索引（空间索引）：空间索引是MyISAM引擎的一个特殊索引类型，主要用于地理空间数据类型，通常使用较少，不做特别介绍。</li><li>Full-text （全文索引） ：全文索引也是MyISAM的一个特殊索引类型，主要用于全文索引，InnoDB从Mysql5.6版本开始支持全文索引。</li></ul><h4 id="btree" tabindex="-1">BTREE <a class="header-anchor" href="#btree" aria-label="Permalink to &quot;BTREE&quot;">​</a></h4><p>  BTree又叫多路平衡搜索树，一颗m叉的BTree特性如下：</p><ul><li>树中每个节点最多包含m个孩子。</li><li>除根节点与叶子节点外，每个节点至少有[ceil(m/2)]个孩子。</li><li>若根节点不是叶子节点，则至少有两个孩子。</li><li>所有的叶子节点都在同一层。</li><li>每个非叶子节点由n个key与n+1个指针组成，其中[ceil(m/2)-1] &lt;= n &lt;= m-1</li></ul><p>  以5叉BTree为例，key的数量：公式推导[ceil(m/2)-1] &lt;= n &lt;= m-1。所以 2 &lt;= n &lt;=4 。当n&gt;4时，中间节点分裂到父节点，两边节点分裂。 <img src="/charles-blog/assets/BTree1.b793ead3.png" alt="BTree1"><img src="/charles-blog/assets/BTree2.3335a196.png" alt="BTree2"><img src="/charles-blog/assets/BTree3.d8f37a82.png" alt="BTree3"><img src="/charles-blog/assets/BTree4.1720061f.png" alt="BTree4"><img src="/charles-blog/assets/BTree5.e7c0dde2.png" alt="BTree5"></p><h4 id="索引类别" tabindex="-1">索引类别 <a class="header-anchor" href="#索引类别" aria-label="Permalink to &quot;索引类别&quot;">​</a></h4><ol><li>普通索引：（又关键字Key 或 index 定义的索引）：加快对数据的访问速度；</li><li>唯一索引：被索引的数据列不可以包含重复的值（UNIQUE）：避免数据出现重复性；</li><li>主索引：为主键字段创建一个索引：和唯一索引的区别是，主索引的关键字是PRIMARY</li><li>外键索引：为外键字段定义一外键约束条件：</li><li>复合索引：覆盖多个数据列：index(A,B,C) 可以当作A 或 （A,B）的索引来使用，不能当作B或（B,C）的索引</li></ol><h4 id="索引设计原则" tabindex="-1">索引设计原则 <a class="header-anchor" href="#索引设计原则" aria-label="Permalink to &quot;索引设计原则&quot;">​</a></h4><p>  索引的设计可以遵循一些已有的原则，创建索引的时候请尽量考虑符合这些原则，便于提升索引的使用效率，更高效的使用索引。</p><ul><li>对查询频次较高，且数据量比较大的表建立索引。</li><li>索引字段的选择，最佳候选列应当从where子句的条件中提取，如果where子句中的组合比较多，那么应当挑选最常用、过滤效果最好的列的组合。</li><li>使用唯一索引 ，区分度越高，使用索引的效率越高。</li><li>索引可以有效的提升查询数据的效率，但索引数量不是多多益善，索引越多，维护索引的代价自然也就水涨船高 。对于插入、更新、删除等DML操作比较频繁的表来说，索引过多，会引入相当高的维护代价，降低DML操作的效率，增加相应操作的时间消耗。 另外索引过多的话，MySQL也会犯选择困难病，虽然最终仍然会找到一个可用的索引，但无疑提高了选择的代价。</li><li>使用短索引，索引创建之后也是使用硬盘来存储的，因此提升索引访问的I/O效率，也可以提升总体的访问效率。 假如构成索引的字段总长度比较短，那么在给定大小的存储块内可以存储更多的索引值，相应的可以有效的提升MySQL访问索引的I/O效率。</li><li>利用最左前缀 ，N个列组合而成的组合索引，那么相当于是创建了N个索引，如果查询时where子句中使用了组成该索引的前几个字段，那么这条查询SQL可以利用组合索引来提升查询效率。</li></ul><h4 id="索引相关sql" tabindex="-1">索引相关SQL <a class="header-anchor" href="#索引相关sql" aria-label="Permalink to &quot;索引相关SQL&quot;">​</a></h4><h5 id="创建索引" tabindex="-1">创建索引 <a class="header-anchor" href="#创建索引" aria-label="Permalink to &quot;创建索引&quot;">​</a></h5><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">CREATE</span><span style="color:#ADBAC7;"> [UNIQUE|FULLTEXT|SPATIAL] </span><span style="color:#F47067;">INDEX</span><span style="color:#ADBAC7;"> index_name</span></span>
<span class="line"><span style="color:#ADBAC7;">[USING index_type]</span></span>
<span class="line"><span style="color:#F47067;">ON</span><span style="color:#ADBAC7;"> tbl_name(index_col_name,...)</span></span>
<span class="line"><span style="color:#ADBAC7;">index_col_name : column_name[(length)][ASC | DESC]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 例子：</span></span>
<span class="line"><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">index</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">idx_city_name</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">on</span><span style="color:#ADBAC7;"> city(city_name);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 添加一个主键，这意味着索引值必须是唯一的，且不能为NULL</span></span>
<span class="line"><span style="color:#F47067;">alter</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">table</span><span style="color:#ADBAC7;"> tb_name </span><span style="color:#F47067;">add</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">primary key</span><span style="color:#ADBAC7;">(column_list);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 创建索引的值必须是唯一的（除了NULL外，NULL可能会出现多次）</span></span>
<span class="line"><span style="color:#F47067;">alter</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">table</span><span style="color:#ADBAC7;"> tb_name </span><span style="color:#F47067;">add</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">unique</span><span style="color:#ADBAC7;"> index_name(column_list);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 添加普通索引， 索引值可以出现多次。</span></span>
<span class="line"><span style="color:#F47067;">alter</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">table</span><span style="color:#ADBAC7;"> tb_name </span><span style="color:#F47067;">add</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">index</span><span style="color:#ADBAC7;"> index_name(column_list);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 指定了索引为FULLTEXT， 用于全文索引</span></span>
<span class="line"><span style="color:#F47067;">alter</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">table</span><span style="color:#ADBAC7;"> tb_name </span><span style="color:#F47067;">add</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">fulltext</span><span style="color:#ADBAC7;"> index_name(column_list);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 创建复合索引:</span></span>
<span class="line"><span style="color:#F47067;">CREATE</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">INDEX</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">idx_name_email_status</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">ON</span><span style="color:#ADBAC7;"> tb_seller(</span><span style="color:#F47067;">NAME</span><span style="color:#ADBAC7;">,email,</span><span style="color:#F47067;">STATUS</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#768390;">-- 就相当于</span></span>
<span class="line"><span style="color:#768390;">-- 对name 创建索引 ;</span></span>
<span class="line"><span style="color:#768390;">-- 对name , email 创建了索引 ;</span></span>
<span class="line"><span style="color:#768390;">-- 对name , email, status 创建了索引 ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> [UNIQUE|FULLTEXT|SPATIAL] </span><span style="color:#D73A49;">INDEX</span><span style="color:#24292E;"> index_name</span></span>
<span class="line"><span style="color:#24292E;">[USING index_type]</span></span>
<span class="line"><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> tbl_name(index_col_name,...)</span></span>
<span class="line"><span style="color:#24292E;">index_col_name : column_name[(length)][ASC | DESC]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 例子：</span></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">index</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">idx_city_name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">on</span><span style="color:#24292E;"> city(city_name);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 添加一个主键，这意味着索引值必须是唯一的，且不能为NULL</span></span>
<span class="line"><span style="color:#D73A49;">alter</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> tb_name </span><span style="color:#D73A49;">add</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">primary key</span><span style="color:#24292E;">(column_list);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 创建索引的值必须是唯一的（除了NULL外，NULL可能会出现多次）</span></span>
<span class="line"><span style="color:#D73A49;">alter</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> tb_name </span><span style="color:#D73A49;">add</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">unique</span><span style="color:#24292E;"> index_name(column_list);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 添加普通索引， 索引值可以出现多次。</span></span>
<span class="line"><span style="color:#D73A49;">alter</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> tb_name </span><span style="color:#D73A49;">add</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">index</span><span style="color:#24292E;"> index_name(column_list);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 指定了索引为FULLTEXT， 用于全文索引</span></span>
<span class="line"><span style="color:#D73A49;">alter</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> tb_name </span><span style="color:#D73A49;">add</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">fulltext</span><span style="color:#24292E;"> index_name(column_list);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 创建复合索引:</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">idx_name_email_status</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> tb_seller(</span><span style="color:#D73A49;">NAME</span><span style="color:#24292E;">,email,</span><span style="color:#D73A49;">STATUS</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#6A737D;">-- 就相当于</span></span>
<span class="line"><span style="color:#6A737D;">-- 对name 创建索引 ;</span></span>
<span class="line"><span style="color:#6A737D;">-- 对name , email 创建了索引 ;</span></span>
<span class="line"><span style="color:#6A737D;">-- 对name , email, status 创建了索引 ;</span></span></code></pre></div><h5 id="查看索引" tabindex="-1">查看索引 <a class="header-anchor" href="#查看索引" aria-label="Permalink to &quot;查看索引&quot;">​</a></h5><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">show </span><span style="color:#F47067;">index</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> table_name;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 例子：</span></span>
<span class="line"><span style="color:#ADBAC7;">show </span><span style="color:#F47067;">index</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> city;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">show </span><span style="color:#D73A49;">index</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> table_name;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 例子：</span></span>
<span class="line"><span style="color:#24292E;">show </span><span style="color:#D73A49;">index</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> city;</span></span></code></pre></div><h5 id="删除索引" tabindex="-1">删除索引 <a class="header-anchor" href="#删除索引" aria-label="Permalink to &quot;删除索引&quot;">​</a></h5><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">DROP</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">INDEX</span><span style="color:#ADBAC7;"> index_name </span><span style="color:#F47067;">ON</span><span style="color:#ADBAC7;"> tbl_name;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 例子：</span></span>
<span class="line"><span style="color:#F47067;">drop</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">index</span><span style="color:#ADBAC7;"> idx_city_name </span><span style="color:#F47067;">on</span><span style="color:#ADBAC7;"> city;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">DROP</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">INDEX</span><span style="color:#24292E;"> index_name </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> tbl_name;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 例子：</span></span>
<span class="line"><span style="color:#D73A49;">drop</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">index</span><span style="color:#24292E;"> idx_city_name </span><span style="color:#D73A49;">on</span><span style="color:#24292E;"> city;</span></span></code></pre></div><h2 id="数据库中引起全表扫描的sql语句" tabindex="-1">数据库中引起全表扫描的SQL语句 <a class="header-anchor" href="#数据库中引起全表扫描的sql语句" aria-label="Permalink to &quot;数据库中引起全表扫描的SQL语句&quot;">​</a></h2><h3 id="_1、模糊查询-like" tabindex="-1">1、模糊查询（like） <a class="header-anchor" href="#_1、模糊查询-like" aria-label="Permalink to &quot;1、模糊查询（like）&quot;">​</a></h3><ul><li>原因：like本身效率就比较低，应该尽量避免查询条件使用like；对于like ‘%...%’（全模糊）这样的条件，是无法使用索引的，全表扫描自然效率很低；另外，由于匹配算法的关系，模糊查询的字段长度越大，模糊查询效率越低。</li><li>解决办法：首先尽量避免模糊查询，如果因为业务需要一定要使用模糊查询，则至少保证不要使用全模糊查询： <ul><li>对于右模糊查询，即like ‘…%’，是会使用索引的；</li><li>左模糊like‘%...’无法直接使用索引，但可以利用reverse + function index 的形式，变化成 like ‘…%’；</li><li>全模糊是无法优化的，一定要的话考虑用搜索引擎。出于降低数据库服务器的负载考虑，尽可能地减少数据库模糊查询。</li></ul></li></ul><h3 id="_2、查询条件中有不等于操作符-、" tabindex="-1">2、查询条件中有不等于操作符（&lt;&gt;、!=） <a class="header-anchor" href="#_2、查询条件中有不等于操作符-、" aria-label="Permalink to &quot;2、查询条件中有不等于操作符（&lt;&gt;、!=）&quot;">​</a></h3><ul><li>原因：SQL中，不等于操作符会限制索引，引起全表扫描，即使比较的字段上有索引。</li><li>解决方法：通过把不等于操作符改成or，可以使用索引，避免全表扫描。例如，把column&lt;&gt;’aaa’，改成column&lt;’aaa’ or column&gt;’aaa’，就可以使用索引了。</li></ul><h3 id="_3、or使用不当" tabindex="-1">3、or使用不当 <a class="header-anchor" href="#_3、or使用不当" aria-label="Permalink to &quot;3、or使用不当&quot;">​</a></h3><p>  原因：where子句中比较的两个条件，一个有索引，一个没索引，使用or则会引起全表扫描。例如：where A==1 or B==2，A上有索引，B上没索引，则比较B==2时会重新开始全表扫描。</p><h3 id="_4、组合索引" tabindex="-1">4、组合索引 <a class="header-anchor" href="#_4、组合索引" aria-label="Permalink to &quot;4、组合索引&quot;">​</a></h3><p>  排序时应按照组合索引中各列的顺序进行排序，即使索引中只有一个列是要排序的，否则排序性能会比较差。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">index</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">skip1</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">on</span><span style="color:#ADBAC7;"> emp5(job,empno，</span><span style="color:#F47067;">date</span><span style="color:#ADBAC7;">); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> job，empno </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> emp5 </span><span style="color:#F47067;">where</span><span style="color:#ADBAC7;"> job</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">’manager’</span><span style="color:#F47067;">and</span><span style="color:#ADBAC7;"> empno</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">’</span><span style="color:#6CB6FF;">10</span><span style="color:#ADBAC7;">’ </span><span style="color:#F47067;">order by</span><span style="color:#ADBAC7;"> job,empno,</span><span style="color:#F47067;">date</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">desc</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#768390;">-- 实际上只是查询出符合job=’manager’and empno=’10’条件的记录并按date降序排列</span></span>
<span class="line"><span style="color:#768390;">-- 但是写成order by date desc性能较差。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">index</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">skip1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">on</span><span style="color:#24292E;"> emp5(job,empno，</span><span style="color:#D73A49;">date</span><span style="color:#24292E;">); </span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> job，empno </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> emp5 </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> job</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">’manager’</span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> empno</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">’</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">’ </span><span style="color:#D73A49;">order by</span><span style="color:#24292E;"> job,empno,</span><span style="color:#D73A49;">date</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">desc</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6A737D;">-- 实际上只是查询出符合job=’manager’and empno=’10’条件的记录并按date降序排列</span></span>
<span class="line"><span style="color:#6A737D;">-- 但是写成order by date desc性能较差。</span></span></code></pre></div><h3 id="_5、在where子句中对字段进行函数操作" tabindex="-1">5、在where子句中对字段进行函数操作 <a class="header-anchor" href="#_5、在where子句中对字段进行函数操作" aria-label="Permalink to &quot;5、在where子句中对字段进行函数操作&quot;">​</a></h3><p>  在where子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。</p><h3 id="_6、不带任何条件的count" tabindex="-1">6、不带任何条件的count <a class="header-anchor" href="#_6、不带任何条件的count" aria-label="Permalink to &quot;6、不带任何条件的count&quot;">​</a></h3><p>  select count(*) from table；这样不带任何条件的count会引起全表扫描，并且没有任何业务意义，是一定要杜绝的。</p><h3 id="_7、update-语句" tabindex="-1">7、Update 语句 <a class="header-anchor" href="#_7、update-语句" aria-label="Permalink to &quot;7、Update 语句&quot;">​</a></h3><p>  如果只更改1、2个字段，不要Update全部字段，否则频繁调用会引起明显的性能消耗，同时带来大量日志。</p><h3 id="_8、列与列对比" tabindex="-1">8、列与列对比 <a class="header-anchor" href="#_8、列与列对比" aria-label="Permalink to &quot;8、列与列对比&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 某个表中，有两列（id和c_id）都建了单独索引，下面这种查询条件不会走索引；</span></span>
<span class="line"><span style="color:#768390;">-- 这种情况会被认为还不如走全表扫描。</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> test </span><span style="color:#F47067;">where</span><span style="color:#ADBAC7;"> id</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">c_id;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 某个表中，有两列（id和c_id）都建了单独索引，下面这种查询条件不会走索引；</span></span>
<span class="line"><span style="color:#6A737D;">-- 这种情况会被认为还不如走全表扫描。</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> test </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> id</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">c_id;</span></span></code></pre></div><h3 id="_9、数据类型的转换" tabindex="-1">9、数据类型的转换 <a class="header-anchor" href="#_9、数据类型的转换" aria-label="Permalink to &quot;9、数据类型的转换&quot;">​</a></h3><p>  当查询条件存在隐式转换时，索引会失效。（字符串不加单引号）</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">--比如在数据库里id存的number类型，但是在查询时，却用了下面的形式：</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> sunyang </span><span style="color:#F47067;">where</span><span style="color:#ADBAC7;"> id</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&#39;123&#39;</span><span style="color:#ADBAC7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">--比如在数据库里id存的number类型，但是在查询时，却用了下面的形式：</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> sunyang </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> id</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;123&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div><h3 id="_10、如果mysql评估使用索引比全表更慢-则不使用索引。" tabindex="-1">10、如果MySQL评估使用索引比全表更慢，则不使用索引。 <a class="header-anchor" href="#_10、如果mysql评估使用索引比全表更慢-则不使用索引。" aria-label="Permalink to &quot;10、如果MySQL评估使用索引比全表更慢，则不使用索引。&quot;">​</a></h3><h2 id="explain" tabindex="-1">Explain <a class="header-anchor" href="#explain" aria-label="Permalink to &quot;Explain&quot;">​</a></h2><h3 id="_1-id" tabindex="-1">1. id <a class="header-anchor" href="#_1-id" aria-label="Permalink to &quot;1. id&quot;">​</a></h3><p>  id 字段是 select查询的序列号，是一组数字，表示的是查询中执行select子句或者是操作表的顺序。id 情况有三种：</p><ul><li>id 相同表示加载表的顺序是从上到下。</li><li>id 不同id值越大，优先级越高，越先被执行。</li><li>id 有相同，也有不同，同时存在。id相同的可以认为是一组，从上往下顺序执行；在所有的组中，id的值越大，优先级越高，越先执行。</li></ul><h3 id="_2-select-type" tabindex="-1">2. select_type <a class="header-anchor" href="#_2-select-type" aria-label="Permalink to &quot;2. select_type&quot;">​</a></h3><p>  可以看id的执行实例，总共有以下几种类型：</p><ul><li>SIMPLE： 表示简单的查询，此查询不包含 UNION 查询或子查询</li><li>PRIMARY： 表示此查询是最外层的查询</li><li>SUBQUERY： 子查询中的第一个 SELECT</li><li>UNION： 表示此查询是 UNION 的第二或随后的查询</li><li>DEPENDENT UNION：UNION 中的第二个或后面的查询语句, 取决于外面的查询</li><li>UNION RESULT, UNION 的结果</li><li>DEPENDENT SUBQUERY: 子查询中的第一个 SELECT, 取决于外面的查询. 即子查询依赖于外层查询的结果.</li><li>DERIVED：衍生，表示导出表的SELECT（FROM子句的子查询）</li></ul><h3 id="_3-table" tabindex="-1">3. table <a class="header-anchor" href="#_3-table" aria-label="Permalink to &quot;3. table&quot;">​</a></h3><p>  输出结果集的表。&lt;derived2&gt;的表示id为2的u和o表衍生出来的。</p><h3 id="_4-type" tabindex="-1">4. type <a class="header-anchor" href="#_4-type" aria-label="Permalink to &quot;4. type&quot;">​</a></h3><p>  type 字段比较重要，它提供了判断查询是否高效的重要依据依据。通过type字段，我们判断此次查询是全表扫描还是索引扫描等。type常用的取值有:</p><ul><li>system: 表中只有一条数据， 这个类型是特殊的 const 类型。</li><li>const: 针对主键或唯一索引的等值查询扫描，最多只返回一行数据。const 查询速度非常快， 因为它仅仅读取一次即可。例如下面的这个查询，它使用了主键索引，因此 type 就是 const 类型的：explain select * from user_info where id = 2；</li><li>eq_ref: 此类型通常出现在多表的 join 查询，表示对于前表的每一个结果，都只能匹配到后表的一行结果。并且查询的比较操作通常是 =，查询效率较高。例如：explain select * from user_info, order_info where user_info.id = order_info.user_id;</li><li>ref: 此类型通常出现在多表的 join 查询，针对于非唯一或非主键索引，或者是使用了 最左前缀 规则索引的查询。例如下面这个例子中， 就使用到了 ref 类型的查询：explain select * from user_info, order_info where user_info.id = order_info.user_id AND order_info.user_id = 5</li><li>range: 表示使用索引范围查询，通过索引字段范围获取表中部分数据记录。这个类型通常出现在 =, &lt;&gt;, &gt;, &gt;=, &lt;, &lt;=, IS NULL, &lt;=&gt;, BETWEEN, IN() 操作中。例如下面的例子就是一个范围查询：explain select * from user_info where id between 2 and 8；</li><li>index: 表示全索引扫描(full index scan)，和 ALL 类型类似，只不过 ALL 类型是全表扫描，而 index 类型则仅仅扫描所有的索引， 而不扫描数据。index 类型通常出现在：所要查询的数据直接在索引树中就可以获取到, 而不需要扫描数据。当是这种情况时，Extra 字段 会显示 Using index。</li><li>ALL: 表示全表扫描，这个类型的查询是性能最差的查询之一。通常来说， 我们的查询不应该出现 ALL 类型的查询，因为这样的查询在数据量大的情况下，对数据库的性能是巨大的灾难。如一个查询是 ALL 类型查询， 那么一般来说可以对相应的字段添加索引来避免。</li></ul><p>  通常来说, 不同的 type 类型的性能关系如下: ALL &lt; index &lt; range ~ index_merge &lt; ref &lt; eq_ref &lt; const &lt; system</p><h3 id="_5-possible-keys" tabindex="-1">5. possible_keys <a class="header-anchor" href="#_5-possible-keys" aria-label="Permalink to &quot;5. possible_keys&quot;">​</a></h3><p>  它表示 mysql 在查询时，可能使用到的索引。注意，即使有些索引在 possible_keys 中出现，但是并不表示此索引会真正地被 mysql 使用到。mysql 在查询时具体使用了哪些索引，由 key 字段决定。</p><h3 id="_6-key" tabindex="-1">6. key <a class="header-anchor" href="#_6-key" aria-label="Permalink to &quot;6. key&quot;">​</a></h3><p>  此字段是 mysql 在当前查询时所真正使用到的索引。比如请客吃饭，possible_keys是应到多少人，key是实到多少人。</p><h3 id="_7-key-len" tabindex="-1">7. key_len <a class="header-anchor" href="#_7-key-len" aria-label="Permalink to &quot;7. key_len&quot;">​</a></h3><p>  表示查询优化器使用了索引的字节数，这个字段可以评估组合索引是否完全被使用。</p><h3 id="_8-ref" tabindex="-1">8. ref <a class="header-anchor" href="#_8-ref" aria-label="Permalink to &quot;8. ref&quot;">​</a></h3><p>  这个表示显示索引的哪一列被使用了，如果可能的话,是一个常量。前文的type属性里也有ref，注意区别。</p><h3 id="_9-rows" tabindex="-1">9. rows <a class="header-anchor" href="#_9-rows" aria-label="Permalink to &quot;9. rows&quot;">​</a></h3><p>  rows 也是一个重要的字段，mysql 查询优化器根据统计信息，估算 sql 要查找到结果集需要扫描读取的数据行数，这个值非常直观的显示 sql 效率好坏， 原则上 rows 越少越好。</p><h3 id="_10-extra" tabindex="-1">10. extra <a class="header-anchor" href="#_10-extra" aria-label="Permalink to &quot;10. extra&quot;">​</a></h3><p>  explain 中的很多额外的信息会在 extra 字段显示, 常见的有以下几种内容:</p><ul><li>using filesort ：表示 mysql 需额外的排序操作，不能通过索引顺序达到排序效果。一般有 using filesort都建议优化去掉，因为这样的查询 cpu 资源消耗大。</li><li>using index：覆盖索引扫描，表示查询在索引树中就可查找所需数据，不用扫描表数据文件，往往说明性能不错。</li><li>using temporary：查询有使用临时表, 一般出现于排序， 分组和多表 join 的情况， 查询效率不高，建议优化。</li><li>using where ：表名使用了where过滤。</li><li>ref: 此类型通常出现在多表的 join 查询，针对于非唯一或非主键索引，或者是使用了 最左前缀 规则索引的查询。例如下面这个例子中， 就使用到了 ref 类型的查询：explain select * from user_info, order_info where user_info.id = order_info.user_id AND order_info.user_id = 5</li></ul><h2 id="查看sql执行频率" tabindex="-1">查看SQL执行频率 <a class="header-anchor" href="#查看sql执行频率" aria-label="Permalink to &quot;查看SQL执行频率&quot;">​</a></h2><p>  MySQL 客户端连接成功后，通过 show [session|global] status 命令可以提供服务器状态信息。show[session|global] status 可以根据需要加上参数“session”或者“global”来显示 session 级（当前连接）的统计结果和 global 级（自数据库上次启动至今）的统计结果。如果不写，默认使用参数是“session”。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 执行 select 操作的次数，一次查询只累加 1。</span></span>
<span class="line"><span style="color:#ADBAC7;">show </span><span style="color:#F47067;">status</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">like</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;Com_select&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 执行 INSERT 操作的次数，对于批量插入的 INSERT 操作，只累加一次。</span></span>
<span class="line"><span style="color:#ADBAC7;">show </span><span style="color:#F47067;">status</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">like</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;Com_insert&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 执行 UPDATE 操作的次数。</span></span>
<span class="line"><span style="color:#ADBAC7;">show </span><span style="color:#F47067;">status</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">like</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;Com_update&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">--执行 DELETE 操作的次数。</span></span>
<span class="line"><span style="color:#ADBAC7;">show </span><span style="color:#F47067;">status</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">like</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;Com_delete&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- select 查询返回的行数。</span></span>
<span class="line"><span style="color:#ADBAC7;">show </span><span style="color:#F47067;">status</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">like</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;Innodb_rows_read&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 执行 INSERT 操作插入的行数。</span></span>
<span class="line"><span style="color:#ADBAC7;">show </span><span style="color:#F47067;">status</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">like</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;Innodb_rows_inserted&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 执行 UPDATE 操作更新的行数。</span></span>
<span class="line"><span style="color:#ADBAC7;">show </span><span style="color:#F47067;">status</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">like</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;Innodb_rows_updated&#39;</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span></span>
<span class="line"><span style="color:#768390;">-- 执行 DELETE 操作删除的行数。</span></span>
<span class="line"><span style="color:#ADBAC7;">show </span><span style="color:#F47067;">status</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">like</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;Innodb_rows_deleted&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 试图连接 MySQL 服务器的次数。</span></span>
<span class="line"><span style="color:#ADBAC7;">show </span><span style="color:#F47067;">status</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">like</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;Connections&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 服务器工作时间。</span></span>
<span class="line"><span style="color:#ADBAC7;">show </span><span style="color:#F47067;">status</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">like</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;Uptime&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 慢查询的次数。</span></span>
<span class="line"><span style="color:#ADBAC7;">show </span><span style="color:#F47067;">status</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">like</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;Slow_queries&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 执行 select 操作的次数，一次查询只累加 1。</span></span>
<span class="line"><span style="color:#24292E;">show </span><span style="color:#D73A49;">status</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Com_select&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 执行 INSERT 操作的次数，对于批量插入的 INSERT 操作，只累加一次。</span></span>
<span class="line"><span style="color:#24292E;">show </span><span style="color:#D73A49;">status</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Com_insert&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 执行 UPDATE 操作的次数。</span></span>
<span class="line"><span style="color:#24292E;">show </span><span style="color:#D73A49;">status</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Com_update&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--执行 DELETE 操作的次数。</span></span>
<span class="line"><span style="color:#24292E;">show </span><span style="color:#D73A49;">status</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Com_delete&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- select 查询返回的行数。</span></span>
<span class="line"><span style="color:#24292E;">show </span><span style="color:#D73A49;">status</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Innodb_rows_read&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 执行 INSERT 操作插入的行数。</span></span>
<span class="line"><span style="color:#24292E;">show </span><span style="color:#D73A49;">status</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Innodb_rows_inserted&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 执行 UPDATE 操作更新的行数。</span></span>
<span class="line"><span style="color:#24292E;">show </span><span style="color:#D73A49;">status</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Innodb_rows_updated&#39;</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">-- 执行 DELETE 操作删除的行数。</span></span>
<span class="line"><span style="color:#24292E;">show </span><span style="color:#D73A49;">status</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Innodb_rows_deleted&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 试图连接 MySQL 服务器的次数。</span></span>
<span class="line"><span style="color:#24292E;">show </span><span style="color:#D73A49;">status</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Connections&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 服务器工作时间。</span></span>
<span class="line"><span style="color:#24292E;">show </span><span style="color:#D73A49;">status</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Uptime&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 慢查询的次数。</span></span>
<span class="line"><span style="color:#24292E;">show </span><span style="color:#D73A49;">status</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Slow_queries&#39;</span></span></code></pre></div><h2 id="定位低效率执行sql" tabindex="-1">定位低效率执行SQL <a class="header-anchor" href="#定位低效率执行sql" aria-label="Permalink to &quot;定位低效率执行SQL&quot;">​</a></h2><p>  慢查询日志: 通过慢查询日志定位那些执行效率较低的SQL语句，用--log-slow-queries[=file_name]选项启动时，mysqld 写一个包含所有执行时间超过long_query_time 秒的 SQL 语句的日志文件。</p><p>  show processlist : 慢查询日志在查询结束以后才记录，所以在应用反映执行效率出现问题的时候查询慢查询日志并不能定位问题，可以使用show processlist命令查看当前MySQL正在进行的线程，包括线程的状态、是否锁表等，可以实时地查看 SQL 的执行情况，同时对一些锁表操作进行优化。 <img src="/charles-blog/assets/ShowProcesslist.8891ed38.png" alt="ShowProcesslist"></p><ol><li>id列，用户登录mysql时，系统分配的&quot;connection_id&quot;，可以使用函数connection_id()查看</li><li>user列，显示当前用户。如果不是root，这个命令就只显示用户权限范围的sql语句</li><li>host列，当前主机名</li><li>db列，显示这个进程目前连接的是哪个数据库</li><li>command列，显示当前连接的执行的命令，一般取值为休眠（sleep），查询（query），连接（connect）等</li><li>time列，显示这个状态持续的时间，单位是秒</li><li>state列，显示使用当前连接的sql语句的状态，很重要的列。state描述的是语句执行中的某一个状态。一个sql语句，以查询为例，可能需要经过copying to tmp table、sorting result、sendingdata等状态才可以完成</li><li>info列，显示这个sql语句，是判断问题语句的一个重要依据</li></ol><h2 id="show-profile分析sql" tabindex="-1">show profile分析SQL <a class="header-anchor" href="#show-profile分析sql" aria-label="Permalink to &quot;show profile分析SQL&quot;">​</a></h2><p>  Mysql从5.0.37版本开始增加了对show profiles和show profile语句的支持。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 通过 have_profiling 参数，能够看到当前MySQL是否支持profile：</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> @@have_profiling</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 默认profiling是关闭的</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> @@profiling;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 可以通过set语句在Session级别开启profiling：</span></span>
<span class="line"><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> profiling</span><span style="color:#F47067;">=</span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">; </span><span style="color:#F47067;">//</span><span style="color:#ADBAC7;">开启profiling 开关；</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 通过 have_profiling 参数，能够看到当前MySQL是否支持profile：</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> @@have_profiling</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 默认profiling是关闭的</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> @@profiling;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 可以通过set语句在Session级别开启profiling：</span></span>
<span class="line"><span style="color:#D73A49;">set</span><span style="color:#24292E;"> profiling</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">; </span><span style="color:#D73A49;">//</span><span style="color:#24292E;">开启profiling 开关；</span></span></code></pre></div><p>  show profiles能够在做SQL优化时帮助我们了解时间都耗费到哪里去了。 <img src="/charles-blog/assets/ShowProfiles.42096a51.png" alt="ShowProfiles">   通过show profile for query query_id 语句可以查看到该SQL执行过程中每个线程的状态和消耗的时间 <img src="/charles-blog/assets/ShowProfileFor.51a23e09.png" alt="ShowProfileFor"></p><h2 id="sql优化" tabindex="-1">SQL优化 <a class="header-anchor" href="#sql优化" aria-label="Permalink to &quot;SQL优化&quot;">​</a></h2><h3 id="_1、大批量插入数据" tabindex="-1">1、大批量插入数据 <a class="header-anchor" href="#_1、大批量插入数据" aria-label="Permalink to &quot;1、大批量插入数据&quot;">​</a></h3><ul><li>主键顺序插入：因为InnoDB类型的表是按照主键的顺序保存的，所以将导入的数据按照主键的顺序排列，可以有效的提高导入数据的效率。如果InnoDB表没有主键，那么系统会自动默认创建一个内部列作为主键，所以如果可以给表创建一个主键，将可以利用这点，来提高导入数据的效率。</li><li>关闭唯一性校验：在导入数据前执行 SET UNIQUE_CHECKS=0，关闭唯一性校验，在导入结束后执行SET UNIQUE_CHECKS=1，恢复唯一性校验，可以提高导入的效率。</li><li>手动提交事务：如果应用使用自动提交的方式，建议在导入前执行 SET AUTOCOMMIT=0，关闭自动提交，导入结束后再执行 SET AUTOCOMMIT=1，打开自动提交，也可以提高导入的效率。</li></ul><h3 id="_2、优化insert语句" tabindex="-1">2、优化insert语句 <a class="header-anchor" href="#_2、优化insert语句" aria-label="Permalink to &quot;2、优化insert语句&quot;">​</a></h3><h4 id="_2-1、对一张表插入多行数据" tabindex="-1">2.1、对一张表插入多行数据 <a class="header-anchor" href="#_2-1、对一张表插入多行数据" aria-label="Permalink to &quot;2.1、对一张表插入多行数据&quot;">​</a></h4><ul><li>如果需要同时对一张表插入很多行数据时，应该尽量使用多个值表的insert语句，</li><li>这种方式将大大的缩减客户端与数据库之间的连接、关闭等消耗。使得效率比分开执行的单个insert语句快。</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 示例，原始方法</span></span>
<span class="line"><span style="color:#F47067;">insert into</span><span style="color:#ADBAC7;"> tb_test </span><span style="color:#F47067;">values</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Tom&#39;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#F47067;">insert into</span><span style="color:#ADBAC7;"> tb_test </span><span style="color:#F47067;">values</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">2</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Cat&#39;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#F47067;">insert into</span><span style="color:#ADBAC7;"> tb_test </span><span style="color:#F47067;">values</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">3</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Jerry&#39;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 优化后的方案为 </span></span>
<span class="line"><span style="color:#F47067;">insert into</span><span style="color:#ADBAC7;"> tb_test </span><span style="color:#F47067;">values</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Tom&#39;</span><span style="color:#ADBAC7;">),(</span><span style="color:#6CB6FF;">2</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Cat&#39;</span><span style="color:#ADBAC7;">)，(</span><span style="color:#6CB6FF;">3</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Jerry&#39;</span><span style="color:#ADBAC7;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 示例，原始方法</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> tb_test </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Tom&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> tb_test </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Cat&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> tb_test </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Jerry&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 优化后的方案为 </span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> tb_test </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Tom&#39;</span><span style="color:#24292E;">),(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Cat&#39;</span><span style="color:#24292E;">)，(</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Jerry&#39;</span><span style="color:#24292E;">);</span></span></code></pre></div><h4 id="_2-2、在事务中进行数据插入" tabindex="-1">2.2、在事务中进行数据插入 <a class="header-anchor" href="#_2-2、在事务中进行数据插入" aria-label="Permalink to &quot;2.2、在事务中进行数据插入&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">start transaction</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#F47067;">insert into</span><span style="color:#ADBAC7;"> tb_test </span><span style="color:#F47067;">values</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Tom&#39;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#F47067;">insert into</span><span style="color:#ADBAC7;"> tb_test </span><span style="color:#F47067;">values</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">2</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Cat&#39;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#F47067;">insert into</span><span style="color:#ADBAC7;"> tb_test </span><span style="color:#F47067;">values</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">3</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Jerry&#39;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#F47067;">commit</span><span style="color:#ADBAC7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">start transaction</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> tb_test </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Tom&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> tb_test </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Cat&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> tb_test </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Jerry&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">commit</span><span style="color:#24292E;">;</span></span></code></pre></div><h4 id="_2-3、数据有序插入" tabindex="-1">2.3、数据有序插入 <a class="header-anchor" href="#_2-3、数据有序插入" aria-label="Permalink to &quot;2.3、数据有序插入&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 原始数据：</span></span>
<span class="line"><span style="color:#F47067;">insert into</span><span style="color:#ADBAC7;"> tb_test </span><span style="color:#F47067;">values</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">2</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Cat&#39;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#F47067;">insert into</span><span style="color:#ADBAC7;"> tb_test </span><span style="color:#F47067;">values</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Tom&#39;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#F47067;">insert into</span><span style="color:#ADBAC7;"> tb_test </span><span style="color:#F47067;">values</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">3</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Jerry&#39;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 优化后：</span></span>
<span class="line"><span style="color:#F47067;">insert into</span><span style="color:#ADBAC7;"> tb_test </span><span style="color:#F47067;">values</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Tom&#39;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#F47067;">insert into</span><span style="color:#ADBAC7;"> tb_test </span><span style="color:#F47067;">values</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">2</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Cat&#39;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#F47067;">insert into</span><span style="color:#ADBAC7;"> tb_test </span><span style="color:#F47067;">values</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">3</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Jerry&#39;</span><span style="color:#ADBAC7;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 原始数据：</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> tb_test </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Cat&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> tb_test </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Tom&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> tb_test </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Jerry&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 优化后：</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> tb_test </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Tom&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> tb_test </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Cat&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> tb_test </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Jerry&#39;</span><span style="color:#24292E;">);</span></span></code></pre></div><h3 id="_3、优化order-by语句" tabindex="-1">3、优化order by语句 <a class="header-anchor" href="#_3、优化order-by语句" aria-label="Permalink to &quot;3、优化order by语句&quot;">​</a></h3><h4 id="_3-1、直接返回有序数据" tabindex="-1">3.1、直接返回有序数据 <a class="header-anchor" href="#_3-1、直接返回有序数据" aria-label="Permalink to &quot;3.1、直接返回有序数据&quot;">​</a></h4><p>  通过有序索引顺序扫描直接返回有序数据，这种情况即为 using index，不需要额外排序，操作效率高。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 示例：原始操作：</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> emp </span><span style="color:#F47067;">order by</span><span style="color:#ADBAC7;"> age </span><span style="color:#F47067;">desc</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 优化后：</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> id,age </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> emp </span><span style="color:#F47067;">order by</span><span style="color:#ADBAC7;"> age </span><span style="color:#F47067;">desc</span><span style="color:#ADBAC7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 示例：原始操作：</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> emp </span><span style="color:#D73A49;">order by</span><span style="color:#24292E;"> age </span><span style="color:#D73A49;">desc</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 优化后：</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> id,age </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> emp </span><span style="color:#D73A49;">order by</span><span style="color:#24292E;"> age </span><span style="color:#D73A49;">desc</span><span style="color:#24292E;">;</span></span></code></pre></div><h4 id="_3-2、尽量减少额外的排序" tabindex="-1">3.2、尽量减少额外的排序 <a class="header-anchor" href="#_3-2、尽量减少额外的排序" aria-label="Permalink to &quot;3.2、尽量减少额外的排序&quot;">​</a></h4><p>  尽量减少额外的排序，通过索引直接返回有序数据(using index)。   where条件和Order by使用相同的索引，并且Order By的顺序和索引顺序相同， 并且Order by的字段都是升序，或者都是降序</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 示例：有age，salary两个字段的复合索引</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> id,age,salary </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> emp </span><span style="color:#F47067;">order by</span><span style="color:#ADBAC7;"> age </span><span style="color:#F47067;">desc</span><span style="color:#ADBAC7;"> salary </span><span style="color:#F47067;">asc</span><span style="color:#ADBAC7;">;  </span><span style="color:#768390;">-- false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 优化后：</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> id,age,salary </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> emp </span><span style="color:#F47067;">order by</span><span style="color:#ADBAC7;"> age </span><span style="color:#F47067;">desc</span><span style="color:#ADBAC7;"> salary </span><span style="color:#F47067;">desc</span><span style="color:#ADBAC7;">; </span><span style="color:#768390;">-- true</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 示例：有age，salary两个字段的复合索引</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> id,age,salary </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> emp </span><span style="color:#D73A49;">order by</span><span style="color:#24292E;"> age </span><span style="color:#D73A49;">desc</span><span style="color:#24292E;"> salary </span><span style="color:#D73A49;">asc</span><span style="color:#24292E;">;  </span><span style="color:#6A737D;">-- false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 优化后：</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> id,age,salary </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> emp </span><span style="color:#D73A49;">order by</span><span style="color:#24292E;"> age </span><span style="color:#D73A49;">desc</span><span style="color:#24292E;"> salary </span><span style="color:#D73A49;">desc</span><span style="color:#24292E;">; </span><span style="color:#6A737D;">-- true</span></span></code></pre></div><h3 id="_4、优化group-by语句" tabindex="-1">4、优化group by语句 <a class="header-anchor" href="#_4、优化group-by语句" aria-label="Permalink to &quot;4、优化group by语句&quot;">​</a></h3><p>  由于GROUP BY 实际上也同样会进行排序操作，而且与ORDER BY 相比，GROUP BY 主要只是多了排序之后的分组操作。所以，在GROUP BY 的实现过程中，与 ORDER BY 一样也可以利用到索引。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 如果查询包含 group by 但是用户想要避免排序结果的消耗， 则可以执行order by null 禁止排序 。</span></span>
<span class="line"><span style="color:#768390;">-- 示例：</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> age,</span><span style="color:#6CB6FF;">count</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> emp </span><span style="color:#F47067;">group by</span><span style="color:#ADBAC7;"> age;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 优化后：</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> age,</span><span style="color:#6CB6FF;">count</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> emp </span><span style="color:#F47067;">group by</span><span style="color:#ADBAC7;"> age </span><span style="color:#F47067;">order by</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">null</span><span style="color:#ADBAC7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 如果查询包含 group by 但是用户想要避免排序结果的消耗， 则可以执行order by null 禁止排序 。</span></span>
<span class="line"><span style="color:#6A737D;">-- 示例：</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> age,</span><span style="color:#005CC5;">count</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> emp </span><span style="color:#D73A49;">group by</span><span style="color:#24292E;"> age;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 优化后：</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> age,</span><span style="color:#005CC5;">count</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> emp </span><span style="color:#D73A49;">group by</span><span style="color:#24292E;"> age </span><span style="color:#D73A49;">order by</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">null</span><span style="color:#24292E;">;</span></span></code></pre></div><h3 id="_5、优化分页查询" tabindex="-1">5、优化分页查询 <a class="header-anchor" href="#_5、优化分页查询" aria-label="Permalink to &quot;5、优化分页查询&quot;">​</a></h3><p>  一般分页查询时，通过创建覆盖索引能够比较好地提高性能。一个常见又非常头疼的问题就是limit 2000000,10 ，此时需要MySQL排序前2000010 记录，仅仅返回2000000 - 2000010 的记录，其他记录丢弃，查询排序的代价非常大。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 在索引上完成排序分页操作，最后根据主键关联回原表查询所需要的其他列内容。</span></span>
<span class="line"><span style="color:#768390;">-- 示例：</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> tb_item </span><span style="color:#F47067;">limit</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">2000000</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">10</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 优化后：</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> tb_item t,(</span><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> id </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> tb_item </span><span style="color:#F47067;">order by</span><span style="color:#ADBAC7;"> id </span><span style="color:#F47067;">limit</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">2000000</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">10</span><span style="color:#ADBAC7;">) a </span><span style="color:#F47067;">where</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">t</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">id</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">a</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">id</span><span style="color:#ADBAC7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 在索引上完成排序分页操作，最后根据主键关联回原表查询所需要的其他列内容。</span></span>
<span class="line"><span style="color:#6A737D;">-- 示例：</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> tb_item </span><span style="color:#D73A49;">limit</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2000000</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 优化后：</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> tb_item t,(</span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> id </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> tb_item </span><span style="color:#D73A49;">order by</span><span style="color:#24292E;"> id </span><span style="color:#D73A49;">limit</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2000000</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">) a </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">t</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">a</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">;</span></span></code></pre></div><h3 id="_6、-使用sql提示" tabindex="-1">6、 使用SQL提示 <a class="header-anchor" href="#_6、-使用sql提示" aria-label="Permalink to &quot;6、 使用SQL提示&quot;">​</a></h3><p>  SQL提示，是优化数据库的一个重要手段，简单来说，就是在SQL语句中加入一些人为的提示来达到优化操作的目的。</p><ul><li>USE INDEX：在查询语句中表名的后面，添加 use index 来提供希望MySQL去参考的索引列表，就可以让MySQL不再考虑其他可用的索引。</li><li>IGNORE INDEX：如果用户只是单纯的想让MySQL忽略一个或者多个索引，则可以使用 ignore index 作为 hint 。</li><li>FORCE INDEX：为强制MySQL使用一个特定的索引，可在查询中使用 force index 作为hint 。</li></ul><h2 id="视图-view" tabindex="-1">视图（View） <a class="header-anchor" href="#视图-view" aria-label="Permalink to &quot;视图（View）&quot;">​</a></h2><p>  视图是一种虚拟存在的表。视图并不在数据库中实际存在，行和列数据来自定义视图的查询中使用的表，并且是在使用视图时动态生成的。通俗的讲，视图就是一条SELECT语句执行后返回的结果集。所以我们在创建视图的时候，主要的工作就落在创建这条SQL查询语句上。</p><p>  视图相对于普通的表的优势主要包括以下几项。</p><ul><li>简单：使用视图的用户完全不需要关心后面对应的表的结构、关联条件和筛选条件，对用户来说已经是过滤好的复合条件的结果集。</li><li>安全：使用视图的用户只能访问他们被允许查询的结果集，对表的权限管理并不能限制到某个行某个列，但是通过视图就可以简单的实现。</li><li>数据独立：一旦视图的结构确定了，可以屏蔽表结构变化对用户的影响，源表增加列对视图没有影响；源表修改列名，则可以通过修改视图来解决，不会造成对访问者的影响。</li></ul><h3 id="视图相关sql" tabindex="-1">视图相关SQL <a class="header-anchor" href="#视图相关sql" aria-label="Permalink to &quot;视图相关SQL&quot;">​</a></h3><h4 id="创建视图" tabindex="-1">创建视图 <a class="header-anchor" href="#创建视图" aria-label="Permalink to &quot;创建视图&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">CREATE</span><span style="color:#ADBAC7;"> [OR REPLACE] [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}]</span></span>
<span class="line"><span style="color:#ADBAC7;">VIEW view_name [(column_list)]</span></span>
<span class="line"><span style="color:#F47067;">AS</span><span style="color:#ADBAC7;"> select_statement</span></span>
<span class="line"><span style="color:#ADBAC7;">[WITH [CASCADED | LOCAL] </span><span style="color:#F47067;">CHECK</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">OPTION</span><span style="color:#ADBAC7;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 例子：</span></span>
<span class="line"><span style="color:#F47067;">create or replace</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">view</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">city_country_view</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">as</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> t.</span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">c</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">country_name</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> country c , city t </span><span style="color:#F47067;">where</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">c</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">country_id</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">t</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">country_id</span><span style="color:#ADBAC7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> [OR REPLACE] [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}]</span></span>
<span class="line"><span style="color:#24292E;">VIEW view_name [(column_list)]</span></span>
<span class="line"><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> select_statement</span></span>
<span class="line"><span style="color:#24292E;">[WITH [CASCADED | LOCAL] </span><span style="color:#D73A49;">CHECK</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">OPTION</span><span style="color:#24292E;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 例子：</span></span>
<span class="line"><span style="color:#D73A49;">create or replace</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">view</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">city_country_view</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> t.</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">c</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">country_name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> country c , city t </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">c</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">country_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">t</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">country_id</span><span style="color:#24292E;">;</span></span></code></pre></div><h4 id="修改视图" tabindex="-1">修改视图 <a class="header-anchor" href="#修改视图" aria-label="Permalink to &quot;修改视图&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">ALTER</span><span style="color:#ADBAC7;"> [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}]</span></span>
<span class="line"><span style="color:#ADBAC7;">VIEW view_name [(column_list)]</span></span>
<span class="line"><span style="color:#F47067;">AS</span><span style="color:#ADBAC7;"> select_statement</span></span>
<span class="line"><span style="color:#ADBAC7;">[WITH [CASCADED | LOCAL] </span><span style="color:#F47067;">CHECK</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">OPTION</span><span style="color:#ADBAC7;">]</span></span>
<span class="line"><span style="color:#ADBAC7;">选项 :</span></span>
<span class="line"><span style="color:#F47067;">WITH</span><span style="color:#ADBAC7;"> [CASCADED | LOCAL] </span><span style="color:#F47067;">CHECK</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">OPTION</span><span style="color:#ADBAC7;"> 决定了是否允许更新数据使记录不再满足视图的条件。</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">LOCAL</span><span style="color:#ADBAC7;"> ： 只要满足本视图的条件就可以更新。</span></span>
<span class="line"><span style="color:#ADBAC7;">    CASCADED ： 必须满足所有针对该视图的所有视图的条件才可以更新。 默认值.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">ALTER</span><span style="color:#24292E;"> [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}]</span></span>
<span class="line"><span style="color:#24292E;">VIEW view_name [(column_list)]</span></span>
<span class="line"><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> select_statement</span></span>
<span class="line"><span style="color:#24292E;">[WITH [CASCADED | LOCAL] </span><span style="color:#D73A49;">CHECK</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">OPTION</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">选项 :</span></span>
<span class="line"><span style="color:#D73A49;">WITH</span><span style="color:#24292E;"> [CASCADED | LOCAL] </span><span style="color:#D73A49;">CHECK</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">OPTION</span><span style="color:#24292E;"> 决定了是否允许更新数据使记录不再满足视图的条件。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">LOCAL</span><span style="color:#24292E;"> ： 只要满足本视图的条件就可以更新。</span></span>
<span class="line"><span style="color:#24292E;">    CASCADED ： 必须满足所有针对该视图的所有视图的条件才可以更新。 默认值.</span></span></code></pre></div><h4 id="查看视图" tabindex="-1">查看视图 <a class="header-anchor" href="#查看视图" aria-label="Permalink to &quot;查看视图&quot;">​</a></h4><p>  从MySQL 5.1版本开始，使用SHOW TABLES命令的时候不仅显示表的名字，同时也会显示视图的名字</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">show tables;</span></span>
<span class="line"><span style="color:#ADBAC7;">SHOW </span><span style="color:#F47067;">TABLE</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">STATUS</span><span style="color:#ADBAC7;">; </span><span style="color:#768390;">-- 不但可以显示表的信息，同时也可以显示视图的信息。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#768390;">-- 查询某个视图的定义</span></span>
<span class="line"><span style="color:#ADBAC7;">SHOW </span><span style="color:#F47067;">CREATE</span><span style="color:#ADBAC7;"> VIEW view_name;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 例子：</span></span>
<span class="line"><span style="color:#ADBAC7;">show </span><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> view city_country_view;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">show tables;</span></span>
<span class="line"><span style="color:#24292E;">SHOW </span><span style="color:#D73A49;">TABLE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">STATUS</span><span style="color:#24292E;">; </span><span style="color:#6A737D;">-- 不但可以显示表的信息，同时也可以显示视图的信息。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">-- 查询某个视图的定义</span></span>
<span class="line"><span style="color:#24292E;">SHOW </span><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> VIEW view_name;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 例子：</span></span>
<span class="line"><span style="color:#24292E;">show </span><span style="color:#D73A49;">create</span><span style="color:#24292E;"> view city_country_view;</span></span></code></pre></div><h4 id="删除视图" tabindex="-1">删除视图 <a class="header-anchor" href="#删除视图" aria-label="Permalink to &quot;删除视图&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">DROP</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">VIEW</span><span style="color:#ADBAC7;"> [IF EXISTS] view_name [, view_name] ...[RESTRICT | CASCADE]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 例子，删除视图city_country_view :</span></span>
<span class="line"><span style="color:#F47067;">DROP</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">VIEW</span><span style="color:#ADBAC7;"> city_country_view ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">DROP</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">VIEW</span><span style="color:#24292E;"> [IF EXISTS] view_name [, view_name] ...[RESTRICT | CASCADE]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 例子，删除视图city_country_view :</span></span>
<span class="line"><span style="color:#D73A49;">DROP</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">VIEW</span><span style="color:#24292E;"> city_country_view ;</span></span></code></pre></div><h2 id="存储过程和存储函数" tabindex="-1">存储过程和存储函数 <a class="header-anchor" href="#存储过程和存储函数" aria-label="Permalink to &quot;存储过程和存储函数&quot;">​</a></h2><p>  存储过程和存储函数是事先经过编译并存储在数据库中的一段 SQL 语句的集合，调用存储过程和存储函数可以简化应用开发人员的很多工作，减少数据在数据库和应用服务器之间的传输，对于提高数据处理的效率是有好处的。</p><p>  存储过程和函数的区别在于函数必须有返回值，而存储过程没有</p><ul><li>函数：是一个有返回值的过程；</li><li>过程：是一个没有返回值的函数；</li></ul><h3 id="相关sql" tabindex="-1">相关SQL <a class="header-anchor" href="#相关sql" aria-label="Permalink to &quot;相关SQL&quot;">​</a></h3><h4 id="创建存储过程" tabindex="-1">创建存储过程 <a class="header-anchor" href="#创建存储过程" aria-label="Permalink to &quot;创建存储过程&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">CREATE</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">PROCEDURE</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">procedure_name</span><span style="color:#ADBAC7;"> ([proc_parameter[,...]])</span></span>
<span class="line"><span style="color:#F47067;">begin</span></span>
<span class="line"><span style="color:#768390;">-- SQL语句</span></span>
<span class="line"><span style="color:#F47067;">end</span><span style="color:#ADBAC7;"> ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 例子：</span></span>
<span class="line"><span style="color:#ADBAC7;">delimiter $   </span><span style="color:#768390;">-- 定义分隔符为‘$’</span></span>
<span class="line"><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">procedure</span><span style="color:#ADBAC7;"> pro_test1()</span></span>
<span class="line"><span style="color:#F47067;">begin</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;Hello Mysql&#39;</span><span style="color:#ADBAC7;"> ;</span></span>
<span class="line"><span style="color:#F47067;">end</span><span style="color:#ADBAC7;">$ </span><span style="color:#768390;">-- 语句结束，可以执行该命令</span></span>
<span class="line"><span style="color:#ADBAC7;">delimiter ; </span><span style="color:#768390;">-- 重新还原分隔符为‘;’</span></span>
<span class="line"><span style="color:#768390;">-- tips：</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#768390;">-- DELIMITER关键字用来声明SQL语句的分隔符,告诉MySQL解释器，该段命令是否已经结束了，mysql是否可以执行了。</span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#768390;">-- 默认情况下，delimiter是分号&#39;;&#39;。在命令行客户端中，如果有一行命令以分号结束，那么回车后，mysql将会执行该命令。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">PROCEDURE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">procedure_name</span><span style="color:#24292E;"> ([proc_parameter[,...]])</span></span>
<span class="line"><span style="color:#D73A49;">begin</span></span>
<span class="line"><span style="color:#6A737D;">-- SQL语句</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;"> ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 例子：</span></span>
<span class="line"><span style="color:#24292E;">delimiter $   </span><span style="color:#6A737D;">-- 定义分隔符为‘$’</span></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">procedure</span><span style="color:#24292E;"> pro_test1()</span></span>
<span class="line"><span style="color:#D73A49;">begin</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Hello Mysql&#39;</span><span style="color:#24292E;"> ;</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;">$ </span><span style="color:#6A737D;">-- 语句结束，可以执行该命令</span></span>
<span class="line"><span style="color:#24292E;">delimiter ; </span><span style="color:#6A737D;">-- 重新还原分隔符为‘;’</span></span>
<span class="line"><span style="color:#6A737D;">-- tips：</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">-- DELIMITER关键字用来声明SQL语句的分隔符,告诉MySQL解释器，该段命令是否已经结束了，mysql是否可以执行了。</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">-- 默认情况下，delimiter是分号&#39;;&#39;。在命令行客户端中，如果有一行命令以分号结束，那么回车后，mysql将会执行该命令。</span></span></code></pre></div><h4 id="调用存储过程" tabindex="-1">调用存储过程 <a class="header-anchor" href="#调用存储过程" aria-label="Permalink to &quot;调用存储过程&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">call</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">procedure_name</span><span style="color:#ADBAC7;">() ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 例子</span></span>
<span class="line"><span style="color:#F47067;">call</span><span style="color:#ADBAC7;"> pro_test1();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">call</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">procedure_name</span><span style="color:#24292E;">() ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 例子</span></span>
<span class="line"><span style="color:#D73A49;">call</span><span style="color:#24292E;"> pro_test1();</span></span></code></pre></div><h4 id="查看存储过程" tabindex="-1">查看存储过程 <a class="header-anchor" href="#查看存储过程" aria-label="Permalink to &quot;查看存储过程&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 查询db_name数据库中的所有的存储过程（在mysql库中查询）</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">name</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">mysql</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">proc</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">where</span><span style="color:#ADBAC7;"> db</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">&#39;db_name&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 查询存储过程的状态信息</span></span>
<span class="line"><span style="color:#ADBAC7;">show </span><span style="color:#F47067;">procedure</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">status</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 查询某个存储过程的定义</span></span>
<span class="line"><span style="color:#ADBAC7;">show </span><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">procedure</span><span style="color:#ADBAC7;"> pro_test1;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 查询db_name数据库中的所有的存储过程（在mysql库中查询）</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">mysql</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">proc</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> db</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;db_name&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 查询存储过程的状态信息</span></span>
<span class="line"><span style="color:#24292E;">show </span><span style="color:#D73A49;">procedure</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">status</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 查询某个存储过程的定义</span></span>
<span class="line"><span style="color:#24292E;">show </span><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">procedure</span><span style="color:#24292E;"> pro_test1;</span></span></code></pre></div><h4 id="删除存储过程" tabindex="-1">删除存储过程 <a class="header-anchor" href="#删除存储过程" aria-label="Permalink to &quot;删除存储过程&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">DROP</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">PROCEDURE</span><span style="color:#ADBAC7;"> [IF EXISTS] sp_name ；</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 例子：</span></span>
<span class="line"><span style="color:#F47067;">drop</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">procedure</span><span style="color:#ADBAC7;"> pro_test1;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">DROP</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">PROCEDURE</span><span style="color:#24292E;"> [IF EXISTS] sp_name ；</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 例子：</span></span>
<span class="line"><span style="color:#D73A49;">drop</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">procedure</span><span style="color:#24292E;"> pro_test1;</span></span></code></pre></div><h4 id="存储过程语法" tabindex="-1">存储过程语法 <a class="header-anchor" href="#存储过程语法" aria-label="Permalink to &quot;存储过程语法&quot;">​</a></h4><p>  存储过程是可以编程的，意味着可以使用变量，表达式，控制结构，来完成比较复杂的功能。</p><h5 id="_1、变量" tabindex="-1">1、变量 <a class="header-anchor" href="#_1、变量" aria-label="Permalink to &quot;1、变量&quot;">​</a></h5><p>  DECLARE</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 通过 DECLARE 可以定义一个局部变量，该变量的作用范围只能在 BEGIN…END 块中。</span></span>
<span class="line"><span style="color:#F47067;">DECLARE</span><span style="color:#ADBAC7;"> var_name[,...] </span><span style="color:#F47067;">type</span><span style="color:#ADBAC7;"> [DEFAULT value]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 例子：</span></span>
<span class="line"><span style="color:#ADBAC7;">delimiter $</span></span>
<span class="line"><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">procedure</span><span style="color:#ADBAC7;"> pro_test2()</span></span>
<span class="line"><span style="color:#F47067;">begin</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">declare</span><span style="color:#ADBAC7;"> num </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">default</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">5</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> num</span><span style="color:#F47067;">+</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">10</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#F47067;">end</span><span style="color:#ADBAC7;">$</span></span>
<span class="line"><span style="color:#ADBAC7;">delimiter ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 通过 DECLARE 可以定义一个局部变量，该变量的作用范围只能在 BEGIN…END 块中。</span></span>
<span class="line"><span style="color:#D73A49;">DECLARE</span><span style="color:#24292E;"> var_name[,...] </span><span style="color:#D73A49;">type</span><span style="color:#24292E;"> [DEFAULT value]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 例子：</span></span>
<span class="line"><span style="color:#24292E;">delimiter $</span></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">procedure</span><span style="color:#24292E;"> pro_test2()</span></span>
<span class="line"><span style="color:#D73A49;">begin</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">declare</span><span style="color:#24292E;"> num </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> num</span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;">$</span></span>
<span class="line"><span style="color:#24292E;">delimiter ;</span></span></code></pre></div><p>  SET</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 直接赋值使用 SET，可以赋常量或者赋表达式</span></span>
<span class="line"><span style="color:#F47067;">SET</span><span style="color:#ADBAC7;"> var_name </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> expr [, var_name = expr] ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 例子：</span></span>
<span class="line"><span style="color:#ADBAC7;">DELIMITER $</span></span>
<span class="line"><span style="color:#F47067;">CREATE</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">PROCEDURE</span><span style="color:#ADBAC7;"> pro_test3()</span></span>
<span class="line"><span style="color:#F47067;">BEGIN</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">DECLARE</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">NAME</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">VARCHAR</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">20</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">SET</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">NAME</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;MYSQL&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">SELECT</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">NAME</span><span style="color:#ADBAC7;"> ;</span></span>
<span class="line"><span style="color:#F47067;">END</span><span style="color:#ADBAC7;">$</span></span>
<span class="line"><span style="color:#ADBAC7;">DELIMITER ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 直接赋值使用 SET，可以赋常量或者赋表达式</span></span>
<span class="line"><span style="color:#D73A49;">SET</span><span style="color:#24292E;"> var_name </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> expr [, var_name = expr] ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 例子：</span></span>
<span class="line"><span style="color:#24292E;">DELIMITER $</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">PROCEDURE</span><span style="color:#24292E;"> pro_test3()</span></span>
<span class="line"><span style="color:#D73A49;">BEGIN</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">DECLARE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">NAME</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">VARCHAR</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">20</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">SET</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">NAME</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;MYSQL&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">NAME</span><span style="color:#24292E;"> ;</span></span>
<span class="line"><span style="color:#D73A49;">END</span><span style="color:#24292E;">$</span></span>
<span class="line"><span style="color:#24292E;">DELIMITER ;</span></span></code></pre></div><p>  可以通过select ... into 方式进行赋值操作</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">DELIMITER $</span></span>
<span class="line"><span style="color:#F47067;">CREATE</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">PROCEDURE</span><span style="color:#ADBAC7;"> pro_test5()</span></span>
<span class="line"><span style="color:#F47067;">BEGIN</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">declare</span><span style="color:#ADBAC7;"> countnum </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">count</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">into</span><span style="color:#ADBAC7;"> countnum </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> city;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> countnum;</span></span>
<span class="line"><span style="color:#F47067;">END</span><span style="color:#ADBAC7;">$</span></span>
<span class="line"><span style="color:#ADBAC7;">DELIMITER ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">DELIMITER $</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">PROCEDURE</span><span style="color:#24292E;"> pro_test5()</span></span>
<span class="line"><span style="color:#D73A49;">BEGIN</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">declare</span><span style="color:#24292E;"> countnum </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">count</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">into</span><span style="color:#24292E;"> countnum </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> city;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> countnum;</span></span>
<span class="line"><span style="color:#D73A49;">END</span><span style="color:#24292E;">$</span></span>
<span class="line"><span style="color:#24292E;">DELIMITER ;</span></span></code></pre></div><h5 id="_2、if条件判断" tabindex="-1">2、if条件判断 <a class="header-anchor" href="#_2、if条件判断" aria-label="Permalink to &quot;2、if条件判断&quot;">​</a></h5><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">if</span><span style="color:#ADBAC7;"> search_condition </span><span style="color:#F47067;">then</span><span style="color:#ADBAC7;"> statement_list</span></span>
<span class="line"><span style="color:#ADBAC7;">    [elseif search_condition then statement_list] ...</span></span>
<span class="line"><span style="color:#ADBAC7;">    [else statement_list]</span></span>
<span class="line"><span style="color:#F47067;">end</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 例子：</span></span>
<span class="line"><span style="color:#768390;">-- 180 及以上 ----------&gt; 身材高挑；</span></span>
<span class="line"><span style="color:#768390;">-- 170 - 180 ---------&gt; 标准身材；</span></span>
<span class="line"><span style="color:#768390;">-- 170 以下 ----------&gt; 一般身材</span></span>
<span class="line"><span style="color:#ADBAC7;">delimiter $</span></span>
<span class="line"><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">procedure</span><span style="color:#ADBAC7;"> pro_test6()</span></span>
<span class="line"><span style="color:#F47067;">begin</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">declare</span><span style="color:#ADBAC7;"> height </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">default</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">175</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">declare</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">description</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">varchar</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">50</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;"> height </span><span style="color:#F47067;">&gt;=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">180</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">then</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">description</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;身材高挑&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    elseif height </span><span style="color:#F47067;">&gt;=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">170</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">and</span><span style="color:#ADBAC7;"> height </span><span style="color:#F47067;">&lt;</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">180</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">then</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">description</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;标准身材&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">else</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">description</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;一般身材&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">end</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">description</span><span style="color:#ADBAC7;"> ;</span></span>
<span class="line"><span style="color:#F47067;">end</span><span style="color:#ADBAC7;">$</span></span>
<span class="line"><span style="color:#ADBAC7;">delimiter ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> search_condition </span><span style="color:#D73A49;">then</span><span style="color:#24292E;"> statement_list</span></span>
<span class="line"><span style="color:#24292E;">    [elseif search_condition then statement_list] ...</span></span>
<span class="line"><span style="color:#24292E;">    [else statement_list]</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 例子：</span></span>
<span class="line"><span style="color:#6A737D;">-- 180 及以上 ----------&gt; 身材高挑；</span></span>
<span class="line"><span style="color:#6A737D;">-- 170 - 180 ---------&gt; 标准身材；</span></span>
<span class="line"><span style="color:#6A737D;">-- 170 以下 ----------&gt; 一般身材</span></span>
<span class="line"><span style="color:#24292E;">delimiter $</span></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">procedure</span><span style="color:#24292E;"> pro_test6()</span></span>
<span class="line"><span style="color:#D73A49;">begin</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">declare</span><span style="color:#24292E;"> height </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">175</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">declare</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">description</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">varchar</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">50</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> height </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">180</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">description</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;身材高挑&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    elseif height </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">170</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> height </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">180</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">description</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;标准身材&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">else</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">description</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;一般身材&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">end</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">description</span><span style="color:#24292E;"> ;</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;">$</span></span>
<span class="line"><span style="color:#24292E;">delimiter ;</span></span></code></pre></div><h5 id="_3、传递参数" tabindex="-1">3、传递参数 <a class="header-anchor" href="#_3、传递参数" aria-label="Permalink to &quot;3、传递参数&quot;">​</a></h5><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">procedure</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">procedure_name</span><span style="color:#ADBAC7;">([in/out/inout] 参数名 参数类型)</span></span>
<span class="line"><span style="color:#ADBAC7;">...</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">procedure</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">procedure_name</span><span style="color:#24292E;">([in/out/inout] 参数名 参数类型)</span></span>
<span class="line"><span style="color:#24292E;">...</span></span></code></pre></div><p>  IN : 该参数可以作为输入，也就是需要调用方传入值 , 默认</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- IN的例子：根据定义的身高变量，判定当前身高的所属的身材类型</span></span>
<span class="line"><span style="color:#ADBAC7;">delimiter $</span></span>
<span class="line"><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">procedure</span><span style="color:#ADBAC7;"> pro_test5(</span><span style="color:#F47067;">in</span><span style="color:#ADBAC7;"> height </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F47067;">begin</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">declare</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">description</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">varchar</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">50</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">default</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;"> height </span><span style="color:#F47067;">&gt;=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">180</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">then</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">description=</span><span style="color:#96D0FF;">&#39;身材高挑&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    elseif height </span><span style="color:#F47067;">&gt;=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">170</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">and</span><span style="color:#ADBAC7;"> height </span><span style="color:#F47067;">&lt;</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">180</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">then</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">description=</span><span style="color:#96D0FF;">&#39;标准身材&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">else</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">description=</span><span style="color:#96D0FF;">&#39;一般身材&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">end</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">concat</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&#39;身高 &#39;</span><span style="color:#ADBAC7;">, height , </span><span style="color:#96D0FF;">&#39;对应的身材类型为:&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#F47067;">description</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#F47067;">end</span><span style="color:#ADBAC7;">$</span></span>
<span class="line"><span style="color:#ADBAC7;">    delimiter ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- IN的例子：根据定义的身高变量，判定当前身高的所属的身材类型</span></span>
<span class="line"><span style="color:#24292E;">delimiter $</span></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">procedure</span><span style="color:#24292E;"> pro_test5(</span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> height </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">begin</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">declare</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">description</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">varchar</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">50</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> height </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">180</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">description=</span><span style="color:#032F62;">&#39;身材高挑&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    elseif height </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">170</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> height </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">180</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">description=</span><span style="color:#032F62;">&#39;标准身材&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">else</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">description=</span><span style="color:#032F62;">&#39;一般身材&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">end</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">concat</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;身高 &#39;</span><span style="color:#24292E;">, height , </span><span style="color:#032F62;">&#39;对应的身材类型为:&#39;</span><span style="color:#24292E;">,</span><span style="color:#D73A49;">description</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;">$</span></span>
<span class="line"><span style="color:#24292E;">    delimiter ;</span></span></code></pre></div><p>  OUT: 该参数作为输出，也就是该参数可以作为返回值</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- OUT的例子：根据传入的身高变量，获取当前身高的所属的身材类型</span></span>
<span class="line"><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">procedure</span><span style="color:#ADBAC7;"> pro_test5(</span><span style="color:#F47067;">in</span><span style="color:#ADBAC7;"> height </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;"> , </span><span style="color:#F47067;">out</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">description</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">varchar</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">100</span><span style="color:#ADBAC7;">))</span></span>
<span class="line"><span style="color:#F47067;">begin</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;"> height </span><span style="color:#F47067;">&gt;=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">180</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">then</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">description=</span><span style="color:#96D0FF;">&#39;身材高挑&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    elseif height </span><span style="color:#F47067;">&gt;=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">170</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">and</span><span style="color:#ADBAC7;"> height </span><span style="color:#F47067;">&lt;</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">180</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">then</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">description=</span><span style="color:#96D0FF;">&#39;标准身材&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">else</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">description=</span><span style="color:#96D0FF;">&#39;一般身材&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">end</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#F47067;">end</span><span style="color:#ADBAC7;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 调用函数：</span></span>
<span class="line"><span style="color:#F47067;">call</span><span style="color:#ADBAC7;"> pro_test5(</span><span style="color:#6CB6FF;">168</span><span style="color:#ADBAC7;">, @description);</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> @description;</span></span>
<span class="line"><span style="color:#768390;">-- @description: 在变量名称前面加上“@”符号，叫做用户会话变量，代表整个会话过程他都是有作用的，这个类似于全局变量一样。</span></span>
<span class="line"><span style="color:#768390;">-- @@global.sort_buffer_size : 这种在变量前加上 &quot;@@&quot; 符号, 叫做系统变量。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- OUT的例子：根据传入的身高变量，获取当前身高的所属的身材类型</span></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">procedure</span><span style="color:#24292E;"> pro_test5(</span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> height </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> , </span><span style="color:#D73A49;">out</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">description</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">varchar</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">100</span><span style="color:#24292E;">))</span></span>
<span class="line"><span style="color:#D73A49;">begin</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> height </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">180</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">description=</span><span style="color:#032F62;">&#39;身材高挑&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    elseif height </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">170</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> height </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">180</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">description=</span><span style="color:#032F62;">&#39;标准身材&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">else</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">description=</span><span style="color:#032F62;">&#39;一般身材&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">end</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;">$</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 调用函数：</span></span>
<span class="line"><span style="color:#D73A49;">call</span><span style="color:#24292E;"> pro_test5(</span><span style="color:#005CC5;">168</span><span style="color:#24292E;">, @description);</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> @description;</span></span>
<span class="line"><span style="color:#6A737D;">-- @description: 在变量名称前面加上“@”符号，叫做用户会话变量，代表整个会话过程他都是有作用的，这个类似于全局变量一样。</span></span>
<span class="line"><span style="color:#6A737D;">-- @@global.sort_buffer_size : 这种在变量前加上 &quot;@@&quot; 符号, 叫做系统变量。</span></span></code></pre></div><p>  INOUT: 既可以作为输入参数，也可以作为输出参数</p><h5 id="_4、case结构" tabindex="-1">4、case结构 <a class="header-anchor" href="#_4、case结构" aria-label="Permalink to &quot;4、case结构&quot;">​</a></h5><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 方式一 :</span></span>
<span class="line"><span style="color:#F47067;">CASE</span><span style="color:#ADBAC7;"> case_value</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">WHEN</span><span style="color:#ADBAC7;"> when_value </span><span style="color:#F47067;">THEN</span><span style="color:#ADBAC7;"> statement_list</span></span>
<span class="line"><span style="color:#ADBAC7;">    [WHEN when_value THEN statement_list] ...</span></span>
<span class="line"><span style="color:#ADBAC7;">    [ELSE statement_list]</span></span>
<span class="line"><span style="color:#F47067;">END</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">CASE</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 方式二 :</span></span>
<span class="line"><span style="color:#F47067;">CASE</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">WHEN</span><span style="color:#ADBAC7;"> search_condition </span><span style="color:#F47067;">THEN</span><span style="color:#ADBAC7;"> statement_list</span></span>
<span class="line"><span style="color:#ADBAC7;">    [WHEN search_condition THEN statement_list] ...</span></span>
<span class="line"><span style="color:#ADBAC7;">    [ELSE statement_list]</span></span>
<span class="line"><span style="color:#F47067;">END</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">CASE</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 例子：给定一个月份, 然后计算出所在的季度</span></span>
<span class="line"><span style="color:#ADBAC7;">delimiter $</span></span>
<span class="line"><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">procedure</span><span style="color:#ADBAC7;"> pro_test9(</span><span style="color:#F47067;">month</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F47067;">begin</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">declare</span><span style="color:#ADBAC7;"> result </span><span style="color:#F47067;">varchar</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">20</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">case</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">when</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">month</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&gt;=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">and</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">month</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&lt;=</span><span style="color:#6CB6FF;">3</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">then</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> result </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;第一季度&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">when</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">month</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&gt;=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">4</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">and</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">month</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&lt;=</span><span style="color:#6CB6FF;">6</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">then</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> result </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;第二季度&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">when</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">month</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&gt;=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">7</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">and</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">month</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&lt;=</span><span style="color:#6CB6FF;">9</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">then</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> result </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;第三季度&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">when</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">month</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&gt;=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">10</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">and</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">month</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">&lt;=</span><span style="color:#6CB6FF;">12</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">then</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> result </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;第四季度&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">end</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">case</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">concat</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&#39;您输入的月份为 :&#39;</span><span style="color:#ADBAC7;">, </span><span style="color:#F47067;">month</span><span style="color:#ADBAC7;"> , </span><span style="color:#96D0FF;">&#39; , 该月份为 : &#39;</span><span style="color:#ADBAC7;"> , result) </span><span style="color:#F47067;">as</span><span style="color:#ADBAC7;"> content ;</span></span>
<span class="line"><span style="color:#F47067;">end</span><span style="color:#ADBAC7;">$</span></span>
<span class="line"><span style="color:#ADBAC7;">delimiter ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 方式一 :</span></span>
<span class="line"><span style="color:#D73A49;">CASE</span><span style="color:#24292E;"> case_value</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">WHEN</span><span style="color:#24292E;"> when_value </span><span style="color:#D73A49;">THEN</span><span style="color:#24292E;"> statement_list</span></span>
<span class="line"><span style="color:#24292E;">    [WHEN when_value THEN statement_list] ...</span></span>
<span class="line"><span style="color:#24292E;">    [ELSE statement_list]</span></span>
<span class="line"><span style="color:#D73A49;">END</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">CASE</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 方式二 :</span></span>
<span class="line"><span style="color:#D73A49;">CASE</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">WHEN</span><span style="color:#24292E;"> search_condition </span><span style="color:#D73A49;">THEN</span><span style="color:#24292E;"> statement_list</span></span>
<span class="line"><span style="color:#24292E;">    [WHEN search_condition THEN statement_list] ...</span></span>
<span class="line"><span style="color:#24292E;">    [ELSE statement_list]</span></span>
<span class="line"><span style="color:#D73A49;">END</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">CASE</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 例子：给定一个月份, 然后计算出所在的季度</span></span>
<span class="line"><span style="color:#24292E;">delimiter $</span></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">procedure</span><span style="color:#24292E;"> pro_test9(</span><span style="color:#D73A49;">month</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">begin</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">declare</span><span style="color:#24292E;"> result </span><span style="color:#D73A49;">varchar</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">20</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">case</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">when</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">month</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">month</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;=</span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">then</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;第一季度&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">when</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">month</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">month</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;=</span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">then</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;第二季度&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">when</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">month</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">7</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">month</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;=</span><span style="color:#005CC5;">9</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">then</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;第三季度&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">when</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">month</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">month</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;=</span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">then</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;第四季度&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">end</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">case</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">concat</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;您输入的月份为 :&#39;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">month</span><span style="color:#24292E;"> , </span><span style="color:#032F62;">&#39; , 该月份为 : &#39;</span><span style="color:#24292E;"> , result) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> content ;</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;">$</span></span>
<span class="line"><span style="color:#24292E;">delimiter ;</span></span></code></pre></div><h5 id="_5、while循环" tabindex="-1">5、while循环 <a class="header-anchor" href="#_5、while循环" aria-label="Permalink to &quot;5、while循环&quot;">​</a></h5><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">while</span><span style="color:#ADBAC7;"> search_condition do</span></span>
<span class="line"><span style="color:#ADBAC7;">    statement_list</span></span>
<span class="line"><span style="color:#F47067;">end</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">while</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 例子：计算从1加到n的值</span></span>
<span class="line"><span style="color:#ADBAC7;">delimiter $</span></span>
<span class="line"><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">procedure</span><span style="color:#ADBAC7;"> pro_test8(n </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F47067;">begin</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">declare</span><span style="color:#ADBAC7;"> total </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">default</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">declare</span><span style="color:#ADBAC7;"> num </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">default</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">while</span><span style="color:#ADBAC7;"> num</span><span style="color:#F47067;">&lt;=</span><span style="color:#ADBAC7;">n do</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> total </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> total </span><span style="color:#F47067;">+</span><span style="color:#ADBAC7;"> num;</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> num </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> num </span><span style="color:#F47067;">+</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">end</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">while</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> total;</span></span>
<span class="line"><span style="color:#F47067;">end</span><span style="color:#ADBAC7;">$</span></span>
<span class="line"><span style="color:#ADBAC7;">delimiter ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">while</span><span style="color:#24292E;"> search_condition do</span></span>
<span class="line"><span style="color:#24292E;">    statement_list</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">while</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 例子：计算从1加到n的值</span></span>
<span class="line"><span style="color:#24292E;">delimiter $</span></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">procedure</span><span style="color:#24292E;"> pro_test8(n </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">begin</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">declare</span><span style="color:#24292E;"> total </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">declare</span><span style="color:#24292E;"> num </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">while</span><span style="color:#24292E;"> num</span><span style="color:#D73A49;">&lt;=</span><span style="color:#24292E;">n do</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> total </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> total </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> num;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> num </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> num </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">end</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">while</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> total;</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;">$</span></span>
<span class="line"><span style="color:#24292E;">delimiter ;</span></span></code></pre></div><h5 id="_6、repeat结构" tabindex="-1">6、repeat结构 <a class="header-anchor" href="#_6、repeat结构" aria-label="Permalink to &quot;6、repeat结构&quot;">​</a></h5><p>  有条件的循环控制语句, 当满足条件的时候退出循环。</p><p>  while 是满足条件才执行，repeat 是满足条件就退出循环。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">REPEAT</span></span>
<span class="line"><span style="color:#ADBAC7;">    statement_list</span></span>
<span class="line"><span style="color:#ADBAC7;">    UNTIL search_condition  </span><span style="color:#768390;">-- UNTIL search_condition 结束条件没有分号</span></span>
<span class="line"><span style="color:#F47067;">END</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">REPEAT</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 例子：计算从1加到n的值</span></span>
<span class="line"><span style="color:#ADBAC7;">delimiter $</span></span>
<span class="line"><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">procedure</span><span style="color:#ADBAC7;"> pro_test10(n </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F47067;">begin</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">declare</span><span style="color:#ADBAC7;"> total </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">default</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">repeat</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> total </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> total </span><span style="color:#F47067;">+</span><span style="color:#ADBAC7;"> n;</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> n </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> n </span><span style="color:#F47067;">-</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">        until n</span><span style="color:#F47067;">=</span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;">  </span><span style="color:#768390;">-- 注意：结束条件没有分号</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">end</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">repeat</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> total ;</span></span>
<span class="line"><span style="color:#F47067;">end</span><span style="color:#ADBAC7;">$</span></span>
<span class="line"><span style="color:#ADBAC7;">delimiter ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">REPEAT</span></span>
<span class="line"><span style="color:#24292E;">    statement_list</span></span>
<span class="line"><span style="color:#24292E;">    UNTIL search_condition  </span><span style="color:#6A737D;">-- UNTIL search_condition 结束条件没有分号</span></span>
<span class="line"><span style="color:#D73A49;">END</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">REPEAT</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 例子：计算从1加到n的值</span></span>
<span class="line"><span style="color:#24292E;">delimiter $</span></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">procedure</span><span style="color:#24292E;"> pro_test10(n </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">begin</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">declare</span><span style="color:#24292E;"> total </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">repeat</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> total </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> total </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> n;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> n </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> n </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        until n</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">-- 注意：结束条件没有分号</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">end</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">repeat</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> total ;</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;">$</span></span>
<span class="line"><span style="color:#24292E;">delimiter ;</span></span></code></pre></div><h5 id="_7、loop语句" tabindex="-1">7、loop语句 <a class="header-anchor" href="#_7、loop语句" aria-label="Permalink to &quot;7、loop语句&quot;">​</a></h5><p>  LOOP实现简单的循环，退出循环的条件需要使用其他的语句定义，通常可以使用 LEAVE 语句实现</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">[begin_label:] </span><span style="color:#F47067;">LOOP</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">-- 给LOOP循环起别名</span></span>
<span class="line"><span style="color:#ADBAC7;">    statement_list  </span><span style="color:#768390;">-- 如果不在 statement_list 中增加退出循环的语句，那么 LOOP 语句可以用来实现简单的死循环。</span></span>
<span class="line"><span style="color:#F47067;">END</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">LOOP</span><span style="color:#ADBAC7;"> [end_label]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[begin_label:] </span><span style="color:#D73A49;">LOOP</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">-- 给LOOP循环起别名</span></span>
<span class="line"><span style="color:#24292E;">    statement_list  </span><span style="color:#6A737D;">-- 如果不在 statement_list 中增加退出循环的语句，那么 LOOP 语句可以用来实现简单的死循环。</span></span>
<span class="line"><span style="color:#D73A49;">END</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">LOOP</span><span style="color:#24292E;"> [end_label]</span></span></code></pre></div><h5 id="_8、leave语句" tabindex="-1">8、leave语句 <a class="header-anchor" href="#_8、leave语句" aria-label="Permalink to &quot;8、leave语句&quot;">​</a></h5><p>  用来从标注的流程构造中退出，通常和BEGIN ... END 或者循环一起使用。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- loop和leave的例子：</span></span>
<span class="line"><span style="color:#ADBAC7;">delimiter $</span></span>
<span class="line"><span style="color:#F47067;">CREATE</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">PROCEDURE</span><span style="color:#ADBAC7;"> pro_test11(n </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F47067;">BEGIN</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">declare</span><span style="color:#ADBAC7;"> total </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">default</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    ins: </span><span style="color:#F47067;">LOOP</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">IF</span><span style="color:#ADBAC7;"> n </span><span style="color:#F47067;">&lt;=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">then</span></span>
<span class="line"><span style="color:#ADBAC7;">            leave ins;</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">END</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">IF</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> total </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> total </span><span style="color:#F47067;">+</span><span style="color:#ADBAC7;"> n;</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> n </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> n </span><span style="color:#F47067;">-</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">END</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">LOOP</span><span style="color:#ADBAC7;"> ins;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> total;</span></span>
<span class="line"><span style="color:#F47067;">END</span><span style="color:#ADBAC7;">$</span></span>
<span class="line"><span style="color:#ADBAC7;">delimiter ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- loop和leave的例子：</span></span>
<span class="line"><span style="color:#24292E;">delimiter $</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">PROCEDURE</span><span style="color:#24292E;"> pro_test11(n </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">BEGIN</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">declare</span><span style="color:#24292E;"> total </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    ins: </span><span style="color:#D73A49;">LOOP</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">IF</span><span style="color:#24292E;"> n </span><span style="color:#D73A49;">&lt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">            leave ins;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">END</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">IF</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> total </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> total </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> n;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> n </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> n </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">END</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">LOOP</span><span style="color:#24292E;"> ins;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> total;</span></span>
<span class="line"><span style="color:#D73A49;">END</span><span style="color:#24292E;">$</span></span>
<span class="line"><span style="color:#24292E;">delimiter ;</span></span></code></pre></div><h5 id="_9、游标-光标" tabindex="-1">9、游标/光标 <a class="header-anchor" href="#_9、游标-光标" aria-label="Permalink to &quot;9、游标/光标&quot;">​</a></h5><p>  游标是用来存储查询结果集的数据类型,在存储过程和存储函数中可以使用光标对结果集进行循环的处理。</p><p>  光标的使用包括光标的声明、OPEN、FETCH 和 CLOSE</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">DELIMITER $</span></span>
<span class="line"><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">procedure</span><span style="color:#ADBAC7;"> pro_test12()</span></span>
<span class="line"><span style="color:#F47067;">begin</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">DECLARE</span><span style="color:#ADBAC7;"> id </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">11</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">DECLARE</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">name</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">varchar</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">50</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">DECLARE</span><span style="color:#ADBAC7;"> age </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">11</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">DECLARE</span><span style="color:#ADBAC7;"> salary </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">11</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">DECLARE</span><span style="color:#ADBAC7;"> has_data </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">default</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">DECLARE</span><span style="color:#ADBAC7;"> emp_result </span><span style="color:#F47067;">CURSOR</span><span style="color:#ADBAC7;"> FOR </span><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> emp;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">DECLARE</span><span style="color:#ADBAC7;"> EXIT HANDLER FOR </span><span style="color:#F47067;">NOT</span><span style="color:#ADBAC7;"> FOUND </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> has_data </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">-- 拿不到数据会触发句柄，意思是抓取不到数据时，将has_data设置为0，该句声明必须在声明游标语句之后</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">open</span><span style="color:#ADBAC7;"> emp_result;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">repeat</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">fetch</span><span style="color:#ADBAC7;"> emp_result </span><span style="color:#F47067;">into</span><span style="color:#ADBAC7;"> id , </span><span style="color:#F47067;">name</span><span style="color:#ADBAC7;"> , age , salary;</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">concat</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&#39;id为&#39;</span><span style="color:#ADBAC7;">,id, </span><span style="color:#96D0FF;">&#39;, name 为&#39;</span><span style="color:#ADBAC7;"> ,</span><span style="color:#F47067;">name</span><span style="color:#ADBAC7;"> , </span><span style="color:#96D0FF;">&#39;, age为 &#39;</span><span style="color:#ADBAC7;"> ,age , </span><span style="color:#96D0FF;">&#39;, 薪水为: &#39;</span><span style="color:#ADBAC7;">, salary);</span></span>
<span class="line"><span style="color:#ADBAC7;">        until has_data </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">end</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">repeat</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">close</span><span style="color:#ADBAC7;"> emp_result;</span></span>
<span class="line"><span style="color:#F47067;">end</span><span style="color:#ADBAC7;">$</span></span>
<span class="line"><span style="color:#ADBAC7;">DELIMITER ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">DELIMITER $</span></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">procedure</span><span style="color:#24292E;"> pro_test12()</span></span>
<span class="line"><span style="color:#D73A49;">begin</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">DECLARE</span><span style="color:#24292E;"> id </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">11</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">DECLARE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">varchar</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">50</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">DECLARE</span><span style="color:#24292E;"> age </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">11</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">DECLARE</span><span style="color:#24292E;"> salary </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">11</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">DECLARE</span><span style="color:#24292E;"> has_data </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">DECLARE</span><span style="color:#24292E;"> emp_result </span><span style="color:#D73A49;">CURSOR</span><span style="color:#24292E;"> FOR </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> emp;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">DECLARE</span><span style="color:#24292E;"> EXIT HANDLER FOR </span><span style="color:#D73A49;">NOT</span><span style="color:#24292E;"> FOUND </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> has_data </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">-- 拿不到数据会触发句柄，意思是抓取不到数据时，将has_data设置为0，该句声明必须在声明游标语句之后</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">open</span><span style="color:#24292E;"> emp_result;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">repeat</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">fetch</span><span style="color:#24292E;"> emp_result </span><span style="color:#D73A49;">into</span><span style="color:#24292E;"> id , </span><span style="color:#D73A49;">name</span><span style="color:#24292E;"> , age , salary;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">concat</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;id为&#39;</span><span style="color:#24292E;">,id, </span><span style="color:#032F62;">&#39;, name 为&#39;</span><span style="color:#24292E;"> ,</span><span style="color:#D73A49;">name</span><span style="color:#24292E;"> , </span><span style="color:#032F62;">&#39;, age为 &#39;</span><span style="color:#24292E;"> ,age , </span><span style="color:#032F62;">&#39;, 薪水为: &#39;</span><span style="color:#24292E;">, salary);</span></span>
<span class="line"><span style="color:#24292E;">        until has_data </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">end</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">repeat</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">close</span><span style="color:#24292E;"> emp_result;</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;">$</span></span>
<span class="line"><span style="color:#24292E;">DELIMITER ;</span></span></code></pre></div><h4 id="创建存储函数" tabindex="-1">创建存储函数 <a class="header-anchor" href="#创建存储函数" aria-label="Permalink to &quot;创建存储函数&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">CREATE</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">FUNCTION</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">function_name</span><span style="color:#ADBAC7;">([param type ... ])</span></span>
<span class="line"><span style="color:#F47067;">RETURNS</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">type</span></span>
<span class="line"><span style="color:#F47067;">BEGIN</span></span>
<span class="line"><span style="color:#ADBAC7;">    ...</span></span>
<span class="line"><span style="color:#F47067;">END</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 例子：定义一个存储函数, 请求满足条件的总记录数;</span></span>
<span class="line"><span style="color:#ADBAC7;">delimiter $</span></span>
<span class="line"><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">function</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">count_city</span><span style="color:#ADBAC7;">(countryId </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F47067;">returns</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">int</span></span>
<span class="line"><span style="color:#F47067;">begin</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">declare</span><span style="color:#ADBAC7;"> cnum </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;"> ;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">count</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">into</span><span style="color:#ADBAC7;"> cnum </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> city </span><span style="color:#F47067;">where</span><span style="color:#ADBAC7;"> country_id </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> countryId;    </span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> cnum;</span></span>
<span class="line"><span style="color:#F47067;">end</span><span style="color:#ADBAC7;">$</span></span>
<span class="line"><span style="color:#ADBAC7;">delimiter ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 调用</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> count_city(</span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FUNCTION</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">function_name</span><span style="color:#24292E;">([param type ... ])</span></span>
<span class="line"><span style="color:#D73A49;">RETURNS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">type</span></span>
<span class="line"><span style="color:#D73A49;">BEGIN</span></span>
<span class="line"><span style="color:#24292E;">    ...</span></span>
<span class="line"><span style="color:#D73A49;">END</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 例子：定义一个存储函数, 请求满足条件的总记录数;</span></span>
<span class="line"><span style="color:#24292E;">delimiter $</span></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">count_city</span><span style="color:#24292E;">(countryId </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">returns</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span></span>
<span class="line"><span style="color:#D73A49;">begin</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">declare</span><span style="color:#24292E;"> cnum </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> ;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">count</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">into</span><span style="color:#24292E;"> cnum </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> city </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> country_id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> countryId;    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> cnum;</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;">$</span></span>
<span class="line"><span style="color:#24292E;">delimiter ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 调用</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> count_city(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">);</span></span></code></pre></div><h2 id="触发器" tabindex="-1">触发器 <a class="header-anchor" href="#触发器" aria-label="Permalink to &quot;触发器&quot;">​</a></h2><p>  触发器是与表有关的数据库对象，指在 insert/update/delete 之前或之后，触发并执行触发器中定义的SQL语句集合。触发器的这种特性可以协助应用在数据库端确保数据的完整性 , 日志记录 , 数据校验等操作 。</p><p>  使用别名 OLD 和 NEW 来引用触发器中发生变化的记录内容，这与其他的数据库是相似的。现在触发器还只支持行级触发，不支持语句级触发。</p><table><thead><tr><th>触发器类型</th><th>NEW和OLD的使用</th></tr></thead><tbody><tr><td>INSERT型触发器</td><td>NEW表示将要或者已经新增的数据</td></tr><tr><td>UPDATE型触发器</td><td>OLD表示修改之前的数据，NEW表示将要或已经修改后的数据</td></tr><tr><td>DELETE型触发器</td><td>OLD表示将要或者已经删除的数据</td></tr></tbody></table><h3 id="相关sql-1" tabindex="-1">相关SQL <a class="header-anchor" href="#相关sql-1" aria-label="Permalink to &quot;相关SQL&quot;">​</a></h3><h4 id="创建触发器" tabindex="-1">创建触发器 <a class="header-anchor" href="#创建触发器" aria-label="Permalink to &quot;创建触发器&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">trigger</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">trigger_name</span></span>
<span class="line"><span style="color:#F47067;">before/after</span><span style="color:#ADBAC7;">   </span><span style="color:#F47067;">insert/update/delete</span></span>
<span class="line"><span style="color:#F47067;">on</span><span style="color:#ADBAC7;"> tbl_name</span></span>
<span class="line"><span style="color:#ADBAC7;">[ for each row ] </span><span style="color:#768390;">-- 行级触发器</span></span>
<span class="line"><span style="color:#F47067;">begin</span></span>
<span class="line"><span style="color:#ADBAC7;">    trigger_stmt ;</span></span>
<span class="line"><span style="color:#F47067;">end</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 例子：通过触发器记录 emp 表的数据变更日志, 包含增加, 修改, 删除 ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 创建 insert 型触发器，完成插入数据时的日志记录 :</span></span>
<span class="line"><span style="color:#ADBAC7;">DELIMITER $</span></span>
<span class="line"><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">trigger</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">emp_logs_insert_trigger</span></span>
<span class="line"><span style="color:#F47067;">after</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">insert</span></span>
<span class="line"><span style="color:#F47067;">on</span><span style="color:#ADBAC7;"> emp</span></span>
<span class="line"><span style="color:#ADBAC7;">for each </span><span style="color:#F47067;">row</span></span>
<span class="line"><span style="color:#F47067;">begin</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">insert into</span><span style="color:#ADBAC7;"> emp_logs (id,operation,operate_time,operate_id,operate_params)</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">values</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">null</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;insert&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#F47067;">now</span><span style="color:#ADBAC7;">(),</span><span style="color:#6CB6FF;">new</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">id</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#6CB6FF;">concat</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&#39;插入后(id:&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">new</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">id</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;, name:&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">new</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">name</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;, age:&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">new</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">age</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;, salary:&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">new</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">salary</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;)&#39;</span><span style="color:#ADBAC7;">));</span></span>
<span class="line"><span style="color:#F47067;">end</span><span style="color:#ADBAC7;"> $</span></span>
<span class="line"><span style="color:#ADBAC7;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 创建 update 型触发器，完成更新数据时的日志记录 :</span></span>
<span class="line"><span style="color:#ADBAC7;">DELIMITER $</span></span>
<span class="line"><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">trigger</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">emp_logs_update_trigger</span></span>
<span class="line"><span style="color:#F47067;">after</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">update</span></span>
<span class="line"><span style="color:#F47067;">on</span><span style="color:#ADBAC7;"> emp</span></span>
<span class="line"><span style="color:#ADBAC7;">for each </span><span style="color:#F47067;">row</span></span>
<span class="line"><span style="color:#F47067;">begin</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">insert into</span><span style="color:#ADBAC7;"> emp_logs (id,operation,operate_time,operate_id,operate_params)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">values</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">null</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;update&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#F47067;">now</span><span style="color:#ADBAC7;">(),</span><span style="color:#6CB6FF;">new</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">id</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#6CB6FF;">concat</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&#39;修改前(id:&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">old</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">id</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;, name:&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">old</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">name</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;, age:&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">old</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">age</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;, salary:&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">old</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">salary</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;) , 修改后(id&#39;</span></span>
<span class="line"><span style="color:#ADBAC7;">    ,</span><span style="color:#6CB6FF;">new</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">id</span><span style="color:#ADBAC7;">, </span><span style="color:#96D0FF;">&#39;name:&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">new</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">name</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;, age:&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">new</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">age</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;, salary:&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">new</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">salary</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;)&#39;</span><span style="color:#ADBAC7;">));</span></span>
<span class="line"><span style="color:#F47067;">end</span><span style="color:#ADBAC7;"> $</span></span>
<span class="line"><span style="color:#ADBAC7;">DELIMITER ;</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span></span>
<span class="line"><span style="color:#768390;">-- 创建delete 行的触发器 , 完成删除数据时的日志记录 :</span></span>
<span class="line"><span style="color:#ADBAC7;">DELIMITER $</span></span>
<span class="line"><span style="color:#F47067;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">trigger</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">emp_logs_delete_trigger</span></span>
<span class="line"><span style="color:#F47067;">after</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">delete</span></span>
<span class="line"><span style="color:#F47067;">on</span><span style="color:#ADBAC7;"> emp</span></span>
<span class="line"><span style="color:#ADBAC7;">for each </span><span style="color:#F47067;">row</span></span>
<span class="line"><span style="color:#F47067;">begin</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">insert into</span><span style="color:#ADBAC7;"> emp_logs (id,operation,operate_time,operate_id,operate_params)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">values</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">null</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;delete&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#F47067;">now</span><span style="color:#ADBAC7;">(),</span><span style="color:#6CB6FF;">old</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">id</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#6CB6FF;">concat</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&#39;删除前(id:&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">old</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">id</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;, name:&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">old</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">name</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;, age:&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">old</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">age</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;, salary:&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">old</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">salary</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;)&#39;</span><span style="color:#ADBAC7;">));</span></span>
<span class="line"><span style="color:#F47067;">end</span><span style="color:#ADBAC7;"> $</span></span>
<span class="line"><span style="color:#ADBAC7;">DELIMITER ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">trigger</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">trigger_name</span></span>
<span class="line"><span style="color:#D73A49;">before/after</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">insert/update/delete</span></span>
<span class="line"><span style="color:#D73A49;">on</span><span style="color:#24292E;"> tbl_name</span></span>
<span class="line"><span style="color:#24292E;">[ for each row ] </span><span style="color:#6A737D;">-- 行级触发器</span></span>
<span class="line"><span style="color:#D73A49;">begin</span></span>
<span class="line"><span style="color:#24292E;">    trigger_stmt ;</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 例子：通过触发器记录 emp 表的数据变更日志, 包含增加, 修改, 删除 ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 创建 insert 型触发器，完成插入数据时的日志记录 :</span></span>
<span class="line"><span style="color:#24292E;">DELIMITER $</span></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">trigger</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">emp_logs_insert_trigger</span></span>
<span class="line"><span style="color:#D73A49;">after</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">insert</span></span>
<span class="line"><span style="color:#D73A49;">on</span><span style="color:#24292E;"> emp</span></span>
<span class="line"><span style="color:#24292E;">for each </span><span style="color:#D73A49;">row</span></span>
<span class="line"><span style="color:#D73A49;">begin</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> emp_logs (id,operation,operate_time,operate_id,operate_params)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">null</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;insert&#39;</span><span style="color:#24292E;">,</span><span style="color:#D73A49;">now</span><span style="color:#24292E;">(),</span><span style="color:#005CC5;">new</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">concat</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;插入后(id:&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">new</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;, name:&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">new</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">name</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;, age:&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">new</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">age</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;, salary:&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">new</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">salary</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;)&#39;</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;"> $</span></span>
<span class="line"><span style="color:#24292E;">DELIMITER ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 创建 update 型触发器，完成更新数据时的日志记录 :</span></span>
<span class="line"><span style="color:#24292E;">DELIMITER $</span></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">trigger</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">emp_logs_update_trigger</span></span>
<span class="line"><span style="color:#D73A49;">after</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">update</span></span>
<span class="line"><span style="color:#D73A49;">on</span><span style="color:#24292E;"> emp</span></span>
<span class="line"><span style="color:#24292E;">for each </span><span style="color:#D73A49;">row</span></span>
<span class="line"><span style="color:#D73A49;">begin</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> emp_logs (id,operation,operate_time,operate_id,operate_params)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">null</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;update&#39;</span><span style="color:#24292E;">,</span><span style="color:#D73A49;">now</span><span style="color:#24292E;">(),</span><span style="color:#005CC5;">new</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">concat</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;修改前(id:&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">old</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;, name:&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">old</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">name</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;, age:&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">old</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">age</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;, salary:&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">old</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">salary</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;) , 修改后(id&#39;</span></span>
<span class="line"><span style="color:#24292E;">    ,</span><span style="color:#005CC5;">new</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;name:&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">new</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">name</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;, age:&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">new</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">age</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;, salary:&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">new</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">salary</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;)&#39;</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;"> $</span></span>
<span class="line"><span style="color:#24292E;">DELIMITER ;</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#6A737D;">-- 创建delete 行的触发器 , 完成删除数据时的日志记录 :</span></span>
<span class="line"><span style="color:#24292E;">DELIMITER $</span></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">trigger</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">emp_logs_delete_trigger</span></span>
<span class="line"><span style="color:#D73A49;">after</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">delete</span></span>
<span class="line"><span style="color:#D73A49;">on</span><span style="color:#24292E;"> emp</span></span>
<span class="line"><span style="color:#24292E;">for each </span><span style="color:#D73A49;">row</span></span>
<span class="line"><span style="color:#D73A49;">begin</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> emp_logs (id,operation,operate_time,operate_id,operate_params)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">null</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;delete&#39;</span><span style="color:#24292E;">,</span><span style="color:#D73A49;">now</span><span style="color:#24292E;">(),</span><span style="color:#005CC5;">old</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">concat</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;删除前(id:&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">old</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">id</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;, name:&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">old</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">name</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;, age:&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">old</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">age</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;, salary:&#39;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">old</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">salary</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;)&#39;</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;"> $</span></span>
<span class="line"><span style="color:#24292E;">DELIMITER ;</span></span></code></pre></div><h4 id="删除触发器" tabindex="-1">删除触发器 <a class="header-anchor" href="#删除触发器" aria-label="Permalink to &quot;删除触发器&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 如果没有指定 schema_name，默认为当前数据库 。        </span></span>
<span class="line"><span style="color:#F47067;">drop</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">trigger</span><span style="color:#ADBAC7;"> [schema_name.]trigger_name</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 如果没有指定 schema_name，默认为当前数据库 。        </span></span>
<span class="line"><span style="color:#D73A49;">drop</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">trigger</span><span style="color:#24292E;"> [schema_name.]trigger_name</span></span></code></pre></div><h4 id="查看触发器" tabindex="-1">查看触发器 <a class="header-anchor" href="#查看触发器" aria-label="Permalink to &quot;查看触发器&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 查看触发器的状态、语法等信息。</span></span>
<span class="line"><span style="color:#ADBAC7;">show triggers;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 查看触发器的状态、语法等信息。</span></span>
<span class="line"><span style="color:#24292E;">show triggers;</span></span></code></pre></div><h2 id="锁" tabindex="-1">锁 <a class="header-anchor" href="#锁" aria-label="Permalink to &quot;锁&quot;">​</a></h2><h3 id="锁分类" tabindex="-1">锁分类 <a class="header-anchor" href="#锁分类" aria-label="Permalink to &quot;锁分类&quot;">​</a></h3><ul><li>从对数据操作的粒度分 ： <ul><li>1） 表锁：操作时，会锁定整个表。</li><li>2） 行锁：操作时，会锁定当前操作行。</li></ul></li></ul><p>  表级锁更适合于以查询为主，只有少量按索引条件更新数据的应用，如Web 应用；而行级锁则更适合于有大量按索引条件并发更新少量不同数据，同时又有并查询的应用，如一些在线事务处理（OLTP）系统。</p><ul><li>从对数据操作的类型分： <ul><li>1） 读锁（共享锁）：针对同一份数据，多个读操作可以同时进行而不会互相影响。</li><li>2） 写锁（排它锁）：当前操作没有完成之前，它会阻断其他写锁和读锁。</li></ul></li></ul><p>  读锁会阻塞写，但是不会阻塞读。而写锁，则既会阻塞读，又会阻塞写。</p><ul><li>对于UPDATE、DELETE和INSERT语句，InnoDB会自动给涉及数据集加排他锁（X)；</li><li>对于普通SELECT语句，InnoDB不会加任何锁；</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 可以通过以下语句显示给记录集加共享锁或排他锁 。</span></span>
<span class="line"><span style="color:#768390;">-- 共享锁（S）：</span></span>
<span class="line"><span style="color:#F47067;">SELECT</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">FROM</span><span style="color:#ADBAC7;"> table_name </span><span style="color:#F47067;">WHERE</span><span style="color:#ADBAC7;"> ... LOCK </span><span style="color:#F47067;">IN</span><span style="color:#ADBAC7;"> SHARE MODE</span></span>
<span class="line"><span style="color:#768390;">-- 排他锁（X) ：</span></span>
<span class="line"><span style="color:#F47067;">SELECT</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">FROM</span><span style="color:#ADBAC7;"> table_name </span><span style="color:#F47067;">WHERE</span><span style="color:#ADBAC7;"> ... FOR </span><span style="color:#F47067;">UPDATE</span><span style="color:#ADBAC7;">  </span><span style="color:#768390;">-- （悲观锁）</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 可以通过以下语句显示给记录集加共享锁或排他锁 。</span></span>
<span class="line"><span style="color:#6A737D;">-- 共享锁（S）：</span></span>
<span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> table_name </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> ... LOCK </span><span style="color:#D73A49;">IN</span><span style="color:#24292E;"> SHARE MODE</span></span>
<span class="line"><span style="color:#6A737D;">-- 排他锁（X) ：</span></span>
<span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> table_name </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> ... FOR </span><span style="color:#D73A49;">UPDATE</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">-- （悲观锁）</span></span></code></pre></div><h3 id="for-update-一个原则-一锁二判三更新" tabindex="-1">for update：（一个原则：一锁二判三更新） <a class="header-anchor" href="#for-update-一个原则-一锁二判三更新" aria-label="Permalink to &quot;for update：（一个原则：一锁二判三更新）&quot;">​</a></h3><ul><li>for update是在数据库中上锁用的，可以为数据库中的行上一个排它锁。当一个事务的操作未完成时候，其他事务可以读取，但是不能写入或更新。</li><li>默认是行级别的锁，当有明确指定的主键/索引时候，是行级锁。否则是表级别。</li><li>for update 仅适用于InnoDB，并且必须开启事务，在begin与commit之间才生效。</li><li>如果没查到记录会加锁吗？会的。有主键/索引产生间隙锁，无主键/索引产生表锁表级锁。</li></ul><h3 id="悲观锁" tabindex="-1">悲观锁 <a class="header-anchor" href="#悲观锁" aria-label="Permalink to &quot;悲观锁&quot;">​</a></h3><p>  在读取数据时添加排它锁行锁，阻止其他进程访问，适合写入频繁的场景。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">begin</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> goods </span><span style="color:#F47067;">where</span><span style="color:#ADBAC7;"> id </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;"> for </span><span style="color:#F47067;">update</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#F47067;">update</span><span style="color:#ADBAC7;"> goods </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> stock </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> stock </span><span style="color:#F47067;">-</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">where</span><span style="color:#ADBAC7;"> id </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#F47067;">commit</span><span style="color:#ADBAC7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">begin</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> goods </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> for </span><span style="color:#D73A49;">update</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">update</span><span style="color:#24292E;"> goods </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> stock </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> stock </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">commit</span><span style="color:#24292E;">;</span></span></code></pre></div><h3 id="乐观锁" tabindex="-1">乐观锁 <a class="header-anchor" href="#乐观锁" aria-label="Permalink to &quot;乐观锁&quot;">​</a></h3><p>  不添加锁，在更新数据时判断程序中的库存量和数据库中的库存量是否相等，相等则更新数据，否则，从数据库中重新获取库存量，直到数据更新成功，适用于读频繁的场景。</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 不加锁获取 id=1 的商品对象</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> goods </span><span style="color:#F47067;">where</span><span style="color:#ADBAC7;"> id </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span></span>
<span class="line"><span style="color:#F47067;">begin</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">-- 更新 stock 值，只有程序中获取到的库存量与数据库中的库存量相等才执行更新</span></span>
<span class="line"><span style="color:#F47067;">update</span><span style="color:#ADBAC7;"> goods </span><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> stock </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> stock </span><span style="color:#F47067;">-</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">where</span><span style="color:#ADBAC7;"> id </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">and</span><span style="color:#ADBAC7;"> stock </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> cur_stock;</span></span>
<span class="line"><span style="color:#F47067;">commit</span><span style="color:#ADBAC7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 不加锁获取 id=1 的商品对象</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> goods </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#D73A49;">begin</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 更新 stock 值，只有程序中获取到的库存量与数据库中的库存量相等才执行更新</span></span>
<span class="line"><span style="color:#D73A49;">update</span><span style="color:#24292E;"> goods </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> stock </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> stock </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> stock </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> cur_stock;</span></span>
<span class="line"><span style="color:#D73A49;">commit</span><span style="color:#24292E;">;</span></span></code></pre></div><ul><li>如果执行了更新语句，会对这一行数据加上排他锁（写锁），提交commit之后，会释放锁。另外一个线程update语句才可以执行解除阻塞状态。前提是两个线程操作同一行数据。</li><li>如果不通过索引条件检索数据，那么InnoDB将对表中的所有记录加锁，实际效果跟表锁一样。</li><li>当我们用范围条件，而不是使用相等条件检索数据，并请求共享或排他锁时，InnoDB会给符合条件的已有数据进行加锁； 对于键值在条件范围内但并不存在的记录，叫做 &quot;间隙（GAP）&quot; ，InnoDB也会对这个 &quot;间隙&quot; 加锁，这种锁机制就是所谓的 间隙锁（Next-Key锁） 。</li></ul><h3 id="锁的优化建议" tabindex="-1">锁的优化建议 <a class="header-anchor" href="#锁的优化建议" aria-label="Permalink to &quot;锁的优化建议&quot;">​</a></h3><ul><li>尽可能让所有数据检索都能通过索引来完成，避免无索引行锁升级为表锁。</li><li>合理设计索引，尽量缩小锁的范围</li><li>尽可能减少索引条件，及索引范围，避免间隙锁</li><li>尽量控制事务大小，减少锁定资源量和时间长度</li><li>尽可使用低级别事务隔离（但是需要业务层面满足需求）</li></ul><h2 id="事务" tabindex="-1">事务 <a class="header-anchor" href="#事务" aria-label="Permalink to &quot;事务&quot;">​</a></h2><h3 id="事务的四大特征" tabindex="-1">事务的四大特征 <a class="header-anchor" href="#事务的四大特征" aria-label="Permalink to &quot;事务的四大特征&quot;">​</a></h3><ol><li>原子性：是不可分割的最小操作单位，要么同时成功，要么同时失败。通过undo log实现原子性。</li><li>持久性：当事务提交或回滚后，数据库会持久化的保存数据。通过redo log实现持久性。</li><li>隔离性：多个事务之间。相互独立。</li><li>一致性：事务操作前后，数据总量不变</li></ol><h3 id="事务的隔离级别" tabindex="-1">事务的隔离级别 <a class="header-anchor" href="#事务的隔离级别" aria-label="Permalink to &quot;事务的隔离级别&quot;">​</a></h3><p>  概念：多个事务之间隔离的，相互独立的。但是如果多个事务操作同一批数据，则会引发一些问题，设置不同的隔离级别就可以解决这些问题。</p><p>  存在问题：</p><ol><li>脏读：一个事务，读取到另一个事务中没有提交的数据</li><li>不可重复读(虚读)：在同一个事务中，两次读取到的数据不一样。</li><li>幻读：一个事务操作(DML)数据表中所有记录，另一个事务添加了一条数据，则第一个事务查询不到新添加的数据</li></ol><p>  隔离级别：可靠性性高的，并发性能低</p><ol><li>read uncommitted：读未提交；在该隔离级别，所有事务都可以看到其他未提交事务的执行结果。（ 产生的问题：脏读、不可重复读、幻读）</li><li>read committed：读已提交 （Oracle默认）一个事务只能看见已经提交事务所做的改变。同一select可能返回不同结果。（产生的问题：不可重复读、幻读）</li><li>repeatable read：可重复读 （MySQL默认隔离级别）同一事务的多个实例在并发读取数据时，会看到同样的数据行。(产生的问题：幻读)</li><li>serializable：串行化（ 可以解决所有的问题）</li></ol><h4 id="数据库查询隔离级别" tabindex="-1">数据库查询隔离级别 <a class="header-anchor" href="#数据库查询隔离级别" aria-label="Permalink to &quot;数据库查询隔离级别&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> @@tx_isolation;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> @@tx_isolation;</span></span></code></pre></div><h4 id="数据库设置隔离级别" tabindex="-1">数据库设置隔离级别 <a class="header-anchor" href="#数据库设置隔离级别" aria-label="Permalink to &quot;数据库设置隔离级别&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">global</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">transaction</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">isolation</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">level</span><span style="color:#ADBAC7;">  </span><span style="color:#96D0FF;">`级别字符串`</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">set</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">global</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">transaction</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">isolation</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">level</span><span style="color:#24292E;">  </span><span style="color:#032F62;">`级别字符串`</span></span></code></pre></div><h4 id="查看事务的默认提交方式" tabindex="-1">查看事务的默认提交方式 <a class="header-anchor" href="#查看事务的默认提交方式" aria-label="Permalink to &quot;查看事务的默认提交方式&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 1 代表自动提交  0 代表手动提交</span></span>
<span class="line"><span style="color:#F47067;">SELECT</span><span style="color:#ADBAC7;"> @@autocommit;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 1 代表自动提交  0 代表手动提交</span></span>
<span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> @@autocommit;</span></span></code></pre></div><h4 id="修改默认提交方式" tabindex="-1">修改默认提交方式 <a class="header-anchor" href="#修改默认提交方式" aria-label="Permalink to &quot;修改默认提交方式&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">set</span><span style="color:#ADBAC7;"> @@autocommit </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">set</span><span style="color:#24292E;"> @@autocommit </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span></code></pre></div><h2 id="josn类型" tabindex="-1">JOSN类型 <a class="header-anchor" href="#josn类型" aria-label="Permalink to &quot;JOSN类型&quot;">​</a></h2><p>  前置准备</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">CREATE</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">TABLE</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">testproject</span><span style="color:#ADBAC7;"> (</span></span>
<span class="line"><span style="color:#ADBAC7;">   </span><span style="color:#96D0FF;">`id`</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">int</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">10</span><span style="color:#ADBAC7;">) unsigned </span><span style="color:#F47067;">NOT NULL</span><span style="color:#ADBAC7;"> AUTO_INCREMENT,</span></span>
<span class="line"><span style="color:#ADBAC7;">   </span><span style="color:#96D0FF;">`skill`</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">JSON</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">NOT NULL</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">   </span><span style="color:#96D0FF;">`student`</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">JSON</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">NOT NULL</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">   </span><span style="color:#F47067;">PRIMARY KEY</span><span style="color:#ADBAC7;"> (</span><span style="color:#96D0FF;">`id`</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">INSERT INTO</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">`testproject`</span><span style="color:#ADBAC7;"> (student, skill) </span><span style="color:#F47067;">VALUES</span><span style="color:#ADBAC7;"> (</span><span style="color:#96D0FF;">&#39;{&quot;id&quot;: 1, &quot;name&quot;: &quot;ggjg&quot;}&#39;</span><span style="color:#ADBAC7;">, </span><span style="color:#96D0FF;">&#39;[&quot;java&quot;, &quot;go&quot;, &quot;vue&quot;]&#39;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#F47067;">INSERT INTO</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">`testproject`</span><span style="color:#ADBAC7;"> (student, skill) </span><span style="color:#F47067;">VALUES</span><span style="color:#ADBAC7;"> (</span><span style="color:#96D0FF;">&#39;{&quot;id&quot;: 5, &quot;name&quot;: &quot;guogege&quot;}&#39;</span><span style="color:#ADBAC7;">, </span><span style="color:#96D0FF;">&#39;[]&#39;</span><span style="color:#ADBAC7;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">testproject</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">`id`</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">) unsigned </span><span style="color:#D73A49;">NOT NULL</span><span style="color:#24292E;"> AUTO_INCREMENT,</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">`skill`</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">JSON</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">NOT NULL</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">`student`</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">JSON</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">NOT NULL</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">PRIMARY KEY</span><span style="color:#24292E;"> (</span><span style="color:#032F62;">`id`</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">INSERT INTO</span><span style="color:#24292E;"> </span><span style="color:#032F62;">`testproject`</span><span style="color:#24292E;"> (student, skill) </span><span style="color:#D73A49;">VALUES</span><span style="color:#24292E;"> (</span><span style="color:#032F62;">&#39;{&quot;id&quot;: 1, &quot;name&quot;: &quot;ggjg&quot;}&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;[&quot;java&quot;, &quot;go&quot;, &quot;vue&quot;]&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">INSERT INTO</span><span style="color:#24292E;"> </span><span style="color:#032F62;">`testproject`</span><span style="color:#24292E;"> (student, skill) </span><span style="color:#D73A49;">VALUES</span><span style="color:#24292E;"> (</span><span style="color:#032F62;">&#39;{&quot;id&quot;: 5, &quot;name&quot;: &quot;guogege&quot;}&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;[]&#39;</span><span style="color:#24292E;">);</span></span></code></pre></div><p>  查询 json 中的数据用 column-&gt;path 的形式</p><p>  其中对象类型 path 这样表示 $.path, 而数组类型则是 $[index]</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 查询testproject表student字段中json对象id为1的记录：</span></span>
<span class="line"><span style="color:#F47067;">SELECT</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">FROM</span><span style="color:#ADBAC7;"> testproject </span><span style="color:#F47067;">WHERE</span><span style="color:#ADBAC7;"> student</span><span style="color:#F47067;">-&gt;</span><span style="color:#96D0FF;">&#39;$.id&#39;</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#F47067;">SELECT</span><span style="color:#ADBAC7;"> skill</span><span style="color:#F47067;">-&gt;</span><span style="color:#96D0FF;">&#39;$[0]&#39;</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">FROM</span><span style="color:#ADBAC7;"> testproject;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 查询testproject表student字段中json对象id为1的记录：</span></span>
<span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> testproject </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> student</span><span style="color:#D73A49;">-&gt;</span><span style="color:#032F62;">&#39;$.id&#39;</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> skill</span><span style="color:#D73A49;">-&gt;</span><span style="color:#032F62;">&#39;$[0]&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> testproject;</span></span></code></pre></div><p>  也可以用函数json_extract</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">SELECT</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">FROM</span><span style="color:#ADBAC7;"> testproject </span><span style="color:#F47067;">WHERE</span><span style="color:#ADBAC7;"> json_extract(student,</span><span style="color:#96D0FF;">&#39;$.id&#39;</span><span style="color:#ADBAC7;">)</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> testproject </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> json_extract(student,</span><span style="color:#032F62;">&#39;$.id&#39;</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">;</span></span></code></pre></div><p>  column-&gt;path 和 json_extract 查出来结果包含双引号，使用JSON_UNQUOTE 或 -&gt;&gt;</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">SELECT</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">FROM</span><span style="color:#ADBAC7;"> testproject </span><span style="color:#F47067;">WHERE</span><span style="color:#ADBAC7;"> student</span><span style="color:#F47067;">-&gt;&gt;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;$.id&#39;</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> testproject </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> student</span><span style="color:#D73A49;">-&gt;&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;$.id&#39;</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">;</span></span></code></pre></div><p>  JSON_CONTAINS:（用JSON_CONTAINS(字段,JSON_OBJECT(‘json属性’, “内容”))）</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 查询json数组里面对象的id等于142的记录</span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> log2 </span><span style="color:#F47067;">where</span><span style="color:#ADBAC7;"> JSON_CONTAINS(</span><span style="color:#F47067;">data</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">JSON_OBJECT</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&#39;id&#39;</span><span style="color:#ADBAC7;">, </span><span style="color:#96D0FF;">&quot;142&quot;</span><span style="color:#ADBAC7;">))</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 查询json数组里面对象的id等于142的记录</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> log2 </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> JSON_CONTAINS(</span><span style="color:#D73A49;">data</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">JSON_OBJECT</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;id&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;142&quot;</span><span style="color:#24292E;">))</span></span></code></pre></div><p>  field自定义排序函数的格式(将获取出来的数据根据str1,str2,str3,str4等的顺序排序)</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 语法：order by field(value,str1,str2,str3,str4,,,,,,strn)，其中value后面的参数自定义，不限制参数个数 </span></span>
<span class="line"><span style="color:#F47067;">select</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> driver_log </span><span style="color:#F47067;">order by</span><span style="color:#ADBAC7;"> field(</span><span style="color:#F47067;">name</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Suzi&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Ben&#39;</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&#39;Henry&#39;</span><span style="color:#ADBAC7;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 语法：order by field(value,str1,str2,str3,str4,,,,,,strn)，其中value后面的参数自定义，不限制参数个数 </span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> driver_log </span><span style="color:#D73A49;">order by</span><span style="color:#24292E;"> field(</span><span style="color:#D73A49;">name</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Suzi&#39;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Ben&#39;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;Henry&#39;</span><span style="color:#24292E;">);</span></span></code></pre></div><h2 id="mysql查用工具" tabindex="-1">MySQL查用工具 <a class="header-anchor" href="#mysql查用工具" aria-label="Permalink to &quot;MySQL查用工具&quot;">​</a></h2><h3 id="_1、mysql" tabindex="-1">1、mysql <a class="header-anchor" href="#_1、mysql" aria-label="Permalink to &quot;1、mysql&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 语法</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">mysql</span><span style="color:#ADBAC7;"> [options] [database]</span></span>
<span class="line"><span style="color:#768390;"># 参数：</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-u,</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--user=name</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#指定用户名</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-p,</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--password[</span><span style="color:#F47067;">=</span><span style="color:#6CB6FF;">name]</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#指定密码</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-h,</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--host=name</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#指定服务器IP或域名</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-P,</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--port=</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#指定连接端口</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-e,</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--execute=sql</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#执行SQL语句并退出</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 语法</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">mysql</span><span style="color:#24292E;"> [options] [database]</span></span>
<span class="line"><span style="color:#6A737D;"># 参数：</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-u,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--user=name</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#指定用户名</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-p,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--password[</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">name]</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#指定密码</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-h,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--host=name</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#指定服务器IP或域名</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-P,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port=</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#指定连接端口</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-e,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--execute=sql</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#执行SQL语句并退出</span></span></code></pre></div><h3 id="_2、mysqladmin" tabindex="-1">2、mysqladmin <a class="header-anchor" href="#_2、mysqladmin" aria-label="Permalink to &quot;2、mysqladmin&quot;">​</a></h3><p>  mysqladmin是一个执行管理操作的客户端程序。可以用它来检查服务器的配置和当前状态、创建并删除数据库等。</p><h3 id="_3、mysqlbinlog" tabindex="-1">3、mysqlbinlog <a class="header-anchor" href="#_3、mysqlbinlog" aria-label="Permalink to &quot;3、mysqlbinlog&quot;">​</a></h3><p>  由于服务器生成的二进制日志文件以二进制格式保存，所以如果想要检查这些文本的文本格式，就会使用到mysqlbinlog日志管理工具。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 语法：</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">mysqlbinlog</span><span style="color:#ADBAC7;"> [options] log-files1 log-files2 ...</span></span>
<span class="line"><span style="color:#768390;"># 参数：</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-d,</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--database=name</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#指定数据库名称，只列出指定的数据库相关操作。</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-o,</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--offset=</span><span style="color:#ADBAC7;"># </span><span style="color:#768390;">#忽略掉日志中的前n行命令。</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-r,--result-file</span><span style="color:#ADBAC7;">=name </span><span style="color:#768390;">#将输出的文本格式日志输出到指定文件。</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-s,</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--short-form</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#显示简单格式， 省略掉一些信息。</span></span>
<span class="line"><span style="color:#ADBAC7;">    --start-datatime</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">date1</span><span style="color:#ADBAC7;"> --stop-datetime</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">date2</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#指定日期间隔内的所有日志。</span></span>
<span class="line"><span style="color:#ADBAC7;">    --start-position</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">pos1</span><span style="color:#ADBAC7;"> --stop-position</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">pos2</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#指定位置间隔内的所有日志。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 语法：</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">mysqlbinlog</span><span style="color:#24292E;"> [options] log-files1 log-files2 ...</span></span>
<span class="line"><span style="color:#6A737D;"># 参数：</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-d,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--database=name</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#指定数据库名称，只列出指定的数据库相关操作。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-o,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--offset=</span><span style="color:#24292E;"># </span><span style="color:#6A737D;">#忽略掉日志中的前n行命令。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-r,--result-file</span><span style="color:#24292E;">=name </span><span style="color:#6A737D;">#将输出的文本格式日志输出到指定文件。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-s,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--short-form</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#显示简单格式， 省略掉一些信息。</span></span>
<span class="line"><span style="color:#24292E;">    --start-datatime</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">date1</span><span style="color:#24292E;"> --stop-datetime</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">date2</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#指定日期间隔内的所有日志。</span></span>
<span class="line"><span style="color:#24292E;">    --start-position</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">pos1</span><span style="color:#24292E;"> --stop-position</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">pos2</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#指定位置间隔内的所有日志。</span></span></code></pre></div><h3 id="_4、mysqldump" tabindex="-1">4、mysqldump <a class="header-anchor" href="#_4、mysqldump" aria-label="Permalink to &quot;4、mysqldump&quot;">​</a></h3><p>  mysqldump 客户端工具用来备份数据库或在不同数据库之间进行数据迁移。备份内容包含创建表，及插入表的SQL语句。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 语法：</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">mysqldump</span><span style="color:#ADBAC7;"> [options] db_name [tables]</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">mysqldump</span><span style="color:#ADBAC7;"> [options] --database/-B db1 [db2 db3...]</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">mysqldump</span><span style="color:#ADBAC7;"> [options] --all-databases/-A</span></span>
<span class="line"><span style="color:#768390;"># 参数：</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-u,</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--user=name</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#指定用户名</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-p,</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--password[</span><span style="color:#F47067;">=</span><span style="color:#6CB6FF;">name]</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#指定密码</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-h,</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--host=name</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#指定服务器IP或域名</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-P,</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--port=name</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#指定连接端口</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">--add-drop-database</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#在每个数据库创建语句前加上 Drop database 语句</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">--add-drop-table</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#在每个表创建语句前加上 Drop table 语句 , 默认开启 ; 不开启(--skip-add-drop-table)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-n,</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--no-create-db</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#不包含数据库的创建语句</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-t,</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--no-create-info</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#不包含数据表的创建语句</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-d</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--no-data</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#不包含数据</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-T,</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">--tab=name</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#自动生成两个文件：一个.sql文件，创建表结构的语句；一个.txt文件，数据文件，相当于select into outfile</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 语法：</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">mysqldump</span><span style="color:#24292E;"> [options] db_name [tables]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">mysqldump</span><span style="color:#24292E;"> [options] --database/-B db1 [db2 db3...]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">mysqldump</span><span style="color:#24292E;"> [options] --all-databases/-A</span></span>
<span class="line"><span style="color:#6A737D;"># 参数：</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-u,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--user=name</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#指定用户名</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-p,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--password[</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">name]</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#指定密码</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-h,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--host=name</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#指定服务器IP或域名</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-P,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port=name</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#指定连接端口</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">--add-drop-database</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#在每个数据库创建语句前加上 Drop database 语句</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">--add-drop-table</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#在每个表创建语句前加上 Drop table 语句 , 默认开启 ; 不开启(--skip-add-drop-table)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-n,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--no-create-db</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#不包含数据库的创建语句</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-t,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--no-create-info</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#不包含数据表的创建语句</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-d</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--no-data</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#不包含数据</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-T,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--tab=name</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#自动生成两个文件：一个.sql文件，创建表结构的语句；一个.txt文件，数据文件，相当于select into outfile</span></span></code></pre></div><h3 id="_5、mysqlimport-source" tabindex="-1">5、mysqlimport/source <a class="header-anchor" href="#_5、mysqlimport-source" aria-label="Permalink to &quot;5、mysqlimport/source&quot;">​</a></h3><p>  mysqlimport 是客户端数据导入工具，用来导入mysqldump 加 -T 参数后导出的文本文件。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 语法：</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">txt文件：mysqlimport</span><span style="color:#ADBAC7;"> [options] db_name textfile1 [textfile2...]</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">sql文件：source</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/root/tb_book.sql</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 语法：</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">txt文件：mysqlimport</span><span style="color:#24292E;"> [options] db_name textfile1 [textfile2...]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">sql文件：source</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/tb_book.sql</span></span></code></pre></div><h3 id="_6、mysqlshow" tabindex="-1">6、mysqlshow <a class="header-anchor" href="#_6、mysqlshow" aria-label="Permalink to &quot;6、mysqlshow&quot;">​</a></h3><p>  mysqlshow 客户端对象查找工具，用来很快地查找存在哪些数据库、数据库中的表、表中的列或者索引。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 语法</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">mysqlshow</span><span style="color:#ADBAC7;"> [options] [db_name [table_name [col_name]]]</span></span>
<span class="line"><span style="color:#768390;"># 参数：</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">--count</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 显示数据库及表的统计信息（数据库，表 均可以不指定）</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F69D50;">-i</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 显示指定数据库或者指定表的状态信息</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 语法</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">mysqlshow</span><span style="color:#24292E;"> [options] [db_name [table_name [col_name]]]</span></span>
<span class="line"><span style="color:#6A737D;"># 参数：</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">--count</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 显示数据库及表的统计信息（数据库，表 均可以不指定）</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-i</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 显示指定数据库或者指定表的状态信息</span></span></code></pre></div><h3 id="_7、mysqlslap" tabindex="-1">7、mysqlslap <a class="header-anchor" href="#_7、mysqlslap" aria-label="Permalink to &quot;7、mysqlslap&quot;">​</a></h3><p>  mysqlslap：mysql自带的基准测试工具，可以模拟多个客户端对MySQL服务器进行并发执行sql语句，还可以指定存储引擎。</p><h4 id="基准测试" tabindex="-1">基准测试 <a class="header-anchor" href="#基准测试" aria-label="Permalink to &quot;基准测试&quot;">​</a></h4><ul><li>数据库的基准测试是对数据库的性能指标进行定量的、可复现的、可对比的测试；</li><li>基准测试不关心业务逻辑，更加简单、直接、易于测试；数据可由工具生成，不要求真实；</li><li>基准测试的作用就是分析在当前的配置下，数据库的性能表现，从而找到MySQL的性能阈值，并根据实际系统的要求调整配置。</li></ul><h4 id="基准测试的指标" tabindex="-1">基准测试的指标 <a class="header-anchor" href="#基准测试的指标" aria-label="Permalink to &quot;基准测试的指标&quot;">​</a></h4><ul><li>TPS/QPS：衡量吞吐量；</li><li>响应时间：（平均响应时间、最小响应时间、最大响应时间、时间百分比）</li><li>并发量：同时处理的查询请求的数量</li></ul><h4 id="测试流程" tabindex="-1">测试流程 <a class="header-anchor" href="#测试流程" aria-label="Permalink to &quot;测试流程&quot;">​</a></h4><ol><li>建立测试数据库schema和待测试的表tables；</li><li>根据table的结果，利用脚本生成一定数量的有效随机数据；</li><li>用mysqlslap对相应的query语句进行测试；</li><li>结果数据的分析</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">--auto-generate-sql(</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">-a</span><span style="color:#ADBAC7;">) </span><span style="color:#768390;"># 自动生成测试表和数据，表示用mysqlslap工具自己生成的SQL脚本来测试并发压力；</span></span>
<span class="line"><span style="color:#ADBAC7;">--auto-generate-sql-load-type</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">type</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 测试语句的类型。测试的是读还是写还是两者混合的。取值包括：read，key，write，update和mixed(默认)；</span></span>
<span class="line"><span style="color:#F69D50;">--auto-generate-sql-add-auto-increment</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 代表对生成的表自动添加auto_increment列，从5.1.18版本开始支持；</span></span>
<span class="line"><span style="color:#ADBAC7;">--number-char-cols</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">N（</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">-x</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">N）</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 自动生成的测试表中包含多少个字符类型的列，默认1；</span></span>
<span class="line"><span style="color:#ADBAC7;">--number-int-cols</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">N（-y</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">N）</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 自动生成的测试表中包含多少个数字类型的列，默认1；</span></span>
<span class="line"><span style="color:#ADBAC7;">--number-of-queries</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">N</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 总共要运行多少次查询。每个客户运行的查询数量可以用查询总数/并发数来计算；</span></span>
<span class="line"><span style="color:#ADBAC7;">--query</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">name（-q）</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 使用自定义脚本执行测试；</span></span>
<span class="line"><span style="color:#F69D50;">--create-schema</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 代表自定义的测试库名称，测试的database，默认为mysqlslap。</span></span>
<span class="line"><span style="color:#ADBAC7;">--commint</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">N</span><span style="color:#ADBAC7;">  </span><span style="color:#768390;"># 多少条DML后提交一次；</span></span>
<span class="line"><span style="color:#ADBAC7;">--concurrency</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">N（</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">-c</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">N）</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 表示并发量。可指定多个值，以逗号或者--delimiter参数指定的值做为分隔符；</span></span>
<span class="line"><span style="color:#F69D50;">--delimiter</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 指定的值作为分隔符；</span></span>
<span class="line"><span style="color:#ADBAC7;">--engine</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">engine_name（-e</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">engine_name）</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 代表要测试的引擎，可以有多个，用分隔符隔开。例如：--engines=myisam,innodb；</span></span>
<span class="line"><span style="color:#ADBAC7;">--iterations</span><span style="color:#F47067;">=</span><span style="color:#96D0FF;">N（-i</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">N）</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 测试执行的迭代次数，要运行这些测试多少次；</span></span>
<span class="line"><span style="color:#F69D50;">--only-print</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 只打印测试sql，不真正操作数据库；</span></span>
<span class="line"><span style="color:#F69D50;">--debug-info（-T）</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 打印内存和CPU的相关信息；</span></span>
<span class="line"><span style="color:#F69D50;">--no-drop</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 执行完成后不删除数据。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">--auto-generate-sql(</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-a</span><span style="color:#24292E;">) </span><span style="color:#6A737D;"># 自动生成测试表和数据，表示用mysqlslap工具自己生成的SQL脚本来测试并发压力；</span></span>
<span class="line"><span style="color:#24292E;">--auto-generate-sql-load-type</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 测试语句的类型。测试的是读还是写还是两者混合的。取值包括：read，key，write，update和mixed(默认)；</span></span>
<span class="line"><span style="color:#6F42C1;">--auto-generate-sql-add-auto-increment</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 代表对生成的表自动添加auto_increment列，从5.1.18版本开始支持；</span></span>
<span class="line"><span style="color:#24292E;">--number-char-cols</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">N（</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">-x</span><span style="color:#24292E;"> </span><span style="color:#032F62;">N）</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 自动生成的测试表中包含多少个字符类型的列，默认1；</span></span>
<span class="line"><span style="color:#24292E;">--number-int-cols</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">N（-y</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">N）</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 自动生成的测试表中包含多少个数字类型的列，默认1；</span></span>
<span class="line"><span style="color:#24292E;">--number-of-queries</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">N</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 总共要运行多少次查询。每个客户运行的查询数量可以用查询总数/并发数来计算；</span></span>
<span class="line"><span style="color:#24292E;">--query</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">name（-q）</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 使用自定义脚本执行测试；</span></span>
<span class="line"><span style="color:#6F42C1;">--create-schema</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 代表自定义的测试库名称，测试的database，默认为mysqlslap。</span></span>
<span class="line"><span style="color:#24292E;">--commint</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">N</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 多少条DML后提交一次；</span></span>
<span class="line"><span style="color:#24292E;">--concurrency</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">N（</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">-c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">N）</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 表示并发量。可指定多个值，以逗号或者--delimiter参数指定的值做为分隔符；</span></span>
<span class="line"><span style="color:#6F42C1;">--delimiter</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 指定的值作为分隔符；</span></span>
<span class="line"><span style="color:#24292E;">--engine</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">engine_name（-e</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">engine_name）</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 代表要测试的引擎，可以有多个，用分隔符隔开。例如：--engines=myisam,innodb；</span></span>
<span class="line"><span style="color:#24292E;">--iterations</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">N（-i</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">N）</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 测试执行的迭代次数，要运行这些测试多少次；</span></span>
<span class="line"><span style="color:#6F42C1;">--only-print</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 只打印测试sql，不真正操作数据库；</span></span>
<span class="line"><span style="color:#6F42C1;">--debug-info（-T）</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 打印内存和CPU的相关信息；</span></span>
<span class="line"><span style="color:#6F42C1;">--no-drop</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 执行完成后不删除数据。</span></span></code></pre></div><h2 id="数据库权限分配" tabindex="-1">数据库权限分配 <a class="header-anchor" href="#数据库权限分配" aria-label="Permalink to &quot;数据库权限分配&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">-- 将数据库所有权限分配给用户</span></span>
<span class="line"><span style="color:#F47067;">GRANT</span><span style="color:#ADBAC7;"> ALL PRIVILEGES </span><span style="color:#F47067;">ON</span><span style="color:#ADBAC7;"> 数据库名.</span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">To</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;用户名&#39;</span><span style="color:#ADBAC7;">@</span><span style="color:#96D0FF;">&#39;%&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#F47067;">GRANT</span><span style="color:#ADBAC7;"> ALL PRIVILEGES </span><span style="color:#F47067;">ON</span><span style="color:#ADBAC7;"> bcs_new.</span><span style="color:#F47067;">*</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">To</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;bcs&#39;</span><span style="color:#ADBAC7;">@</span><span style="color:#96D0FF;">&#39;%&#39;</span><span style="color:#ADBAC7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 将数据库所有权限分配给用户</span></span>
<span class="line"><span style="color:#D73A49;">GRANT</span><span style="color:#24292E;"> ALL PRIVILEGES </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> 数据库名.</span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">To</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;用户名&#39;</span><span style="color:#24292E;">@</span><span style="color:#032F62;">&#39;%&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">GRANT</span><span style="color:#24292E;"> ALL PRIVILEGES </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> bcs_new.</span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">To</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;bcs&#39;</span><span style="color:#24292E;">@</span><span style="color:#032F62;">&#39;%&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-462c643b data-v-f6bde3e6><!--[--><!--]--><div class="edit-info" data-v-f6bde3e6><!----><div class="last-updated" data-v-f6bde3e6><p class="VPLastUpdated" data-v-f6bde3e6 data-v-cfcf869c>最后更新: <time datetime="2023-08-12T07:30:38.000Z" data-v-cfcf869c></time></p></div></div><div class="prev-next" data-v-f6bde3e6><div class="pager" data-v-f6bde3e6><a class="pager-link prev" href="/charles-blog/md/database/" data-v-f6bde3e6><span class="desc" data-v-f6bde3e6>上一篇</span><span class="title" data-v-f6bde3e6>数据库</span></a></div><div class="has-prev pager" data-v-f6bde3e6><a class="pager-link next" href="/charles-blog/md/database/Oracle.html" data-v-f6bde3e6><span class="desc" data-v-f6bde3e6>下一篇</span><span class="title" data-v-f6bde3e6>Oracle</span></a></div></div></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"md_test_child1.md\":\"6f9aed24\",\"md_about_index.md\":\"4984c4d8\",\"md_test_index.md\":\"a179ba4f\",\"md_test_lin_index.md\":\"706ea71f\",\"md_database_cache.md\":\"ee1e9375\",\"index.md\":\"4503a516\",\"md_test_zhu_index.md\":\"2c99a562\",\"md_database_elkstack.md\":\"ca5582c6\",\"md_java_javaother_lock.md\":\"1b11e871\",\"md_java_javaother_regularexpression.md\":\"dbb63f3f\",\"md_java_javaunderlayer_classloader.md\":\"a28e97d8\",\"md_java_mybatis_mybatis.md\":\"d9803a83\",\"md_java_mybatis_mybatisplus.md\":\"a46e638f\",\"md_environment_index.md\":\"4e1f2168\",\"md_database_oracle.md\":\"7147de3e\",\"md_java_javaother_thread.md\":\"2ad6e1e2\",\"md_environment_linux.md\":\"9e61f6d8\",\"md_environment_docker.md\":\"6d9d0c36\",\"md_java_index.md\":\"8e3f7d5f\",\"md_java_spring_spring.md\":\"a80a4f49\",\"md_middleware_activemq.md\":\"45ec1a9b\",\"md_distributed_index.md\":\"85eafa6b\",\"md_java_javaother_synchronized.md\":\"ee25ab08\",\"md_java_javaunderlayer_memoryleak.md\":\"0d57ac68\",\"md_database_mongodb.md\":\"ed78548e\",\"md_java_javaunderlayer_hash.md\":\"e1bfbdd6\",\"md_java_javaunderlayer_jvm.md\":\"4a6ccd9b\",\"md_java_javaother_designpatterns.md\":\"0858d58e\",\"md_network_tcp.md\":\"fcf7ac1f\",\"md_network_index.md\":\"09603bc1\",\"md_java_spring_springtransaction.md\":\"ef9c6d8a\",\"md_network_networkdevices.md\":\"7a850f72\",\"md_environment_shell.md\":\"779c4602\",\"md_java_javaweb_javaweb.md\":\"cc6cf75c\",\"md_distributed_singlesignon.md\":\"e9469380\",\"md_java_spring_springannotations.md\":\"89640029\",\"md_java_spring_springmvc.md\":\"d3ce0b21\",\"md_middleware_nginx.md\":\"2bf5bd09\",\"md_middleware_arthas.md\":\"ed6d7630\",\"md_java_javaother_java8.md\":\"98624343\",\"md_java_spring_springboot.md\":\"5bba519d\",\"md_middleware_jms.md\":\"ac6f5658\",\"md_database_index.md\":\"8ef353e5\",\"md_database_mysql.md\":\"c1f317d9\",\"md_network_conversationtechnolog.md\":\"f21c82a7\",\"md_network_loadbalance.md\":\"1714c06e\",\"md_network_mac.md\":\"992dbcbd\",\"md_java_javaother_javainterviewquestions.md\":\"b05c4f2a\",\"md_network_model.md\":\"7a0f94c4\",\"md_database_redis.md\":\"2eb607ad\",\"md_network_http.md\":\"fa7644b0\",\"md_middleware_index.md\":\"1c4b5f2c\",\"md_middleware_zookeeper.md\":\"7a7e70a5\",\"md_network_dns.md\":\"7a6bd009\",\"md_network_https.md\":\"1fbe42dd\",\"md_network_ip.md\":\"b8f18932\",\"md_java_javaunderlayer_gc.md\":\"8b102f85\",\"md_middleware_kafka.md\":\"3238de67\",\"md_middleware_rabbitmq.md\":\"17ee6046\"}")
__VP_SITE_DATA__ = JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"小朱杂记\",\"description\":\"My Document\",\"base\":\"/charles-blog/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Java\",\"link\":\"/md/java/\",\"activeMatch\":\"/md/java/\"},{\"text\":\"数据库\",\"link\":\"/md/database/\",\"activeMatch\":\"/md/database/\"},{\"text\":\"中间件\",\"link\":\"/md/middleware/\",\"activeMatch\":\"/md/middleware/\"},{\"text\":\"网络\",\"link\":\"/md/network/\",\"activeMatch\":\"/md/network/\"},{\"text\":\"环境\",\"link\":\"/md/environment/\",\"activeMatch\":\"/md/environment/\"},{\"text\":\"分布式\",\"link\":\"/md/distributed/\",\"activeMatch\":\"/md/distributed/\"},{\"text\":\"关于我\",\"link\":\"/md/about/\"}],\"sidebar\":{\"/md/java/\":[{\"text\":\"Java\",\"link\":\"/md/java/\",\"items\":[{\"text\":\"Spring \",\"collapsed\":true,\"items\":[{\"text\":\"Spring杂叙\",\"link\":\"/md/java/spring/Spring\"},{\"text\":\"SpringMvc\",\"link\":\"/md/java/spring/SpringMVC\"},{\"text\":\"SpringBoot\",\"link\":\"/md/java/spring/SpringBoot\"},{\"text\":\"Spring事务\",\"link\":\"/md/java/spring/SpringTransaction\"},{\"text\":\"Spring注解\",\"link\":\"/md/java/spring/SpringAnnotations\"}]},{\"text\":\"Java底层\",\"collapsed\":true,\"items\":[{\"text\":\"JVM\",\"link\":\"/md/java/javaUnderlayer/JVM\"},{\"text\":\"GC\",\"link\":\"/md/java/javaUnderlayer/GC\"},{\"text\":\"内存泄漏\",\"link\":\"/md/java/javaUnderlayer/MemoryLeak\"},{\"text\":\"哈希(Hash)\",\"link\":\"/md/java/javaUnderlayer/Hash\"},{\"text\":\"类加载器\",\"link\":\"/md/java/javaUnderlayer/ClassLoader\"}]},{\"text\":\"JavaWeb\",\"collapsed\":true,\"items\":[{\"text\":\"JavaWeb杂叙\",\"link\":\"/md/java/javaWeb/JavaWeb\"}]},{\"text\":\"Java其他\",\"collapsed\":true,\"items\":[{\"text\":\"Java8\",\"link\":\"/md/java/javaOther/Java8\"},{\"text\":\"锁\",\"link\":\"/md/java/javaOther/Lock\"},{\"text\":\"Synchronized\",\"link\":\"/md/java/javaOther/Synchronized\"},{\"text\":\"浅谈设计模式\",\"link\":\"/md/java/javaOther/DesignPatterns\"},{\"text\":\"进程，线程，线程池，调度\",\"link\":\"/md/java/javaOther/Thread\"},{\"text\":\"正则表达式\",\"link\":\"/md/java/javaOther/RegularExpression\"},{\"text\":\"Java面试题\",\"link\":\"/md/java/javaOther/JavaInterviewQuestions\"}]},{\"text\":\"Mybatis\",\"collapsed\":true,\"items\":[{\"text\":\"Mybatis杂叙\",\"link\":\"/md/java/mybatis/Mybatis\"},{\"text\":\"Mybatis-Plus\",\"link\":\"/md/java/mybatis/MybatisPlus\"}]}]}],\"/md/database/\":[{\"text\":\"数据库\",\"link\":\"/md/database/\",\"items\":[{\"text\":\"MySQL\",\"link\":\"/md/database/Mysql\"},{\"text\":\"Oracle\",\"link\":\"/md/database/Oracle\"},{\"text\":\"Redis\",\"link\":\"/md/database/Redis\"},{\"text\":\"ELK Stack\",\"link\":\"/md/database/ElkStack\"},{\"text\":\"MongoDB\",\"link\":\"/md/database/MongoDB\"},{\"text\":\"缓存\",\"link\":\"/md/database/Cache\"}]}],\"/md/network/\":[{\"text\":\"网络\",\"link\":\"/md/network/\",\"items\":[{\"text\":\"网络模型\",\"link\":\"/md/network/Model\"},{\"text\":\"HTTP\",\"link\":\"/md/network/Http\"},{\"text\":\"HTTPS\",\"link\":\"/md/network/Https\"},{\"text\":\"TCP\",\"link\":\"/md/network/Tcp\"},{\"text\":\"IP\",\"link\":\"/md/network/Ip\"},{\"text\":\"MAC\",\"link\":\"/md/network/Mac\"},{\"text\":\"DNS\",\"link\":\"/md/network/Dns\"},{\"text\":\"会话技术\",\"link\":\"/md/network/ConversationTechnolog\"},{\"text\":\"常见的网络设备\",\"link\":\"/md/network/NetworkDevices\"},{\"text\":\"负载均衡\",\"link\":\"/md/network/LoadBalance\"}]}],\"/md/environment/\":[{\"text\":\"环境\",\"link\":\"/md/environment/\",\"items\":[{\"text\":\"Linux\",\"link\":\"/md/environment/Linux\"},{\"text\":\"Shell\",\"link\":\"/md/environment/Shell\"},{\"text\":\"Docker\",\"link\":\"/md/environment/Docker\"}]}],\"/md/distributed/\":[{\"text\":\"分布式\",\"items\":[{\"text\":\"单点登陆\",\"link\":\"/md/distributed/SingleSignOn\"},{\"text\":\"分布式系统\",\"link\":\"/md/distributed/\"}]}],\"/md/middleware/\":[{\"text\":\"中间件\",\"link\":\"/md/middleware/\",\"items\":[{\"text\":\"Nginx\",\"link\":\"/md/middleware/Nginx\"},{\"text\":\"RabbitMQ\",\"link\":\"/md/middleware/Rabbitmq\"},{\"text\":\"Zookeeper\",\"link\":\"/md/middleware/Zookeeper\"},{\"text\":\"Arthas\",\"link\":\"/md/middleware/Arthas\"},{\"text\":\"JMS\",\"link\":\"/md/middleware/Jms\"},{\"text\":\"ActiveMQ\",\"link\":\"/md/middleware/ActiveMq\"},{\"text\":\"Kafka\",\"link\":\"/md/middleware/Kafka\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/CharleZhuJJ/charles-blog\"}],\"outline\":{\"level\":\"deep\",\"label\":\"目录\"},\"darkModeSwitchLabel\":\"切换日光/暗黑模式\",\"sidebarMenuLabel\":\"文章\",\"returnToTopLabel\":\"返回顶部\",\"lastUpdatedText\":\"最后更新\",\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"},\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}")</script>
    
  </body>
</html>