<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Zookeeper | 小朱杂记</title>
    <meta name="description" content="My Document">
    <link rel="preload stylesheet" href="/charles-blog/assets/style.f8bbea1d.css" as="style">
    <script type="module" src="/charles-blog/assets/app.854d147a.js"></script>
    <link rel="preload" href="/charles-blog/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
  <link rel="modulepreload" href="/charles-blog/assets/chunks/framework.981adca9.js">
  <link rel="modulepreload" href="/charles-blog/assets/chunks/theme.86d74e48.js">
  <link rel="modulepreload" href="/charles-blog/assets/chunks/ArticleMetadata.8b6b367a.js">
  <link rel="modulepreload" href="/charles-blog/assets/md_middleware_Zookeeper.md.7a7e70a5.lean.js">
  <link rel="icon" href="/charles-blog/favicon.ico">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-fc105c82><!--[--><!--]--><!--[--><span tabindex="-1" data-v-827f7975></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-827f7975> Skip to content </a><!--]--><!----><header class="VPNav" data-v-fc105c82 data-v-4765fb17><div class="VPNavBar has-sidebar" data-v-4765fb17 data-v-c560f0cd><div class="container" data-v-c560f0cd><div class="title" data-v-c560f0cd><div class="VPNavBarTitle has-sidebar" data-v-c560f0cd data-v-ebec4beb><a class="title" href="/charles-blog/" data-v-ebec4beb><!--[--><!--]--><!----><!--[-->小朱杂记<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-c560f0cd><div class="curtain" data-v-c560f0cd></div><div class="content-body" data-v-c560f0cd><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-c560f0cd><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-c560f0cd data-v-8a05be25><span id="main-nav-aria-label" class="visually-hidden" data-v-8a05be25>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/java/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->Java<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/database/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->数据库<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/charles-blog/md/middleware/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->中间件<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/network/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->网络<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/environment/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->环境<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/distributed/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->分布式<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/charles-blog/md/about/" tabindex="0" data-v-8a05be25 data-v-f5f69d10 data-v-a8e5736d><!--[-->关于我<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-c560f0cd data-v-7489216d><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-7489216d data-v-c852f474 data-v-43044c5b><span class="check" data-v-43044c5b><span class="icon" data-v-43044c5b><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-c852f474><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-c852f474><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-c560f0cd data-v-46915da0 data-v-5e7b6306><!--[--><a class="VPSocialLink" href="https://github.com/CharleZhuJJ/charles-blog" aria-label="github" target="_blank" rel="noopener" data-v-5e7b6306 data-v-5124df20><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-c560f0cd data-v-0f46c100 data-v-fa61944e><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-fa61944e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-fa61944e><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-fa61944e><div class="VPMenu" data-v-fa61944e data-v-4eba600d><!----><!--[--><!--[--><!----><div class="group" data-v-0f46c100><div class="item appearance" data-v-0f46c100><p class="label" data-v-0f46c100>切换日光/暗黑模式</p><div class="appearance-action" data-v-0f46c100><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-0f46c100 data-v-c852f474 data-v-43044c5b><span class="check" data-v-43044c5b><span class="icon" data-v-43044c5b><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-c852f474><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-c852f474><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-0f46c100><div class="item social-links" data-v-0f46c100><div class="VPSocialLinks social-links-list" data-v-0f46c100 data-v-5e7b6306><!--[--><a class="VPSocialLink" href="https://github.com/CharleZhuJJ/charles-blog" aria-label="github" target="_blank" rel="noopener" data-v-5e7b6306 data-v-5124df20><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-c560f0cd data-v-05cc2436><span class="container" data-v-05cc2436><span class="top" data-v-05cc2436></span><span class="middle" data-v-05cc2436></span><span class="bottom" data-v-05cc2436></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-fc105c82 data-v-c9d1ee7c><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-c9d1ee7c><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-c9d1ee7c><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-c9d1ee7c>文章</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-c9d1ee7c data-v-43a3820c><button data-v-43a3820c>返回顶部</button><!----></div></div><aside class="VPSidebar" data-v-fc105c82 data-v-def99251><div class="curtain" data-v-def99251></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-def99251><span class="visually-hidden" id="sidebar-aria-label" data-v-def99251> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-def99251><section class="VPSidebarItem level-0 is-link has-active" data-v-def99251 data-v-94aa024f><div class="item" tabindex="0" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/middleware/" data-v-94aa024f data-v-a8e5736d><!--[--><h2 class="text" data-v-94aa024f>中间件</h2><!--]--><!----></a><!----></div><div class="items" data-v-94aa024f><!--[--><div class="VPSidebarItem level-1 is-link" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/middleware/Nginx.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>Nginx</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/middleware/Rabbitmq.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>RabbitMQ</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link is-active has-active" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/middleware/Zookeeper.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>Zookeeper</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/middleware/Arthas.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>Arthas</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/middleware/Jms.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>JMS</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/middleware/ActiveMq.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>ActiveMQ</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-94aa024f data-v-94aa024f><div class="item" data-v-94aa024f><div class="indicator" data-v-94aa024f></div><a class="VPLink link link" href="/charles-blog/md/middleware/Kafka.html" data-v-94aa024f data-v-a8e5736d><!--[--><p class="text" data-v-94aa024f>Kafka</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-fc105c82 data-v-6c89610d><div class="VPDoc has-sidebar has-aside" data-v-6c89610d data-v-462c643b><!--[--><!--]--><div class="container" data-v-462c643b><div class="aside" data-v-462c643b><div class="aside-curtain" data-v-462c643b></div><div class="aside-container" data-v-462c643b><div class="aside-content" data-v-462c643b><div class="VPDocAside" data-v-462c643b data-v-eda16060><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-eda16060 data-v-5a905545><div class="content" data-v-5a905545><div class="outline-marker" data-v-5a905545></div><div class="outline-title" data-v-5a905545>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-5a905545><span class="visually-hidden" id="doc-outline-aria-label" data-v-5a905545> Table of Contents for current page </span><ul class="root" data-v-5a905545 data-v-ce114d19><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-eda16060></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-462c643b><div class="content-container" data-v-462c643b><!--[--><!--]--><!----><main class="main" data-v-462c643b><div style="position:relative;" class="vp-doc _charles-blog_md_middleware_Zookeeper" data-v-462c643b><div><h1 id="zookeeper" tabindex="-1">Zookeeper <span class="VPBadge warning" data-v-b4e454e3><!--[-->持续更新<!--]--></span> <a class="header-anchor" href="#zookeeper" aria-label="Permalink to &quot;Zookeeper  &lt;Badge text=&quot;持续更新&quot; type=&quot;warning&quot; /&gt;&quot;">​</a></h1><!----><p>  ZooKeeper是一个分布式的，开放源码的分布式应用程序协调服务。它是一个为分布式应用提供一致性服务的软件，提供的功能包括：配置维护、域名服务、分布式同步、组服务等。</p><p>  zookeeper的数据节点可以视为树状结构（或者目录），树中的各节点被称为znode（即zookeeper node）</p><h2 id="znode" tabindex="-1">znode <a class="header-anchor" href="#znode" aria-label="Permalink to &quot;znode&quot;">​</a></h2><p>  znode，兼具文件和目录两种特点。既像文件一样维护着数据、元信息、ACL、时间戳等数据结构，又像目录一样可以作为路径标识的一部分。</p><p>  一个znode大体上分为3各部分：</p><ul><li>节点的数据：即znode data(节点path, 节点data)的关系就像是java map中(key,value)的关系</li><li>子节点的引用：节点的子节点children</li><li>节点的状态stat：用来描述当前节点的创建、修改记录，包括cZxid、ctime等</li><li>访问权限（acl）：记录客户端对znode节点的访问权限，如IP等。</li></ul><h3 id="znode的三种类型" tabindex="-1">Znode的三种类型 <a class="header-anchor" href="#znode的三种类型" aria-label="Permalink to &quot;Znode的三种类型&quot;">​</a></h3><ul><li>持久节点（persistent node）节点会被持久</li><li>临时节点（ephemeral node）客户端断开连接后，ZooKeeper 会自动删除临时节点</li><li>顺序节点（sequential node）每次创建顺序节点，ZooKeeper 都会在路径后面自动添加上10位的数字，从1开始，最大是2147483647 （2^32-1）</li></ul><h3 id="znode的四种形式" tabindex="-1">Znode的四种形式 <a class="header-anchor" href="#znode的四种形式" aria-label="Permalink to &quot;Znode的四种形式&quot;">​</a></h3><ul><li>持久节点:如 create /test/a  &quot;hello&quot;，通过 create</li><li>持久顺序节点:通过 create -s</li><li>临时节点:通过 create -e</li><li>临时顺序节点:通过 create -s -e</li></ul><h2 id="zookeeper常用shell命令" tabindex="-1">zookeeper常用Shell命令 <a class="header-anchor" href="#zookeeper常用shell命令" aria-label="Permalink to &quot;zookeeper常用Shell命令&quot;">​</a></h2><h3 id="远程登录zookeeper命令" tabindex="-1">远程登录zookeeper命令 <a class="header-anchor" href="#远程登录zookeeper命令" aria-label="Permalink to &quot;远程登录zookeeper命令&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">./zkCli.sh</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">-server</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">ip</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">./zkCli.sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ip</span></span></code></pre></div><h3 id="_1、新增节点" tabindex="-1">1、新增节点 <a class="header-anchor" href="#_1、新增节点" aria-label="Permalink to &quot;1、新增节点&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">create</span><span style="color:#ADBAC7;"> [-s] [-e] path data  </span></span>
<span class="line"><span style="color:#768390;"># 其中-s 为有序节点，-e 临时节点，ZooKeeper的临时节点不允许拥有子节点。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F69D50;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/hadoop</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;123456&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">create</span><span style="color:#24292E;"> [-s] [-e] path data  </span></span>
<span class="line"><span style="color:#6A737D;"># 其中-s 为有序节点，-e 临时节点，ZooKeeper的临时节点不允许拥有子节点。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/hadoop</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;123456&quot;</span></span></code></pre></div><h3 id="_2、更新节点" tabindex="-1">2、更新节点 <a class="header-anchor" href="#_2、更新节点" aria-label="Permalink to &quot;2、更新节点&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#6CB6FF;">set</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">path</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">data</span><span style="color:#ADBAC7;"> [version]</span></span>
<span class="line"><span style="color:#768390;"># 可以基于版本号进行更改，此时类似于乐观锁机制.</span></span>
<span class="line"><span style="color:#768390;"># 当你传入的数据版本号(dataVersion)和当前节点的数据版本号不符合时，zookeeper会拒绝本次修改</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6CB6FF;">set</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/hadoop</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;345&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">set</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path</span><span style="color:#24292E;"> </span><span style="color:#032F62;">data</span><span style="color:#24292E;"> [version]</span></span>
<span class="line"><span style="color:#6A737D;"># 可以基于版本号进行更改，此时类似于乐观锁机制.</span></span>
<span class="line"><span style="color:#6A737D;"># 当你传入的数据版本号(dataVersion)和当前节点的数据版本号不符合时，zookeeper会拒绝本次修改</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">set</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/hadoop</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;345&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span></code></pre></div><h3 id="_3、删除节点" tabindex="-1">3、删除节点 <a class="header-anchor" href="#_3、删除节点" aria-label="Permalink to &quot;3、删除节点&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">delete</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">path</span><span style="color:#ADBAC7;"> [version] </span></span>
<span class="line"><span style="color:#768390;"># 和更新节点数据一样，也可以传入版本号</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F69D50;">delete</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/hadoop</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;"> </span></span>
<span class="line"><span style="color:#F69D50;">version</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">No</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">is</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">not</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">valid</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/hadoop</span><span style="color:#ADBAC7;"> </span></span>
<span class="line"><span style="color:#768390;"># 当你传入的数据版本号 (dataVersion)和当前节点的数据版本号不符合时，zookeeper 不会执行删除操作。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F69D50;">delete</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/hadoop</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 要想删除某个节点及其所有后代节点，可以使用递归删除</span></span>
<span class="line"><span style="color:#F69D50;">rmr</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">path</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path</span><span style="color:#24292E;"> [version] </span></span>
<span class="line"><span style="color:#6A737D;"># 和更新节点数据一样，也可以传入版本号</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/hadoop</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">version</span><span style="color:#24292E;"> </span><span style="color:#032F62;">No</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">valid</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/hadoop</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;"># 当你传入的数据版本号 (dataVersion)和当前节点的数据版本号不符合时，zookeeper 不会执行删除操作。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/hadoop</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 要想删除某个节点及其所有后代节点，可以使用递归删除</span></span>
<span class="line"><span style="color:#6F42C1;">rmr</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path</span></span></code></pre></div><h3 id="_4、查看节点" tabindex="-1">4、查看节点 <a class="header-anchor" href="#_4、查看节点" aria-label="Permalink to &quot;4、查看节点&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># get path</span></span>
<span class="line"><span style="color:#F69D50;">get</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/hadoop</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F69D50;">123456</span></span>
<span class="line"><span style="color:#F69D50;">cZxid</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0x4</span><span style="color:#ADBAC7;">  </span><span style="color:#768390;"># 数据节点创建时的事务 ID</span></span>
<span class="line"><span style="color:#F69D50;">ctime</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">Thu</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">Dec</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">12</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">14</span><span style="color:#96D0FF;">:55:53</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">CST</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">2019</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 数据节点创建时的时间</span></span>
<span class="line"><span style="color:#F69D50;">mZxid</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0x4</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 数据节点最后一次更新时的事务 ID</span></span>
<span class="line"><span style="color:#F69D50;">mtime</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">Thu</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">Dec</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">12</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">14</span><span style="color:#96D0FF;">:55:53</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">CST</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">2019</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 数据节点最后一次更新时的时间</span></span>
<span class="line"><span style="color:#F69D50;">pZxid</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0x4</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 数据节点的子节点最后一次被修改时的事务 ID</span></span>
<span class="line"><span style="color:#F69D50;">cversion</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 子节点的更改次数</span></span>
<span class="line"><span style="color:#F69D50;">dataVersion</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 节点数据的更改次数</span></span>
<span class="line"><span style="color:#F69D50;">aclVersion</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 节点的 ACL 的更改次数</span></span>
<span class="line"><span style="color:#F69D50;">ephemeralOwner</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0x0</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 如果节点是临时节点，则表示创建该节点的会话的SessionID；如果节点是持久节点，则该属性值为 0</span></span>
<span class="line"><span style="color:#F69D50;">dataLength</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">6</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 数据内容的长度</span></span>
<span class="line"><span style="color:#F69D50;">numChildren</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 数据节点当前的子节点个数</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># get path</span></span>
<span class="line"><span style="color:#6F42C1;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/hadoop</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">123456</span></span>
<span class="line"><span style="color:#6F42C1;">cZxid</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0x4</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 数据节点创建时的事务 ID</span></span>
<span class="line"><span style="color:#6F42C1;">ctime</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Thu</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Dec</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">14</span><span style="color:#032F62;">:55:53</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2019</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 数据节点创建时的时间</span></span>
<span class="line"><span style="color:#6F42C1;">mZxid</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0x4</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 数据节点最后一次更新时的事务 ID</span></span>
<span class="line"><span style="color:#6F42C1;">mtime</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Thu</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Dec</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">14</span><span style="color:#032F62;">:55:53</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2019</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 数据节点最后一次更新时的时间</span></span>
<span class="line"><span style="color:#6F42C1;">pZxid</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0x4</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 数据节点的子节点最后一次被修改时的事务 ID</span></span>
<span class="line"><span style="color:#6F42C1;">cversion</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 子节点的更改次数</span></span>
<span class="line"><span style="color:#6F42C1;">dataVersion</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 节点数据的更改次数</span></span>
<span class="line"><span style="color:#6F42C1;">aclVersion</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 节点的 ACL 的更改次数</span></span>
<span class="line"><span style="color:#6F42C1;">ephemeralOwner</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0x0</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 如果节点是临时节点，则表示创建该节点的会话的SessionID；如果节点是持久节点，则该属性值为 0</span></span>
<span class="line"><span style="color:#6F42C1;">dataLength</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 数据内容的长度</span></span>
<span class="line"><span style="color:#6F42C1;">numChildren</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 数据节点当前的子节点个数</span></span></code></pre></div><h3 id="_5、查看节点状态" tabindex="-1">5、查看节点状态 <a class="header-anchor" href="#_5、查看节点状态" aria-label="Permalink to &quot;5、查看节点状态&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#6CB6FF;">stat</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">path</span></span>
<span class="line"><span style="color:#768390;"># stat命令的返回值和 get 命令类似，但不会返回节点数据</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">stat</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path</span></span>
<span class="line"><span style="color:#6A737D;"># stat命令的返回值和 get 命令类似，但不会返回节点数据</span></span></code></pre></div><h3 id="_6、查看节点列表" tabindex="-1">6、查看节点列表 <a class="header-anchor" href="#_6、查看节点列表" aria-label="Permalink to &quot;6、查看节点列表&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># 查看节点列表有 ls path 和 ls2 path 两个命令，后者是前者的增强。</span></span>
<span class="line"><span style="color:#F69D50;">ls</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">path</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 不仅可以查看指定路径下的所有节点，还可以查看当前节点的信息</span></span>
<span class="line"><span style="color:#F69D50;">ls2</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">path</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 查看节点列表有 ls path 和 ls2 path 两个命令，后者是前者的增强。</span></span>
<span class="line"><span style="color:#6F42C1;">ls</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 不仅可以查看指定路径下的所有节点，还可以查看当前节点的信息</span></span>
<span class="line"><span style="color:#6F42C1;">ls2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path</span></span></code></pre></div><h3 id="_7、监听器" tabindex="-1">7、监听器 <a class="header-anchor" href="#_7、监听器" aria-label="Permalink to &quot;7、监听器&quot;">​</a></h3><p>  zookeeper 的触发器是一次性的 (One-time trigger)，即触发一次后就会立即失效。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F69D50;">get</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">path</span><span style="color:#ADBAC7;"> [watch]</span></span>
<span class="line"><span style="color:#768390;"># 使用 get path [watch] 注册的监听器能够在节点内容发生改变的时候，向客户端发出通知。</span></span>
<span class="line"><span style="color:#F69D50;">get</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/hadoop</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">watch</span></span>
<span class="line"><span style="color:#6CB6FF;">set</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/hadoop</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">45678</span></span>
<span class="line"><span style="color:#F69D50;">WATCHER::WatchedEvent</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">state:SyncConnected</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">type:NodeDataChanged</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">path:/hadoop</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 节点值改变</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6CB6FF;">stat</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">path</span><span style="color:#ADBAC7;"> [watch]</span></span>
<span class="line"><span style="color:#768390;"># 使用 stat path [watch] 注册的监听器能够在节点状态发生改变的时候，向客户端发出通知</span></span>
<span class="line"><span style="color:#6CB6FF;">stat</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/hadoop</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">watch</span></span>
<span class="line"><span style="color:#6CB6FF;">set</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/hadoop</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">112233</span></span>
<span class="line"><span style="color:#F69D50;">WATCHER::WatchedEvent</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">state:SyncConnected</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">type:NodeDataChanged</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">path:/hadoop</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;"># 节点值改变</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F69D50;">ls</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">path</span><span style="color:#ADBAC7;"> [watch]</span></span>
<span class="line"><span style="color:#F69D50;">ls2</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">path</span><span style="color:#ADBAC7;"> [watch]</span></span>
<span class="line"><span style="color:#768390;"># ​使用 ls path [watch] 或 ls2 path [watch] 注册的监听器能够监听该节点下所有子节点的增加和删除操作。</span></span>
<span class="line"><span style="color:#F69D50;">ls</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/hadoop</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">watch</span><span style="color:#ADBAC7;"> </span></span>
<span class="line"><span style="color:#F69D50;">create</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/hadoop/yarn</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;aaa&quot;</span></span>
<span class="line"><span style="color:#F69D50;">WATCHER::WatchedEvent</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">state:SyncConnected</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">type:NodeChildrenChanged</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">path:/hadoop</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path</span><span style="color:#24292E;"> [watch]</span></span>
<span class="line"><span style="color:#6A737D;"># 使用 get path [watch] 注册的监听器能够在节点内容发生改变的时候，向客户端发出通知。</span></span>
<span class="line"><span style="color:#6F42C1;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/hadoop</span><span style="color:#24292E;"> </span><span style="color:#032F62;">watch</span></span>
<span class="line"><span style="color:#005CC5;">set</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/hadoop</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">45678</span></span>
<span class="line"><span style="color:#6F42C1;">WATCHER::WatchedEvent</span><span style="color:#24292E;"> </span><span style="color:#032F62;">state:SyncConnected</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type:NodeDataChanged</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path:/hadoop</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 节点值改变</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">stat</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path</span><span style="color:#24292E;"> [watch]</span></span>
<span class="line"><span style="color:#6A737D;"># 使用 stat path [watch] 注册的监听器能够在节点状态发生改变的时候，向客户端发出通知</span></span>
<span class="line"><span style="color:#005CC5;">stat</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/hadoop</span><span style="color:#24292E;"> </span><span style="color:#032F62;">watch</span></span>
<span class="line"><span style="color:#005CC5;">set</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/hadoop</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">112233</span></span>
<span class="line"><span style="color:#6F42C1;">WATCHER::WatchedEvent</span><span style="color:#24292E;"> </span><span style="color:#032F62;">state:SyncConnected</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type:NodeDataChanged</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path:/hadoop</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 节点值改变</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">ls</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path</span><span style="color:#24292E;"> [watch]</span></span>
<span class="line"><span style="color:#6F42C1;">ls2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path</span><span style="color:#24292E;"> [watch]</span></span>
<span class="line"><span style="color:#6A737D;"># ​使用 ls path [watch] 或 ls2 path [watch] 注册的监听器能够监听该节点下所有子节点的增加和删除操作。</span></span>
<span class="line"><span style="color:#6F42C1;">ls</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/hadoop</span><span style="color:#24292E;"> </span><span style="color:#032F62;">watch</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/hadoop/yarn</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;aaa&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">WATCHER::WatchedEvent</span><span style="color:#24292E;"> </span><span style="color:#032F62;">state:SyncConnected</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type:NodeChildrenChanged</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path:/hadoop</span></span></code></pre></div><h2 id="一致性协议-zab协议" tabindex="-1">一致性协议(zab协议) <a class="header-anchor" href="#一致性协议-zab协议" aria-label="Permalink to &quot;一致性协议(zab协议)&quot;">​</a></h2><p>  zab协议 的全称是 Zookeeper Atomic Broadcast （zookeeper原子广播）。zookeeper是通过 zab协议来保证分布式事务的最终一致性。</p><p>  基于zab协议，zookeeper集群中的角色主要有以下三类：</p><table><thead><tr><th>角色</th><th>描述</th></tr></thead><tbody><tr><td>领导者（Leader）</td><td>领导者负责进行投票的发起和决议，更新系统状态。</td></tr><tr><td>学习者（Learner）- 跟随者（Follower）</td><td>Follower用于接受客户请求并向客户端返回结果，在选主过程中参与投票</td></tr><tr><td>学习者（Learner）- 观察者（Observer）</td><td>Observer可以接受客户端连接，将写请求转发给leader节点。当Observer不参加投票过程，只同步leader的状态。Observer的目的是为了扩展系统，提高读取速度。</td></tr><tr><td>客户端（Client）</td><td>请求发起方</td></tr></tbody></table><h3 id="zab广播模式工作原理" tabindex="-1">zab广播模式工作原理 <a class="header-anchor" href="#zab广播模式工作原理" aria-label="Permalink to &quot;zab广播模式工作原理&quot;">​</a></h3><p>  通过类似两阶段提交协议的方式解决数据一致性 <img src="/charles-blog/assets/ZabPrinciple.0508fa3b.png" alt="ZabPrinciple"></p><ol><li>leader从客户端收到一个写请求；</li><li>leader生成一个新的事务并为这个事务生成一个唯一的ZXID；</li><li>leader将这个事务提议(propose)发送给所有的follows节点；</li><li>follower节点将收到的事务请求加入到历史队列(history queue)中,并发送ack给leader；</li><li>当leader收到大多数follower（半数以上节点）的ack消息，leader会发送commit请求；</li><li>当follower收到commit请求时，从历史队列中将事务请求commit；</li></ol><h2 id="zookeeper初始化leader的选举" tabindex="-1">Zookeeper初始化Leader的选举 <a class="header-anchor" href="#zookeeper初始化leader的选举" aria-label="Permalink to &quot;Zookeeper初始化Leader的选举&quot;">​</a></h2><ul><li>集群机器 ID <ul><li>集群机器 ID 是指 myid，它是每一个集群机器中的编号文件，代表 ZooKeeper 集群服务器的标识，手动生成，全局唯一。</li></ul></li><li>事务 ID <ul><li>事务 ID 是指 zxid，Zookeeper 会给每个更新请求分配一个事务 ID，它是一个 64 位的数字，由 Leader 统一进行分配，全局唯一，不断递增，在一个节点的状态信息中可以查看到最新的事务 ID 信息。 <img src="/charles-blog/assets/VoteLeader.f1119a08.png" alt="VoteLeader">   在集群初始化阶段，只有两台以以上的 ZK 启动才会发生leader选举，过程如下：</li></ul></li></ul><ol><li>每个 Server 发出一个投票。初始选举 ZK1 和 ZK2 都会将自己作为 Leader 服务器来进行投票，每次投票会包含所推举的服务器的(myid, ZXID)，此时 ZK1 的投票为(1, 0)，ZK2 的投票为(2, 0)，然后各自将这个投票发给集群中其他机器。</li><li>收到投票。集群的每个服务器收到投票后，首先判断该投票的有效性，如检查是否是本轮投票、是否来自 LOOKING 状态的服务器。</li><li>处理投票。每个发起投票的服务器需要将别人的投票和自己的投票进行比较，规则如下: 优先检查 ZXID。ZXID 比较大的服务器优先作为 Leader。如果 ZXID 相同，那么就比较 myid。myid 较大的服务器作为Leader服务器。</li><li>统计投票。每次投票后，服务器都会统计投票信息，判断是否已经有过半机器接受到相同的投票信息，对于 ZK1、ZK2 而言，都统计出集群中已经有两台机器接受了(2, 0)的投票信息，此时便认为已经选出 ZK2 作为Leader。</li><li>改变服务器状态。一旦确定了 Leader，每个服务器就会更新自己的状态，如果是Follower，那么就变更为 FOLLOWING，如果是 Leader，就变更为 LEADING。当新的 Zookeeper 节点 ZK3 启动时，发现已经有 Leader 了，不再选举，直接将直接的状态从 LOOKING 改为 FOLLOWING。</li></ol><h2 id="zookeeper的acl权限控制" tabindex="-1">zookeeper的acl权限控制 <a class="header-anchor" href="#zookeeper的acl权限控制" aria-label="Permalink to &quot;zookeeper的acl权限控制&quot;">​</a></h2><p>  zookeeper的access control list 访问控制列表可以做到节点的权限控制；</p><p>  acl 权限控制，使用scheme：id：permission 来标识，主要涵盖 3 个方面：</p><ul><li>权限模式（scheme）：授权的策略</li><li>授权对象（id）：授权的对象</li><li>权限（permission）：授予的权限</li></ul><p>  其特性如下：</p><ul><li>zooKeeper的权限控制是基于每个znode节点的，需要对每个节点设置权限</li><li>每个znode支持设置多种权限控制方案和多个权限</li><li>子节点不会继承父节点的权限，客户端无权访问某节点，但可能可以访问它的子节点</li></ul><h3 id="权限模式-​采用何种方式授权" tabindex="-1">权限模式(​采用何种方式授权) <a class="header-anchor" href="#权限模式-​采用何种方式授权" aria-label="Permalink to &quot;权限模式(​采用何种方式授权)&quot;">​</a></h3><table><thead><tr><th>方案</th><th>描述</th></tr></thead><tbody><tr><td>world</td><td>只有一个用户：anyone，代表登录zokeeper所有人（默认）</td></tr><tr><td>ip</td><td>对客户端使用IP地址认证</td></tr><tr><td>auth</td><td>使用已添加认证的用户认证</td></tr><tr><td>digest</td><td>使用“用户名:密码”方式认证</td></tr></tbody></table><h3 id="授权对象-给谁授予权限" tabindex="-1">授权对象(给谁授予权限) <a class="header-anchor" href="#授权对象-给谁授予权限" aria-label="Permalink to &quot;授权对象(给谁授予权限)&quot;">​</a></h3><p>  ​授权对象ID是指，权限赋予的实体，例如：IP 地址或用户。</p><h3 id="授予的权限" tabindex="-1">授予的权限 <a class="header-anchor" href="#授予的权限" aria-label="Permalink to &quot;授予的权限&quot;">​</a></h3><p>  create、delete、read、writer、admin也就是 增、删、改、查、管理权限，这5种权限简写为cdrwa。</p><p>  这5种权限中，delete是指对子节点的删除权限，其它4种权限指对自身节点的操作权限。</p><table><thead><tr><th>权限</th><th>ACL简写</th><th>描述</th></tr></thead><tbody><tr><td>create</td><td>c</td><td>可以创建子节点</td></tr><tr><td>delete</td><td>d</td><td>可以删除子节点（仅下一级节点）</td></tr><tr><td>read</td><td>r</td><td>可以读取节点数据及显示子节点列表</td></tr><tr><td>write</td><td>w</td><td>可以设置节点数据</td></tr><tr><td>admin</td><td>a</td><td>可以设置节点访问控制列表权限</td></tr></tbody></table><h3 id="授权的相关命令" tabindex="-1">授权的相关命令 <a class="header-anchor" href="#授权的相关命令" aria-label="Permalink to &quot;授权的相关命令&quot;">​</a></h3><table><thead><tr><th>命令</th><th>使用方式</th><th>描述</th></tr></thead><tbody><tr><td>getAcl</td><td>getAcl</td><td>读取ACL权限</td></tr><tr><td>setAcl</td><td>setAcl</td><td>设置ACL权限</td></tr><tr><td>addauth</td><td>addauth</td><td>添加认证用户</td></tr></tbody></table><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;"># world授权模式</span></span>
<span class="line"><span style="color:#768390;"># setAcl &lt;path&gt; world:anyone:&lt;acl&gt;</span></span>
<span class="line"><span style="color:#F69D50;">setAcl</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/node1</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">world:anyone:cdrwa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># IP授权模式</span></span>
<span class="line"><span style="color:#768390;"># setAcl &lt;path&gt; ip:&lt;ip&gt;:&lt;acl&gt;</span></span>
<span class="line"><span style="color:#F69D50;">setAcl</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/node2</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">ip:192.168.60.129:cdrwa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># Auth授权模式</span></span>
<span class="line"><span style="color:#768390;"># addauth digest &lt;user&gt;:&lt;password&gt; #添加认证用户</span></span>
<span class="line"><span style="color:#768390;"># setAcl &lt;path&gt; auth:&lt;user&gt;:&lt;acl&gt;</span></span>
<span class="line"><span style="color:#F69D50;">addauth</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">digest</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">itcast:123456</span></span>
<span class="line"><span style="color:#F69D50;">setAcl</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/node3</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">auth:itcast:cdrwa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># Digest授权模式</span></span>
<span class="line"><span style="color:#768390;"># 先经过SHA1和BASE64处理的password</span></span>
<span class="line"><span style="color:#768390;"># echo -n &lt;user&gt;:&lt;password&gt; | openssl dgst -binary -sha1 | openssl base64</span></span>
<span class="line"><span style="color:#768390;"># setAcl &lt;path&gt; digest:&lt;user&gt;:&lt;password&gt;:&lt;acl&gt;</span></span>
<span class="line"><span style="color:#6CB6FF;">echo</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">-n</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">itheima:123456</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">|</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">openssl</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">dgst</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">-binary</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">-sha1</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">|</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">openssl</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">base64</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">#得到123456的密文qlzQzCLKhBROghkooLvb+Mlwv4A=</span></span>
<span class="line"><span style="color:#F69D50;">setAcl</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/node4</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">digest:itheima:qlzQzCLKhBROghkooLvb+Mlwv4A=:cdrwa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;"># 多种模式授权，同一个节点可以同时使用多种模式授权，用逗号分隔</span></span>
<span class="line"><span style="color:#F69D50;">setAcl</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">/node5</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">ip:192.168.60.129:cdra,auth:itcast:cdrwa,digest:itheima:qlzQzCLKhBROghkooLvb+Mlwv4A=:cdrwa</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># world授权模式</span></span>
<span class="line"><span style="color:#6A737D;"># setAcl &lt;path&gt; world:anyone:&lt;acl&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">setAcl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">world:anyone:cdrwa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># IP授权模式</span></span>
<span class="line"><span style="color:#6A737D;"># setAcl &lt;path&gt; ip:&lt;ip&gt;:&lt;acl&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">setAcl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ip:192.168.60.129:cdrwa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Auth授权模式</span></span>
<span class="line"><span style="color:#6A737D;"># addauth digest &lt;user&gt;:&lt;password&gt; #添加认证用户</span></span>
<span class="line"><span style="color:#6A737D;"># setAcl &lt;path&gt; auth:&lt;user&gt;:&lt;acl&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">addauth</span><span style="color:#24292E;"> </span><span style="color:#032F62;">digest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">itcast:123456</span></span>
<span class="line"><span style="color:#6F42C1;">setAcl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">auth:itcast:cdrwa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Digest授权模式</span></span>
<span class="line"><span style="color:#6A737D;"># 先经过SHA1和BASE64处理的password</span></span>
<span class="line"><span style="color:#6A737D;"># echo -n &lt;user&gt;:&lt;password&gt; | openssl dgst -binary -sha1 | openssl base64</span></span>
<span class="line"><span style="color:#6A737D;"># setAcl &lt;path&gt; digest:&lt;user&gt;:&lt;password&gt;:&lt;acl&gt;</span></span>
<span class="line"><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">itheima:123456</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">openssl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dgst</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-binary</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-sha1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">openssl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">base64</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#得到123456的密文qlzQzCLKhBROghkooLvb+Mlwv4A=</span></span>
<span class="line"><span style="color:#6F42C1;">setAcl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/node4</span><span style="color:#24292E;"> </span><span style="color:#032F62;">digest:itheima:qlzQzCLKhBROghkooLvb+Mlwv4A=:cdrwa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 多种模式授权，同一个节点可以同时使用多种模式授权，用逗号分隔</span></span>
<span class="line"><span style="color:#6F42C1;">setAcl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/node5</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ip:192.168.60.129:cdra,auth:itcast:cdrwa,digest:itheima:qlzQzCLKhBROghkooLvb+Mlwv4A=:cdrwa</span></span></code></pre></div><h2 id="zookeeper-事件监听机制" tabindex="-1">zookeeper 事件监听机制 <a class="header-anchor" href="#zookeeper-事件监听机制" aria-label="Permalink to &quot;zookeeper 事件监听机制&quot;">​</a></h2><p>  zookeeper提供了数据的发布/订阅功能，多个订阅者可同时监听某一特定主题对象，当该主题对象的自身状态发生变化时(例如节点内容改变、节点下的子节点列表改变等)，会实时、主动通知所有订阅者</p><h3 id="watcher架构" tabindex="-1">watcher架构 <a class="header-anchor" href="#watcher架构" aria-label="Permalink to &quot;watcher架构&quot;">​</a></h3><p>客户端首先将Watcher注册到服务端，同时将Watcher对象保存到客户端的Watch管理器中。当ZooKeeper服务端监听的数据状态发生变化时，服务端会主动通知客户端，接着客户端的Watch管理器会触发相关Watcher来回调相应处理逻辑，从而完成整体的数据发布/订阅流程。 <img src="/charles-blog/assets/Watch.22e92b1d.png" alt="Watch"></p><h4 id="四个特性" tabindex="-1">四个特性 <a class="header-anchor" href="#四个特性" aria-label="Permalink to &quot;四个特性&quot;">​</a></h4><ul><li>一次性：一旦一个Wather触发之后，Zookeeper就会将它从存储中移除，如果还要继续监听这个节点，就需要我们在客户端的监听回调中，再次对节点的监听watch事件设置为True。否则客户端只能接收到一次该节点的变更通知</li><li>客户端串行：客户端的Wather回调处理是串行同步的过程，不要因为一个Wather的逻辑阻塞整个客户端</li><li>轻量：Wather通知的单位是WathedEvent，只包含通知状态、事件类型和节点路径，不包含具体的事件内容，具体的时间内容需要客户端主动去重新获取数据</li><li>异步:  Zookeeper服务器发送watcher的通知事件到客户端是异步的，不能期望能够监控到节点每次的变化，Zookeeper只能保证最终的一致性，而无法保证强一致性。</li></ul><h4 id="watcher接口设计" tabindex="-1">watcher接口设计 <a class="header-anchor" href="#watcher接口设计" aria-label="Permalink to &quot;watcher接口设计&quot;">​</a></h4><h5 id="keeperstate" tabindex="-1">KeeperState <a class="header-anchor" href="#keeperstate" aria-label="Permalink to &quot;KeeperState&quot;">​</a></h5><p>  KeeperState是客户端与服务端连接状态发生变化时对应的通知类型。</p><table><thead><tr><th>枚举属性</th><th>说明</th></tr></thead><tbody><tr><td>SyncConnected</td><td>客户端与服务器正常连接时</td></tr><tr><td>Disconnected</td><td>客户端与服务器断开连接时</td></tr><tr><td>Expired</td><td>会话session失效时</td></tr><tr><td>AuthFailed</td><td>身份认证失败时</td></tr></tbody></table><h5 id="eventtype" tabindex="-1">EventType <a class="header-anchor" href="#eventtype" aria-label="Permalink to &quot;EventType&quot;">​</a></h5><p>  EventType是数据节点(znode)发生变化时对应的通知类型。</p><table><thead><tr><th>枚举属性</th><th>说明</th></tr></thead><tbody><tr><td>None</td><td>无</td></tr><tr><td>NodeCreated</td><td>Watcher监听的数据节点被创建时</td></tr><tr><td>NodeDeleted</td><td>Watcher监听的数据节点被删除时</td></tr><tr><td>NodeDataChanged</td><td>Watcher监听的数据节点内容发生变更时(无论内容数据是否变化)</td></tr><tr><td>NodeChildrenChanged</td><td>Watcher监听的数据节点的子节点列表发生变更时</td></tr></tbody></table><p>  EventType变化时KeeperState永远处于SyncConnected通知状态下；当KeeperState发生变化时，EventType永远为None。</p><h2 id="curator" tabindex="-1">Curator <a class="header-anchor" href="#curator" aria-label="Permalink to &quot;Curator&quot;">​</a></h2><p>  Curator是Netflix公司开源的一套zookeeper客户端框架，解决了很多Zookeeper客户端非常底层的细节开发工作，包括连接重连、反复注册Watcher和NodeExistsException异常等等，现在是Apache的开源项目。</p><p>  Curator封装了很多功能（分布式锁、leader选举、分布式队列、共享计数器等等），更加简单易用。</p><h3 id="_1、session重连策略" tabindex="-1">1、session重连策略 <a class="header-anchor" href="#_1、session重连策略" aria-label="Permalink to &quot;1、session重连策略&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">//3秒后重连一次，只重连1次</span></span>
<span class="line"><span style="color:#ADBAC7;">RetryPolicy</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">retryPolicy</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">RetryOneTime</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">3000</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">//每3秒重连一次，重连3次</span></span>
<span class="line"><span style="color:#ADBAC7;">RetryPolicy</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">retryPolicy</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">RetryNTimes</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">3</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">3000</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">//每3秒重连一次，总等待时间超过10秒后停止重连</span></span>
<span class="line"><span style="color:#ADBAC7;">RetryPolicy</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">retryPolicy</span><span style="color:#F47067;">=new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">RetryUntilElapsed</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">10000</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">3000</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// baseSleepTimeMs * Math.max(1, random.nextInt(1 &lt;&lt; (retryCount+ 1)))</span></span>
<span class="line"><span style="color:#ADBAC7;">RetryPolicy</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">retryPolicy</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">ExponentialBackoffRetry</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">1000</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">3</span><span style="color:#ADBAC7;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//3秒后重连一次，只重连1次</span></span>
<span class="line"><span style="color:#24292E;">RetryPolicy retryPolicy </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RetryOneTime</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">3000</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//每3秒重连一次，重连3次</span></span>
<span class="line"><span style="color:#24292E;">RetryPolicy retryPolicy </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RetryNTimes</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">3000</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//每3秒重连一次，总等待时间超过10秒后停止重连</span></span>
<span class="line"><span style="color:#24292E;">RetryPolicy retryPolicy</span><span style="color:#D73A49;">=new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RetryUntilElapsed</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">10000</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">3000</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// baseSleepTimeMs * Math.max(1, random.nextInt(1 &lt;&lt; (retryCount+ 1)))</span></span>
<span class="line"><span style="color:#24292E;">RetryPolicy retryPolicy </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ExponentialBackoffRetry</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1000</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">);</span></span></code></pre></div><h3 id="_2、连接到zookeeper" tabindex="-1">2、连接到zookeeper <a class="header-anchor" href="#_2、连接到zookeeper" aria-label="Permalink to &quot;2、连接到zookeeper&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">// 创建连接对象</span></span>
<span class="line"><span style="color:#ADBAC7;">CuratorFramework</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">client</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> CuratorFrameworkFactory.</span><span style="color:#DCBDFB;">builder</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// IP地址端口号</span></span>
<span class="line"><span style="color:#ADBAC7;">    .</span><span style="color:#DCBDFB;">connectString</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;192.168.60.130:2181,192.168.60.130:2182,192.168.60.130:2183&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// 会话超时时间</span></span>
<span class="line"><span style="color:#ADBAC7;">    .</span><span style="color:#DCBDFB;">sessionTimeoutMs</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">5000</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// 重连机制</span></span>
<span class="line"><span style="color:#ADBAC7;">    .</span><span style="color:#DCBDFB;">retryPolicy</span><span style="color:#ADBAC7;">(retryPolicy)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// 命名空间</span></span>
<span class="line"><span style="color:#ADBAC7;">    .</span><span style="color:#DCBDFB;">namespace</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;create&quot;</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// 构建连接对象</span></span>
<span class="line"><span style="color:#ADBAC7;">    .</span><span style="color:#DCBDFB;">build</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#768390;">// 打开连接</span></span>
<span class="line"><span style="color:#ADBAC7;">client.</span><span style="color:#DCBDFB;">start</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// 执行操作.....</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// 关闭连接</span></span>
<span class="line"><span style="color:#ADBAC7;">client.</span><span style="color:#DCBDFB;">close</span><span style="color:#ADBAC7;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 创建连接对象</span></span>
<span class="line"><span style="color:#24292E;">CuratorFramework client</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> CuratorFrameworkFactory.</span><span style="color:#6F42C1;">builder</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// IP地址端口号</span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">connectString</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;192.168.60.130:2181,192.168.60.130:2182,192.168.60.130:2183&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 会话超时时间</span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">sessionTimeoutMs</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">5000</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 重连机制</span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">retryPolicy</span><span style="color:#24292E;">(retryPolicy)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 命名空间</span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">namespace</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;create&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 构建连接对象</span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">build</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#6A737D;">// 打开连接</span></span>
<span class="line"><span style="color:#24292E;">client.</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 执行操作.....</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 关闭连接</span></span>
<span class="line"><span style="color:#24292E;">client.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();</span></span></code></pre></div><h3 id="_3、新增节点" tabindex="-1">3、新增节点 <a class="header-anchor" href="#_3、新增节点" aria-label="Permalink to &quot;3、新增节点&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">client.</span><span style="color:#DCBDFB;">create</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// 节点的类型</span></span>
<span class="line"><span style="color:#ADBAC7;">    .</span><span style="color:#DCBDFB;">withMode</span><span style="color:#ADBAC7;">(CreateMode.PERSISTENT)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// 节点的权限列表 world:anyone:cdrwa</span></span>
<span class="line"><span style="color:#ADBAC7;">    .</span><span style="color:#DCBDFB;">withACL</span><span style="color:#ADBAC7;">(ZooDefs.Ids.OPEN_ACL_UNSAFE)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// arg1:节点的路径，arg2:节点的数据</span></span>
<span class="line"><span style="color:#ADBAC7;">    .</span><span style="color:#DCBDFB;">forPath</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;/node1&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#96D0FF;">&quot;node1&quot;</span><span style="color:#ADBAC7;">.</span><span style="color:#DCBDFB;">getBytes</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#768390;">// 自定义权限列表</span></span>
<span class="line"><span style="color:#768390;">// 权限列表</span></span>
<span class="line"><span style="color:#ADBAC7;">List</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">ACL</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">list</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">new</span><span style="color:#ADBAC7;"> ArrayList&lt;</span><span style="color:#F47067;">ACL</span><span style="color:#ADBAC7;">&gt;();</span></span>
<span class="line"><span style="color:#768390;">// 授权模式和授权对象</span></span>
<span class="line"><span style="color:#ADBAC7;">Id</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">id</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">Id</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;ip&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#96D0FF;">&quot;192.168.60.130&quot;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">list.</span><span style="color:#DCBDFB;">add</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">ACL</span><span style="color:#ADBAC7;">(ZooDefs.Perms.ALL, id));</span></span>
<span class="line"><span style="color:#ADBAC7;">client.</span><span style="color:#DCBDFB;">create</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">withMode</span><span style="color:#ADBAC7;">(CreateMode.PERSISTENT).</span><span style="color:#DCBDFB;">withACL</span><span style="color:#ADBAC7;">(list).</span><span style="color:#DCBDFB;">forPath</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;/node2&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#96D0FF;">&quot;node2&quot;</span><span style="color:#ADBAC7;">.</span><span style="color:#DCBDFB;">getBytes</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// 递归创建节点树</span></span>
<span class="line"><span style="color:#ADBAC7;">client.</span><span style="color:#DCBDFB;">create</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">creatingParentsIfNeeded</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">withMode</span><span style="color:#ADBAC7;">(CreateMode.PERSISTENT)</span></span>
<span class="line"><span style="color:#ADBAC7;">    .</span><span style="color:#DCBDFB;">withACL</span><span style="color:#ADBAC7;">(ZooDefs.Ids.OPEN_ACL_UNSAFE).</span><span style="color:#DCBDFB;">forPath</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;/node3/node31&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#96D0FF;">&quot;node31&quot;</span><span style="color:#ADBAC7;">.</span><span style="color:#DCBDFB;">getBytes</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span></span>
<span class="line"><span style="color:#ADBAC7;"> </span><span style="color:#768390;">// 异步方式创建节点</span></span>
<span class="line"><span style="color:#ADBAC7;">client.</span><span style="color:#DCBDFB;">create</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">creatingParentsIfNeeded</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">withMode</span><span style="color:#ADBAC7;">(CreateMode.PERSISTENT)</span></span>
<span class="line"><span style="color:#ADBAC7;">    .</span><span style="color:#DCBDFB;">withACL</span><span style="color:#ADBAC7;">(ZooDefs.Ids.OPEN_ACL_UNSAFE)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// 异步回调接口</span></span>
<span class="line"><span style="color:#ADBAC7;">    .</span><span style="color:#DCBDFB;">inBackground</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">BackgroundCallback</span><span style="color:#ADBAC7;">() {</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">void</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">processResult</span><span style="color:#ADBAC7;">(CuratorFramework </span><span style="color:#F69D50;">curatorFramework</span><span style="color:#ADBAC7;">, CuratorEvent </span><span style="color:#F69D50;">curatorEvent</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">throws</span><span style="color:#ADBAC7;"> Exception {</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#768390;">// 节点的路径</span></span>
<span class="line"><span style="color:#ADBAC7;">            System.out.</span><span style="color:#DCBDFB;">println</span><span style="color:#ADBAC7;">(curatorEvent.</span><span style="color:#DCBDFB;">getPath</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"><span style="color:#ADBAC7;">            </span><span style="color:#768390;">// 时间类型</span></span>
<span class="line"><span style="color:#ADBAC7;">            System.out.</span><span style="color:#DCBDFB;">println</span><span style="color:#ADBAC7;">(curatorEvent.</span><span style="color:#DCBDFB;">getType</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"><span style="color:#ADBAC7;">        }</span></span>
<span class="line"><span style="color:#ADBAC7;">    })</span></span>
<span class="line"><span style="color:#ADBAC7;">    .</span><span style="color:#DCBDFB;">forPath</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;/node4&quot;</span><span style="color:#ADBAC7;">,</span><span style="color:#96D0FF;">&quot;node4&quot;</span><span style="color:#ADBAC7;">.</span><span style="color:#DCBDFB;">getBytes</span><span style="color:#ADBAC7;">());</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">client.</span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 节点的类型</span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">withMode</span><span style="color:#24292E;">(CreateMode.PERSISTENT)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 节点的权限列表 world:anyone:cdrwa</span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">withACL</span><span style="color:#24292E;">(ZooDefs.Ids.OPEN_ACL_UNSAFE)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// arg1:节点的路径，arg2:节点的数据</span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">forPath</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/node1&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;node1&quot;</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">getBytes</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#6A737D;">// 自定义权限列表</span></span>
<span class="line"><span style="color:#6A737D;">// 权限列表</span></span>
<span class="line"><span style="color:#24292E;">List&lt;</span><span style="color:#D73A49;">ACL</span><span style="color:#24292E;">&gt; list </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> ArrayList&lt;</span><span style="color:#D73A49;">ACL</span><span style="color:#24292E;">&gt;();</span></span>
<span class="line"><span style="color:#6A737D;">// 授权模式和授权对象</span></span>
<span class="line"><span style="color:#24292E;">Id id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Id</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;ip&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;192.168.60.130&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">list.</span><span style="color:#6F42C1;">add</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ACL</span><span style="color:#24292E;">(ZooDefs.Perms.ALL, id));</span></span>
<span class="line"><span style="color:#24292E;">client.</span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">withMode</span><span style="color:#24292E;">(CreateMode.PERSISTENT).</span><span style="color:#6F42C1;">withACL</span><span style="color:#24292E;">(list).</span><span style="color:#6F42C1;">forPath</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/node2&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;node2&quot;</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">getBytes</span><span style="color:#24292E;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 递归创建节点树</span></span>
<span class="line"><span style="color:#24292E;">client.</span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">creatingParentsIfNeeded</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">withMode</span><span style="color:#24292E;">(CreateMode.PERSISTENT)</span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">withACL</span><span style="color:#24292E;">(ZooDefs.Ids.OPEN_ACL_UNSAFE).</span><span style="color:#6F42C1;">forPath</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/node3/node31&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;node31&quot;</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">getBytes</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 异步方式创建节点</span></span>
<span class="line"><span style="color:#24292E;">client.</span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">creatingParentsIfNeeded</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">withMode</span><span style="color:#24292E;">(CreateMode.PERSISTENT)</span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">withACL</span><span style="color:#24292E;">(ZooDefs.Ids.OPEN_ACL_UNSAFE)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 异步回调接口</span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">inBackground</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BackgroundCallback</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">processResult</span><span style="color:#24292E;">(CuratorFramework </span><span style="color:#E36209;">curatorFramework</span><span style="color:#24292E;">, CuratorEvent </span><span style="color:#E36209;">curatorEvent</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">throws</span><span style="color:#24292E;"> Exception {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 节点的路径</span></span>
<span class="line"><span style="color:#24292E;">            System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(curatorEvent.</span><span style="color:#6F42C1;">getPath</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 时间类型</span></span>
<span class="line"><span style="color:#24292E;">            System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(curatorEvent.</span><span style="color:#6F42C1;">getType</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    })</span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">forPath</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/node4&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;node4&quot;</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">getBytes</span><span style="color:#24292E;">());</span></span></code></pre></div><h3 id="_4、更新节点" tabindex="-1">4、更新节点 <a class="header-anchor" href="#_4、更新节点" aria-label="Permalink to &quot;4、更新节点&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">// arg1:节点的路径,arg2:节点的数据</span></span>
<span class="line"><span style="color:#ADBAC7;">client.</span><span style="color:#DCBDFB;">setData</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">forPath</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;/node1&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#96D0FF;">&quot;node11&quot;</span><span style="color:#ADBAC7;">.</span><span style="color:#DCBDFB;">getBytes</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// 指定版本号</span></span>
<span class="line"><span style="color:#ADBAC7;">client.</span><span style="color:#DCBDFB;">setData</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">withVersion</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">2</span><span style="color:#ADBAC7;">).</span><span style="color:#DCBDFB;">forPath</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;/node1&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#96D0FF;">&quot;node1111&quot;</span><span style="color:#ADBAC7;">.</span><span style="color:#DCBDFB;">getBytes</span><span style="color:#ADBAC7;">());</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// arg1:节点的路径,arg2:节点的数据</span></span>
<span class="line"><span style="color:#24292E;">client.</span><span style="color:#6F42C1;">setData</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">forPath</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/node1&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;node11&quot;</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">getBytes</span><span style="color:#24292E;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 指定版本号</span></span>
<span class="line"><span style="color:#24292E;">client.</span><span style="color:#6F42C1;">setData</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">withVersion</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">forPath</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/node1&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;node1111&quot;</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">getBytes</span><span style="color:#24292E;">());</span></span></code></pre></div><h3 id="_5、删除节点" tabindex="-1">5、删除节点 <a class="header-anchor" href="#_5、删除节点" aria-label="Permalink to &quot;5、删除节点&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">client.</span><span style="color:#DCBDFB;">delete</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">forPath</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;/node1&quot;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">//删除包含子节点的节点</span></span>
<span class="line"><span style="color:#ADBAC7;">client.</span><span style="color:#DCBDFB;">delete</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">deletingChildrenIfNeeded</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">withVersion</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">-</span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">).</span><span style="color:#DCBDFB;">forPath</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;/node1&quot;</span><span style="color:#ADBAC7;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">client.</span><span style="color:#6F42C1;">delete</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">forPath</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/node1&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//删除包含子节点的节点</span></span>
<span class="line"><span style="color:#24292E;">client.</span><span style="color:#6F42C1;">delete</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">deletingChildrenIfNeeded</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">withVersion</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">forPath</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/node1&quot;</span><span style="color:#24292E;">);</span></span></code></pre></div><h3 id="_6、查看节点" tabindex="-1">6、查看节点 <a class="header-anchor" href="#_6、查看节点" aria-label="Permalink to &quot;6、查看节点&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">byte</span><span style="color:#F69D50;"> [] </span><span style="color:#ADBAC7;">bys</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">client.</span><span style="color:#DCBDFB;">getData</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">forPath</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;/node1&quot;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// 读取数据时读取节点的属性</span></span>
<span class="line"><span style="color:#ADBAC7;">Stat</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">stat</span><span style="color:#F47067;">=new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">Stat</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#F47067;">byte</span><span style="color:#F69D50;"> [] </span><span style="color:#ADBAC7;">bys</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">client.</span><span style="color:#DCBDFB;">getData</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">storingStatIn</span><span style="color:#ADBAC7;">(stat).</span><span style="color:#DCBDFB;">forPath</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;/node1&quot;</span><span style="color:#ADBAC7;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">byte</span><span style="color:#24292E;"> [] bys</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">client.</span><span style="color:#6F42C1;">getData</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">forPath</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/node1&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 读取数据时读取节点的属性</span></span>
<span class="line"><span style="color:#24292E;">Stat stat</span><span style="color:#D73A49;">=new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Stat</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#D73A49;">byte</span><span style="color:#24292E;"> [] bys</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">client.</span><span style="color:#6F42C1;">getData</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">storingStatIn</span><span style="color:#24292E;">(stat).</span><span style="color:#6F42C1;">forPath</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/node1&quot;</span><span style="color:#24292E;">);</span></span></code></pre></div><h3 id="_7、查看子节点" tabindex="-1">7、查看子节点 <a class="header-anchor" href="#_7、查看子节点" aria-label="Permalink to &quot;7、查看子节点&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">List</span><span style="color:#F69D50;">&lt;</span><span style="color:#F47067;">String</span><span style="color:#F69D50;">&gt; </span><span style="color:#ADBAC7;">list</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> client.</span><span style="color:#DCBDFB;">getChildren</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">forPath</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;/get&quot;</span><span style="color:#ADBAC7;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">List&lt;</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">&gt; list </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> client.</span><span style="color:#6F42C1;">getChildren</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">forPath</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/get&quot;</span><span style="color:#24292E;">);</span></span></code></pre></div><h3 id="_8、检查节点是否存在" tabindex="-1">8、检查节点是否存在 <a class="header-anchor" href="#_8、检查节点是否存在" aria-label="Permalink to &quot;8、检查节点是否存在&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">Stat</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">stat</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> client.</span><span style="color:#DCBDFB;">checkExists</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">forPath</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;/node2&quot;</span><span style="color:#ADBAC7;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Stat stat</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> client.</span><span style="color:#6F42C1;">checkExists</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">forPath</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/node2&quot;</span><span style="color:#24292E;">);</span></span></code></pre></div><h3 id="_9、watcherapi" tabindex="-1">9、watcherAPI <a class="header-anchor" href="#_9、watcherapi" aria-label="Permalink to &quot;9、watcherAPI&quot;">​</a></h3><p>  NodeCache : 只是监听某一个特定的节点，监听节点的新增和修改</p><p>  PathChildrenCache : 监控ZNode的子节点。当一个子节点增加，更新，删除时，PathCache会改变它的状态，会包含最新的子节点，子节点的数据和状态</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">// 监视某个节点的数据变化。arg1:连接对象，arg2:监视的节点路径</span></span>
<span class="line"><span style="color:#ADBAC7;">NodeCache</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">nodeCache</span><span style="color:#F47067;">=new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">NodeCache</span><span style="color:#ADBAC7;">(client,</span><span style="color:#96D0FF;">&quot;/watcher1&quot;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#768390;">// 启动监视器对象</span></span>
<span class="line"><span style="color:#ADBAC7;">nodeCache.</span><span style="color:#DCBDFB;">start</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">nodeCache.</span><span style="color:#DCBDFB;">getListenable</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">addListener</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">NodeCacheListener</span><span style="color:#ADBAC7;">() {</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// 节点变化时回调的方法</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">void</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">nodeChanged</span><span style="color:#ADBAC7;">() </span><span style="color:#F47067;">throws</span><span style="color:#ADBAC7;"> Exception {</span></span>
<span class="line"><span style="color:#ADBAC7;">        System.out.</span><span style="color:#DCBDFB;">println</span><span style="color:#ADBAC7;">(nodeCache.</span><span style="color:#DCBDFB;">getCurrentData</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">getPath</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"><span style="color:#ADBAC7;">        System.out.</span><span style="color:#DCBDFB;">println</span><span style="color:#ADBAC7;">(</span><span style="color:#DCBDFB;">newString</span><span style="color:#ADBAC7;">(nodeCache.</span><span style="color:#DCBDFB;">getCurrentData</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">getData</span><span style="color:#ADBAC7;">()));</span></span>
<span class="line"><span style="color:#ADBAC7;">   }</span></span>
<span class="line"><span style="color:#ADBAC7;">});</span></span>
<span class="line"><span style="color:#768390;">//关闭监视器对象</span></span>
<span class="line"><span style="color:#ADBAC7;">nodeCache.</span><span style="color:#DCBDFB;">close</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// 监视子节点的变化。arg1:连接对象，arg2:监视的节点路径，arg3:事件中是否可以获取节点的数据</span></span>
<span class="line"><span style="color:#ADBAC7;">PathChildrenCache</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">pathChildrenCache</span><span style="color:#F47067;">=new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">PathChildrenCache</span><span style="color:#ADBAC7;">(client,</span><span style="color:#96D0FF;">&quot;/watcher1&quot;</span><span style="color:#ADBAC7;">,</span><span style="color:#6CB6FF;">true</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#768390;">// 启动监听</span></span>
<span class="line"><span style="color:#ADBAC7;">pathChildrenCache.</span><span style="color:#DCBDFB;">start</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#ADBAC7;">pathChildrenCache.</span><span style="color:#DCBDFB;">getListenable</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">addListener</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">PathChildrenCacheListener</span><span style="color:#ADBAC7;">() {</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// 当子节点方法变化时回调的方法</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">public</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">void</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">childEvent</span><span style="color:#ADBAC7;">(CuratorFramework </span><span style="color:#F69D50;">curatorFramework</span><span style="color:#ADBAC7;">,PathChildrenCacheEvent </span><span style="color:#F69D50;">pathChildrenCacheEvent</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#768390;">// 节点的事件类型</span></span>
<span class="line"><span style="color:#ADBAC7;">        System.out.</span><span style="color:#DCBDFB;">println</span><span style="color:#ADBAC7;">(pathChildrenCacheEvent.</span><span style="color:#DCBDFB;">getType</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#768390;">// 节点的路径</span></span>
<span class="line"><span style="color:#ADBAC7;">        System.out.</span><span style="color:#DCBDFB;">println</span><span style="color:#ADBAC7;">(pathChildrenCacheEvent.</span><span style="color:#DCBDFB;">getData</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">getPath</span><span style="color:#ADBAC7;">());</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#768390;">// 节点数据</span></span>
<span class="line"><span style="color:#ADBAC7;">        System.out.</span><span style="color:#DCBDFB;">println</span><span style="color:#ADBAC7;">(</span><span style="color:#F47067;">new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">String</span><span style="color:#ADBAC7;">(pathChildrenCacheEvent.</span><span style="color:#DCBDFB;">getData</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">getData</span><span style="color:#ADBAC7;">()));</span></span>
<span class="line"><span style="color:#ADBAC7;">    }</span></span>
<span class="line"><span style="color:#ADBAC7;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// 关闭监听</span></span>
<span class="line"><span style="color:#ADBAC7;">pathChildrenCache.</span><span style="color:#DCBDFB;">close</span><span style="color:#ADBAC7;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 监视某个节点的数据变化。arg1:连接对象，arg2:监视的节点路径</span></span>
<span class="line"><span style="color:#24292E;">NodeCache nodeCache</span><span style="color:#D73A49;">=new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NodeCache</span><span style="color:#24292E;">(client,</span><span style="color:#032F62;">&quot;/watcher1&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#6A737D;">// 启动监视器对象</span></span>
<span class="line"><span style="color:#24292E;">nodeCache.</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">nodeCache.</span><span style="color:#6F42C1;">getListenable</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">addListener</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NodeCacheListener</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 节点变化时回调的方法</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">nodeChanged</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">throws</span><span style="color:#24292E;"> Exception {</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(nodeCache.</span><span style="color:#6F42C1;">getCurrentData</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">getPath</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">newString</span><span style="color:#24292E;">(nodeCache.</span><span style="color:#6F42C1;">getCurrentData</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">getData</span><span style="color:#24292E;">()));</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"><span style="color:#6A737D;">//关闭监视器对象</span></span>
<span class="line"><span style="color:#24292E;">nodeCache.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 监视子节点的变化。arg1:连接对象，arg2:监视的节点路径，arg3:事件中是否可以获取节点的数据</span></span>
<span class="line"><span style="color:#24292E;">PathChildrenCache pathChildrenCache</span><span style="color:#D73A49;">=new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">PathChildrenCache</span><span style="color:#24292E;">(client,</span><span style="color:#032F62;">&quot;/watcher1&quot;</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#6A737D;">// 启动监听</span></span>
<span class="line"><span style="color:#24292E;">pathChildrenCache.</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">pathChildrenCache.</span><span style="color:#6F42C1;">getListenable</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">addListener</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">PathChildrenCacheListener</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 当子节点方法变化时回调的方法</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">childEvent</span><span style="color:#24292E;">(CuratorFramework </span><span style="color:#E36209;">curatorFramework</span><span style="color:#24292E;">,PathChildrenCacheEvent </span><span style="color:#E36209;">pathChildrenCacheEvent</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 节点的事件类型</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(pathChildrenCacheEvent.</span><span style="color:#6F42C1;">getType</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 节点的路径</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(pathChildrenCacheEvent.</span><span style="color:#6F42C1;">getData</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">getPath</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 节点数据</span></span>
<span class="line"><span style="color:#24292E;">        System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">String</span><span style="color:#24292E;">(pathChildrenCacheEvent.</span><span style="color:#6F42C1;">getData</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">getData</span><span style="color:#24292E;">()));</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 关闭监听</span></span>
<span class="line"><span style="color:#24292E;">pathChildrenCache.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();</span></span></code></pre></div><h3 id="_10、事务" tabindex="-1">10、事务 <a class="header-anchor" href="#_10、事务" aria-label="Permalink to &quot;10、事务&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#ADBAC7;">client.</span><span style="color:#DCBDFB;">inTransaction</span><span style="color:#ADBAC7;">().</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#DCBDFB;">create</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">forPath</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;node1&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#96D0FF;">&quot;node1&quot;</span><span style="color:#ADBAC7;">.</span><span style="color:#DCBDFB;">getBytes</span><span style="color:#ADBAC7;">()).</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#DCBDFB;">and</span><span style="color:#ADBAC7;">().</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#DCBDFB;">create</span><span style="color:#ADBAC7;">().</span><span style="color:#DCBDFB;">forPath</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&quot;node2&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#96D0FF;">&quot;node2&quot;</span><span style="color:#ADBAC7;">.</span><span style="color:#DCBDFB;">getBytes</span><span style="color:#ADBAC7;">()).</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#DCBDFB;">and</span><span style="color:#ADBAC7;">().</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#DCBDFB;">commit</span><span style="color:#ADBAC7;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">client.</span><span style="color:#6F42C1;">inTransaction</span><span style="color:#24292E;">().</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">forPath</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;node1&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;node1&quot;</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">getBytes</span><span style="color:#24292E;">()).</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">and</span><span style="color:#24292E;">().</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">forPath</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;node2&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;node2&quot;</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">getBytes</span><span style="color:#24292E;">()).</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">and</span><span style="color:#24292E;">().</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">commit</span><span style="color:#24292E;">();</span></span></code></pre></div><h3 id="_11、分布式锁" tabindex="-1">11、分布式锁 <a class="header-anchor" href="#_11、分布式锁" aria-label="Permalink to &quot;11、分布式锁&quot;">​</a></h3><p>  InterProcessMutex：分布式可重入排它锁</p><p>  InterProcessReadWriteLock：分布式读写锁</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">// 排他锁。arg1:连接对象，arg2:节点路径</span></span>
<span class="line"><span style="color:#ADBAC7;">InterProcessLock</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">interProcessLock</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">InterProcessMutex</span><span style="color:#ADBAC7;">(client,</span><span style="color:#96D0FF;">&quot;/lock1&quot;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#768390;">// 获取锁</span></span>
<span class="line"><span style="color:#ADBAC7;">interProcessLock.</span><span style="color:#DCBDFB;">acquire</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#F47067;">for</span><span style="color:#ADBAC7;"> (</span><span style="color:#F47067;">int</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">i</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">; i </span><span style="color:#F47067;">&lt;=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">10</span><span style="color:#ADBAC7;">; i</span><span style="color:#F47067;">++</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#ADBAC7;">    Thread.</span><span style="color:#DCBDFB;">sleep</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">3000</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">    System.out.</span><span style="color:#DCBDFB;">println</span><span style="color:#ADBAC7;">(i);</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span>
<span class="line"><span style="color:#768390;">// 释放锁</span></span>
<span class="line"><span style="color:#ADBAC7;">interProcessLock.</span><span style="color:#DCBDFB;">release</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// 读锁</span></span>
<span class="line"><span style="color:#ADBAC7;">InterProcessReadWriteLock</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">interProcessReadWriteLock</span><span style="color:#F47067;">=new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">InterProcessReadWriteLock</span><span style="color:#ADBAC7;">(client, </span><span style="color:#96D0FF;">&quot;/lock1&quot;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#768390;">// 获取读锁对象</span></span>
<span class="line"><span style="color:#ADBAC7;">InterProcessLock</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">interProcessLock</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">interProcessReadWriteLock.</span><span style="color:#DCBDFB;">readLock</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#768390;">// 获取锁</span></span>
<span class="line"><span style="color:#ADBAC7;">interProcessLock.</span><span style="color:#DCBDFB;">acquire</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#F47067;">for</span><span style="color:#ADBAC7;"> (</span><span style="color:#F47067;">int</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">i</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">; i </span><span style="color:#F47067;">&lt;=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">10</span><span style="color:#ADBAC7;">; i</span><span style="color:#F47067;">++</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#ADBAC7;">    Thread.</span><span style="color:#DCBDFB;">sleep</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">3000</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">    System.out.</span><span style="color:#DCBDFB;">println</span><span style="color:#ADBAC7;">(i);</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span>
<span class="line"><span style="color:#768390;">// 释放锁</span></span>
<span class="line"><span style="color:#ADBAC7;">interProcessLock.</span><span style="color:#DCBDFB;">release</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// 写锁</span></span>
<span class="line"><span style="color:#ADBAC7;">InterProcessReadWriteLock</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">interProcessReadWriteLock</span><span style="color:#F47067;">=new</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">InterProcessReadWriteLock</span><span style="color:#ADBAC7;">(client, </span><span style="color:#96D0FF;">&quot;/lock1&quot;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#768390;">// 获取写锁对象</span></span>
<span class="line"><span style="color:#ADBAC7;">InterProcessLock</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">interProcessLock</span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;">interProcessReadWriteLock.</span><span style="color:#DCBDFB;">writeLock</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#768390;">// 获取锁</span></span>
<span class="line"><span style="color:#ADBAC7;">interProcessLock.</span><span style="color:#DCBDFB;">acquire</span><span style="color:#ADBAC7;">();</span></span>
<span class="line"><span style="color:#F47067;">for</span><span style="color:#ADBAC7;"> (</span><span style="color:#F47067;">int</span><span style="color:#F69D50;"> </span><span style="color:#ADBAC7;">i</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">; i </span><span style="color:#F47067;">&lt;=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">10</span><span style="color:#ADBAC7;">; i</span><span style="color:#F47067;">++</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#ADBAC7;">    Thread.</span><span style="color:#DCBDFB;">sleep</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">3000</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">    System.out.</span><span style="color:#DCBDFB;">println</span><span style="color:#ADBAC7;">(i);</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span>
<span class="line"><span style="color:#768390;">// 释放锁</span></span>
<span class="line"><span style="color:#ADBAC7;">interProcessLock.</span><span style="color:#DCBDFB;">release</span><span style="color:#ADBAC7;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 排他锁。arg1:连接对象，arg2:节点路径</span></span>
<span class="line"><span style="color:#24292E;">InterProcessLock interProcessLock </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">InterProcessMutex</span><span style="color:#24292E;">(client,</span><span style="color:#032F62;">&quot;/lock1&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#6A737D;">// 获取锁</span></span>
<span class="line"><span style="color:#24292E;">interProcessLock.</span><span style="color:#6F42C1;">acquire</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">; i </span><span style="color:#D73A49;">&lt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">; i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    Thread.</span><span style="color:#6F42C1;">sleep</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">3000</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(i);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">// 释放锁</span></span>
<span class="line"><span style="color:#24292E;">interProcessLock.</span><span style="color:#6F42C1;">release</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 读锁</span></span>
<span class="line"><span style="color:#24292E;">InterProcessReadWriteLock interProcessReadWriteLock</span><span style="color:#D73A49;">=new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">InterProcessReadWriteLock</span><span style="color:#24292E;">(client, </span><span style="color:#032F62;">&quot;/lock1&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#6A737D;">// 获取读锁对象</span></span>
<span class="line"><span style="color:#24292E;">InterProcessLock interProcessLock</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">interProcessReadWriteLock.</span><span style="color:#6F42C1;">readLock</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#6A737D;">// 获取锁</span></span>
<span class="line"><span style="color:#24292E;">interProcessLock.</span><span style="color:#6F42C1;">acquire</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">; i </span><span style="color:#D73A49;">&lt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">; i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    Thread.</span><span style="color:#6F42C1;">sleep</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">3000</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(i);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">// 释放锁</span></span>
<span class="line"><span style="color:#24292E;">interProcessLock.</span><span style="color:#6F42C1;">release</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 写锁</span></span>
<span class="line"><span style="color:#24292E;">InterProcessReadWriteLock interProcessReadWriteLock</span><span style="color:#D73A49;">=new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">InterProcessReadWriteLock</span><span style="color:#24292E;">(client, </span><span style="color:#032F62;">&quot;/lock1&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#6A737D;">// 获取写锁对象</span></span>
<span class="line"><span style="color:#24292E;">InterProcessLock interProcessLock</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">interProcessReadWriteLock.</span><span style="color:#6F42C1;">writeLock</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#6A737D;">// 获取锁</span></span>
<span class="line"><span style="color:#24292E;">interProcessLock.</span><span style="color:#6F42C1;">acquire</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">; i </span><span style="color:#D73A49;">&lt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">; i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    Thread.</span><span style="color:#6F42C1;">sleep</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">3000</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(i);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">// 释放锁</span></span>
<span class="line"><span style="color:#24292E;">interProcessLock.</span><span style="color:#6F42C1;">release</span><span style="color:#24292E;">();</span></span></code></pre></div><h2 id="zookeeper应用场景" tabindex="-1">zookeeper应用场景 <a class="header-anchor" href="#zookeeper应用场景" aria-label="Permalink to &quot;zookeeper应用场景&quot;">​</a></h2><p>  zooKeeper是一个经典的分布式数据一致性解决方案，致力于为分布式应用提供一个高性能、高可用，且具有严格顺序访问控制能力的分布式协调存储服务。Zookeeper 最常用的一个使用场景就是作为注册中心，生产者将自己提供的服务注册到 Zookeeper，然后消费者从 Zookeeper 中拿到生产者的服务列表信息，然后再去调用生产者的内容数据，比如 Dubbo，Kafka 都是使用 Zookeeper 作为注册中心的。</p><h3 id="维护配置信息" tabindex="-1">维护配置信息 <a class="header-anchor" href="#维护配置信息" aria-label="Permalink to &quot;维护配置信息&quot;">​</a></h3><p>  将公共的配置存放在Zookeeper的节点中，应用程序连接到Zookeeper中并对Zookeeper中配置节点进行读取或者修改（对于写操作可以进行权限验证设置） <img src="/charles-blog/assets/ManagerConfiguration.e12e1759.png" alt="ManagerConfiguration"></p><h3 id="分布式锁服务" tabindex="-1">分布式锁服务 <a class="header-anchor" href="#分布式锁服务" aria-label="Permalink to &quot;分布式锁服务&quot;">​</a></h3><ol><li>首先zookeeper中我们可以创建一个/distributed_lock持久化节点</li><li>然后再在/distributed_lock节点下创建自己的临时顺序节点，比如：/distributed_lock/task_00000000008</li><li>获取所有的/distributed_lock下的所有子节点，并排序</li><li>判读自己创建的节点是否最小值（第一位）</li><li>如果是，则获取得到锁，执行自己的业务逻辑，最后删除这个临时节点。</li><li>如果不是最小值，则需要监听自己创建节点前一位节点的数据变化，并阻塞。</li><li>当前一位节点被删除时，我们需要通过递归来判断自己创建的节点是否在是最小的，如果是则执行5）；如果不是则执行6）（就是递归循环的判断） <img src="/charles-blog/assets/DistributedLock.4bce9973.png" alt="DistributedLock"></li></ol><h3 id="分布式队列" tabindex="-1">分布式队列 <a class="header-anchor" href="#分布式队列" aria-label="Permalink to &quot;分布式队列&quot;">​</a></h3><ol><li>首先利用Zookeeper中临时顺序节点的特点</li><li>当生产者创建节点生产时，需要判断父节点下临时顺序子节点的个数，如果达到了上限，则阻塞等待；如果没有达到，就创建节点。</li><li>当消费者获取节点时，如果父节点中不存在临时顺序子节点，则阻塞等待；如果有子节点，则获取执行自己的业务，执行完毕后删除该节点即可。</li><li>获取时获取最小值，保证FIFO特性。</li></ol><h3 id="集群管理-负载均衡" tabindex="-1">集群管理（负载均衡） <a class="header-anchor" href="#集群管理-负载均衡" aria-label="Permalink to &quot;集群管理（负载均衡）&quot;">​</a></h3><p><img src="/charles-blog/assets/ClusterManagement.450ba21e.png" alt="ClusterManagement"></p><h3 id="生成分布式唯一id" tabindex="-1">生成分布式唯一ID <a class="header-anchor" href="#生成分布式唯一id" aria-label="Permalink to &quot;生成分布式唯一ID&quot;">​</a></h3></div></div></main><footer class="VPDocFooter" data-v-462c643b data-v-f6bde3e6><!--[--><!--]--><div class="edit-info" data-v-f6bde3e6><!----><div class="last-updated" data-v-f6bde3e6><p class="VPLastUpdated" data-v-f6bde3e6 data-v-cfcf869c>最后更新: <time datetime="2023-09-03T04:08:44.000Z" data-v-cfcf869c></time></p></div></div><div class="prev-next" data-v-f6bde3e6><div class="pager" data-v-f6bde3e6><a class="pager-link prev" href="/charles-blog/md/middleware/Rabbitmq.html" data-v-f6bde3e6><span class="desc" data-v-f6bde3e6>上一篇</span><span class="title" data-v-f6bde3e6>RabbitMQ</span></a></div><div class="has-prev pager" data-v-f6bde3e6><a class="pager-link next" href="/charles-blog/md/middleware/Arthas.html" data-v-f6bde3e6><span class="desc" data-v-f6bde3e6>下一篇</span><span class="title" data-v-f6bde3e6>Arthas</span></a></div></div></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"md_test_index.md\":\"a179ba4f\",\"md_test_lin_index.md\":\"706ea71f\",\"md_database_cache.md\":\"ee1e9375\",\"md_about_index.md\":\"4984c4d8\",\"md_database_elkstack.md\":\"ca5582c6\",\"md_distributed_singlesignon.md\":\"e9469380\",\"md_distributed_index.md\":\"85eafa6b\",\"md_environment_docker.md\":\"6d9d0c36\",\"md_environment_linux.md\":\"9e61f6d8\",\"md_environment_shell.md\":\"779c4602\",\"md_environment_index.md\":\"4e1f2168\",\"md_java_index.md\":\"8e3f7d5f\",\"md_test_child1.md\":\"6f9aed24\",\"md_test_zhu_index.md\":\"2c99a562\",\"md_java_javaunderlayer_hash.md\":\"e1bfbdd6\",\"md_java_javaother_lock.md\":\"1b11e871\",\"md_java_javaunderlayer_classloader.md\":\"a28e97d8\",\"md_java_spring_springboot.md\":\"5bba519d\",\"md_java_javaunderlayer_jvm.md\":\"4a6ccd9b\",\"md_java_javaweb_javaweb.md\":\"cc6cf75c\",\"md_java_mybatis_mybatis.md\":\"d9803a83\",\"md_java_mybatis_mybatisplus.md\":\"a46e638f\",\"md_java_spring_spring.md\":\"a80a4f49\",\"md_java_spring_springannotations.md\":\"89640029\",\"md_java_javaunderlayer_memoryleak.md\":\"0d57ac68\",\"md_network_conversationtechnolog.md\":\"f21c82a7\",\"md_network_dns.md\":\"7a6bd009\",\"md_middleware_index.md\":\"1c4b5f2c\",\"md_network_https.md\":\"1fbe42dd\",\"md_network_http.md\":\"fa7644b0\",\"md_network_ip.md\":\"b8f18932\",\"md_network_loadbalance.md\":\"1714c06e\",\"md_network_mac.md\":\"992dbcbd\",\"md_java_javaother_java8.md\":\"98624343\",\"md_network_model.md\":\"7a0f94c4\",\"md_network_networkdevices.md\":\"7a850f72\",\"md_network_tcp.md\":\"fcf7ac1f\",\"md_network_index.md\":\"09603bc1\",\"md_database_index.md\":\"8ef353e5\",\"md_database_redis.md\":\"2eb607ad\",\"index.md\":\"4503a516\",\"md_java_javaother_synchronized.md\":\"ee25ab08\",\"md_java_javaother_thread.md\":\"2ad6e1e2\",\"md_java_spring_springtransaction.md\":\"ef9c6d8a\",\"md_middleware_kafka.md\":\"3238de67\",\"md_java_javaother_designpatterns.md\":\"0858d58e\",\"md_java_javaother_javainterviewquestions.md\":\"e3e5f22f\",\"md_middleware_zookeeper.md\":\"7a7e70a5\",\"md_database_oracle.md\":\"7147de3e\",\"md_middleware_jms.md\":\"ac6f5658\",\"md_database_mongodb.md\":\"ed78548e\",\"md_middleware_rabbitmq.md\":\"17ee6046\",\"md_middleware_activemq.md\":\"45ec1a9b\",\"md_database_mysql.md\":\"c1f317d9\",\"md_java_javaunderlayer_gc.md\":\"8b102f85\",\"md_middleware_arthas.md\":\"ed6d7630\",\"md_java_spring_springmvc.md\":\"d3ce0b21\",\"md_middleware_nginx.md\":\"2bf5bd09\",\"md_java_javaother_regularexpression.md\":\"dbb63f3f\"}")
__VP_SITE_DATA__ = JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"小朱杂记\",\"description\":\"My Document\",\"base\":\"/charles-blog/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Java\",\"link\":\"/md/java/\",\"activeMatch\":\"/md/java/\"},{\"text\":\"数据库\",\"link\":\"/md/database/\",\"activeMatch\":\"/md/database/\"},{\"text\":\"中间件\",\"link\":\"/md/middleware/\",\"activeMatch\":\"/md/middleware/\"},{\"text\":\"网络\",\"link\":\"/md/network/\",\"activeMatch\":\"/md/network/\"},{\"text\":\"环境\",\"link\":\"/md/environment/\",\"activeMatch\":\"/md/environment/\"},{\"text\":\"分布式\",\"link\":\"/md/distributed/\",\"activeMatch\":\"/md/distributed/\"},{\"text\":\"关于我\",\"link\":\"/md/about/\"}],\"sidebar\":{\"/md/java/\":[{\"text\":\"Java\",\"link\":\"/md/java/\",\"items\":[{\"text\":\"Spring \",\"collapsed\":true,\"items\":[{\"text\":\"Spring杂叙\",\"link\":\"/md/java/spring/Spring\"},{\"text\":\"SpringMvc\",\"link\":\"/md/java/spring/SpringMVC\"},{\"text\":\"SpringBoot\",\"link\":\"/md/java/spring/SpringBoot\"},{\"text\":\"Spring事务\",\"link\":\"/md/java/spring/SpringTransaction\"},{\"text\":\"Spring注解\",\"link\":\"/md/java/spring/SpringAnnotations\"}]},{\"text\":\"Java底层\",\"collapsed\":true,\"items\":[{\"text\":\"JVM\",\"link\":\"/md/java/javaUnderlayer/JVM\"},{\"text\":\"GC\",\"link\":\"/md/java/javaUnderlayer/GC\"},{\"text\":\"内存泄漏\",\"link\":\"/md/java/javaUnderlayer/MemoryLeak\"},{\"text\":\"哈希(Hash)\",\"link\":\"/md/java/javaUnderlayer/Hash\"},{\"text\":\"类加载器\",\"link\":\"/md/java/javaUnderlayer/ClassLoader\"}]},{\"text\":\"JavaWeb\",\"collapsed\":true,\"items\":[{\"text\":\"JavaWeb杂叙\",\"link\":\"/md/java/javaWeb/JavaWeb\"}]},{\"text\":\"Java其他\",\"collapsed\":true,\"items\":[{\"text\":\"Java8\",\"link\":\"/md/java/javaOther/Java8\"},{\"text\":\"锁\",\"link\":\"/md/java/javaOther/Lock\"},{\"text\":\"Synchronized\",\"link\":\"/md/java/javaOther/Synchronized\"},{\"text\":\"浅谈设计模式\",\"link\":\"/md/java/javaOther/DesignPatterns\"},{\"text\":\"进程，线程，线程池，调度\",\"link\":\"/md/java/javaOther/Thread\"},{\"text\":\"正则表达式\",\"link\":\"/md/java/javaOther/RegularExpression\"},{\"text\":\"Java面试题\",\"link\":\"/md/java/javaOther/JavaInterviewQuestions\"}]},{\"text\":\"Mybatis\",\"collapsed\":true,\"items\":[{\"text\":\"Mybatis杂叙\",\"link\":\"/md/java/mybatis/Mybatis\"},{\"text\":\"Mybatis-Plus\",\"link\":\"/md/java/mybatis/MybatisPlus\"}]}]}],\"/md/database/\":[{\"text\":\"数据库\",\"link\":\"/md/database/\",\"items\":[{\"text\":\"MySQL\",\"link\":\"/md/database/Mysql\"},{\"text\":\"Oracle\",\"link\":\"/md/database/Oracle\"},{\"text\":\"Redis\",\"link\":\"/md/database/Redis\"},{\"text\":\"ELK Stack\",\"link\":\"/md/database/ElkStack\"},{\"text\":\"MongoDB\",\"link\":\"/md/database/MongoDB\"},{\"text\":\"缓存\",\"link\":\"/md/database/Cache\"}]}],\"/md/network/\":[{\"text\":\"网络\",\"link\":\"/md/network/\",\"items\":[{\"text\":\"网络模型\",\"link\":\"/md/network/Model\"},{\"text\":\"HTTP\",\"link\":\"/md/network/Http\"},{\"text\":\"HTTPS\",\"link\":\"/md/network/Https\"},{\"text\":\"TCP\",\"link\":\"/md/network/Tcp\"},{\"text\":\"IP\",\"link\":\"/md/network/Ip\"},{\"text\":\"MAC\",\"link\":\"/md/network/Mac\"},{\"text\":\"DNS\",\"link\":\"/md/network/Dns\"},{\"text\":\"会话技术\",\"link\":\"/md/network/ConversationTechnolog\"},{\"text\":\"常见的网络设备\",\"link\":\"/md/network/NetworkDevices\"},{\"text\":\"负载均衡\",\"link\":\"/md/network/LoadBalance\"}]}],\"/md/environment/\":[{\"text\":\"环境\",\"link\":\"/md/environment/\",\"items\":[{\"text\":\"Linux\",\"link\":\"/md/environment/Linux\"},{\"text\":\"Shell\",\"link\":\"/md/environment/Shell\"},{\"text\":\"Docker\",\"link\":\"/md/environment/Docker\"}]}],\"/md/distributed/\":[{\"text\":\"分布式\",\"items\":[{\"text\":\"单点登陆\",\"link\":\"/md/distributed/SingleSignOn\"},{\"text\":\"分布式系统\",\"link\":\"/md/distributed/\"}]}],\"/md/middleware/\":[{\"text\":\"中间件\",\"link\":\"/md/middleware/\",\"items\":[{\"text\":\"Nginx\",\"link\":\"/md/middleware/Nginx\"},{\"text\":\"RabbitMQ\",\"link\":\"/md/middleware/Rabbitmq\"},{\"text\":\"Zookeeper\",\"link\":\"/md/middleware/Zookeeper\"},{\"text\":\"Arthas\",\"link\":\"/md/middleware/Arthas\"},{\"text\":\"JMS\",\"link\":\"/md/middleware/Jms\"},{\"text\":\"ActiveMQ\",\"link\":\"/md/middleware/ActiveMq\"},{\"text\":\"Kafka\",\"link\":\"/md/middleware/Kafka\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/CharleZhuJJ/charles-blog\"}],\"outline\":{\"level\":\"deep\",\"label\":\"目录\"},\"darkModeSwitchLabel\":\"切换日光/暗黑模式\",\"sidebarMenuLabel\":\"文章\",\"returnToTopLabel\":\"返回顶部\",\"lastUpdatedText\":\"最后更新\",\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"},\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}")</script>
    
  </body>
</html>